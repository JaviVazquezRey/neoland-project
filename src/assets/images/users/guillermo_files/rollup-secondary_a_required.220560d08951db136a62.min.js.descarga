(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[421,39,122],{101:function(e,t,n){var r=n(109)("keys");var i=n(91);e.exports=function(e){return r[e]||(r[e]=i(e))}},109:function(e,t,n){var r=n(46);var i="__core-js_shared__";var a=r[i]||(r[i]={});e.exports=function(e){return a[e]||(a[e]={})}},110:function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},111:function(e,t){t.f={}.propertyIsEnumerable},114:function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},115:function(e,t,n){var r=n(68);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},119:function(e,t,n){var r=n(58).f;var i=n(60);var a=n(43)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:true,value:t})}},120:function(e,t,n){var r=n(96);e.exports=function(e){return Object(r(e))}},125:function(e,t,n){"use strict";var r=n(208)(true);n(155)(String,"String",function(e){this._t=String(e);this._i=0},function(){var e=this._t;var t=this._i;var n;if(t>=e.length)return{value:void 0,done:true};n=r(e,t);this._i+=n.length;return{value:n,done:false}})},126:function(e,t,n){var r=n(68);var i=n(46).document;var a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},127:function(e,t){e.exports=true},132:function(e,t){t.f=Object.getOwnPropertySymbols},133:function(e,t,n){var r=n(114);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},136:function(e,t,n){e.exports=!n(56)&&!n(73)(function(){return 7!=Object.defineProperty(n(126)("div"),"a",{get:function(){return 7}}).a})},137:function(e,t,n){var r=n(60);var i=n(66);var a=n(182)(false);var s=n(101)("IE_PROTO");e.exports=function(e,t){var n=i(e);var o=0;var l=[];var u;for(u in n)u!=s&&r(n,u)&&l.push(u);while(t.length>o)r(n,u=t[o++])&&(~a(l,u)||l.push(u));return l}},146:function(e,t,n){var r=n(181);e.exports=function(e,t,n){r(e);if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},148:function(e,t,n){n(220);var r=n(46);var i=n(64);var a=n(80);var s=n(43)("toStringTag");var o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(",");for(var l=0;l<o.length;l++){var u=o[l];var d=r[u];var c=d&&d.prototype;c&&!c[s]&&i(c,s,u);a[u]=a.Array}},154:function(e,t,n){var r=n(95);var i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},155:function(e,t,n){"use strict";var r=n(127);var i=n(86);var a=n(168);var s=n(64);var o=n(60);var l=n(80);var u=n(209);var d=n(119);var c=n(205);var _=n(43)("iterator");var m=!([].keys&&"next"in[].keys());var f="@@iterator";var p="keys";var h="values";var g=function(){return this};e.exports=function(e,t,n,S,T,v,b){u(n,t,S);var y=function(e){if(!m&&e in C)return C[e];switch(e){case p:return function t(){return new n(this,e)};case h:return function t(){return new n(this,e)}}return function t(){return new n(this,e)}};var w=t+" Iterator";var k=T==h;var x=false;var C=e.prototype;var I=C[_]||C[f]||T&&C[T];var M=!m&&I||y(T);var A=T?k?y("entries"):M:void 0;var E="Array"==t&&C.entries||I;var P,F,O;if(E){O=c(E.call(new e));if(O!==Object.prototype&&O.next){d(O,w,true);r||o(O,_)||s(O,_,g)}}if(k&&I&&I.name!==h){x=true;M=function e(){return I.call(this)}}r&&!b||!m&&!x&&C[_]||s(C,_,M);l[t]=M;l[w]=g;if(T){P={values:k?M:y(h),keys:v?M:y(p),entries:A};if(b)for(F in P)F in C||a(C,F,P[F]);else i(i.P+i.F*(m||x),t,P)}return P}},156:function(e,t,n){t.f=n(43)},157:function(e,t,n){var r=n(46);var i=n(52);var a=n(127);var s=n(156);var o=n(58).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:s.f(e)})}},163:function(e,t,n){var r=n(71);var i=n(204);var a=n(110);var s=n(101)("IE_PROTO");var o=function(){};var l="prototype";var u=function(){var e=n(126)("iframe");var t=a.length;var r="<";var i=">";var s;e.style.display="none";n(210).appendChild(e);e.src="javascript:";s=e.contentWindow.document;s.open();s.write(r+"script"+i+"document.F=Object"+r+"/script"+i);s.close();u=s.F;while(t--)delete u[l][a[t]];return u()};e.exports=Object.create||function e(t,n){var a;if(null!==t){o[l]=r(t);a=new o;o[l]=null;a[s]=t}else a=u();return void 0===n?a:i(a,n)}},168:function(e,t,n){e.exports=n(64)},181:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},182:function(e,t,n){var r=n(66);var i=n(154);var a=n(183);e.exports=function(e){return function(t,n,s){var o=r(t);var l=i(o.length);var u=a(s,l);var d;if(e&&n!=n)while(l>u){d=o[u++];if(d!=d)return true}else for(;l>u;u++)if((e||u in o)&&o[u]===n)return e||u||0;return!e&&-1}}},183:function(e,t,n){var r=n(95);var i=Math.max;var a=Math.min;e.exports=function(e,t){e=r(e);return e<0?i(e+t,0):a(e,t)}},191:function(e,t,n){var r=n(137);var i=n(110).concat("length","prototype");t.f=Object.getOwnPropertyNames||function e(t){return r(t,i)}},192:function(e,t,n){var r=n(114);var i=n(43)("toStringTag");var a="Arguments"==r(function(){return arguments}());var s=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),i))?n:a?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},1980:function(e,t){(function(){TS.registerModule("enterprise",{onStart:function e(){if(!TS.boot_data.page_needs_enterprise)return;TS.client&&TS.interop.environment.isSSBAndAtLeastVersion("2.7")&&TS.redux.socket.connectedSig.add(t)},promiseToSearchEnterpriseChannels:function t(i){var a=i.query,s=i.count;if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return Promise.resolve();var o=!!a;r(!o);var l=n({query:a,count:s});if(!l)return Promise.resolve();var u=TS.interop.api.callExpedited("enterprise.channels.search",l).then(function(t){_.get(t,"data.channels",[]).forEach(function(t){e[t.id]||(e[t.id]=t)})}).catch(_.noop);return o?u:new Promise(function(e){return u.then(e)})},getChannelById:function t(n){var r=e[n];return r&&!r.is_group?r:null},getGroupById:function t(n){var r=e[n];return r&&r.is_group?r:null},getChannels:function t(){if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return[];return _.reject(e,"is_group")},getGroups:function t(){if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return[];return _.filter(e,"is_group")},getModelObById:function e(t){var n=false;if(!TS.boot_data.page_needs_enterprise)return TS.redux.channels.getEntityById(t,n);return TS.enterprise.getChannelById(t)||TS.enterprise.getGroupById(t)||TS.redux.channels.getEntityById(t,n)},isCrossWorkspacePrototypeEnabled:function e(){return TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_enterprise_frecency&&TS.boot_data.feature_cross_workspace_quick_switcher_prototype},updateMenuWithName:function e(t){var n=$(".team_menu.slack_menu");n.find(".slack_menu_header .current_team_name").text(t);n.find(".menu_list .enterprise_logout_url a strong").text(t);$(".enterprise-name").text(t)}});var e={};var t=function e(t){if(t)return;if(!TS.shared.isRelevantTeam())return;var n=TS.interop.desktop.getSignedInTeamIds();var r=_.get(n,"length");var i=20;if(!r)return TS.warn("WTF did not find any teams in the desktop?");if(r>=i)return TS.warn("Will not auto add any more teams to the desktop.");var a=TS.prefs.getPref("enterprise_excluded_app_teams");var s=a?a.split(","):[];var o=_.difference(_.get(TS.model,"user.enterprise_user.teams",[]),n,s).slice(0,i-r);_.map(o,function(e){return TS.client.userAddedToTeam(e)})};var n=function e(t){var n=t.query,r=t.count;if(n)return{query:n,count:r};var i=100;var a="C";var s="G";var o=false;var l=_(TS.ui.frecency.getMostCommonWithPrefix(a)).map("id").reject(function(e){return TS.redux.channels.getEntityById(e,o)}).value().slice(0,i);var u=_(TS.ui.frecency.getMostCommonWithPrefix(s)).map("id").reject(function(e){return TS.redux.channels.getEntityById(e,o)}).value().slice(0,i);var d=l.concat(u);if(d.length)return{channels:d,count:d.length};return null};var r=function t(n){n&&(e={})}})()},1988:function(e,t,n){"use strict";n.r(t);var r=n(40);var i=n.n(r);var a=n(67);var s=n.n(a);(function(){TS.registerModule("utility",{onStart:function e(){TS.utility.makeRefererSafeLink=_.memoize(TS.utility.makeRefererSafeLink);TS.interop.Flannel.useSocket()&&TS.redux.socket.connectedSig.add(TS.utility.resetRefererSafeLinkCache);TS.prefs&&TS.prefs.team_hide_referers_changed_sig&&TS.prefs.team_hide_referers_changed_sig.add(TS.utility.resetRefererSafeLinkCache);t=TS.interop.i18n.t("me","utility")();n=TS.interop.i18n.t("you","utility")();S=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/files");T=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/team")},keymap:{alt:18,ctrl:17,cmd_ff:224,cmd_other:91,cmd_right:93,esc:27,shift:16,tab:9,del:8,delete:46,enter:13,left:37,up:38,right:39,down:40,pageup:33,pagedown:34,end:35,home:36,space:32,semicolon:59,equals_sign:187,minus_sign:189,comma:188,period:190,left_square_bracket:219,right_square_bracket:221,V:86,a:65,e:69,b:66,k:75,i:73,z:90,y:89,insert:45,slash:191,f6:117},email_regex:new RegExp("^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i"),regexpEscape:function e(t,n){n=Math.min(n||5e5,5e5);t.length>n&&(t=t.slice(0,n));return _.escapeRegExp(t)},ensureInArray:function e(t,n){if(t.indexOf(n)>-1)return false;t.push(n);return true},makeComparableVersion:function e(t){var n=t.split("-")[0];return _.reduce(n.split("."),function(e,t){return 1e3*e+parseInt(t,10)},0)},compareSemanticVersions:function e(t,n){var r=TS.utility.makeComparableVersion(t);var i=TS.utility.makeComparableVersion(n);if(r===i)return 0;return r>i?1:-1},isAppVersionBefore:function e(t){if(!TS.model.is_our_app){if("dev"===TS.boot_data.version_ts)throw new Error("Cannot check app version because we are not in the app, silly goose.");return false}return-1===TS.utility.compareSemanticVersions(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch,t)},doRectsOverlap:function e(t,n){return!(n.left>t.right||n.right<t.left||n.top>t.bottom||n.bottom<t.top)},doesRectContainRect:function e(t,n,r,i){r=r||0;if(n.top<t.top-r)return false;if(n.bottom>t.bottom+r)return false;if(i)return true;if(n.left<t.left-r)return false;if(n.right>t.right+r)return false;return true},shouldLinksHaveTargets:function e(){return!!(TS.client||TS.web&&TS.web.space)},parseJSONOrElse:function e(t,n){if(""===t)return n;try{return JSON.parse(t)}catch(e){return n}},stringifyJSONOrElse:function e(t,n,r,i){try{return JSON.stringify(t,n,r)}catch(e){if("function"===typeof i)return i(e);return i}},ordinalNumber:function e(t){return TS.interop.i18n.t("{number_str, selectordinal, one{#st}two{#nd}few{#rd}other{#th}}","utilities")({number_str:t.toString()})},getTeamUrl:function e(){return T},getHistoryRetryDelay:function e(t,n){t=_.isInteger(t)?t:1;var r=2500;var i=5e3;var a=_.random(r,i);if("fatal_error"===n){var s=1.3;a*=Math.pow(s,t)}return a},getChannelNameFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r="messages"==n[0]||"archives"==n[0];if(!r)return"";return decodeURIComponent(n[1])},getMessageTimestampFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r="messages"==n[0]||"archives"==n[0];if(!r)return"";var i=n[2];if(!i||"p"!=i[0]||17!=i.length)return"";i=i.substr(1,10)+"."+i.substr(11);return decodeURIComponent(i)},getHCAttributionQS:function e(){return TS.boot_data.hc_tracking_qs},getFlexPartsFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r={messages:true,archives:true}[n[0]];var i=r?2:1;return n.slice(i)},getFlexNameFromUrl:function e(t){var n=TS.utility.getFlexPartsFromUrl(t)[0];if(!n)return"";return decodeURIComponent(n)},getFlexExtraFromUrl:function e(t){var n=TS.utility.getFlexPartsFromUrl(t)[1];if(!n)return"";return decodeURIComponent(n).replace(/%2F/g,"/")},getFlexExtraTypeFromUrl:function e(t){var n=TS.utility.getFlexPartsFromUrl(t)[2];if(!n)return"";return decodeURIComponent(n).replace(/%2F/g,"/")},removeUrlParam:function e(t,n){var r=n.split("?")[0];var i=-1!==n.indexOf("?")?n.split("?")[1]:"";var a=[];var s;if(""!==i){a=i.split("&");for(var o=a.length-1;o>=0;o-=1){s=a[o].split("=")[0];s===t&&a.splice(o,1)}r=a.length?r+"?"+a.join("&"):r}return r},isUnreadViewPath:function e(t){return 0===t.indexOf("/unreads")},isThreadsViewPath:function e(t){return 0===t.indexOf("/threads")},isAppSpaceViewPath:function e(t){return 0===t.indexOf("/app-space")},isSearchViewPath:function e(t){return 0===t.indexOf("/search")},isSlackUrl:function e(t){return p.test(t)},getPathFromSlackUrl:function e(t){var n=t.match(p);var r=n&&n[2];if(!r)return;var i=t.split(r);var a=i[1].split("?")[0];return(r+a).split("/")},getTeamFromSlackUrl:function e(t){var n=t.match(p);var r=n&&n[1];return r},refashionUrl:function e(t,n,r,i){var a=document.createElement("a");a.href=t;var o=a.pathname.slice(1).split("/").slice(0,2),l=s()(o,2),u=l[0],d=l[1];a.pathname=_.compact([n||"/"+u+"/"+d,r,i]).join("/");"/"!==a.pathname[a.pathname.length-1]&&(a.pathname+="/");return a.toString()},dataURItoBlob:function e(t){return TS.utility.base64StrtoBlob(TS.utility.base64StrFromDataURI(t))},base64StrFromDataURI:function e(t){return t.split(",")[1]},base64StrtoBlob:function e(t){var n=atob(t);var r=new ArrayBuffer(n.length);var i=new Uint8Array(r);for(var a=0;a<n.length;a+=1)i[a]=n.charCodeAt(a);var s=new DataView(r);var o=new Blob([s]);return o},ellipsize:function e(t,n){if(!t)return t;n&&parseInt(n,10)||(n=50);if(t.length>n){var r=t.substr(0,n/2);var i=t.substr(-n/2,t.length);t=r+"..."+i}return t},makeSafeForDomId:function e(t){return String(t).replace(/\./g,"_")},makeSafeForDomClass:function e(t){return t.replace(/\s/g,"_")},getImageIconClass:function e(t,n){var r=n;var i=80;var a=80;t&&(t.thumb_360_w<i||t.thumb_360_h<a)&&(r=t.thumb_360_w>t.thumb_360_h?"landscape":t.thumb_360_w<t.thumb_360_h?"portrait":"square");return r},getAppliedClasses:function e(t){return _.reduce(t,function(e,t,n){t&&e.push(n);return e},[]).join(" ")},numberWithK:function e(t){if(t>999){t=Math.round(t/1e3*10)/10;return(TS.interop.i18n.number(t)||"")+"K"}return TS.interop.i18n.number(t)||""},cleanChannelName:function e(t){var n=XRegExp("[^\\pL\\pM\\pN_-]+","g");var r=XRegExp("[\\pM\\pM\\pM]","g");var i=/^[-_]+?$/;t=t.toLowerCase();t=t.replace(/^#+/g,"");t=t.replace(/ /g,"-");t=t.replace(n,"_");t=t.replace(/-+/g,"-");t=t.replace(/_+/g,"_");if(i.test(t)||r.test(t))return null;return t},openInNewTab:function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.dontEncodeHash,a=void 0!==i&&i;if(0===t.indexOf("/")&&TS.boot_data.team_url){var s=TS.boot_data.team_url;s=s.substr(0,s.length-1);t=s+t}var o=t;var l="";var u=o.indexOf("?");var d=TS.utility.urlNeedsRefererHiding(t);if(-1!==u){d&&(t=_.escape(t.substring(0,u)));var c=o.substring(u+1,o.length);o=o.substring(0,u);if(c.length){var m=TS.interop.url.queryStringParse(c);var f=TS.interop.url.parseUrl(t);var p=false;f&&"accounts.google.com"==f.hostname&&"/o/oauth2/auth"==f.pathname&&(p=true);_.forEach(m,function(e,n){if(d){t=TS.interop.url.setUrlQueryStringValue(t,n,e||"",p);a&&(t=t.replace("%23","#"))}else l+='<input type="hidden" name="'+_.escape(n)+'" value="'+_.escape(e||"")+'">'})}}if(d){l='<input type="hidden" name="url" value="'+_.escape(t)+'">';o="https://"+TS.boot_data.redir_domain+"/link"}$("<form>"+l+"</form>").attr({method:"GET",action:o,target:n}).appendTo("body").submit().remove()},isScalar:function e(t){return/boolean|number|string/.test("undefined"===typeof t?"undefined":i()(t))},sanitizeHTML:function t(n,r,i,a){var s=function e(t){var n=t.tagName.toLowerCase();if(r.indexOf(n)<0)return null;Array.prototype.slice.apply(t.attributes).forEach(function(e){i.indexOf(e.name)<0&&t.attributes.removeNamedItem(e.name)});Array.prototype.slice.apply(t.children).forEach(function(n){var r=e(n);r||t.removeChild(n)});return t};e=e||new DOMParser;var o=e.parseFromString(n,"text/html")||e.parseFromString(n,"text/xml");var l=o.body;if(1!=l.children.length)return"";var u=s(l.children[0]);l=null;o=null;if(u)return a?u:u.outerHTML;return""},getChildTextNodes:function e(t){var n=[];if(!t)return n;if(t instanceof Text){n.push(t);return n}var r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,false);var i=r.nextNode();while(i){n.push(i);i=r.nextNode()}return n},getAttributesFromHTMLString:function t(n){e=e||new DOMParser;var r=e.parseFromString(n,"text/html")||e.parseFromString(n,"text/xml");var i=r.body;if(1!=i.children.length)return{};var a={};[].slice.apply(i.children[0].attributes).forEach(function(e){a[e.name]=e.value});i=null;r=null;return a},linkify:function e(t,n,r,i){if(!t)return t;t=t.replace(TS.interop.url.URL_REGEXP,function(e){var t;if(0===e.toLowerCase().indexOf("www.")){if(!r)return e;t="http://"+e}else t=e;if(i)return"<"+t+"|"+e+">";return"<a "+TS.utility.makeRefererSafeLink(t)+' target="'+(n||"")+'">'+e+"</a>"});return t},linkifyInternal:function e(t,n){return TS.utility.linkify(t,"",n,true)},preg_quote:function e(t){return(""+t).replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},getActiveElementProp:function e(t){if(!document.activeElement)return"";if("NODENAME"===t){if(!document.activeElement.nodeName)return"";return document.activeElement.nodeName.toUpperCase()}return document.activeElement[t]},isTabCompleteShowing:function e(){if($("#chat_input_tab_ui").length)return true;return false},isFocusOnInput:function e(){return TS.interop.utility.isInputElement(document.activeElement)},unformatTopicOrPurpose:function e(t){return TS.format.unFormatMsg(t)},formatTopicOrPurpose:function e(t,n){t=TS.format.formatWithOptions(t,{},{no_preformatted:!!n});t=t.replace(/(<br[^>]*>)/,'<span class="hidden br_ellipsis">\u2026</span>$1');return t},removeLinksFromTabFlow:function e(t){return t.replace(h,'$1 tabindex="-1"$2')},populateInput:function e(t,n,r){n||(n="");var i=$(t);TS.utility.contenteditable.value(i,n);_.isNumber(r)&&TS.utility.contenteditable.cursorPosition(i,r)},populateThreadInputs:function e(t,n,r){TS.ui.replies.activeConvoModelId()===n&&TS.ui.replies.activeConvoThreadTs()===r&&TS.ui.replies.populateReplyInput(t);TS.model.threads_view_is_showing&&TS.ui.thread.findAndPopulateInput(t,n,r)},urlNeedsRefererHiding:function e(t){if(!t)return false;t=t.toLowerCase();if(0!==t.indexOf("https://")&&0!==t.indexOf("http://")&&0!==t.indexOf("ftp://")&&0!==t.indexOf("sftp://"))return false;var n=true;var r=TS.interop.url.getHostName(t,n);var i=getRefererHidingWhiteList();if(i&&i.indexOf&&-1!==i.indexOf(r))return false;return true},referer_safe_url_map:{},makeRefererSafeLink:function e(t){if("string"!==typeof t){TS.error("Expected url to be a string, got: "+("undefined"===typeof t?"undefined":i()(t)));return}t=TS.format.replaceHighlightMarkers(t);f(t);var n=t.replace(/&amp;/g,"&");n.match(/javascript(:|&colon;)/gi)&&(n="#");var r=true;var a=TS.utility.sanitizeHTML('<a href="'+n+'"></a>',["a"],["href"],r)||null;a&&(n=a.href);n=_.escape(n).replace(/&amp;/g,"&").replace(/(%27|&#39;)/g,"'");t&&t.lastIndexOf("/")!==t.length-1&&n&&n.lastIndexOf("/")===n.length-1&&(n=n.slice(0,-1));n=n||"#";var s='href="'+n+'"';var l="onclick";var u=o();TS.model&&TS.model.is_our_app||u&&u.rewrite_on_right_click&&(l="onmousedown");if(!TS.utility.urlNeedsRefererHiding(t))return s;if(TS.utility.externalURLsNeedRedirecting()){var d=encodeURIComponent(n);var c="https://"+TS.boot_data.redir_domain+"/link?url="+d+(u&&u.redirect_type?"&v="+u.redirect_type:"");var m="url-"+Math.random()+"-"+performance.now();TS.utility.referer_safe_url_map[m]=n;s+=' data-referer-safe="1" '+l+'="this.href=&quot;'+c+'&quot;" onmouseover="this.href=TS.utility.referer_safe_url_map[&quot;'+m+'&quot;]" data-referer-original-href="'+n+'" rel="noreferrer"'}else s+=' rel="noreferrer"';return s},resetRefererSafeLinkCache:function e(){TS.utility.makeRefererSafeLink&&TS.utility.makeRefererSafeLink.cache&&TS.utility.makeRefererSafeLink.cache.clear()},makeSureAllExternalLinksAreRefererSafe:function e(t){var n=Date.now();var r=[];if(TS.utility.externalURLsNeedRedirecting()){t.find("a[href]:not([data-referer-safe])").each(function(){var e=$(this);var t=e.attr("href");if(!TS.utility.urlNeedsRefererHiding(t))return;r.push(this.outerHTML);e.removeAttr("href");var n=this.outerHTML.replace("<a",function(){return"<a "+TS.utility.makeRefererSafeLink(t)+" "});e.replaceWith(n);r[r.length-1]+="\n->\n"+n});if(TS.model&&TS.model.team&&TS.has_pri[g]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(g,"#"+t.attr("id")+" had "+r.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to fix it took "+(Date.now()-n)+"ms");TS.dir(g,r)}else TS.log(g,"#"+t.attr("id")+" had "+r.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to check it took "+(Date.now()-n)+"ms")}else{t.find("a[href]:not([rel])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){if(TS.utility.urlNeedsRefererHiding(t)){r.push(this.outerHTML);e.attr("rel","noreferrer");r[r.length-1]+="\n->\n"+this.outerHTML}}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[g]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(g,"#"+t.attr("id")+" had "+r.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to add rel it took '+(Date.now()-n)+"ms");TS.dir(g,r)}else TS.log(g,"#"+t.attr("id")+" had "+r.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to check it took '+(Date.now()-n)+"ms")}},makeSureAllLinksHaveTargets:function e(t){var n=Date.now();var r=[];t.find("a[href]:not([target])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){r.push(this.outerHTML);e.attr("target",t);r[r.length-1]+="\n->\n"+this.outerHTML}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[g]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(g,"#"+t.attr("id")+" had "+r.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to add targets it took "+(Date.now()-n)+"ms");TS.dir(g,r)}else TS.log(g,"#"+t.attr("id")+" had "+r.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to check it took "+(Date.now()-n)+"ms");TS.utility.makeSureAllExternalLinksAreRefererSafe(t)},sortTable:function e(t,n,r,i,a){r="desc"===r?"desc":"asc";a="desc"===a?"desc":"asc";function s(e){return function(t,n){var s=o(t,e);var l=o(n,e);if($.isNumeric(s)&&$.isNumeric(l)){if(s==l&&i){s=o(t,i);l=o(n,i);if($.isNumeric(s)&&$.isNumeric(l)){if(a!=r)return l-s;return s-l}if(a!=r)return TS.interop.i18n.sorter(l,s);return TS.interop.i18n.sorter(s,l)}return s-l}return TS.interop.i18n.sorter(s,l)}}function o(e,t){return $(e).children("td").eq(t).attr("data-sort-val")}var l=t.find("tr:gt(0)").toArray().sort(s(n));"desc"===r&&(l=l.reverse());for(var u=0;u<l.length;u+=1)t.append(l[u])},getPercSmartly:function e(t,n){if(!t||!n)return"0%";var r=t/n*100;if(100!=r&&100==Math.round(r))return"99%";if(r<.7)return"<1%";return Math.round(r)+"%"},isCursorWithinTBTs:function e(t){var n=TS.utility.contenteditable.cursorPosition(t);var r=TS.utility.contenteditable.value(t);var i=r.substr(0,n.end);var a=i.match(/```/g);if(!a)return false;var s=a.length;if(s%2)return true;return false},hex2rgb:function e(t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:void 0},rgb2hex:function e(t){if(/^#[0-9A-F]{6}$/i.test(t))return t;var n=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);n||(n=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)\)$/));if(!n)return;function r(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}return"#"+r(n[1])+r(n[2])+r(n[3])},setImmediate:function e(t){u(t)},immediateDebounce:function e(t){var n=false;return function(){if(n)return;var e=this;var r=arguments;n=true;u(function(){n=false;t.apply(e,r)})}},debounce:function e(t,n){var r;return function(){var e=this;var i=arguments;clearTimeout(r);r=setTimeout(function(){t.apply(e,i)},n)}},debounceWithPromise:function e(t,n){var r;return function(){var e=this;var i=arguments;r&&r.cancel();r=new Promise(function(e){setTimeout(e,n)}).then(function(){return t.apply(e,i)});return r}},throttleFunc:function e(t,n,r){var i={};var a=function e(){var r=Array.prototype.slice.apply(arguments);var a=_.some(r,_.isObject);a&&TS.error("You're passing non-scalar arguments to a function throttled with TS.utility.throttleFunc; it will likely not work as you want");var s="f-"+r.join("-");if(i[s]&&i[s].context!==this)throw new Error("Cannot use this function with different `this` contexts across different calls "+this+" "+i[s].context);i[s]=i[s]||{requested:Date.now(),timeout:0,context:this};i[s].timeout||e.always_wait?i[s].requested=Date.now():t.apply(i[s].context,r);if(i[s].timeout)return;i[s].timeout=setTimeout(function e(){var a=Date.now()-i[s].requested;if(a>=n){t.apply(i[s].context,r);delete i[s]}else i[s].timeout=setTimeout(e,n-a)},n)};a.always_wait=!!r;return a},looksLikeKeyboardShortcut:function e(t){var n=t.ctrlKey||t.altKey||t.metaKey;if(!n)return false;if(t.keyCode===TS.utility.keymap.alt||t.keyCode===TS.utility.keymap.ctrl||t.keyCode===TS.utility.keymap.cmd_ff||t.keyCode===TS.utility.keymap.cmd_other||t.keyCode===TS.utility.keymap.cmd_right)return false;var r=String.fromCharCode(t.keyCode);if(/^(\w|[$-\/:-?{-~!"^_`[\]])$/i.test(r))return true;return true},isForwardDeleteKey:function e(t){if(t.keyCode===TS.utility.keymap.delete)return true;if(TS.model.is_mac&&t.ctrlKey&&"d"===t.key)return true;return false},throttle:function(){var e;var t;e={delay:200,timer_group:"generic"};t={timers:{},queues:{}};function n(e){var n;var r;if(t.timers[e]){if(t.queues[e])for(n=0,r=t.queues[e].length;n<r;n+=1)t.queues[e][n]&&t.queues[e][n]();t.queues[e]=null;t.timers[e]=null}}function r(r,i,a){if(!r)return false;i=i||e.timer_group;if(!t.timers[i]){a=a||e.delay;t.timers[i]=window.setTimeout(function(){n(i)},a)}t.queues[i]||(t.queues[i]=[]);t.queues[i].indexOf?-1===t.queues[i].indexOf(r)&&t.queues[i].push(r):t.queues[i].push(r)}return{method:r}}(),getImgProxyURL:function e(t,n,r){return TS.utility.getImgProxyURLWithOptions(t,{width:n,height:r})},getImgProxyURLWithOptions:function e(t,n){if(!t)return t;if(!TS.boot_data.image_proxy_url)return t;var r=TS.boot_data.image_proxy_url;if(0===t.indexOf(r))return t;var i=getRefererHidingWhiteList();var a;if(!n.emoji&&0===t.indexOf("https://")){a=t.replace(/^https:\/\//,"");var s=true;var o=TS.interop.url.getHostName(t,s);if(i&&-1!==i.indexOf(o)){if(n.stop_animations&&"slack-imgs.com"===o){var l=TS.interop.url.urlQueryStringParse(a).o1;var u;u=n.stop_animations||false===TS.prefs.getPref("a11y_animations")?l?l+".gu":"gu":l&&l.replace(/\.gu|gu/,"");return TS.interop.url.setUrlQueryStringValue(t,"o1",u)}return t}}if(0===t.indexOf("/img/"))return t;r=TS.interop.url.setUrlQueryStringValue(r,"c","1");var d=[];var c=parseInt(n.width,10);var _=parseInt(n.height,10);if(c&&_){d.push("wi"+c);d.push("he"+_);TS.boot_data.feature_use_imgproxy_resizing&&d.push("si")}n.rotate&&d.push("ro");n.render_svg&&d.push("sv2");n.convert_ico&&d.push("ip");(n.stop_animations||false==TS.prefs.getPref("a11y_animations"))&&d.push("gu");d.length>0&&(r=TS.interop.url.setUrlQueryStringValue(r,"o1",d.join(".")));return TS.interop.url.setUrlQueryStringValue(r,"url",t)},rAF:function(){var e=["ms","moz","webkit","o"];var t=window.requestAnimationFrame;var n;for(n=0;n<e.length&&!t;n+=1)t=window[e[n]+"RequestAnimationFrame"];if(!t){var r=0;return function(e){var t=Date.now();var n=Math.max(0,16-(t-r));var i=window.setTimeout(function(){e(t+n)},n);r=t+n;return i}}return function(e){return t.call(window,e)}}(),cancelRAF:function(){var e=["ms","moz","webkit","o"];var t=window.cancelAnimationFrame;var n;for(n=0;n<e.length&&!t;n+=1)t=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];if(!t)return function(e){clearTimeout(e)};return function(e){t.call(window,e)}}(),startAnimation:function e(t){return m.subscribe(t)},getLocationHashString:function e(t){t=t||document;var n=t.location.hash;if(n&&n.length)return n.substr(1);return n},getYoutubeIdFromURL:function e(t){var n="";t=t.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);if(void 0!==t[2]){n=t[2].split(/[^0-9a-z_-]/i);n=n[0]}else n=t;return n},loadUrlInWindowIfOnline:function e(t,n){n=n||document;var r=function e(r){if(r){$("body").addClass("hidden");n.location=t}else TS.generic_dialog.alert(TS.interop.i18n.t("You can\u2019t perform that action because you are not online :(","utility")())};return TS.interop.api.call("api.test",{}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},externalURLsNeedRedirecting:function e(){if(TS.model.team&&TS.prefs.getTeamPref("hide_referers")&&!TS.model.is_our_app)return true;return false},swapInRedirUrlForIframe:function e(t,n){n=n||o();if(!n)return t;if(!n.iframe_redirect_type)return t;var r=$(t);var i=r.attr("src");if(!i)return t;"1"==TS.qs_args.test_iframe_referers&&(i="https://"+document.location.host+"/referertester.html?"+Date.now());i="https://"+TS.boot_data.redir_domain+"/link?v="+n.iframe_redirect_type+"&url="+encodeURIComponent(i);r.attr("src",i);t=r[0].outerHTML;"1"==TS.qs_args.test_iframe_referers&&TS.info("html with redir:"+t);return t},setCssFromHeightAndWidthAttrs:function e(t){if(!t)return;var n=$(t);n.css({height:n.attr("height"),width:n.attr("width")});return n[0].outerHTML},isArrowKey:function e(t){var n=TS.utility.keymap;if(t==n.down)return true;if(t==n.up)return true;if(t==n.right)return true;if(t==n.left)return true;return false},isPageKey:function e(t){var n=TS.utility.keymap;if(t==n.pageup)return true;if(t==n.pagedown)return true;if(t==n.home)return true;if(t==n.end)return true;return false},isNumericKey:function e(t){if(t>=48&&t<=57)return true;return false},getFileIDFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var n=document.createElement("a");n.href=S;var r=n.host;var i=document.createElement("a");i.href=t;var a;try{a=_.trimStart(i.pathname,"/")}catch(e){var s=true;TS.console.logError(e,"invalid_pathname_bug input="+t+", files_url="+S,void 0,s);return null}var o=[r,"files.dev.slack.com","files.staging.slack.com","files.slack.com"];var l=TS.redux.enterprise.getEnterprise();l&&l.domain&&(TS.boot_data&&"dev"===TS.boot_data.version_ts?o.push(l.domain+".enterprise.dev.slack.com"):o.push(l.domain+".enterprise.slack.com"));if(-1===o.indexOf(i.host))return null;var u;var d;if(0===a.indexOf("files/")){d=a.split("/");if(d.length<3)return null;var c=d[1];if(!c)return null;if(!(!TS.boot_data.feature_deprecate_get_member_by_name&&TS.interop.members.getMemberByName(c)||TS.interop.members.getMemberById(c)))return null;u=d[2]}else{if(0!==a.indexOf("files-pri/"))return null;d=a.split("/");if(d.length<3)return null;var m=d[1];if(m.indexOf("-")<0)return null;var f=m.split("-");if(2!==f.length)return null;u=f[1]}if(!u)return null;if("F"!==u.substr(0,1))return null;if(u.length<2)return null;if(u.length>15)return null;return u},getMemberIdFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var n;if(0===t.indexOf("/team/"))n=t.split("/team/");else{n=TS.utility.getPathFromSlackUrl(t);if(!n||n.length<2||"team"!==n[0])return null}var r=n[1];if(!r)return null;var i=TS.interop.members.getMemberById(r)||!TS.boot_data.feature_deprecate_get_member_by_name&&TS.interop.members.getMemberByName(r);if(i)return i.id;return null},normalizeDevHost:function e(t){return t.replace(/\.dev[0-9]*.slack.com/i,".dev.slack.com").replace(/\.staging.slack.com/i,".slack.com")},platformSupportsHtmlNotifications:function e(){if(window.desktop&&window.desktop.app){if(window.desktop.app.canShowHtmlNotifications)return window.desktop.app.canShowHtmlNotifications();return false!==window.desktop.app.willUseHwAcceleration}return false},findAllTeamEmojiInStr:function e(t,n){t=$.trim(t);var r=[];if(!t)return r;r=t.match(TS.emoji.legacyGetColonsRx())||r;var i=[];r=r.filter(function(e){if(TS.emoji.isValidName(e))return true;e.split("::").forEach(function(e){var t=TS.emoji.isValidName(e);if(!t)return;i.push(":"+t+":")});return false});r=r.concat(i);n&&(r=_.uniq(r));TS.dir(248,r);return r},areSimpleObjectsEqual:function e(t,n){if(t===n)return true;if(void 0===t&&n)return false;if(void 0===n&&t)return false;if(("undefined"===typeof t?"undefined":i()(t))!==("undefined"===typeof n?"undefined":i()(n)))return false;if(null===t&&n)return false;if(null===n&&t)return false;if(t.length!==n.length)return false;var r;for(r in n){if("undefined"===typeof t[r]&&"undefined"!==typeof n[r])return false;if(n[r])switch(i()(n[r])){case"object":if(!e(t[r],n[r]))return false;break;case"function":if(String(n[r])!=String(t[r]))return false;break;default:if(n[r]!==t[r])return false}else if(t[r])return false}for(r in t)if("undefined"===typeof n[r]&&"undefined"!==typeof t[r])return false;return true},deepDiffObjects:function e(t,n){if(_.isEmpty(t))return{};if(_.isEmpty(n))return t;var r={};_.each(t,function(e,t){var a=n[t];if(a===e)return;if(("undefined"===typeof e?"undefined":i()(e))!==("undefined"===typeof a?"undefined":i()(a)))r[t]=e;else if(_.isArray(e))r[t]=_.difference(e,a);else if(_.isPlainObject(e)){var s=TS.utility.deepDiffObjects(e,a);_.isEmpty(s)||(r[t]=s)}else r[t]=e});return r},appendLogToUrlWithLimit:function e(t,n){if(!t)return t;t+=-1==t.indexOf("?")?"?":"&";if(!n)return t;var r=2e3-t.length;return t+n.substr(0,r)},makeWebWorker:function e(t,n){var r=URL.createObjectURL(new Blob(["(",t,")()"],{type:"application/javascript"}));var i=new Worker(r);URL.revokeObjectURL(r);i.onmessage=n;return i},strGetWordCount:function e(t){return t.trim().split(/\s+/).length},truncateToNearestWordBoundary:function e(t,n){t.string&&(t=t.string);if(t.length<=n)return t;var r="\u2026";var i=t.substring(0,n);var a=i.lastIndexOf(" ");if(a>0&&a>n-15)return i.substring(0,a)+r;return i.substring(0,i.length-1)+r},truncateAndEscape:function e(t,n){if(t.length<=n)return _.escape(t);return _.escape(t.substring(0,n-1))+"&hellip;"},truncateHTML:function(){var e;try{if(window.DOMParser){e=new DOMParser;e.parseFromString("","text/html")||(e=null)}}catch(t){e=null}function t(e,n,r){var i=_.toArray(n.childNodes);_.forEach(i,function(i){if(e>=r){n.removeChild(i);return}if(i.nodeType===Node.TEXT_NODE){var a=i.textContent;if(e+a.length>r){i.textContent=a.substring(0,r-e);e+=r-e}else e+=i.textContent.length}else e=t(e,i,r)});return e}return function(n,r){try{var i;if(e){var a=e.parseFromString(n,"text/html");i=a.body}else{var s=jQuery.parseHTML("<div>"+n+"</div>");i=s[0]}var o=t(0,i,r);if(o>=r){var l=document.createTextNode("\u2026");i.appendChild(l)}return i.innerHTML}catch(e){TS.error(e);return n}}}(),isSpaceClickEventSafe:function e(t,n){if(t.target){var i=$(t.target).closest("[href]");if(!i[0])return true;if(!i.closest(".post_body").length&&!i.closest("ts-rocket").length)return true;var a=i[0].protocol;if(a&&false===/^https?:$/.test(a)){TS.warn("not following bad link from a post preview");t.preventDefault();return false}if(i.data("original-href")){TS.warn("not following possibly spoofed link from a post preview");t.preventDefault();var s=i.data("referer-original-href")||i.attr("href");n||r(i.data("original-href"),i.attr("href"),s);return false}}return true},getCachedScript:function e(t,n){n=$.extend(n||{},{dataType:"script",cache:true,url:t});return jQuery.ajax(n)},disableElement:function e(t,n){t=$(t);t.attr("disabled",n);t.attr("aria-disabled",n)},enableFeatureForUser:function e(t){if(t<0||t>100){TS.warn("TS.utility.enableFeatureForUser() expects a number between 0 and 100");return false}return _.random(0,100)<t},roundToThree:function e(t){return+(Math.round(t+"e+3")+"e-3")},convertBytesToMegabytes:function e(t){return t/1024/1024},convertKilobytesToMegabytes:function e(t){return t/1024},queryIsMaybeSelf:function e(r){r=_.toLower(r);if("me"===r||"you"===r||r===t||r===n)return true;return false},openAuthenticatedInBrowser:function e(t){if(TS.interop.desktop.isDesktop){var n=TS.boot_data.team_url+"web/open"+t;TS.interop.desktop.openAuthenticatedInBrowser(n)}else window.open(t)},getFontDescriptorForElement:function e(t){var n=t instanceof jQuery?t:$(t);return[n.css("font-style"),n.css("font-weight"),n.css("font-size"),n.css("font-family")].join(" ")},measureTextWidth:function e(t,n){if(!t)return 0;this._measure_text_width_canvas=this._measure_text_width_canvas||document.createElement("canvas");var r=this._measure_text_width_canvas.getContext("2d");r.font=n;return r.measureText(t).width},getRefererPolicy:o,exampleEmailAddress:function e(t){if("you"===t)return TS.interop.i18n.t("you@{example_com}","utility")({example_com:"example.com"});return TS.interop.i18n.t("name@{example_com}","utility")({example_com:"example.com"})},exampleWebAddress:function e(){return"example.com"},test:function e(){var t={clearAndGetRefererPolicy:function e(){a=void 0;return o()},getRefererPolicy:function e(){return o()}};Object.defineProperty(t,"_files_url",{get:function e(){return S},set:function e(t){S=t}});Object.defineProperty(t,"_team_url",{get:function e(){return T},set:function e(t){T=t}});return t}});var e;var t;var n;var r=function e(t,n,r){var i="";var a="";i+='<ts-icon class="ts_icon_warning yolk_orange small_right_margin"></ts-icon> ';i+=TS.interop.i18n.t("Caution: Tricky Link","utility")();a+="<p>";a+='  <span class="inline_block">'+TS.interop.i18n.t("The link you clicked (<strong>{url}</strong>) is tricky.","utility")({url:TS.interop.i18n.safeString(_.escape(r))})+"</span>";a+='  <span class="inline_block">'+TS.interop.i18n.t("It has been formatted to look like another web address (<strong>{url}</strong>).","utility")({url:TS.interop.i18n.safeString(_.escape(t))})+"</span>";a+="</p>";a+="<p>"+TS.interop.i18n.t("Are you sure you want to follow it?","utility")()+"</p>";TS.generic_dialog.start({title:i,body:a,show_cancel_button:false,show_secondary_go_button:true,secondary_go_button_text:TS.interop.i18n.t("Let\u2019s risk it","utility")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){window.open(n)},go_button_text:TS.interop.i18n.t("Take me back to safety","utility")(),esc_for_ok:true,enter_always_gos:true})};var a;function o(){if(!_.isUndefined(a))return a;var e=window.boot_data;if(!e){TS.warn("window.boot_data not available");a=null;return a}var t={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};var n=TS.console&&TS.console.warn;if(!window.bowser){n&&TS.warn(8675309,"window.bowser undefined, defaulting to restrictive referrer policy");a=t;return a}if(bowser.chrome&&bowser.version>=4.1||bowser.opera&&bowser.version>=15){a={iframe_redirect_type:4,redirect_type:null,rewrite_on_right_click:false};return a}if(bowser.ie){a={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};return a}if(bowser.firefox){a={iframe_redirect_type:bowser.version>=36?4:2,redirect_type:3,rewrite_on_right_click:bowser.version<36};return a}if(bowser.safari&&bowser.version>=5||navigator.userAgent.match(/(Slack_SSB)/g)){a={iframe_redirect_type:2,redirect_type:null,rewrite_on_right_click:false};return a}navigator.userAgent&&navigator.userAgent.match(/phantomjs/i)&&(n=false);n&&TS.warn(8675309,"browser not recognized, defaulting to restrictive referrer policy");a=t;return t}var l=null;window.getRefererHidingWhiteList=function(){if(l)return l;l=["slack.com","slack-files.com","slack-imgs.com",TS.boot_data.redir_domain];return l};var u=window.setImmediate;if(!u)if(window.MutationObserver){var d=document.createElement("div");var c=[];new MutationObserver(function(){var e=c.slice();c.length=0;e.forEach(function(e){e()})}).observe(d,{attributes:true});u=function e(t){c.length||d.setAttribute("yes","no");c.push(t)}}else u=function e(t){setTimeout(t,0)};var m=function(){var e=false;var t=[];function n(){if(!e)return;t.forEach(function(e){e()});TS.utility.rAF(n)}function r(r){var i={start:function i(){t.push(r);if(!e){e=true;TS.utility.rAF(n)}},stop:function n(){t.splice(t.indexOf(r),1);t.length||(e=false)}};i.start();return i}return{subscribe:r,subscribers:t,isRunning:function t(){return e}}}();var f=function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(n&&n.length>1){var r={messages:true,archives:true}[n[0]];var i=decodeURIComponent(n[1]);r&&i&&TS.interop.utility.looksLikeChannelId(i)&&!TS.interop.channels.hasChannelWithId(i)&&TS.redux.channels.getEntityById(i)}};var p=/([^.:\/]+)(?:\.[^.]+)?\.slack\.com\/((?:messages|archives|unreads|threads|team)\/)/;var h=/(<a\b[^>]*)(>)/gi;var g=365;var S=null;var T=null})()},204:function(e,t,n){var r=n(58);var i=n(71);var a=n(98);e.exports=n(56)?Object.defineProperties:function e(t,n){i(t);var s=a(n);var o=s.length;var l=0;var u;while(o>l)r.f(t,u=s[l++],n[u]);return t}},205:function(e,t,n){var r=n(60);var i=n(120);var a=n(101)("IE_PROTO");var s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){e=i(e);if(r(e,a))return e[a];if("function"==typeof e.constructor&&e instanceof e.constructor)return e.constructor.prototype;return e instanceof Object?s:null}},208:function(e,t,n){var r=n(95);var i=n(96);e.exports=function(e){return function(t,n){var a=String(i(t));var s=r(n);var o=a.length;var l,u;if(s<0||s>=o)return e?"":void 0;l=a.charCodeAt(s);return l<55296||l>56319||s+1===o||(u=a.charCodeAt(s+1))<56320||u>57343?e?a.charAt(s):l:e?a.slice(s,s+2):u-56320+(l-55296<<10)+65536}}},209:function(e,t,n){"use strict";var r=n(163);var i=n(83);var a=n(119);var s={};n(64)(s,n(43)("iterator"),function(){return this});e.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)});a(e,t+" Iterator")}},210:function(e,t,n){var r=n(46).document;e.exports=r&&r.documentElement},215:function(e,t,n){var r=n(192);var i=n(43)("iterator");var a=n(80);e.exports=n(52).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},220:function(e,t,n){"use strict";var r=n(221);var i=n(222);var a=n(80);var s=n(66);e.exports=n(155)(Array,"Array",function(e,t){this._t=s(e);this._i=0;this._k=t},function(){var e=this._t;var t=this._k;var n=this._i++;if(!e||n>=e.length){this._t=void 0;return i(1)}if("keys"==t)return i(0,n);if("values"==t)return i(0,e[n]);return i(0,[n,e[n]])},"values");a.Arguments=a.Array;r("keys");r("values");r("entries")},221:function(e,t){e.exports=function(){}},222:function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},224:function(e,t,n){e.exports={default:n(248),__esModule:true}},24:function(e,t,n){"use strict";t.__esModule=true;var r=n(412);var i=a(r);function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},248:function(e,t,n){n(249);e.exports=n(52).Object.assign},249:function(e,t,n){var r=n(86);r(r.S+r.F,"Object",{assign:n(250)})},250:function(e,t,n){"use strict";var r=n(98);var i=n(132);var a=n(111);var s=n(120);var o=n(133);var l=Object.assign;e.exports=!l||n(73)(function(){var e={};var t={};var n=Symbol();var r="abcdefghijklmnopqrst";e[n]=7;r.split("").forEach(function(e){t[e]=e});return 7!=l({},e)[n]||Object.keys(l({},t)).join("")!=r})?function e(t,n){var l=s(t);var u=arguments.length;var d=1;var c=i.f;var _=a.f;while(u>d){var m=o(arguments[d++]);var f=c?r(m).concat(c(m)):r(m);var p=f.length;var h=0;var g;while(p>h)_.call(m,g=f[h++])&&(l[g]=m[g])}return l}:l},261:function(e,t,n){var r=n(111);var i=n(83);var a=n(66);var s=n(115);var o=n(60);var l=n(136);var u=Object.getOwnPropertyDescriptor;t.f=n(56)?u:function e(t,n){t=a(t);n=s(n,true);if(l)try{return u(t,n)}catch(e){}if(o(t,n))return i(!r.f.call(t,n),t[n])}},275:function(e,t,n){e.exports={default:n(287),__esModule:true}},276:function(e,t,n){var r=n(91)("meta");var i=n(68);var a=n(60);var s=n(58).f;var o=0;var l=Object.isExtensible||function(){return true};var u=!n(73)(function(){return l(Object.preventExtensions({}))});var d=function(e){s(e,r,{value:{i:"O"+ ++o,w:{}}})};var c=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!l(e))return"F";if(!t)return"E";d(e)}return e[r].i};var _=function(e,t){if(!a(e,r)){if(!l(e))return true;if(!t)return false;d(e)}return e[r].w};var m=function(e){u&&f.NEED&&l(e)&&!a(e,r)&&d(e);return e};var f=e.exports={KEY:r,NEED:false,fastKey:c,getWeak:_,onFreeze:m}},277:function(e,t,n){var r=n(66);var i=n(191).f;var a={}.toString;var s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var o=function(e){try{return i(e)}catch(e){return s.slice()}};e.exports.f=function e(t){return s&&"[object Window]"==a.call(t)?o(t):i(r(t))}},287:function(e,t,n){n(125);n(148);e.exports=n(156).f("iterator")},2878:function(e,t){(function(){TS.registerModule("presence_manager",{sub_list_changed:new signals.Signal,onStart:function e(){i=true;p=TS.utility.enableFeatureForUser(1);o.length&&b();l.length&&y();TS.redux.socket.disconnectedSig.add(k);TS.redux.socket.connectedSig.add(w)},addPresenceList:function e(t){if(-1===a.indexOf(t)){a.push(t);t.added_sig.add(g);t.removed_sig.add(S)}},removePresenceList:function e(t){if(a.indexOf(t)>-1){a.splice(a.indexOf(t),1);t.added_sig.remove(g);t.removed_sig.remove(S)}},createNewPresenceList:function e(t){return new TS.PresenceList(t)},isSubscribedToMember:function e(t){return o.indexOf(t)>=0},queryMemberPresence:function e(t){_.isArray(t)?t.forEach(function(e){h(e)}):h(t);y()},periodicallyCheckPresenceConsistency:function e(t){_.isUndefined(t)&&(t=1e3);if(c){clearInterval(c);c=null}c=setInterval(x,t)},stopCheckingPresenceConsistency:function e(){c&&clearInterval(c);c=null},getSubList:function e(){return o.slice()},test:function e(){var t={getSubObject:function e(){var t={};var n;for(n in s)s[n]&&(t[n+" "+TS.interop.members.getMemberById(n).name]=s[n]);return t},getSubList:function e(){return o}};Object.defineProperty(t,"_is_first_connection",{get:function e(){return f},set:function e(t){f=t}});Object.defineProperty(t,"_handleConnect",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(t,"_addMemberToQueryList",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(t,"_sendSubList",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(t,"_sendQueryList",{get:function e(){return y},set:function e(t){y=t}});return t}});var e="USLACKBOT";var t=1e3;var n=1300;var r=1300;var i=false;var a=[];var s={};var o=[];var l=[];var u=false;var d=false;var c;var m=false;var f=true;var p=false;var h=function e(t){if(o.indexOf(t)>-1)return;if(l.indexOf(t)>-1)return;l.push(t)};var g=function e(t){_.isArray(t)||(t=[t]);t.forEach(function(e){T(e)})};var S=function e(t){_.isArray(t)||(t=[t]);t.forEach(function(e){v(e)})};var T=function t(n){if(n===e)return;if(s[n])s[n]+=1;else{s[n]=1;o.push(n);b()}return null};var v=function e(t){if(s[t]){s[t]-=1;if(!s[t]){var n=o.indexOf(t);o.splice(n,1);b()}}return null};var b=function e(){if(TS.boot_data.feature_sonic_presence_manager)return null;if(!i||0===o.length||u)return null;if(!TS.redux.socket.isConnected())return;u=true;Promise.resolve().then(function(){u=false;p&&TS.metrics.count("presence_manager",o.length);if(o&&o.length>n){if(!m){TS.console.logError({},"presence_sub_list_too_long","List length is "+o.length);m=true}o=o.slice(0,n)}var e={type:"presence_sub",ids:o};TS.interop.SocketManager.send(e);TS.presence_manager.sub_list_changed.dispatch();return null})};var y=function e(){if(!i||0===l.length||d)return null;if(!TS.redux.socket.isConnected())return;d=true;Promise.resolve().then(function(){d=false;_.chunk(l,r).forEach(function(e){var t={type:"presence_query",ids:e};TS.interop.SocketManager.send(t)});l=[];return null})};b=_.throttle(b,t);y=_.throttle(y,t);var w=function e(t){if(TS.boot_data.feature_sonic_presence_manager)return;if(TS.client&&!f&&!t&&!TS.boot_data.feature_legacy_cfm){var n=_.map(TS.model.members,"id");var r=_.map(TS.model.bots,"id");var i=n.concat(r);i.forEach(function(e){h(e)})}f=false;b();y()};var k=function e(){if(TS.boot_data.feature_sonic_presence_manager)return;TS.redux.socket.promiseToHaveOpenWebSocket().then(function(){b();y()})};var x=function e(){var t;var n=[];var r=[];var i=[];var a=Array.prototype.slice.call(document.querySelectorAll("[data-member-presence]"));a.forEach(function(e){t=e.getAttribute("data-member-presence");$(e).is(":visible")?r.push(t):i.push(t)});r=_.uniq(r);if(_.difference(r,o).length){var s=_.map(_.difference(r,o),function(e){return TS.interop.members.getMemberById(e)});TS.warn("There are members needing presence updates in the DOM that are not in the presence subscription list");TS.warn("Missing Names:",_.map(s,"name"));TS.warn("Missing Ids:",_.map(s,"id"))}n=_.uniq(r.concat(i));if(_.difference(o,n).length){var l=_.map(_.difference(o,n),function(e){return TS.interop.members.getMemberById(e)});TS.warn("There are members in the presence subscription list that are no longer in the DOM.");TS.warn("This might be fine if a longListView of members is showing, but once that list is removed these errors should go away.");TS.warn("Extra Names:",_.map(l,"name"));TS.warn("Extra Ids:",_.map(l,"id"))}}})()},2879:function(e,t){(function(){TS.registerModule("compression",{compress:function e(t,n,i,s){var o=Date.now();if(i){var l=LZString.compress(n);var u=Date.now()-o;TS.has_pri[a]&&TS.log(a,t+" took "+u+"ms to _compress immediately str.length: "+n.length);return s({k:t,str:l})}r(t,n,function(e,n){var r=Date.now()-o;TS.has_pri[a]&&TS.log(a,t+" took "+r+"ms for the compression worker to callback ("+n+"ms spent within the worker) result.length: "+e.length);s({k:t,str:e})})},deCompress:function e(t,n){return""},terminate:function t(){e&&e.terminate();e=null}});var e=null;var t=0;var n={};var r=function r(a,s,o){e||i();t+=1;var l="job_key"+t;n[l]=function(e,t){o(e,t);delete n[l]};e.postMessage({request:"compress",input:s,job_key:l,k:a})};var i=function t(){if(e){TS.error("_makeWorker but there is a _worker");return}var r=_.get(TS,"boot_data.vvv_paths.lz_string","/js/libs/lz-string-1.4.4.js");var i=TS.environment.is_dev;(TS.qs_args.local_assets||i)&&0!==r.indexOf("http")&&(r=location.protocol+"//"+location.host+r);e=TS.utility.makeWebWorker("function() {\t\t\tself.importScripts('"+r+"');\t\t\tself.onmessage = function(e) {\t\t\t\tvar start = Date.now();\t\t\t\tvar result;\t\t\t\tif (e.data.request === 'compress') {\t\t\t\t\tresult = LZString.compress(e.data.input)\t\t\t\t}\t\t\t\tvar elapsed = Date.now() - start;\t\t\t\tpostMessage({\t\t\t\t\trequest: e.data.request,\t\t\t\t\tresult: result,\t\t\t\t\tjob_key: e.data.job_key,\t\t\t\t\tk: e.data.k,\t\t\t\t\telapsed: elapsed\t\t\t\t});\t\t\t}\t\t}",function(e){var t=n[e.data.job_key];if(!t){TS.error("e.data.job_key:"+e.data.job_key+" had no record in _callbacks??");return}t(e.data.result,e.data.elapsed)})};var a=488})()},288:function(e,t,n){e.exports={default:n(289),__esModule:true}},2880:function(e,t){(function(){TS.registerModule("api",{})})()},2881:function(e,t){(function(){TS.registerModule("permissions.members",{onStart:function e(){},canThread:function e(t){return TS.interop.rules.channels.canThread(t)},canPostInChannel:function e(t){if(!t)return false;return TS.interop.rules.user.canPostInChannel(t.id)},canPostInGeneral:function e(){return TS.interop.rules.user.canPostInGeneral()},canTriggerCustomResponses:function e(){return TS.interop.rules.user.canTriggerCustomResponses()},canPostInModelOb:function e(t){return TS.permissions.members.canPostInChannel(t)},canNonAdminsAtMentionEveryoneBySettings:function e(){var t=TS.shared.legacyGetActiveModelOb();if(!t)return false;return TS.interop.rules.user.canNonAdminsAtMentionEveryoneBySettings(t.id)},canAtMentionEveryone:function e(t){var n=TS.redux.channels.getEntityById(t)||TS.shared.legacyGetActiveModelOb();if(!n)return false;return TS.interop.rules.user.canAtMentionEveryone(n.id)},canNonAdminsAtChannelOrGroupBySettings:function e(t){return TS.interop.rules.user.canNonAdminsAtMentionEveryoneBySettings(t)},canAtChannelOrGroup:function e(t){var n=TS.redux.channels.getEntityById(t)||TS.shared.legacyGetActiveModelOb();if(!n)return false;return TS.interop.rules.user.canAtChannelOrGroup(n.id)},canArchiveChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_archive_channels",TS.model.user)},canCreateChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_create_channels",TS.model.user)},canCreateGroups:function t(){if(TS.model.user.is_ultra_restricted)return false;return e("who_can_create_groups",TS.model.user)},canCreateMpims:function e(){if(TS.model.user.is_ultra_restricted)return false;return true},canCreateAndDeleteUserGroups:function e(){return TS.interop.userGroups.canCreateAndDeleteUserGroups()},canEditUserGroups:function e(){return TS.interop.userGroups.canEditUserGroups()},canUserSeeMember:function e(t){if(!TS.model.user.is_restricted)return true;if(t.is_self)return true;if(TS.interop.rules.members.isSlackbotOrTeambot(t,TS.boot_data.feature_teambot))return true;return!!_.find(TS.members.getMembersForUser(),function(e){return t.id===e.id})},canKickFromChannels:function e(){return TS.interop.rules.user.canKickFromPublicChannels()},canKickFromGroups:function e(){return TS.interop.rules.user.canKickFromPrivateChannels()},canCreateConvertOrgSharedChannels:function e(){if(!TS.boot_data.page_needs_enterprise)return false;if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return true;return TS.permissions.members.canManageOrgSharedChannels()},canManageOrgSharedChannels:function e(){if(!TS.prefs.getTeamPref("who_can_manage_shared_channels"))return true;if(!TS.boot_data.page_needs_enterprise)return false;var t=TS.model.user;if(t.is_restricted)return false;if(void 0!==TS.prefs.getTeamPref("can_user_manage_shared_channels"))return TS.prefs.getTeamPref("can_user_manage_shared_channels");var n=TS.prefs.getTeamPref("who_can_manage_shared_channels").type[0];if("regular"===n)return true;if("admin"===n)return t.is_admin||t.is_owner||!!(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner));if("owner"===n){if(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner))return true;if(TS.prefs.getTeamPref("who_can_manage_shared_channels").user&&TS.prefs.getTeamPref("who_can_manage_shared_channels").user.indexOf(TS.model.user.id)>-1)return true;return false}return false},canRequestSharedChannel:function e(){if(!TS.model.team.plan)return false;if(TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_shared_channels_enterprise)return false;var n=_.includes(t,TS.model.team.domain);var r=TS.model.user.is_owner||TS.model.user.is_admin;if(n&&r)return 0!==TS.prefs.getTeamPref("enable_shared_channels");return 1===TS.prefs.getTeamPref("enable_shared_channels")},canCreateSharedChannel:function e(){if(!TS.model.user.is_owner&&!TS.model.user.is_admin)return false;return TS.permissions.members.canRequestSharedChannel()},canDisconnectSharedChannels:function e(){if(!TS.model.user.is_owner&&!TS.model.user.is_admin)return false;return true},canManageParticipationInSharedChannelsOpenBeta:function e(){if(!TS.model.team.plan)return false;if(TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_shared_channels_enterprise)return false;return TS.model.user.is_admin},canManageExternalSharedChannels:function e(){return TS.model.user.is_owner||TS.model.user.is_admin},canExportMessageHistory:function e(t){if(TS.boot_data.feature_channel_exports&&(TS.model.user.is_admin||t.is_im||t.is_group))return true;return false},canUserInviteToChannel:function e(t){if(TS.model.user.is_ultra_restricted)return false;if(t.is_channel&&t.is_member)return true;if(t.is_group)return true;return false},canNonAdminInviteToWorkspace:function e(){if(!TS.model.team||!TS.model.user)return false;if(TS.model.user.is_restricted)return false;return!TS.prefs.getTeamPref("invites_only_admins")||TS.boot_data.page_needs_enterprise&&TS.prefs.getTeamPref("who_can_manage_guests")&&TS.interop.rules.teams.canOrgUserManageGuests(TS.model.team,TS.model.user)},canUserInviteToWorkspace:function e(){if(!TS.model.user)return false;return TS.model.user.is_admin||TS.permissions.members.canNonAdminInviteToWorkspace()},test:function t(){var n={};Object.defineProperty(n,"_checkPrefCascade",{get:function t(){return e},set:function t(n){e=n}});return n}});var e=function e(t,n,r){"undefined"===typeof r&&(r=true);if(n.is_restricted)return"ra"===TS.prefs.getTeamPref(t);if("ra"===TS.prefs.getTeamPref(t))return true;if("regular"===TS.prefs.getTeamPref(t))return true;if("admin"===TS.prefs.getTeamPref(t))return!!n.is_admin;if("owner"===TS.prefs.getTeamPref(t))return!!n.is_owner;return r};var t=["rsquared","shared-channels","ultra4slack","slacksharedchannels","bankrate","mtzhf","sarankco","caspersleep","patronage","forbes-business","forbes","nobleppl","tray","stembolt","aking-prod-60","aking-prod-120","stripe","c2","sidlee","nprdigital","insideenergy","3qdigital","radiant-lighting","labyrinth-lab","coloradopublicradio","pcetest1","pcetest2","50bradslavin","surveymonkey","parlevel","zdcorp","happy-returns","solsties","ncc-test-api1-team1","ncc-test-api2-team1","digitalica","eventbrite","songkick","everlane","smyte","bauerxcelmedia","stroeerdigitalgroup","crossengage","outcastagency","methodhome","awaymessages","hellofresh","npr","harvest-test","harvest-client","paperplayground","paper-dbx","digishopgirl","zoomwebdevep1","zoomwebdevep2","carousell","sidearm","paciolan","wwit-apps-ogilvy","iridesco","nikkeidevs","stripe-vendor","nikkeiitb","tab","fogcreek","beproud","institute-group","frontiers-inc","zd-media","ce-one-sharedchannels","ce-two-sharedchannels","friendstestteam","frontiersdemo1","frontiersdemo2","frontiersdemo3"]})()},2882:function(e,t){(function(){TS.registerModule("tips",{onStart:function t(){e.delegate(".ts_tip_lazy, .ts_tip_float","mouseenter",o);e.delegate(".ts_tip_float","mouseleave",l);e.on("click",".ts_tip",function(e){if(TS.isPartiallyBooted()){e.preventDefault();e.stopPropagation();TS.incremental_boot.userDidInteractWithUI();return}c($(this))})},hideAll:function e(){$(".ts_tip").addClass("ts_tip_hide")},unhideAll:function e(){$(".ts_tip").removeClass("ts_tip_hide")},updateTipTitle:function e(t,r){var a=m(t);a.length?a.html(r):t.attr("title",r);if(n&&n[0]==t[0])if(r){i.html(r);d()}else u()},updateFloater:function e(t){i&&t.title&&i.text(t.title);r&&t.classes_to_add&&r.addClass(t.classes_to_add.join(" "))},manuallyToggleTipTitle:function e(t){c(t)}});var e=$("BODY");var t=null;var n=null;var r=null;var i=null;var a=10;var s=0;var o=function o(l){n=$(l.currentTarget);var c=n.hasClass("ts_tip_multiline");n.addClass("ts_tip_hidden");0==n.children(".ts_tip_tip").length&&p(n,c);n.removeAttr("title");n.removeClass("ts_tip_lazy");$("#ts_tip_float_floater").remove();if(n.hasClass("ts_tip_float")){var _=n.attr("class").split(/\s+/).filter(function(e){if("ts_tip_float"===e)return false;if("ts_tip_lazy"===e)return false;return 0===e.indexOf("ts_tip")});var m=TS.templates.builders.strBuilder('<div id="ts_tip_float_floater" style="width:${w}px; height:${h}px;" class="${classes}">${tip_html}</div>',{w:n.outerWidth(),h:n.outerHeight(),classes:_.join(" "),tip_html:n.find(".ts_tip_tip").clone()[0].outerHTML});r=$(m);e.append(r);s=setTimeout(function(){r.removeClass("ts_tip_hidden");d()},a);t=n.closest(":scrollable(vertical)");t.on("scroll.ts_tip_removal",u);n.on("destroyed.ts_tip_removal",u);n.hasClass("ts_tip_hide_on_click")&&n.on("click.ts_tip_removal",u);if(c)i=r.find(".ts_tip_multiline_inner");else{i=r.find(".ts_tip_tip_inner");i.length||(i=r.find(".ts_tip_tip"))}}else setTimeout(function(){n.removeClass("ts_tip_hidden")},a)};var l=function e(){u()};var u=function e(){clearTimeout(s);r&&r.addClass("ts_tip_hidden");if(n&&n.length){n.off("click.ts_tip_removal");n.off("destroyed.ts_tip_removal")}t&&t.off("scroll.ts_tip_removal");t=null;n=null;r=null;i=null};var d=function e(){var t=n.offset();var i=2;var a=window.innerWidth-i;var s=window.innerHeight-i;var o=r.hasClass("ts_tip_multiline");var l=function e(){if(o)return r.find(".ts_tip_multiline_inner").dimensions_rect();return r.find(".ts_tip_tip").dimensions_rect()};var u=function e(t){r.removeClass("\t\t\tts_tip_right \t\t\tts_tip_rightish \t\t\tts_tip_left \t\t\tts_tip_leftish \t\t\tts_tip_multiline_top_leftish \t\t\tts_tip_multiline_top_left \t\t\tts_tip_multiline_top_right \t\t\tts_tip_multiline_top_rightish \t\t").addClass(t)};r.css("left",t.left).css("top",t.top);var d=l();d.bottom>s?r.removeClass("ts_tip_bottom").addClass("ts_tip_top"):d.top<i&&r.removeClass("ts_tip_top").addClass("ts_tip_bottom");if(o){d.right>a?u("ts_tip_multiline_top_rightish"):d.left<i&&u("ts_tip_multiline_top_leftish");d=l();d.right>a?u("ts_tip_multiline_top_right"):d.left<i&&u("ts_tip_multiline_top_left")}else{d.right>a?u("ts_tip_rightish"):d.left<i&&u("ts_tip_leftish");d=l();d.right>a?u("ts_tip_right"):d.left<i&&u("ts_tip_left")}};var c=function e(t){var n=m(t);var r="tip-toggle-auto";var i;t.data(r)?i=t:n.data(r)&&(i=n);if(!(i&&i.length))return;var a=n.html();var s=i.data(r);if(!s)return TS.warn("No toggle state text defined on tipped element. Please add text to data-tip-toggle-text or data-tip-toggle-auto attribute");TS.tips.updateTipTitle(t,s);i.data(r,a)};var m=function e(t){var n=t.find(".ts_tip_multiline_inner");n.length||(n=t.find(".ts_tip_tip_inner"));n.length||(n=t.find(".ts_tip_tip"));return n};var f=function e(t){if(t.text().trim().length)return;if(t.attr("aria-label"))return;return _.uniqueId("ts_tip_tip_")};var p=function e(t,n){var r="";if(t.data("tip-member"))r=TS.templates["c-unified_member"]({member:TS.interop.members.getMemberById(t.data("tip-member")),size:"small",avatar:true,no_tip:true,dark:true,omit_status:true,forced_primary:"real_name"});else{var i=_.escape(t.prop("title"));var a=f(t);var s=a?' id="'+a+'"':"";r=n?'<span class="ts_tip_multiline_inner">'+i+"</span>":i}var o=["<span",s,' class="ts_tip_tip"',">",r,"</span>"];t.append(o.join(""));t.attr("aria-labelledby",a)}})()},2883:function(e,t){(function(){TS.registerModule("tips.texty",{onStart:function t(){e.delegate(".ts_tip_texty","mouseenter",n);e.delegate(".ts_tip_texty","mouseleave",r)},show:function e(t,n){i(t,n)},hide:function e(){a()},isShowing:function e(){return t}});var e=$("BODY");var t=false;var n=function e(t){i(t.target)};var r=function e(){a()};var i=function n(r,i){var a=$(r).closest(".ql-container");if(!a.length||a.hasClass("texty_hide_tooltips"))return;var s=r.getAttribute("data-title")||null;var o=r.getAttribute("data-id")&&"UNVERIFIED"!==r.getAttribute("data-id")?TS.interop.members.getMemberById(r.getAttribute("data-id")):null;$("#ts_tip_texty_tip").remove();if(!s&&!o)return;var l=$('<div id="ts_tip_texty_tip"'+(i?' class="ts_tip_texty_slow"':"")+"></div>");var u=r.getBoundingClientRect();TS.interop.mountTooltipTip(TS.boot_data.team_id,l[0],o?o.id:null,{children:s,position:"top",className:o?"c-tooltip__tip--member":""});e.append(l);var d=e.height()-u.top;var c=u.left;c-=l.width()/2;c+=u.width/2;l.css({bottom:d+"px",left:c+"px",opacity:1});t=true};var a=function e(){var n=document.getElementById("ts_tip_texty_tip");if(!n)return;var r=$(n).hasClass("ts_tip_texty_slow")?200:100;$(n).fadeOut(r,function(){TS.interop.unmountTooltipTip(n);$(n).remove();t=false})}})()},2884:function(e,t){(function(){TS.registerModule("notifs",{onStart:function e(){},canCorGHaveChannelMentions:function e(t){var n=TS.interop.channels.getPublicChannelById(t)||TS.interop.channels.getGroupById(t)||TS.interop.channels.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.canModelObHaveChannelMentions(n)},canModelObHaveChannelMentions:function e(t){if(t.is_im)return false;if("admin"===TS.prefs.getTeamPref("who_can_at_channel")||"owner"===TS.prefs.getTeamPref("who_can_at_channel"))return true;if(TS.interop.rules.channels.isRequired(t)&&("admin"===TS.prefs.getTeamPref("who_can_at_everyone")||"owner"===TS.prefs.getTeamPref("who_can_at_everyone")))return true;if(t.is_general&&("admin"===TS.prefs.getTeamPref("who_can_post_general")||"owner"===TS.prefs.getTeamPref("who_can_post_general")))return true;var n=TS.notifs.getCalculatedCorGNotifySetting(t.id);var r=TS.notifs.isCorGMuted(t.id);if("everything"===n&&!r)return true;return!TS.notifs.hasUserSuppressedCorGChannelMentions(t)},hasUserSuppressedCorGChannelMentions:function e(t){if(TS.boot_data.feature_turn_mpdm_notifs_on)return!!TS.redux.notifications.getNotificationsChannelPref(t.id,"suppress_at_channel");var n=TS.model.at_channel_suppressed_channels.indexOf(t.id);if(-1!=n)return true;return false},hasUserSuppressedCorGChannelMentionsById:function e(t){var n=TS.interop.channels.getPublicChannelById(t)||TS.interop.channels.getGroupById(t)||TS.interop.channels.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.hasUserSuppressedCorGChannelMentions(n)},hasUserSuppressedCorGPushChannelMentions:function e(t){var n=TS.interop.channels.getPublicChannelById(t)||TS.interop.channels.getGroupById(t)||TS.interop.channels.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}var r=TS.model.push_at_channel_suppressed_channels.indexOf(n.id);if(-1!=r)return true;return false},isCorGMuted:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}return TS.redux.channels.isChannelMutedById(t)},getCorGsNotUsingGlobalPushNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[]};var n;var r;var i={};var a;var s;var o="quiet";(TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert"))&&(o="mentions");TS.prefs.getPref("push_everything")&&(o="loud");s=TS.prefs.getPref("push_loud_channels_set")?TS.prefs.getPref("push_loud_channels_set").split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;i[a]="quiet"}s=TS.interop.redux.models.channels.getPublicChannelsUserIsIn(TS.redux.getState());for(r=0;r<s.length;r+=1){if(!s[r])continue;a=s[r].id;if("mentions"!==TS.notifs.getCalculatedCorGPushNotifySetting(a))continue}s=TS.prefs.getPref("push_mention_channels")?TS.prefs.getPref("push_mention_channels").split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;if(!i[a])continue;i[a]="mentions"}s=TS.prefs.getPref("push_loud_channels")?TS.prefs.getPref("push_loud_channels").split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;if(!i[a])continue;i[a]="loud"}_.forOwn(i,function(e,r){n=TS.interop.channels.getPublicChannelById(r)||TS.interop.channels.getGroupById(r)||TS.interop.channels.getMpimById(r);if(!n)return;if(n.is_archived)return;if(n.is_channel&&!n.is_member)return;if("loud"===e){if("loud"===o)return;t.everything.push(n)}else if("mentions"===e){if("mentions"===o)return;t.mentions.push(n)}else if("mentions_suppressed"===e);else{if("quiet"===o)return;t.nothing.push(n)}});return t},getCorGsNotUsingGlobalNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[],muted:[],suppressed:[]};var n=TS.interop.redux.models.channels.getPublicChannelsUserIsIn(TS.redux.getState());_.forOwn(n,function(e){if(e.is_archived)return;if(!e.is_member)return;r(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});_.forOwn(TS.model.groups,function(e){if(e.is_archived)return;r(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});_.forOwn(TS.model.mpims,function(e){if(e.is_archived)return;r(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});return t},getCalculatedCorGNotifySetting:function r(i){if(!i){TS.error('wtf no c_id "'+i+'"');return false}if(TS.boot_data.feature_turn_mpdm_notifs_on){var a=TS.redux.notifications.getCalculatedDesktopNotifySetting(i);if("mentions_dms"===a)return"mentions";return a}var s=n(i);if(s){if(e(i))return"everything";if(t(i))return"nothing";return"mentions"}if(TS.prefs.getPref("growls_enabled")){if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"}return"nothing"},muteOrUnmuteCorG:function e(t){if(!t)return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var n=TS.redux.channels.getEntityById(t);if(!n)return;if(n.is_im)return;var r=TS.notifs.isCorGMuted(t);if(r)TS.notifs.makeCorGNOTMuted(t);else{TS.notifs.makeCorGMuted(t);n.is_mpim&&TS.mpims.legacyMarkMostRecentReadMsg(n,TS.model.marked_reasons.muted)}var i=TS.redux.channels.getMutedChannelsAsArray().join(",");TS.prefs.legacyOnPrefChanged({name:"muted_channels",value:i});TS.prefs.setPrefByAPI({name:"muted_channels",value:i})},makeCorGMuted:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=true;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","))},makeCorGNOTMuted:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=false;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","))},makeCorGSuppressed:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);-1==a&&TS.model.at_channel_suppressed_channels.push(t);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","))},makeCorGNOTSuppressed:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);-1!=a&&TS.model.at_channel_suppressed_channels.splice(a,1);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","))},makeCorGPushSuppressed:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);-1==a&&TS.model.push_at_channel_suppressed_channels.push(t);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGNOTPushSuppressed:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);-1!=a&&TS.model.push_at_channel_suppressed_channels.splice(a,1);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGDTopNothing:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);-1!=a&&TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);if(TS.prefs.getPref("growls_enabled")){-1==a&&TS.model.never_channels.push(t);u(t)}else{-1!=a&&TS.model.never_channels.splice(a,1);d(t)}TS.prefs.setNeverChannels(TS.model.never_channels.join(","))},makeCorGDTopEverything:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.never_channels.indexOf(t);-1!=a&&TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));a=TS.model.loud_channels.indexOf(t);if(TS.prefs.getPref("growls_enabled")&&TS.prefs.getPref("all_channels_loud")){-1!=a&&TS.model.loud_channels.splice(a,1);d(t)}else{-1==a&&TS.model.loud_channels.push(t);u(t)}TS.prefs.setLoudChannels(TS.model.loud_channels.join(","))},makeCorGDTopMentions:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);-1!=a&&TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);-1!=a&&TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));TS.prefs.getPref("growls_enabled")&&!TS.prefs.getPref("all_channels_loud")?d(t):u(t)},makeCorGPushNothing:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);-1!=a&&TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);-1!=a&&TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));TS.prefs.getPref("push_everything")||TS.prefs.getPref("push_mention_alert")?c(t):m(t)},makeCorGPushEverything:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_mention_channels.indexOf(t);-1!=a&&TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));a=TS.model.push_loud_channels.indexOf(t);if(TS.prefs.getPref("push_everything")){-1!=a&&TS.model.push_loud_channels.splice(a,1);m(t)}else{-1==a&&TS.model.push_loud_channels.push(t);c(t)}TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","))},makeCorGPushMentions:function e(t){var n=TS.interop.channels.getPublicChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);-1!=a&&TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);if(!TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_everything")){-1==a&&TS.model.push_mention_channels.push(t);c(t)}else{-1!=a&&TS.model.push_mention_channels.splice(a,1);m(t)}TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","))},getCalculatedCorGPushNotifySetting:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.boot_data.feature_turn_mpdm_notifs_on){var n=TS.redux.notifications.getCalculatedMobileNotifySetting(t);if("mentions_dms"===n)return"mentions";return n}var r=l(t);if(r){if(s(t))return"everything";if(o(t))return"mentions";return"nothing"}if(TS.prefs.getPref("push_everything"))return"everything";if(TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert"))return"mentions";return"nothing"},getGlobalHighlightWords:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getGlobalHighlightWords();return TS.prefs.getPref("highlight_words")},setGlobalHighlightWords:function e(t){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey("global_keywords",t);return TS.prefs.setPrefByAPI({name:"highlight_words",value:t})},getDesktopNotificationSoundPref:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getDesktopNotificationSoundPref();return TS.prefs.getPref("new_msg_snd")},setDesktopNotificationSoundPref:function e(t){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey("desktop_sound",t);return TS.prefs.setPrefByAPI({name:"new_msg_snd",value:t})},getThreadsEverythingNotificationPref:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getThreadsEverythingNotificationPref();return TS.prefs.getPref("threads_everything")},setThreadsEverythingNotificationPref:function e(t){var n="threads_everything";if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey(n,t);return TS.prefs.setPrefByAPI({name:n,value:t})},getNotificationPushIdleWaitTimeInMinutes:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getNotificationPushIdleWaitTimeInMinutes();return TS.prefs.getPref("push_idle_wait")},setNotificationPushIdleWaitTimeInMinutes:function e(t){var n="push_idle_wait";if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey(n,t);return TS.prefs.setPrefByAPI({name:n,value:t})},getNoTextInNotificationsPref:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getNoTextInNotificationsPref();return TS.prefs.getPref("no_text_in_notifications")},setNoTextInNotificationsPref:function e(t){var n="no_text_in_notifications";if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey(n,t);return TS.prefs.setPrefByAPI({name:n,value:t})},getGlobalNotificationSetting:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on){var t=TS.redux.notifications.getGlobalDesktopNotifySetting();if("mentions_dms"===t)return"mentions";return t}if(!TS.prefs.getPref("growls_enabled"))return"nothing";if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"},setDesktopGlobalNotifySetting:function e(t,n){if(!TS.boot_data.feature_turn_mpdm_notifs_on)return;return TS.notifs.setGlobalNotificationPrefByKey("global_desktop",t,n)},getGlobalPushNotificationSetting:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on){var t=TS.redux.notifications.getGlobalMobileNotifySetting();if("mentions_dms"===t||"dms"===t)return"mentions";return t}if(TS.prefs.getPref("push_everything"))return"everything";if(TS.prefs.getPref("push_mention_alert")&&TS.prefs.getPref("push_dm_alert"))return"dm_and_mentions";if(TS.prefs.getPref("push_mention_alert"))return"mentions";if(TS.prefs.getPref("push_dm_alert"))return"dms";return"nothing"},setMobileGlobalNotifySetting:function e(t){if(!TS.boot_data.feature_turn_mpdm_notifs_on)return;return TS.notifs.setGlobalNotificationPrefByKey("global_mobile",t)},setGlobalNotificationPrefByKey:function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"mentions"===n&&(n="mentions_dms");return TS.interop.api.call("users.prefs.setNotifications",{global:true,name:t,value:n,sync:r,_x_reason:TS.ui.prefs_dialog&&TS.ui.prefs_dialog.isOpen()?"prefs_dialog_open":"prefs_dialog_closed"}).then(function(e){if(!TS.boot_data.feature_degraded_send)return;var n=e.data;if(n&&n.all_notifications_prefs){TS.prefs.legacyOnPrefChanged({name:"all_notifications_prefs",value:JSON.stringify(n.all_notifications_prefs)});"global_keywords"===t&&_.get(n.all_notifications_prefs,"global.global_keywords")&&TS.prefs.legacyOnPrefChanged({name:"highlight_words",value:n.all_notifications_prefs.global.global_keywords})}})}});var e=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels.indexOf(t)>-1)return true;return false};var t=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.never_channels.indexOf(t)>-1)return true;return false};var n=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels_set&&TS.model.loud_channels_set.indexOf(t)>-1)return true;return false};var r=function e(t){if(TS.prefs.getPref("growls_enabled")&&"nothing"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var i=function e(t){var n=TS.notifs.getCalculatedCorGNotifySetting(t);if("mentions"!==n)return false;if(!TS.prefs.getPref("growls_enabled")||TS.prefs.getPref("all_channels_loud"))return true;return false};var a=function e(t){if((!TS.prefs.getPref("growls_enabled")||!TS.prefs.getPref("all_channels_loud"))&&"everything"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var s=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels.indexOf(t)>-1)return true;return false};var o=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_mention_channels.indexOf(t)>-1)return true;return false};var l=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels_set&&TS.model.push_loud_channels_set.indexOf(t)>-1)return true;return false};var u=function e(t){var n=TS.model.loud_channels_set.indexOf(t);-1==n&&TS.model.loud_channels_set.push(t);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var d=function e(t){var n=TS.model.loud_channels_set.indexOf(t);-1!=n&&TS.model.loud_channels_set.splice(n,1);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var c=function e(t){var n=TS.model.push_loud_channels_set.indexOf(t);-1==n&&TS.model.push_loud_channels_set.push(t);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))};var m=function e(t){var n=TS.model.push_loud_channels_set.indexOf(t);-1!=n&&TS.model.push_loud_channels_set.splice(n,1);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))}})()},2885:function(e,t){(function(){TS.registerModule("redux.all_unreads",{onStart:function e(){t()},updateHasUnreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreads(t))},updateHasUnreadThreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreadThreads(t))},updateThreadsMentionCount:function e(t){if(!_.isInteger(t))return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateThreadsMentionCount(t))}});function e(){TS.redux.all_unreads.updateHasUnreadThreads(TS.model.threads_has_unreads);TS.redux.all_unreads.updateThreadsMentionCount(TS.model.threads_mention_count)}function t(){_.get(TS,"client.threads.threads_unread_changed")&&!TS.boot_data.feature_react_threads&&TS.client.threads.threads_unread_changed.add(e)}})()},2886:function(e,t){(function(){TS.registerModule("redux.channels",{onStart:function r(){e=true;n=TS.interop.rules.channels.isIm||t;Object.defineProperty(TS.model,"channels",{get:function e(){return g("channels")}});Object.defineProperty(TS.model,"groups",{get:function e(){return g("groups")}});Object.defineProperty(TS.model,"mpims",{get:function e(){return g("mpims")}});Object.defineProperty(TS.model,"ims",{get:function e(){return g("ims")}})},clearAllShowInListEvenThoughUnreadsFlags:function e(){TS.redux.dispatch(TS.interop.redux.models.channels.clearAllShowInListEvenThoughUnreadsFlags())},dangerouslyGetEntityById:function e(t){return a(t)},dangerouslyGetPublicChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.includeFromAnotherTeam,r=void 0!==n&&n;return TS.interop.redux.models.channels.getPublicChannels(TS.redux.getState(),{includeFromAnotherTeam:r})},dangerouslyGetPrivateChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.includeFromAnotherTeam,r=void 0!==n&&n;return TS.interop.redux.models.channels.getPrivateChannels(TS.redux.getState(),{includeFromAnotherTeam:r})},dangerouslyGetMpims:function e(){return TS.interop.redux.models.channels.getMpims(TS.redux.getState())},setMarkingState:function e(t,n){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.setMarkingState({id:t,needsApiMarking:n}))},clearAllMarkingFlags:function e(){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearAllMarkingFlags())},clearMarkingFlagsForIds:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearMarkingFlagsForIds(t))},getAllIdsNeedingMarking:function e(){return l()},getAllUnmutedIdsNeedingMarking:function e(){return d()},getAllMutedIdsNeedingMarking:function e(){return u()},bulkAddEntities:function e(t){TS.redux.dispatch(TS.interop.redux.models.channels.bulkAddChannels({channels:t}))},bulkUpdateEntities:function e(t){TS.redux.dispatch(TS.interop.redux.models.channels.bulkUpdateChannels({channels:t}))},addEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var n="Attempting to add a channel interop object, not a channel. Only raw channel objects can be added. Take this to #dhtml.";if(h())throw new Error(n);TS.error(n);return}TS.redux.dispatch(TS.interop.redux.models.channels.addChannel({channel:t}))},removeEntity:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.channels.removeChannels({ids:[t.id]}))},replaceEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var n="Attempting to replace a channel object with a channel interop object. If you are trying to update a property for this channel you should change the property directly. Take this to #dhtml.";if(h())throw new Error(n);TS.error(n);return}TS.redux.channels.addEntity(t)},updateMutedChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];var n=_.reduce(t,function(e,t){e[t]=true;return e},{});TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannels(n))},getMutedChannelsAsArray:function e(){return _.reduce(c(),function(e,t,n){e.push(n);return e},[])},setMutedChannelById:function e(t,n){if(!t||_.isUndefined(n))return;var r={id:t,muted:n};TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannel(r))},isChannelMutedById:function e(t){if(!t)return false;return r(t)},getEntityById:function e(t,n){return TS.interop.channels.getEntityById(t,n)},getPublicChannelByName:function e(t){var n=s(t);if(TS.interop.rules.channels.isPublicChannel(n))return n},getPublicOrPrivateChannelByName:function e(t){var n=s(t);if(TS.interop.rules.channels.isPublicChannel(n)||TS.interop.rules.channels.isPrivateChannel(n))return n},getChannelByName:function e(t){return s(t)},getImByMemberId:function e(t){var r=o(t);var i=TS.redux.channels.getEntityById(r);if(n(i))return i;return null},test:function e(){var t={};return t}});var e=false;function t(){TS.console.logError("missing-isIm: onStartDidRun="+e+", i("+_.has(window,"TS.interop")+"), i.r("+_.has(window,"TS.interop.rules")+"), i.r.c("+_.has(window,"TS.interop.rules.channels")+"), i.r.c.i("+_.has(window,"TS.interop.rules.channels.isIm")+")");var t=Date.now()-(window.localStorage.isImBugLastEncountered||0);localStorage.isImBugLastEncountered=Date.now();t>6e4&&TS.reload(null,"isIM bug detected");throw new Error("TS.interop.rules.channels.isIm not present on page, not sure how to proceed")}var n=t;var r=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.isChannelMutedById");var i=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getAllChannels");var a=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelById");var s=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelByName");var o=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getImIdByMemberId");var l=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllIdsNeedingMarking");var u=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllMutedIdsNeedingMarking");var d=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllUnmutedIdsNeedingMarking");var c=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.getMutedChannels");var m;var f={};var p={channels:void 0,groups:void 0,mpims:void 0,ims:void 0};var h=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var g=function e(t){var r=i();var a;switch(t){case"channels":a=function e(t){return t.is_channel&&!t.fromAnotherTeam};break;case"groups":a=function e(t){return t.is_group&&!t.is_mpim&&!t.fromAnotherTeam};break;case"ims":a=n;break;case"mpims":a=function e(t){return t.is_group&&t.is_mpim};break;default:}if(r===m&&f[t])return f[t];if(r!==m){m=r;f={}}f[t]=_.filter(r,a);f[t]=_.map(f[t],TS.redux.channels.interop.maybeWrapEntity);p[t]||(p[t]=_.defer(function(){delete f[t];delete p[t];m=null}));return f[t]}})()},2887:function(e,t){(function(){TS.registerModule("redux.channels.interop",{maybeWrapEntity:function e(t){if(!t||!t.id)return t;return T(t.id)},getSetCounts:function e(){return _.chain(t).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},getReduxSetCounts:function e(){return _.chain(n).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelById");var t={};var n={};var r={};var i=function e(){var t=window.Proxy&&S();return t};var a=function e(t,n,r){if(!t||!n)return;var i={id:t};i[n]=r;TS.redux.dispatch(TS.interop.redux.models.channels.updateOneKeyForChannel(i))};var s=["_show_in_list_even_though_no_unreads","deleted","has_draft","is_archived","is_channel","is_ext_shared","is_group","is_im","is_member","is_mpim","is_open","is_org_shared","is_pending_ext_shared","is_shared","is_starred","last_read","members","priority","unread_cnt","unread_highlight_cnt"];var o=["_display_name","_archive_msgs","_checking_at_channel_status","_delayed_fetch_timer","_did_defer_initial_msg_history","_display_name_lc","_display_name_truncated","_i18n_ns_history","_i18n_ns","_internal_name","_jumper_previous_name_match","_latest_via_users_counts","_mark_most_recent_read_timer","_marked_reason","_members","_mention_count_display_via_users_counts","_name_lc","_prev_last_read","_score","_users_counts_info","active_members","can_thread","create_channel","created","creator","date_created","enterprise_id","fetched_history_after_scrollback_time","has_fetched_history_after_scrollback","has_pins","history_changed","history_fetch_failed","history_fetch_retries","history_is_being_fetched","id","inherit","is_default","is_general","is_global_shared","is_limited","is_moved","is_non_threadable","is_org_default","is_org_mandatory","is_private","is_read_only","is_thread_only","last_made_active","last_msg_input","latest","length","member","msgs","name_normalized","name","needs_joined_message","never_needs_joined_msg","note","num_members","old_name","oldest_msg_ts","opened_this_session","org","parent_group","pending_shared","pinned_items","pinned_items_count","presence","previous_names","purpose","scroll_top","shared_team_ids","shares","domain","tooltip","topic","unlinked","unread_count_display","unread_count","unread_highlight_cnt_in_client","unread_highlights","unreads","user","was_archived_this_session","isUnknown","isNonExistent","fromAnotherTeam","team_id"];var l=["_get","_is_interop_channel_object","_set","_setWithReduxAction","attributes","children","disabled","is_broadcast_keyword","is_divider","is_emoji","is_usergroup","is_view","is_app_action","nodeType","old_name","props_to_define","selector","then","title","toObject","toJSON","window"];var u=_.reduce(s,function(e,t){e[t]=true;return e},{});var d=_.reduce(o,function(e,t){e[t]=true;return e},{});var c=_.reduce(l,function(e,t){e[t]=true;return e},{});var m={};var f=function t(n,i){if(!d[i]&&!u[i]&&!c[i]&&_.isString(i)){TS.console.logStackTrace("Accessing an unknown key "+i+" on a model object");r[i]||(r[i]=true);S()&&TS.console.error('Dev only warning: Trying to get an unknown field "'+i+'" from a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml');var a=e(n.id);return a&&a[i]}return n[i]};var p=function n(i,a,s){_.isString(a)&&(t[a]=(t[a]||0)+1);if(!d[a]&&!u[a]&&_.isString(a)){TS.console.logStackTrace("Setting an unknown key "+a+" on a model object");r[a]||(r[a]=true);if(S())throw new Error('Dev only warning: Trying to set an unknown field "'+a+'" on a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml');var o=e(i.id);o&&(o[a]=s)}i[a]=s;return true};var h=function e(t){this.id=t;Object.defineProperties(this,this.props_to_define)};var g={};_.without(o,"id").forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(n){return this._set(e,n)}};s.forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(n){return this._setWithReduxAction(e,n)}}})});h.prototype.props_to_define=g;h.prototype._is_interop_channel_object=true;h.prototype._get=function(t){var n=e(this.id);if(n)return n[t]};h.prototype._set=function(t,n){var r=e(this.id);r&&(r[t]=n);return true};h.prototype._setWithReduxAction=function(t,r){var i=e(this.id);if(i&&i[t]!==r){a(this.id,t,r);n[t]=(n[t]||0)+1}return true};var S=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var T=function e(t){if(!t)throw new Error("Must pass in a valid id to _createWrappedEntityById");var n;var r=i();if(m[t])n=m[t];else{n=new h(t);r&&(n=new window.Proxy(n,{get:function e(t,n){return f(t,n)},set:function e(t,n,r){return p(t,n,r)}}));m[t]=n}return n}})()},2888:function(e,t){(function(){TS.registerModule("redux.presence",{onStart:function e(){r()},getPresenceByMemberId:function t(n){return e(n)},toggleUserPresence:function e(){return TS.redux.dispatch(TS.interop.redux.features.presence.toggleUserPresence())},updatePresenceForMember:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:t.id,presence:t.presence}))},addToBulkUpsertPayload:function e(n){if(!n)return;var r=n.id;var i=n.presence;t.push({id:r,presence:i})},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.presence.getPresenceByMemberId");var t=[];var n=function e(){if(t.length){TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(t));t=[]}};var r=function e(){TS.members.presence_changed_sig.add(TS.redux.presence.updatePresenceForMember);TS.members.batch_upserted_sig.add(n)}})()},2889:function(e,t){(function(){TS.registerModule("redux.dnd",{isMemberInDndById:function t(n){return e(n)},getDndScheduleByMemberId:function e(n){return t(n)},getAllDndSchedules:function e(){return r()},getSnoozeScheduleForCurrentUser:function e(){return n()},updateDndForMember:function e(t,n){if(!t)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDnd({memberId:t,isInDnd:n}))},updateDndScheduleForMembers:function e(t){if(!t||!_.isArray(t)||!t.length)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDndSchedules(t))},updateDndScheduleForMember:function e(t,n,r){if(!t)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDndSchedule({memberId:t,nextDndStartTs:n,nextDndEndTs:r}))},removeDndScheduleForMember:function e(t){if(!t||!_.isArray(t)||!t.length)return;TS.redux.dispatch(TS.interop.redux.features.dnd.removeDndSchedule({memberIds:t}))},updateSnoozeScheduleForCurrentMember:function e(t,n){TS.redux.dispatch(TS.interop.redux.features.dnd.updateSnooze({snoozeEnabled:t,snoozeEndTs:n}))},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getDndByMemberId");var t=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getDndScheduleByMemberId");var n=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getSnoozeScheduleForCurrentUser");var r=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getAllDndSchedules")})()},289:function(e,t,n){n(290);n(293);n(294);n(295);e.exports=n(52).Symbol},2890:function(e,t){(function(){TS.registerModule("redux.enterprise",{setEnterprise:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.enterprise.setEnterprise(t))},getEnterprise:function e(){if(!TS.interop.redux.models.enterprise.getEnterprise)return null;return TS.interop.redux.models.enterprise.getEnterprise(TS.redux.getState())},getEnterpriseOrgName:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseOrgName)return null;return TS.interop.redux.models.enterprise.getEnterpriseOrgName(TS.redux.getState())},updateEnterpriseOrgName:function e(t){if(!TS.interop.redux.models.enterprise.updateEnterpriseName)return null;return TS.redux.dispatch(TS.interop.redux.models.enterprise.updateEnterpriseName(t))},getEnterpriseId:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseId)return null;return TS.interop.redux.models.enterprise.getEnterpriseId(TS.redux.getState())},getEnterpriseOrgInfo:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseOrgInfo)return Promise.reject();return TS.redux.dispatch(TS.interop.redux.models.enterprise.getEnterpriseOrgInfo())}})})()},2891:function(e,t){(function(){TS.registerModule("redux.files",{onStart:function e(){Object.defineProperty(TS.model,"files",{get:function e(){return TS.redux.files.getAllFiles()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.files: Set TS.model.files");return false}})},getFileById:function e(n){var r=t(n);if(!r||r.id!==n)return null;return r},getFileByProp:function e(t,n){var r=TS.redux.files.getAllFiles();return _.find(r,function(e){return e[t]===n})},getAllFiles:function t(){var i=e();if(i===n)return r;r=_.values(i);n=i;return r},addFile:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.files.addFile(t))},bulkAddFiles:function e(t){if(!_.isArray(t))return;TS.redux.dispatch(TS.interop.redux.models.files.bulkAddFiles(t))},logStats:function e(){var t=_(i).keys().union(_.keys(a)).value();var n={};_.forEach(t,function(e){n[e]={gets:i[e]||0,sets:a[e]||0}});TS.console.table(n)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getAllFiles");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getFileById");var n;var r;var i={};var a={}})()},2892:function(e,t){(function(){TS.registerModule("redux.prefs",{setUserPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setUserPrefs(t))},setTeamPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setTeamPrefs(t))},setEnterprisePrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setEnterprisePrefs(t))},setUserPref:function e(t,n){if(TS.redux.prefs.getUserPref(t)===n)return;TS.redux.dispatch(TS.interop.redux.features.prefs.setUserPref({pref:t,value:n}))},setMultipleUserPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setMultipleUserPrefs(t))},setTeamPref:function e(t,n){if(TS.redux.prefs.getTeamPref(t)===n)return;TS.redux.dispatch(TS.interop.redux.features.prefs.setTeamPref({pref:t,value:n}))},setChannelNotificationOverrideAndCallApi:function e(t,n,r){TS.redux.dispatch(TS.interop.redux.features.prefs.setChannelNotificationOverrideAndCallApi({name:t,value:n,channelId:r}))},getUserPref:function t(n){return e(n)},getTeamPref:function e(n){return t(n)},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getUserPref");var t=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getTeamPref")})()},2893:function(e,t){(function(){TS.registerModule("redux.reactions",{getReactionsForKey:function e(t){return TS.interop.redux.models.reactions.getReactionsForKey(TS.redux.getState(),t)},getReactionsForKeyAndName:function e(t,n){return TS.interop.redux.models.reactions.getReactionsForKeyAndName(TS.redux.getState(),t,n)},changeReactionFromUserAction:function e(t,n,r){return TS.redux.dispatch(TS.interop.redux.models.reactions.changeReactionFromUserAction({key:t,name:n,adding:r}))},addOrRemoveReaction:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.adding,r=t.key,i=t.name,a=t.userId,s=t.url,o=t.fromUserAction;var l=TS.redux.reactions.getReactionsForKey(r);var u=n?TS.interop.redux.models.reactions.addReaction({key:r,name:i,userId:a,url:s,fromUserAction:o}):TS.interop.redux.models.reactions.removeReaction({key:r,name:i,userId:a,url:s,fromUserAction:o});var d=TS.redux.dispatch(u);var c="NOOP";var m=TS.redux.reactions.getReactionsForKey(r);d&&(m&&_.isEmpty(l)?c="ADDED":_.isEqual(l,m)||(c="CHANGED"));return{status:c,what_changed:[],rxns:m}},upsertReactions:function e(t,n,r){var i=TS.redux.reactions.getReactionsForKey(t);var a=TS.redux.dispatch(TS.interop.redux.models.reactions.upsertReactions({key:t,reactions:n,fromUserAction:r}));var s="NOOP";a&&(n&&_.isEmpty(i)?s="ADDED":_.isEqual(i,n)||(s="CHANGED"));return{status:s,what_changed:[],rxns:n}}})})()},2894:function(e,t){(function(){TS.registerModule("redux.notifications",{getCalculatedDesktopNotifySetting:function t(n){return e(n)},getCalculatedMobileNotifySetting:function e(n){return t(n)},getDefaultDesktopNotifySetting:function e(t){return n(t)},getDefaultMobileNotifySetting:function e(t){return r(t)},getGlobalDesktopNotifySetting:function e(){return i("global_desktop")},getGlobalMobileNotifySetting:function e(){return i("global_mobile")},getGlobalHighlightWords:function e(){return i("global_keywords")},getDesktopNotificationSoundPref:function e(){return i("desktop_sound")},getNotificationPushIdleWaitTimeInMinutes:function e(){return i("push_idle_wait")},getThreadsEverythingNotificationPref:function e(){return i("threads_everything")},getNoTextInNotificationsPref:function e(){return i("no_text_in_notifications")},getAllNotificationOverrides:function e(){return a()},getNotificationsChannelPref:function e(t,n){return s(t,n)}});var e=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedDesktopNotifySetting");var t=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedMobileNotifySetting");var n=TS.redux.bindSelectorToStore("TS.interop.notifications.getDefaultDesktopNotifySetting");var r=TS.redux.bindSelectorToStore("TS.interop.notifications.getDefaultMobileNotifySetting");var i=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getNotificationsGlobalPref");var a=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getAllNotificationOverrides");var s=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getNotificationsChannelPref")})()},2895:function(e,t){(function(){TS.registerModule("redux.teams",{onStart:function e(){Object.defineProperty(TS.model,"team",{get:function e(){return TS.redux.teams.getCurrentTeam()},set:function e(){TS.error("TS.redux.teams: trying to set TS.model.team???");return false}})},upsertTeam:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.teams.upsertTeam({team:t}))},removeTeam:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.teams.removeTeam(t))},getTeamById:function e(t,n){if(!TS.interop.redux.models.teams.getTeamById)return null;return TS.interop.redux.models.teams.getTeamById(TS.redux.getState(),t,n)},getAllTeams:function e(){if(!TS.interop.redux.models.teams.getAllTeams)return null;return TS.interop.redux.models.teams.getAllTeams(TS.redux.getState())},getTeamByEnterpriseId:function e(t){if(!TS.interop.redux.models.teams.getTeamByEnterpriseId)return null;return TS.interop.redux.models.teams.getTeamByEnterpriseId(TS.redux.getState(),t)},getTeamByDomain:function e(t){if(!TS.interop.redux.models.teams.getTeamByDomain)return null;return TS.interop.redux.models.teams.getTeamByDomain(TS.redux.getState(),t)},getCurrentTeam:function e(){if(!TS.interop.redux.models.teams.getCurrentTeam)return null;return TS.interop.redux.models.teams.getCurrentTeam(TS.redux.getState())},ensureEnterpriseTeamIsKnown:function e(t,n){if(!TS.interop.redux.models.teams.ensureEnterpriseTeamIsKnown)return null;return TS.redux.dispatch(TS.interop.redux.models.teams.ensureEnterpriseTeamIsKnown({teamId:t,additionalOptions:n}))}})})()},2896:function(e,t){(function(){TS.registerModule("redux.socket",{connectedSig:new signals.Signal,disconnectedSig:new signals.Signal,provisionallyConnectedSig:new signals.Signal,socketErrorMessageReceivedSig:new signals.Signal,socketMessageReceivedSig:new signals.Signal,troubleConnectingSig:new signals.Signal,waitingForRateLimitSig:new signals.Signal,hasNeverConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.hasNeverConnected"),wasPreviouslyConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.wasPreviouslyConnected"),isAsleep:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isAsleep"),isConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnected"),isConnecting:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnecting"),isProvisionallyConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isProvisionallyConnected"),isWaitingForConnectivity:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForConnectivity"),isWaitingForRateLimit:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForRateLimit"),promiseToHaveOpenWebSocket:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.promiseToHaveOpenWebSocket")})})()},2897:function(e,t){(function(){TS.registerModule("redux.canvases",{addCanvas:function e(t){TS.redux.dispatch(TS.interop.redux.models.canvases.addCanvas(t))},updateCanvas:function e(t){TS.redux.dispatch(TS.interop.redux.models.canvases.updateCanvas(t))}})})()},2898:function(e,t){(function(){TS.registerModule("channels",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,left_sig:new signals.Signal,member_left_sig:new signals.Signal,list_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,topic_changed_sig:new signals.Signal,purpose_changed_sig:new signals.Signal,created_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,unshared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,shared_invite_pending_sig:new signals.Signal,shared_invite_revoked_sig:new signals.Signal,shared_invite_accepted_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,onStart:function e(){TS.channels.deleted_sig.add(function(e){TS.channels.temp_list_of_removed_channels[e]=true});TS.channels.joined_sig.add(function(e){delete TS.channels.temp_list_of_removed_channels[e.id]})},data_updated_sig:new signals.Signal,temp_list_of_removed_channels:{},legacyAddMsg:function e(t,n){var r=TS.interop.channels.getPublicChannelById(t);if(!r){TS.channels.temp_list_of_removed_channels[t]||TS.error('unknown channel "'+t+'"');return}if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return;TS.utility.msgs.maybeTruncateMsgs(r);TS.channels.message_received_sig.dispatch(r,n);r.is_mpim&&!r.is_open&&TS.interop.messages.canCountAsUnreadForCurrentUser(n,TS.model.user.id)&&TS.interop.api.call("conversations.open",{channel:r.id,reason:"TS.channels.legacyAddMsg"})},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getPublicChannelById(t);if(!r){TS.error('unknown channel "'+t+'"');return}TS.redux.messages.removeMessage(n);if(TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.channels.message_removed_sig.dispatch(r,n)},legacyEnsureWeCanSendMessageToChannel:function e(t,n,r){var i;if(!t)return false;if(t.is_archived)return false;if(!t.is_member)return false;var a=TS.interop.channels.getGeneralChannel();var s=function e(t,i){if(i){var a={text:t,ephemeral_type:i,slackbot_feels:"sad_surprise"};TS.client.ui.addOrFlashEphemeralBotMsg(a)}else TS.generic_dialog.alert(t).then(function(){r?TS.ui.replies.focusReplyInput():TS.view.focusMessageInput()});if(r){TS.ui.replies.populateReplyInput(n);TS.ui.replies.focusReplyInput()}else{TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}};if(TS.boot_data.feature_announce_only){if(!TS.interop.rules.user.canPostInChannel(t.id)){var o=TS.interop.i18n.t("Posting to the #*{channel_name}* channel has been restricted.","channels")({channel_name:t.name});s(o,"general_posting_restricted");return false}}else if(t.is_general&&!TS.permissions.members.canPostInGeneral()){var l=TS.interop.i18n.t("A Workspace Owner has restricted posting to the #*{channel_name}* channel.","channels")({channel_name:t.name});s(l,"general_posting_restricted");return false}var u=TS.format.cleanMsg(n);var d=!!r;var c=TS.interop.messages.atHereRegExp.test(u)||u.match(/(^|\s)@here(\b|$)/i);var _=TS.interop.messages.atChannelRegExp.test(u)&&!d||TS.interop.messages.atGroupRegExp.test(u)&&!d;var m=TS.interop.messages.atEveryoneRegExp.test(u)&&!d||TS.interop.rules.channels.isRequired(t)&&_;if(m){if(!TS.permissions.members.canAtMentionEveryone(t.id)){if(TS.model.user.is_restricted){i="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";s(i);return false}if(TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings(t.id)){i="<p>"+TS.interop.i18n.t("Usage of <b>{everyone}</b> is restricted to Workspace Admins in the large general channel.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}else i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";!TS.interop.rules.channels.isRequired(t)&&TS.permissions.members.canAtChannelOrGroup(t.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>");s(i);return false}if(!TS.interop.rules.channels.isRequired(t)&&!c){if(a&&a.is_member)TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","channels")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.interop.i18n.t('<p class="bold">Would you like to switch to #{general_channel} and send your message?</p>\t\t\t\t\t\t\t<p class="">Using <b>{everyone}</b> in a message is a way to address your entire workspace, but it must be done in the #{general_channel} channel.</p>\t\t\t\t\t\t\t<p class="no_bottom_margin">If you just want to address everyone in this channel, use <b>{channel}</b> instead.</p>',"channels")({general_channel:a.name,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","channels")(),onGo:function e(){TS.channels.legacyDisplayChannel({id:a.id,and_send_txt:n})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}});else{i="<p>"+TS.interop.i18n.t("You cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.permissions.members.canAtChannelOrGroup(t.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>");s(i)}return false}}if((_||c)&&!TS.permissions.members.canAtChannelOrGroup(t.id)){var f=c?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");if(TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t.id)){i="<p>"+TS.interop.i18n.t("Usage of <b>{key_word}</b> is restricted to Workspace Admins in this large channel.","channels")({key_word:f})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}else i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{key_word}</b> messages.","channels")({key_word:f})+"</p>";s(i);return false}if(!d&&TS.ui.needToShowAtChannelWarning(t.id,n)){TS.ui.at_channel_warning_dialog.startInMessagePane(t.id,n);return false}return true},legacyOnSendMsg:function e(t,n){var r=_.get(n,"SENT_MSG.channel");var i=TS.interop.channels.getPublicChannelById(r);if(!i){TS.error("unknown channel? "+r);return}TS.shared.legacyOnSendMsg(t,n,i,TS.channels)},legacyDisplayChannel:function e(t){var n=_.defaults({},t,{from_history:false,replace_history_state:false});var r=n.id;if(!r){TS.error("no channel id supplied");return}var a=n.path;var s=n.and_send_txt;var o=n.from_history;var l=n.replace_history_state;if(TS.isPartiallyBooted()&&r!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+r);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:r}));var u=TS.interop.channels.getPublicChannelById(r);if(!u){TS.error('channel "'+r+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);if(r===TS.model.active_channel_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('channel "'+r+'" already displayed');s&&TS.shared.legacySendMsg(r,_.trim(s));return}TS.has_pri[i]&&TS.log(i,"legacyDisplayChannel: "+u.id);if(!u.is_member&&s){TS.model.requested_channel_joins[r]={and_send_txt:s};TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:r})).catch(_.noop);return}var d=!l&&o;var c=TS.client.channelDisplaySwitched({id:r,path:a,replace_history_state:l,no_history_add:d});c&&TS.channels.switched_sig.dispatch();s&&TS.shared.legacySendMsg(r,_.trim(s))},legacyMarkMostRecentReadMsg:function e(t,n){if(!t){TS.error("channel unknown");return}TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}))},markReadMsg:function e(t,n,r){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}))},legacyOnJoin:function e(t,n,r){if(!t){if("name_taken"===n.error);else if("is_archived"===n.error)TS.channels.legacyDisplayChannel({id:TS.redux.channels.getPublicChannelByName(r.name).id});else if("restricted_action"===n.error)TS.generic_dialog.alert(TS.interop.i18n.t("<p>You don\u2019t have permission to create new channels.</p><p>Talk to your Workspace Owner.</p>","channels")());else{TS.error("failed to join channel");TS.generic_dialog.alert(TS.interop.i18n.t("Oops, something went wrong.","client")())}return}var i;var a;if(n.channel){a=TS.interop.channels.upsertChannel(n.channel);i=n.channel.id}if(!i){TS.error("no channel_id?!!");return}var s="";if(TS.model.requested_channel_joins[i]){s=TS.model.requested_channel_joins[i].and_send_txt;delete TS.model.requested_channel_joins[i]}if(!a){TS.error("no channel?!!");return}if(r._in_background)return;TS.interop.channels.getNeedsCreatedMessageState(a.name)||a.never_needs_joined_msg||(a.needs_joined_message=true);TS.client&&TS.channels.legacyDisplayChannel({id:i,and_send_txt:s})},leave:function r(i){var a=TS.interop.channels.getPublicChannelById(i)||TS.interop.channels.getGroupById(i);if(!a)return t({channel:a,reason:"no_channel"});var s=TS.interop.rules.channels.getLeaveAction(TS.redux.getState(),a);var o=TS.interop.rules.channels.LEAVE_ACTIONS;switch(s){case o.CONFIRM_AND_LEAVE:return n(a).then(function(t){if(t)return e(a)});case o.CONFIRM_LEAVE_AND_ARCHIVE:var l=true;return Promise.resolve(TS.channels.ui.showArchiveGroupDialog(a,l));case o.CLOSE:return Promise.resolve(TS.shared.legacyCloseArchivedChannel(a.id));case o.LEAVE:return e(a);case o.NONE:return t({channel:a,reason:"restricted_action"});default:TS.error("Failed to leave channel "+i+'. No case for a leave action "'+s+'" is defined.')}},legacyAlertSetPurposeError:function e(t){var n;var r=_.get(t,"data.error");n="too_long"===r?TS.interop.i18n.t("That purpose is too long. Please try again with fewer than 250 characters.","channels")():"restricted_action"===r||"user_is_restricted"===r?TS.interop.i18n.t("Uh oh! You don\u2019t have permission to change the purpose. Talk to your workspace admin.","channels")():TS.interop.i18n.t("Uh oh! Something went wrong with setting the purpose. Please try again.","channels")();var i=TS.interop.i18n.t("Oooops!","channels")();TS.generic_dialog.alert(n,i)},legacyAlertSetTopicError:function e(t){var n=_.get(t,"data.error");var r=TS.interop.i18n.t("Oooops!","channels")();var i=TS.interop.channels.getChannelTopicError(n);TS.generic_dialog.alert(i,r)},legacyUpdateTopicFromAPI:function e(t){if(TS.boot_data.feature_degraded_send){var n=_.get(t,"channel.id");var r=_.get(t,"channel.topic");if(!n||!r)return;TS.redux.dispatch(TS.interop.redux.models.channels.setChannelTopic({id:n,topic:r}))}},legacyUpdatePurposeFromAPI:function e(t){if(TS.boot_data.feature_degraded_send){var n=_.get(t,"channel.id");var r=_.get(t,"channel.purpose");if(!n||!r)return;TS.redux.dispatch(TS.interop.redux.models.channels.setChannelPurpose({id:n,purpose:r}))}},closeArchivedChannel:function e(t){TS.shared.legacyCloseArchivedChannel(t)},fetchList:function e(t,n){var i={exclude_members:1};if(TS.boot_data.feature_conversations_list){t&&(i.cursor=t);i.types="public_channel";i.limit=1e3;i.include_shared=true;var a=n||[];TS.interop.api.call("conversations.list",i).then(function(e){var t=e.data,n=e.args,i=e.request_id;var s=true;a=a.concat(t.channels);if(!t.response_metadata.next_cursor){t.channels=a;r&&r(s,t,n,i);return{data:t,args:n,request_id:i}}TS.channels.fetchList(t.response_metadata.next_cursor,a)},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}})}else TS.interop.api.call("channels.list",i).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}})},legacyKickMember:function e(t,n){var r=TS.redux.channels.getEntityById(t);if(TS.interop.rules.channels.isPublicChannel(r)&&!TS.permissions.members.canKickFromChannels())return;if(TS.interop.rules.channels.isPrivateChannel(r)&&!TS.permissions.members.canKickFromGroups())return;return TS.shared.legacyKickMember(r,n)},test:function e(){var t={_onListFetched:r};Object.defineProperty(t,"_confirmIntentToLeaveChannel",{get:function e(){return n},set:function e(t){n=t}});return t}});var e=function e(n){TS.channels.legacyMarkMostRecentReadMsg(n,TS.model.marked_reasons.left);TS.client.markLastReadsWithAPI();return TS.redux.dispatch(TS.interop.channels.submitLeave({channelId:n.id})).then(function(){n.msgs&&(n.msgs.length=0);n.is_limited&&(n.is_limited=false)}).catch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.message,i=e.data;var a=_.get(i,"error")||r;return t({channel:n,reason:a})})};var t=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.channel,r=t.reason;var i;switch(r){case"last_member":TS.interop.rules.channels.isExternallySharedChannel(n)?i=TS.model.user.is_admin?TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need to stop sharing this channel before you can leave it.</p>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))}):TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need an admin\u2019s help to leave. It\u2019s just a couple steps:</p><ul><li>Invite an admin to this channel.</li><li>Ask them to unshare and archive the channel.</li></ul>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))}):TS.shared.legacyCloseArchivedChannel(n.id);break;case"restricted_action":i=TS.interop.i18n.t("Sorry, you can\u2019t leave <strong>#{channel_name}</strong>!","channels")({channel_name:n.name});break;default:break}return i?TS.generic_dialog.alert(i):Promise.resolve()};var n=function e(t){return new Promise(function(e){TS.generic_dialog.start({title:TS.interop.i18n.t("Leave {group}","groups")({group:TS.model.group_prefix+t.name}),body:TS.interop.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","groups")(),go_button_text:TS.interop.i18n.t("Yes, leave the private channel","groups")(),onGo:function t(){return e(true)},onCancel:function t(){return e(false)}})})};var r=function e(t,n){if(!t){TS.error("failed to fetch channel list");return}n.channels&&n.channels.length&&TS.redux.channels.bulkAddEntities(_.compact(n.channels));TS.channels.list_fetched_sig.dispatch(n.channels)};var i=999})()},2899:function(e,t){(function(){TS.registerModule("membership",{membership_counts_need_refetch_sig:new signals.Signal,onStart:function t(){var n=Infinity;TS.members.changed_deleted_sig.add(e,this,n)}});var e=function e(){TS.redux.dispatch(TS.interop.redux.models.memberCounts.clearAllMemberCounts())}})()},290:function(e,t,n){"use strict";var r=n(46);var i=n(60);var a=n(56);var s=n(86);var o=n(168);var l=n(276).KEY;var u=n(73);var d=n(109);var c=n(119);var _=n(91);var m=n(43);var f=n(156);var p=n(157);var h=n(291);var g=n(292);var S=n(71);var T=n(68);var v=n(66);var b=n(115);var y=n(83);var w=n(163);var k=n(277);var x=n(261);var C=n(58);var I=n(98);var M=x.f;var A=C.f;var E=k.f;var P=r.Symbol;var F=r.JSON;var O=F&&F.stringify;var D="prototype";var H=m("_hidden");var $=m("toPrimitive");var j={}.propertyIsEnumerable;var B=d("symbol-registry");var L=d("symbols");var N=d("op-symbols");var R=Object[D];var U="function"==typeof P;var G=r.QObject;var q=!G||!G[D]||!G[D].findChild;var W=a&&u(function(){return 7!=w(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=M(R,t);r&&delete R[t];A(e,t,n);r&&e!==R&&A(R,t,r)}:A;var z=function(e){var t=L[e]=w(P[D]);t._k=e;return t};var K=U&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P};var V=function e(t,n,r){t===R&&V(N,n,r);S(t);n=b(n,true);S(r);if(i(L,n)){if(r.enumerable){i(t,H)&&t[H][n]&&(t[H][n]=false);r=w(r,{enumerable:y(0,false)})}else{i(t,H)||A(t,H,y(1,{}));t[H][n]=true}return W(t,n,r)}return A(t,n,r)};var Y=function e(t,n){S(t);var r=h(n=v(n));var i=0;var a=r.length;var s;while(a>i)V(t,s=r[i++],n[s]);return t};var J=function e(t,n){return void 0===n?w(t):Y(w(t),n)};var Q=function e(t){var n=j.call(this,t=b(t,true));if(this===R&&i(L,t)&&!i(N,t))return false;return!(n||!i(this,t)||!i(L,t)||i(this,H)&&this[H][t])||n};var X=function e(t,n){t=v(t);n=b(n,true);if(t===R&&i(L,n)&&!i(N,n))return;var r=M(t,n);!r||!i(L,n)||i(t,H)&&t[H][n]||(r.enumerable=true);return r};var Z=function e(t){var n=E(v(t));var r=[];var a=0;var s;while(n.length>a)i(L,s=n[a++])||s==H||s==l||r.push(s);return r};var ee=function e(t){var n=t===R;var r=E(n?N:v(t));var a=[];var s=0;var o;while(r.length>s)!i(L,o=r[s++])||n&&!i(R,o)||a.push(L[o]);return a};if(!U){P=function e(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var t=_(arguments.length>0?arguments[0]:void 0);var n=function(e){this===R&&n.call(N,e);i(this,H)&&i(this[H],t)&&(this[H][t]=false);W(this,t,y(1,e))};a&&q&&W(R,t,{configurable:true,set:n});return z(t)};o(P[D],"toString",function e(){return this._k});x.f=X;C.f=V;n(191).f=k.f=Z;n(111).f=Q;n(132).f=ee;a&&!n(127)&&o(R,"propertyIsEnumerable",Q,true);f.f=function(e){return z(m(e))}}s(s.G+s.W+s.F*!U,{Symbol:P});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)m(te[ne++]);for(var re=I(m.store),ie=0;re.length>ie;)p(re[ie++]);s(s.S+s.F*!U,"Symbol",{for:function(e){return i(B,e+="")?B[e]:B[e]=P(e)},keyFor:function e(t){if(!K(t))throw TypeError(t+" is not a symbol!");for(var n in B)if(B[n]===t)return n},useSetter:function(){q=true},useSimple:function(){q=false}});s(s.S+s.F*!U,"Object",{create:J,defineProperty:V,defineProperties:Y,getOwnPropertyDescriptor:X,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});F&&s(s.S+s.F*(!U||u(function(){var e=P();return"[null]"!=O([e])||"{}"!=O({a:e})||"{}"!=O(Object(e))})),"JSON",{stringify:function e(t){var n=[t];var r=1;var i,a;while(arguments.length>r)n.push(arguments[r++]);a=i=n[1];if(!T(i)&&void 0===t||K(t))return;g(i)||(i=function(e,t){"function"==typeof a&&(t=a.call(this,e,t));if(!K(t))return t});n[1]=i;return O.apply(F,n)}});P[D][$]||n(64)(P[D],$,P[D].valueOf);c(P,"Symbol");c(Math,"Math",true);c(r.JSON,"JSON",true)},2900:function(e,t){(function(){TS.registerModule("channels.read_only",{list_updated_sig:new signals.Signal,refetching_channel_info_ids:{},stashAndFetchChannelPostingUpdates:function e(t,n,r){if(!TS.boot_data.page_needs_enterprise||!TS.boot_data.feature_default_shared_channels)return;if(TS.channels.read_only.refetching_channel_info_ids[t])return;TS.channels.read_only.refetching_channel_info_ids[t]=true;var i={id:t};var a=true;switch(n){case 6:i.is_read_only=true;i.is_thread_only=false;i.is_non_threadable=false;break;case 7:i.is_read_only=false;i.is_thread_only=true;i.is_non_threadable=false;break;case 8:i.is_read_only=false;i.is_thread_only=false;i.is_non_threadable=true;break;default:a=false;break}if(a){TS.interop.channels.upsertChannel(i);TS.channels.read_only.list_updated_sig.dispatch()}TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.shared.promiseToRefetchModelOb(t,r).then(function(){delete TS.channels.read_only.refetching_channel_info_ids[t];TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.channels.read_only.list_updated_sig.dispatch()})},addChannelToList:function e(t){TS.model.read_only_channels=_.uniq(_.concat(TS.model.read_only_channels,t));TS.channels.read_only.list_updated_sig.dispatch()},removeChannelFromList:function e(t){TS.model.read_only_channels=TS.model.read_only_channels.filter(function(e){return e!==t});TS.channels.read_only.list_updated_sig.dispatch()},isReadOnly:function e(t){if(TS.boot_data.page_needs_enterprise){if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return false}else if(TS.model.user.owner)return false;if(!TS.interop.utility.looksLikeChannelId(t))return false;var n=false;var r=TS.redux.channels.getEntityById(t,n);if(!r)return false;if(r.is_im||r.is_mpim)return false;if(!_.isUndefined(r.is_read_only))return r.is_read_only;return TS.model.read_only_channels.indexOf(t)>-1}})})()},2901:function(e,t){(function(){TS.registerModule("channels.ui",{onStart:function e(){},showArchiveChannelDialog:function e(t){TS.generic_dialog.start({title:TS.interop.i18n.t("Archive #{channel_name}","channels")({channel_name:t.name}),body:TS.templates.channel_option_archive({name:t.name}),go_button_text:TS.interop.i18n.t("Yes, archive the channel","channels")(),onGo:function e(){var n=function e(t,n){if(t){if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var r=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:n.error});"last_ra_channel"===n.error?r=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"restricted_action"===n.error?r=TS.interop.i18n.t("<p>You don\u2019t have permission to archive channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"already_archived"===n.error?r=TS.interop.i18n.t("This channel was already archived.","channels")():"cant_archive_general"===n.error&&(r=TS.interop.i18n.t("This channel cannot be archived.","channels")());setTimeout(TS.generic_dialog.alert,500,r)};TS.interop.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}},function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})}})},showArchiveGroupDialog:function e(t,n){var r=TS.interop.i18n.t("{leave, select, true{Leave and archive}other{Archive}} {prefix}{name}","channels")({leave:n,prefix:TS.model.group_prefix,name:t.name});var i=TS.interop.i18n.t("{leave, select, true{Yes, leave & archive the channel}other{Yes, archive the channel}}","channel")({leave:n});TS.generic_dialog.start({title:r,body:TS.templates.channel_option_archive({name:t.name,group_prefix:TS.model.group_prefix}),go_button_text:i,onGo:function e(){var r=function e(r,i){if(r){n&&TS.client&&TS.shared.legacyCloseArchivedChannel(t.id);if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var a=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:i.error});"last_ra_channel"===i.error?a=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"already_archived"===i.error?a=TS.interop.i18n.t("This channel was already archived.","channels")():"restricted_action"===i.error?a=TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"user_is_restricted"===i.error&&(a=n?TS.interop.i18n.t('<h3 class="top_margin">Ask an admin to archive this channel</h3><p>Since you\u2019re the last one here, you\u2019ll need to invite an admin and ask them to archive the channel.</p>',"channels","1cbc791173101451030c2c2ad2d4a672ee7b86d8")():TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")());setTimeout(TS.generic_dialog.alert,500,a)};TS.interop.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})}})},channelCreateDialogShowDisallowedCharsAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".invalid_chars_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowSinglePunctuationAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".single_punctuation_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogCleanName:function e(t){var n=t.find(".title_input").val();var r=TS.utility.cleanChannelName(n);while("#"===n.substr(0,1))n=n.substr(1);if(r!=n){t.find(".title_input").val(r);TS.channels.ui.channelCreateDialogShowDisallowedCharsAlert(t);return false}return true},channelCreateDialogValidateInput:function e(t){var n=t.find(".title_input").val();var r=TS.utility.cleanChannelName(n);if(!TS.channels.ui.channelCreateDialogCleanName(t))return false;if("_"===r||"-"===r){TS.channels.ui.channelCreateDialogShowSinglePunctuationAlert(t);return false}if(!n){$("#channel_create_title").select();return false}if(TS.redux.channels.getPublicChannelByName(n)||TS.interop.memberExistsWithName(n)){TS.channels.ui.channelCreateDialogShowNameTakenAlert(t);return false}return true}})})()},2902:function(e,t){(function(){TS.registerModule("groups",{switched_sig:new signals.Signal,member_joined_sig:new signals.Signal,member_left_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,closed_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,legacyAddMsg:function e(t,n){var r=TS.interop.channels.getGroupById(t);if(!r){TS.channels.temp_list_of_removed_channels[t]||TS.error('unknown group "'+t+'"');return}if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return;TS.utility.msgs.maybeTruncateMsgs(r);TS.groups.message_received_sig.dispatch(r,n)},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getGroupById(t);if(!r){TS.error('unknown group "'+t+'"');return}TS.redux.messages.removeMessage(n);if(TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.groups.message_removed_sig.dispatch(r,n)},legacyOnSendMsg:function e(t,n){var r=TS.interop.channels.getGroupById(n.SENT_MSG.channel);if(!r){TS.error("unknown group? "+n.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,n,r,TS.groups)},legacyDisplayGroup:function e(n){var r=_.defaults({},n,{from_history:false,replace_history_state:false});var i=r.id;if(!i){TS.error("no group id supplied");return}var a=r.path;var s=r.and_send_txt;var o=r.from_history;var l=r.replace_history_state;if(TS.isPartiallyBooted()&&i!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+i);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:i}));var u=TS.interop.channels.getGroupById(i);if(!u){TS.error('group "'+i+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.has_pri[t]&&TS.log(t,"legacyDisplayGroup "+u.id+" from_history:"+o+" replace_history_state:"+l);if(i===TS.model.active_group_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('group "'+i+'" already displayed');s&&TS.shared.legacySendMsg(i,$.trim(s));return}var d=!l&&o;var c=a||"/messages/"+u;var m=TS.client.channelDisplaySwitched({id:i,path:c,replace_history_state:l,no_history_add:d});m&&TS.groups.switched_sig.dispatch();s&&TS.shared.legacySendMsg(i,$.trim(s))},legacyMarkMostRecentReadMsg:function e(t,n){if(!t){TS.error("group unknown");return}TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}))},markReadMsg:function e(t,n,r){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}))},createChild:function t(n,r,i){var a=false;var s=TS.interop.channels.getGroupById(n,a);s||(s=TS.interop.channels.getPublicChannelById(n,a));if(!s)return;if(TS.interop.rules.channels.isExternallySharedChannel(s)){var o=TS.interop.i18n.t("Uh oh!","channel_invite")();var l=TS.interop.i18n.t("Sorry! Something went wrong.","channel_invite")();TS.ui.fs_modal.close();TS.generic_dialog.alert(l,o);return}TS.model.archives_and_recreated_groups[n]=true;var u=r?r.join(","):"";var d=function t(n,r,a){e(n,r,a);i&&i(n,r,a)};TS.interop.api.call("conversations.createChild",{channel:n,_and_invite_members_ids:u}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d(i,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d(i,t,n,r);return{data:t,args:n,request_id:r}})},createSuggestedName:function e(t){var n=TS.model.user.name;var r=[];var i;var a;var s=TS.model.channel_name_max_length;for(a=0;a<t.length;a+=1){i=TS.interop.members.getMemberById(t[a]);if(!i)continue;r.push(i)}r.sort(function e(t,n){var r=t._name_lc;var i=n._name_lc;if(r<i)return-1;if(r>i)return 1;return 0});for(a=0;a<r.length;a+=1){i=r[a];n+="-"+i.name.split("-")[0]}if(n.length>s){n=n.substr(0,s);"-"===n.charAt(n.length-1)&&(n=n.substr(0,s-1))}var o=n;var l=1;var u;while(TS.redux.channels.getPublicOrPrivateChannelByName(n)||TS.interop.members.memberExistsWithName(n)){u=(l+1).toString();l+=1;n=o+u;n.length>s&&(n=o.substr(0,s-u.length)+u)}return n},kickMember:function e(t,n){if(!TS.permissions.members.canKickFromGroups())return;var r=TS.interop.channels.getGroupById(t);if(!r)return;return TS.shared.legacyKickMember(r,n)},test:function t(){return{_onCreate:e}}});var e=function e(t,n,r){if(!t){"name_taken"===n.error||"restricted_action"===n.error||TS.error("failed to create group");return}if(n.channel){var i=TS.interop.channels.upsertChannel(n.channel);var a=n.channel.id}if(!a){TS.error("no group_id?!!");return}if(!i){TS.error("no group?!!");return}var s=r._and_invite_members_ids?r._and_invite_members_ids.split(","):null;s&&TS.interop.api.call("conversations.invite",{channel:a,users:s.join(",")});if(TS.client){var o={id:a};n.channel.is_group?TS.groups.legacyDisplayGroup(o):TS.channels.legacyDisplayChannel(o)}};var t=999})()},2903:function(e,t){(function(){TS.registerModule("ims",{switched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,closed_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(n);TS.prefs.team_display_real_names_changed_sig.add(n);TS.members.changed_profile_sig.add(t)},legacyAddMsg:function e(t,n){var r=TS.interop.channels.getImById(t);if(!r){TS.error('unknown im "'+t+'"');return}if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return;TS.utility.msgs.maybeTruncateMsgs(r);TS.ims.message_received_sig.dispatch(r,n);r.is_open||TS.interop.api.call("conversations.open",{users:r.user,return_im:true,reason:"TS.ims.legacyAddMsg"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}})},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getImById(t);if(!r){TS.error('unknown im "'+t+'"');return}TS.redux.messages.removeMessage(n);if(TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.ims.message_removed_sig.dispatch(r,n)},legacyOnSendMsg:function e(t,n){var r=TS.interop.channels.getImById(n.SENT_MSG.channel);if(!r){TS.error("unknown im? "+n.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,n,r,TS.ims)},legacyOnClose:function e(t){if(!TS.client)return;var n=TS.model.active_im_id===t;n?TS.client.activeChannelDisplayGoneAway():TS.ims.closed_sig.dispatch(TS.interop.channels.getImById(t))},legacyStartImById:function e(t,n,r){var i=TS.interop.channels.getImById(t);if(!i){TS.error(t+" not an im");return}TS.ims.legacyStartImByMemberId(i.user,n,r)},legacyStartImByMemberId:function e(t,n,r){var i=TS.shared.legacyGetActiveModelOb();i&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessagesInChannel({channelId:i.id}));var a=TS.redux.channels.getImByMemberId(t);if(a){TS.ims.legacyDisplayIm(a.id,n);if(a.is_open){r&&TS.shared.legacySendMsg(a.id,$.trim(r));return Promise.resolve()}}TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.addPendingOpenChannel({memberId:t,msgText:r}));return TS.interop.channels.openConversationByMembers({memberIds:[t],reason:"TS.ims.legacyStartImByMemberId"}).then(function(e){var n=e.data,r=e.args,i=e.request_id;var a=true;if(TS.ims.legacyOnOpened){TS.ims.legacyOnOpened(a,n,r,i);if(r.return_im&&TS.boot_data.feature_degraded_send&&TS.redux.channels.getImByMemberId(t)){var s=TS.redux.channels.getImByMemberId(t);TS.interop.channels.setConversationOpen(s.id,t)}}return{data:n,args:r,request_id:i}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}})},promiseToStartImByMemberId:function e(t){var n;n=TS.redux.dispatch(TS.interop.actions.displayModelOrViewById({id:t})).catch(function(e){e&&"editing-message"===e.message&&TS.ui.fs_modal.close();throw e});var r=function e(){var n=TS.shared.legacyGetActiveModelOb();return n&&n.is_im&&n.user===t};if(r())return Promise.resolve();return n.then(function(){if(r())return Promise.resolve();var e;return new Promise(function(t){e=function e(){if(r())return t()};TS.ims.switched_sig.add(e)}).timeout(3e4).finally(function(){TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.clearPendingOpenChannel({memberId:t}));TS.ims.switched_sig.remove(e)})}).catch(_.noop)},legacyOnOpened:function e(t,n,r){if(!t)return;r.return_im&&n.channel&&TS.interop.channels.upsertChannel(n.channel)},legacyDisplayIm:function e(t,n,r){if(TS.isPartiallyBooted()&&t!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+t);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:t}));var a=TS.interop.channels.getImById(t);if(!a){TS.error('im "'+t+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(a);if(t==TS.model.active_im_id&&!TS.client.activeChannelIsHidden()){r&&TS.shared.legacySendMsg(a.id,$.trim(r));return}TS.has_pri[i]&&TS.log(i,"legacyDisplayChannel (im): "+t);var s=TS.client.channelDisplaySwitched({id:t,no_history_add:n});s&&TS.ims.switched_sig.dispatch();r&&TS.shared.legacySendMsg(a.id,$.trim(r))},legacyMarkMostRecentReadMsg:function e(t,n){if(!t){TS.error("im unknown");return}TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}))},markReadMsg:function e(t,n,r){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}))},getDisplayNameOfUserForIm:function t(n){return e(n)},getDisplayNameOfUserForImLowerCase:function e(t){return TS.interop.members.getPrefCompliantMemberNameLowerCase(TS.interop.members.getMemberById(t.user))},getImByUsername:function e(t){if(TS.boot_data.feature_deprecate_get_member_by_name){TS.logError("Tried to get IM by username","get_member_by_name","getImByUsername");return}var n=TS.interop.members.getMemberByName(t);if(!n)return null;return TS.redux.channels.getImByMemberId(n.id)},getFirstOpenIm:function e(){var t=TS.model.ims;var n;if(!t)return null;for(var r=0;r<t.length;r+=1){n=t[r];if(n.is_open)return n}return null}});var e=function e(t){if(t._display_name)return t._display_name;var n=t.user;var r=TS.interop.members.getMemberById(t.user);if(!r)return t.name;var i=TS.interop.members.getPrefCompliantMemberName(r);if(i===t.user||i===r.id){TS.console.logError({msg:"Member name looks like an ID",im_user:n,member:r},"member_name_is_id");return t.name}t._display_name=i;return t._display_name};var t=function e(t){var n=_.find(TS.model.ims,{user:t.id});n&&r(n)};var n=function e(){TS.model.ims.forEach(r)};var r=function e(t){t._display_name=void 0};var i=999})()},2904:function(e,t){(function(){TS.registerModule("mpims",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(n);TS.prefs.team_display_real_names_changed_sig.add(n);TS.members.changed_profile_sig.add(t)},legacyAddMsg:function e(t,n){var r=TS.interop.channels.getMpimById(t);if(!r){TS.error('unknown mpim "'+t+'"');return}if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return;TS.utility.msgs.maybeTruncateMsgs(r);TS.mpims.message_received_sig.dispatch(r,n);if(!r.is_open&&TS.interop.messages.canCountAsUnreadForCurrentUser(n,TS.model.user.id))if(1==r.members.length){var i=r.members[0];TS.interop.api.call("conversations.open",{users:i,return_im:true,reason:"TS.mpims.legacyAddMsg"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}})}else if(r.members.length>1){var a=r.members.join(",");TS.interop.api.call("conversations.open",{users:a})}},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getMpimById(t);if(!r){TS.error('unknown mpim "'+t+'"');return}TS.redux.messages.removeMessage(n);if(TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.mpims.message_removed_sig.dispatch(r,n)},legacyOnSendMsg:function e(t,n){var r=TS.interop.channels.getMpimById(n.SENT_MSG.channel);if(!r){TS.error("unknown mpim? "+n.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,n,r,TS.mpims)},legacyDisplayMpim:function e(t){var n=_.defaults({},t,{from_history:false,replace_history_state:false});var r=n.id;if(!r){TS.error("no mpim id supplied");return}var i=n.path;var a=n.and_send_txt;var o=n.from_history;var l=n.replace_history_state;if(TS.isPartiallyBooted()&&r!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+r);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:r}));var u=TS.interop.channels.getEntityById(r);if(!TS.interop.rules.channels.isMpim(u)){TS.error('mpim "'+r+'" unknown');return}if(u.is_channel)return TS.channels.legacyDisplayChannel(t);TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);if(r==TS.model.active_mpim_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('mpim "'+r+'" already displayed');a&&TS.shared.legacySendMsg(r,$.trim(a));return}TS.has_pri[s]&&TS.log(s,"legacyDisplayChannel (mpim): "+r);var d=!l&&o;var c=i||"/messages/"+u;var m=TS.client.channelDisplaySwitched({id:r,path:c,replace_history_state:l,no_history_add:d});m&&TS.mpims.switched_sig.dispatch();if(u.is_open){a&&TS.shared.legacySendMsg(r,$.trim(a));return}TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.addPendingOpenChannel({channelId:u.id,msgText:a}));var f=u.members.filter(function(e){return TS.model.user.id!==e});TS.interop.api.call("conversations.open",{users:f.join(",")})},legacyMarkMostRecentReadMsg:function e(t,n){if(!t){TS.error("mpim unknown");return}TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}))},markReadMsg:function e(t,n,r){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}))},legacyGetMembersInDisplayOrder:function e(t){if(TS.boot_data.feature_modern_mpim_make_name)return TS.interop.mpims.getMembersInDisplayOrder(t);if(!t)return;return _.chain(t.members).without(TS.model.user.id).map(function(e){return TS.redux.members.getPotentiallyUnknownMemberById(e)}).compact().value()},legacyGetDisplayName:function e(t,n,r,s,o){var l=_.isInteger(s);if(t._display_name&&!n&&!r&&!l&&!o)return t._display_name;if(t._display_name_truncated&&!n&&!r&&!o&&l)return t._display_name_truncated;if(o)return a(t);return i(t,n)},legacyHasUnknownMember:function e(t){var n=TS.mpims.legacyGetMembersInDisplayOrder(t);if(!n)return true;return _.some(n,"is_unknown")},getMemberCount:function e(t){return Math.min(Math.max(t.members.length-1,2),9)},makeNameForMpim:function t(n){if(TS.boot_data.feature_modern_mpim_make_name)return TS.interop.mpims.makeNameForMpim(n);return e(n)},checkMpimMatch:function e(t,n,r){if(!t)return;var i=true;var a=true;var s=TS.mpims.legacyGetMembersInDisplayOrder(t);for(var o=0;o<n.length;o+=1){var l=false;for(var u=0;u<s.length;u+=1)(TS.utility.members.checkMemberMatch(s[u],n[o],i)||r&&TS.utility.members.checkMemberMatch(s[u],r[o],i))&&(l=true);l||(a=false)}return a}});var e=function e(t){var n=TS.mpims.legacyGetMembersInDisplayOrder(t);if(n.length<2)return t._internal_name;return"@"+_(n).compact().map(function(e){if(TS.interop.members.isExternal(e))return e.name+"_"+e.team_id;return e.name}).value().join(",")};var t=function e(t){TS.model.mpims.forEach(function(e){-1!==e.members.indexOf(t.id)&&r(e)})};var n=function e(){TS.model.mpims.forEach(r)};var r=function e(t){t._display_name=void 0};var i=function e(t,n){var r=TS.mpims.legacyGetMembersInDisplayOrder(t);var i=_.find(r,"is_unknown");if(i)return TS.templates.unknown_member({id:i.id});var a=_(r).map(function(e){var t=TS.interop.members.getPrefCompliantMemberName(e);if(n){var r="";var i=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e.id);(i.emoji||i.text)&&(r=" "+TS.templates.current_status({tip_direction:"bottom",member:e,classes:"ts_tip_float ts_tip_hidden"}));t=_.escape($.trim(t));t='<li class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+t+r+"</li>"}return t}).compact().value();var s=n?a.join(" "):a.join(", ");n||(t._display_name=s);return s};var a=function e(t){var n=TS.mpims.legacyGetMembersInDisplayOrder(t);var r=n.map(function(e){return TS.interop.members.getPrefCompliantMemberName(e)});var i=TS.interop.i18n.listify(r,{strong:true}).join("");return i};var s=999})()},2905:function(e,t){(function(){var e="HISTORY";TS.registerModule("shared",{msg_sent_sig:new signals.Signal,onStart:function e(){if(TS.client){TS.channels.switched_sig.add(l);TS.ims.switched_sig.add(l);TS.groups.switched_sig.add(l);TS.mpims.switched_sig.add(l);TS.client&&TS.client.unread&&TS.client.unread.switched_sig.add(l);TS.client&&TS.client.threads&&TS.client.threads.switched_sig.add(l);var t=function e(){h()};TS.redux.socket.connectedSig.addOnce(t)}},test:function e(){var t={};Object.defineProperty(t,"_queried_usernames",{get:function e(){return g},set:function e(t){g=t}});return t},legacyMaybeClearUsersCountsInfo:function e(t){if(!t)return;if(b(t.id))return;TS.has_pri[x]&&TS.log(x,"Deleting users_counts_info for "+t.id);TS.shared.legacyDeleteUserCountsInfoForId(t.id)},legacySetUserCountsInfoForId:function e(t,r){if(!t)return;n[t]=r},legacyDeleteUserCountsInfoForId:function e(t){if(!t)return;delete n[t]},legacyGetOldestUnreadTsForId:function e(t){if(!t)return;return r[t]},legacySetOldestUnreadTsForId:function e(t,n){if(!t)return;r[t]=n},legacyOnSendMsg:function e(t,n,r,i){var s=n.temp_ts?TS.utility.msgs.getMsgByProp("temp_ts",n.temp_ts,r.msgs):null;if(!t){if(s){TS.model.unsent_msgs[s.ts]=true;i.msg_not_sent_sig.dispatch(r,s,n)}else TS.error("that makes no sense");return}TS.view.scroll_down_when_msg_from_user_is_added=true;var o;if(s){o=_.cloneDeep(s);o.text=n.text;o.ts=n.ts;delete o.is_pending;i.legacyRemoveMsg(r.id,s)}else{TS.warn("no temp msg for "+n.reply_to);o={text:n.text,user:TS.model.user.id,ts:n.ts}}n.SENT_MSG.thread_ts&&(o.thread_ts=n.SENT_MSG.thread_ts);i.legacyAddMsg(n.SENT_MSG.channel||r.id,TS.interop.messages.preprocessImsg(o,r.id));var l=TS.client&&TS.client.stats&&TS.client.stats.isEnabled();l&&TS.metrics.measureAndClear("send_msg_channel","msg_input_try_to_submit");r.id&&a(r.id,o)},legacySendMsg:function e(t,n,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!n)return false;var s=TS.redux.channels.getEntityById(t);if(!s)return false;var o=TS.shared.legacyGetControllerForModelOb(s);if(a)if(o===TS.groups||o===TS.ims){var l=C(s,n,o,r);if(!l)return false}else if(o===TS.channels){var u=TS.channels.legacyEnsureWeCanSendMessageToChannel(s,n,r);if(!u)return false}TS.redux.dispatch(TS.interop.redux.actions.prepareAndSendMessage({channelId:t,text:n,replyToTs:r?r.thread_ts||r.ts:null,shouldBroadcast:i}));TS.redux.dispatch(TS.interop.typing.currentUserEndedTyping({channelId:t}));return true},legacyMaybeDealWithAllSentTempMsgs:function n(r,i){if(!TS.interop.Flannel.useSocket())return;function a(t){var n=TS.utility.msgs.getMsg(t,r.msgs);if(!n)return;var a=TS.utility.msgs.getNonTempMsgFromUserMatchingText(n.text,TS.model.user.id,r.msgs);if(a){var s=TS.interop.datetime.toDateObject(a.ts);var o=TS.interop.datetime.toDateObject(t);if(s<o){TS.interop.console.info(e,"existing_msg time is older than temp_msg time, so it can\u2019t be the message we were looking for");a=null}}if(!a){TS.warn("not removing, we don\u2019t appear to have this non-temp message: "+n.ts);TS.model.unsent_msgs[n.ts]=true;i.msg_not_sent_sig.dispatch(r,n);return}TS.interop.console.info(e,"removing temp_msg: "+n.ts+" existing_msg:"+a.ts);i||(i=TS.shared.legacyGetControllerForModelOb(r));_.isFunction(i.legacyRemoveMsg)&&i.legacyRemoveMsg(r.id,n);return true}if(!t.hasOwnProperty(r.id))return;t[r.id].forEach(function(e){a(e)});delete t[r.id]},legacyGetControllerForModelOb:function e(t){if(!t)return{};if(t.is_im)return TS.ims;if(t.is_mpim&&t.is_group)return TS.mpims;if(t.is_group)return TS.groups;return TS.channels},legacyGetActiveModelOb:function e(){var t;if(TS.client)TS.model.active_channel_id?t=TS.interop.channels.getPublicChannelById(TS.model.active_channel_id):TS.model.active_im_id?t=TS.interop.channels.getImById(TS.model.active_im_id):TS.model.active_mpim_id?t=TS.interop.channels.getMpimById(TS.model.active_mpim_id):TS.model.active_group_id&&(t=TS.interop.channels.getGroupById(TS.model.active_group_id));else if(TS.boot_data.channel_id)t=TS.interop.channels.getPublicChannelById(TS.boot_data.channel_id);else if(TS.boot_data.im_id)t=TS.interop.channels.getImById(TS.boot_data.im_id);else if(TS.boot_data.mpim_id)t=TS.interop.channels.getMpimById(TS.boot_data.mpim_id);else if(TS.boot_data.group_id)t=TS.interop.channels.getGroupById(TS.boot_data.group_id);else{TS.warn("error getActiveModelOb found no ob");TS.warn("TS.boot_data.channel_id: "+TS.boot_data.channel_id);TS.warn("TS.boot_data.im_id: "+TS.boot_data.im_id);TS.warn("TS.boot_data.group_id: "+TS.boot_data.group_id)}return t},legacyGetShareModelObId:function e(t,n){if(TS.boot_data.feature_file_threads){if(!t){n(t);return}TS.redux.dispatch(TS.interop.redux.actions.getChannelIdForSharing({channelOrMemberId:t})).then(n);return}var r;var i;var a=function e(t){TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==t&&TS.client.archives.cancel()};if(t&&TS.interop.utility.looksLikeMemberId(t)){r=TS.redux.channels.getImByMemberId(t);if(r){t=r.id;a(t);n(t)}else{var s=function e(i,a,s){if(i){TS.ims.legacyOnOpened(i,a,s);r=TS.redux.channels.getImByMemberId(t);r?n(r.id):TS.web?n(a.channel.id):TS.error("legacyGetShareModelObId opened an IM, but it is not in the model? data.channel.id: "+a.channel.id)}else TS.error("legacyGetShareModelObId try to open an IM, but failed data: "+JSON.stringify(a||null))};TS.interop.api.call("conversations.open",{users:t,return_im:true,reason:"TS.shared.legacyGetShareModelObId"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}}else if(t&&"C"===t.charAt(0)){i=TS.interop.channels.getPublicChannelById(t);if(i.is_member||i.is_archived){a(t);n(t)}else TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:i.id})).catch(_.noop).finally(function(){n(t)})}else{a(t);n(t)}},legacyMaybeMarkReadIfMuted:function e(t){if(!t)return;if(!t.is_mpim)return;if(!TS.notifs.isCorGMuted(t.id))return;if(!t.unreads.length||t.unread_highlights.length)return;if("hide_read_channels"===TS.prefs.getPref("sidebar_behavior")){if(TS.model.active_cid==t.id)return}else if("hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&!t.is_starred&&TS.model.active_cid==t.id)return;t.is_mpim?TS.mpims.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted):t.is_group?TS.groups.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted):TS.channels.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted)},legacyMarkReadMsg:function e(t,n,r){var i=TS.redux.channels.getEntityById(t);var a=TS.shared.legacyGetControllerForModelOb(i);_.isFunction(a.markReadMsg)&&a.markReadMsg(i.id,n,r)},moveLastMsgInput:function e(t,n){if(!t.last_msg_input)return;n.last_msg_input=t.last_msg_input;n.has_draft=!!n.last_msg_input;t.last_msg_input="";t.has_draft=!!t.last_msg_input;TS.storage.storeLastMsgInput(t.id,t.last_msg_input);TS.storage.storeLastMsgInput(n.id,n.last_msg_input)},legacyCloseArchivedChannel:function e(t){var n=TS.redux.channels.getEntityById(t);if(!n)return;if(!n.is_archived)return;n.was_archived_this_session=false;TS.client.activeChannelDisplayGoneAway()},legacyGetLastMsg:function e(t){if(!t.msgs||0===t.msgs.length)return null;for(var n=0;n<t.msgs.length;n+=1)if(!TS.interop.rules.messages.isHidden(t.msgs[n])&&!t.msgs[n].is_ephemeral)return t.msgs[n];return null},legacyCheckForOldImsToClose:function e(){var t=TS.model.ims;var n=TS.model.mpims;var r=t.concat(n);var i;var a;var s;var o;var l;var u=0;var d=221;var c=11;var m=6048e5;for(l=0;l<r.length;l+=1){i=r[l];if(!i.is_open&&!i.unread_cnt)continue;u+=1}var f=u-c;if(f<1)return;TS.info("legacyCheckForOldImsToClose might close some. this_too_many:"+f);var p=[];for(l=0;l<r.length;l+=1){i=r[l];TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": model_ob_id: "+i.id);if(TS.interop.rules.channels.isSlackbot(i)){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": don't autoclose slackbot DM");continue}if(TS.interop.rules.channels.isYou(i)){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": don't close messages with self");continue}if(!i.is_open){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if it is not opened we do not have to close it");continue}if(i.unread_cnt){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if there are unreads, we should not close it");continue}if(i.last_msg_input){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if there is a draft, we should not close it");continue}if(i.is_starred){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if it is starred, we should not close it");continue}if(i.opened_this_session){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": opened_this_session, it should not be closed this session");continue}if(i==TS.shared.legacyGetActiveModelOb()){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+":  active conversation, we should not close it");continue}var h=false;var g=TS.redux.messages.getRecentMessagesInChannel(i.id,h);var S=_.map(g,"ts");a=TS.interop.rules.channels.getLatestTs(i,S);if(a){s=TS.interop.datetime.toDateObject(a);TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": activity_date from activity_ts: "+s)}else{s=new Date(1e3*i.created);TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": no activity_ts found, activity date based on model_ob.created: "+s)}o=new Date-s;TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": ms_since_activity: "+o);if(o>m){TS.info(i.id+" "+s+" ms_since_activity:"+o+" allow_elapsed_ms:"+m);TS.has_pri[d]&&TS.log(d,"this IM is older than a week, we can leave the model_ob");p.push({model_ob:i,ms_since_activity:o})}else TS.has_pri[d]&&TS.info(d,"there has been activity in this IM in the past week, do not close")}if(!p.length){TS.info("legacyCheckForOldImsToClose found no candidates for closing");return}p.sort(function e(t,n){var r=t.ms_since_activity;var i=n.ms_since_activity;if(r<i)return 1;if(r>i)return-1;return 0});p.length=p.length>f?f:p.length;for(l=0;l<p.length;l+=1){i=p[l].model_ob;TS.warn("legacyCheckForOldImsToClose CLOSING:"+i.id+" ms_since_activity:"+p[l].ms_since_activity);(i.is_im||i.is_mpim)&&TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id}))}},promiseToRefetchModelOb:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.shared.promiseToRefetchModelOb";if(!t||"string"!==typeof t)return Promise.resolve();var r=[t];return TS.interop.channels.fetchAndUpsertChannelsFromFlannel({ids:r}).then(function(e){var t=e.channels;return _.isEmpty(t)?TS.interop.channels.fetchAndUpsertChannelsFromAPI({ids:r,reason:n}):{channels:t}}).then(function(e){var t=e.channels;return t&&t[0]})},ensureModelObsArePresent:function e(t,n){if(!t||!t.length)return Promise.resolve();return TS.interop.channels.fetchAndUpsertChannelsById({ids:t,reason:n}).then(function(e){var t=e.missing;if(_.isEmpty(t))return Promise.resolve();t.forEach(function(e){return TS.interop.channels.upsertChannel({id:e,isNonExistent:true})});return Promise.resolve()})},legacyEnsureModelObsInDataArePresent:function e(t,n){var r=TS.interop.utility.extractAllModelObIds(t);"search.messages"===n&&TS.boot_data.page_needs_enterprise&&v(t,r);return TS.shared.ensureModelObsArePresent(r,n)},legacyAddMsg:function e(t,n){return i(t,[n])},legacyAddMsgFromModern:function e(t,n){var r=TS.shared.legacyGetControllerForModelOb(t);return r.legacyAddMsg(t.id,n)},legacyRemoveMsgFromModern:function e(t,n){var r=TS.shared.legacyGetControllerForModelOb(t);return r.legacyRemoveMsg(t.id,n)},legacyMsgNotSentFromModern:function e(t,n,r){var i=TS.shared.legacyGetControllerForModelOb(t);TS.model.unsent_msgs[n.ts]=true;i.msg_not_sent_sig.dispatch(t,n,r)},legacyAddMsgs:function e(t,n){if(i(t,n)){TS.utility.msgs.maybeTruncateMsgs(t);TS.client&&TS.model.active_cid!==t.id&&TS.has_pri[y]&&TS.log(y,'Got message(s) for "'+t.id+'", but not active_cid "'+TS.model.active_cid+'" (yet.) NOT rebuilding.');return true}return false},legacyKickMember:function e(t,n){var r=t.is_channel||t.is_group&&!t.is_mpim;if(!r)return;if(TS.interop.rules.channels.isPrivateChannel(t)){if(!TS.permissions.members.canKickFromGroups())return}else if(!TS.permissions.members.canKickFromChannels())return;var i=TS.interop.members.getMemberById(n);if(!i)return;var a=true;var s=true;var o=TS.interop.i18n.safeString(TS.interop.members.getPrefCompliantMemberName(i,a,s));var l=TS.interop.rules.channels.getDisplayNameForChannel(t);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(t.id,[n]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,n);if(!e.is_member){TS.generic_dialog.alert(TS.interop.i18n.t("<strong>{user_name}</strong> is not a member of {channel_name}.","shared")({user_name:o,channel_name:l}));return null}var r;r=TS.interop.rules.channels.isPrivateChannel(t)?"<p>"+TS.interop.i18n.t("If you remove <strong>{user_name}</strong> from {channel_name}, they will no longer be able to see any of its messages. To rejoin the private channel, they will have to be re-invited.</p><p>Are you sure you wish to do this?","shared")({user_name:o,channel_name:l})+"</p>":"<p>"+TS.interop.i18n.t("Are you sure you wish to remove <strong>{user_name}</strong> from {channel_name}?","shared")({user_name:TS.interop.i18n.safeString(o),channel_name:l})+"</p>";var a="conversations.kick";TS.generic_dialog.start({title:TS.interop.i18n.t("Remove {user_name}","shared")({user_name:o}),body:r,go_button_text:TS.interop.i18n.t("Yes, remove them","shared")(),onGo:function e(){TS.interop.api.call(a,{channel:t.id,user:n}).catch(function(e){TS.info("Removing user failed; api="+a+"; error="+e.data.error);setTimeout(function(){var t=i.is_ultra_restricted?TS.interop.i18n.t("Single-channel guests","shared")():TS.interop.i18n.t("Multi-channel guests","shared")();if("cant_kick_from_last_channel"===e.data.error&&TS.model.user.is_admin){TS.generic_dialog.start({title:TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}),body:TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>If <strong>{member_display_name}</strong> should no longer have access to your workspace, we suggest deactivating their account.</p>","shared")({account_type:t,member_display_name:o}),go_button_text:TS.interop.i18n.t("Manage Members","shared")(),show_cancel_button:true,onGo:function e(){TS.utility.openInNewTab("/admin#restricted",TS.templates.builders.newWindowName())}});return}var n;switch(e.data.error){case"cant_kick_from_last_channel":n=TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({account_type:t,member_display_name:o});break;case"restricted_action":n=TS.interop.i18n.t("<p>Hmm, looks like you don\u2019t have permission to kick from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({member_display_name:o});break;default:n=TS.interop.i18n.t("<p>Something\u2019s gone wrong, and we couldn\u2019t remove <strong>{member_display_name}</strong> from {channel}. We suspect this is only temporary. Try again in a bit?</p>","shared")({member_display_name:o,channel:l})}TS.generic_dialog.alert(n,TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}))},500)})}});return null})},isRelevantTeam:function e(){var t=true;if(!TS.model.is_our_app||!window.desktop)return t;if(!TS.boot_data.page_needs_enterprise||!TS.model.team||!TS.model.team.enterprise_id||!TS.boot_data.other_accounts)return t;if(!window.desktop)return t;TS.has_pri[w]&&TS.log(w,"isRelevantTeam()");var n=_.get(TS.model.user,"enterprise_user.teams",[]);if(1===n.length)return t;var r=TS.interop.desktop.getLastActiveTeamIdForTeamIds(n);var i;TS.has_pri[w]&&TS.log(w,"isRelevantTeam(): Got relevant team IDs from SSB",r);if(r instanceof Array&&r.length){i=r[0];TS.has_pri[w]&&TS.log(w,"isRelevantTeam(): Array case - taking the first relevant team id",i,r)}else if(TS.has_pri[w]){TS.log(w,"isRelevantTeam(): relevant_team_ids is not an array, OR, is empty?",r);TS.log(w,"isRelevantTeam(): Electron did not provide any matches for the given team_ids",n)}if(!i){TS.has_pri[w]&&TS.log(w,"Invalid response from SSB lastActiveTeamIdForTeamIds() call? Exiting.");return t}TS.has_pri[w]&&TS.log(w,"comparing most_relevant_team_id ( "+i+") -> TS.model.team_id ("+TS.model.team.id+")");if(i===TS.model.team.id)TS.has_pri[w]&&TS.log(w,"isRelevantTeam(): "+TS.model.team.id+" is relevant. Including.");else{TS.has_pri[w]&&TS.log(w,"isRelevantTeam(): "+TS.model.team.id+" is NOT relevant. Excluding.");t=false}return t},onDisplayEmailAddressesPrefChanged:function e(){if(!TS.model||!TS.model.team)return;TS.info('Team pref "display_email_addresses" -> '+TS.prefs.getTeamPref("display_email_addresses"));var t=0;TS.model.members&&(TS.model.members=_.map(TS.model.members,function(e){if(!e.profile||!e.profile.email)return e;if(e.id===TS.model.user.id)return e;t+=1;TS.prefs.getTeamPref("display_email_addresses")||(e.profile.email=void 0);return e}));TS.prefs.getTeamPref("display_email_addresses")?t||TS.info("display_email_addresses check: pref enabled, but 0 email fields found in TS.model.members."):t?TS.info("display_email_addresses check: found and cleared "+t+" email fields from TS.model.members."):TS.info("display_email_addresses check: TS.model.members is already clear of email fields. \u2713");var n=true;TS.client&&TS.client.ui&&!TS.model.ms_logged_in_once&&TS.client.ui.rebuildAll(n)},dispatchMessageReceived:function e(t,n){var r=TS.shared.legacyGetControllerForModelOb(t);r.message_received_sig.dispatch(t,n)},legacyDispatchUnreadChanged:function e(t){var n=TS.shared.legacyGetControllerForModelOb(t);n.unread_changed_sig.dispatch(t)},legacyDispatchUnreadHighlightChanged:function e(t){var n=TS.shared.legacyGetControllerForModelOb(t);n.unread_highlight_changed_sig.dispatch(t)},legacyDispatchMarkedSig:function e(t){var n=TS.shared.legacyGetControllerForModelOb(t);n.marked_sig.dispatch(t)},legacyBatchUpsertObjects:function e(t){TS.has_pri[k]&&TS.log(k,"Flannel: upserting batch of "+t.length+" objects");var n=[];var r=[];var i=[];_.forEach(t,function(e){TS.interop.utility.looksLikeMemberId(_.get(e,"id"))?TS.redux.members.hasMemberWithId(e.id)?n.push(e):r.push(e):S(e)&&i.push(e)});var a=!!r.length;var s=[];function o(e){TS.has_pri[k]&&TS.log(k,"Flannel: upserting and signaling user "+e.id+" from query results");var t=TS.members.legacyUpsertAndSignal(e).member;s.push(t)}function l(e){TS.has_pri[k]&&TS.log(k,"Flannel: upserting user "+e.id+" from query results");var t=TS.members.legacyUpsertMember(e).member;s.push(t)}n.forEach(o);if(a){TS.members.legacyStartBatchUpsert();r.forEach(l);TS.members.legacyFinishBatchUpsert()}if(i.length){TS.redux.bots.bulkUpsertBots(i);i.forEach(function(e){TS.has_pri[k]&&TS.log(k,"Flannel: upserting bot "+e.id+" from query results");var t=TS.interop.bots.getBotById(e.id);s.push(t)})}return s},revokeSharedChannelInvite:function e(t,n){return TS.interop.api.call("conversations.revokeSharedInvite",{channel:t.id,target_team:n.id})}});var t={};var n={};var r={};var i=function e(t,n){var r=false;n=_.filter(n,function(e){var n=e.ts&&TS.utility.msgs.getMsg(e.ts,t.msgs);n&&TS.has_pri[y]&&TS.log(y,"Not adding duplicate message "+e.ts+", already in "+t.id);return!n});if(!n.length){TS.has_pri[y]&&TS.log(y,"No messages to add to "+t.id+" - exiting.");return false}TS.has_pri[y]&&TS.log(y,"Adding "+(n.length>1?"messages":"message")+" to "+t.id);n.forEach(function(e){if(TS.utility.msgs.validateMsg(t.id,e,t.msgs)){r=true;TS.utility.msgs.appendMsg(t.msgs,e)}});if(!r)return false;TS.utility.msgs.sortMsgs(t.msgs);TS.utility.msgs.maybeSetOldestMsgsTsAfterMsgAdded(t);return true};var a=function e(t,n){var r={message_timestamp:n.ts,channel_id:t,channel_type:t?t.charAt(0):""};var i=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==i&&(r.channel_session_id=i);TS.interop.clog.track("MSG_SENT",r)};var s=null;var o=function e(){var t=TS.client.activeChannelIsHidden()?null:TS.shared.legacyGetActiveModelOb();var n=t&&t.id?t.id:null;TS.redux.dispatch(TS.interop.redux.features.messagePane.updateActiveChannelSessionId(n))};var l=function e(t){var n=TS.client.activeChannelIsHidden()?null:TS.shared.legacyGetActiveModelOb();var r=s;r&&r.id&&d(r);o();if(n&&n.id){u(n,t);var i=n.id.charAt(0);"D"===i&&p(n)}s=n};var u=function e(t,n){var r=t.id;var i=r.charAt(0);var a={channel_id:r,channel_type:i,is_boot:!!n,unread_channel_ids:c(),mentioned_channel_ids:m()};var s=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==s&&(a.channel_session_id=s);void 0!==t.is_member&&null!==t.is_member&&(a.is_member=t.is_member);n||(a.num_unreads=t.unread_cnt);TS.interop.clog.track("CHANNEL_SWITCHED",a)};var d=function e(t){var n=t.id;var r=n.charAt(0);var i={channel_id:n,channel_type:r};var a=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==a&&(i.channel_session_id=a);void 0!==t.is_member&&null!==t.is_member&&(i.is_member=t.is_member);TS.interop.clog.track("CHANNEL_SWITCHED_OUT",i)};var c=function e(){return f(function(e){return e.unread_cnt>0})};var m=function e(){return f(function(e){return e.unread_highlight_cnt>0})};var f=function e(t){if(!TS.model)return[];var n=[];var r=function e(t){return t.id};TS.model.channels&&(n=n.concat(_.map(_.filter(TS.model.channels,t),r)));TS.model.groups&&(n=n.concat(_.map(_.filter(TS.model.groups,t),r)));TS.model.ims&&(n=n.concat(_.map(_.filter(TS.model.ims,t),r)));return n};var p=function e(t){var n=t.id;var r={};var i=TS.interop.channels.getImById(n);var a=i?TS.interop.members.getMemberById(i.user):null;if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.interop.bots.getBotById(s);r.app_id=o?o.app_id:"";r.bot_id=s}TS.interop.clog.track("DM_OPEN",r)};var h=function e(){var t=true;l(t)};var g={};var S=function e(t){var n=_.get(t,"id[0]");return"B"===n};var T=function e(t,n){var r={no_sort:true,types:"private_channel",limit:1e3};n&&(r.cursor=n);var i=t||[];return TS.interop.api.callExpedited("conversations.list",r).then(function(t){i=i.concat(t.data.channels);if(!t.data.response_metadata.next_cursor){var n=_(i).map("id").concat(_.map(TS.model.mpims,"id")).concat(_.map(TS.model.groups,"id")).uniq().value();TS.log(48,"all_group_ids: "+n);return n}return e(i,t.data.response_metadata.next_cursor)})};function v(e,t){var n=TS.model.team.id;_.remove(t,function(t){var r=_.find(e.messages.matches,function(e){return e.channel.id==t},this);var i=_.get(r,"channel");var a=TS.interop.rules.channels.isOrgShared(i)||TS.interop.rules.channels.isExternallySharedChannel(i);if(r&&_.get(r,"team")!=n&&_.startsWith(t,"C")&&!a)return t})}function b(e){if(!e)return;return n[e]}var y=58;var w=1701;var k=1989;var x=888;var C=function e(t,n,r,i){var a=t.is_mpim?TS.interop.i18n.t("conversation","shared")():TS.interop.i18n.t("channel","shared")();var s=t.is_mpim?"conversation":"channel";if(!t)return false;if(t.is_archived)return false;var o=TS.interop.channels.getGeneralChannel();var l=function e(t){TS.generic_dialog.alert(t).then(function(){i?TS.ui.replies.focusReplyInput():TS.view.focusMessageInput()});i?TS.ui.replies.populateReplyInput(n):TS.utility.contenteditable.value(TS.client.ui.$msg_input,n)};var u=TS.format.cleanMsg(n);var d=!!i;var c;if(TS.interop.messages.atEveryoneRegExp.test(u)&&!d){if(!TS.permissions.members.canAtMentionEveryone()){c=TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()?"<p>"+TS.interop.i18n.t("Usage of <strong>{everyone}</strong> is restricted to Workspace Admins in the large general channel.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>":"<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.permissions.members.canAtChannelOrGroup(t.id)?c+="channel"===s?'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(s)})+"</p>":'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(s)})+"</p>":TS.model.user.is_restricted&&(c="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>");l(c);return false}if(o&&o.is_member){var m=void 0;m=t.is_mpim?TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this conversation, use <strong>{channel}</strong> instead.</p>',"shared"):TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this channel, use <strong>{channel}</strong> instead.</p>',"shared");TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","shared")({everyone:TS.templates.builders.atLabel("everyone")}),body:m({general_channel:TS.interop.i18n.safeString("#"+_.escape(o.name)),conversation_or_channel:a,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","shared")(),onGo:function e(){TS.channels.legacyDisplayChannel({id:o.id,and_send_txt:n})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}})}else{c="<p>"+TS.interop.i18n.t("You cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup()){var f=void 0;var p=TS.templates.builders.atLabel(s);f=t.is_mpim?TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:p}):TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:p});c+='<p class="no_bottom_margin">'+f+"</p>"}l(c)}return false}var h=TS.interop.messages.atHereRegExp.test(u);var g=(TS.interop.messages.atChannelRegExp.test(u)||TS.interop.messages.atGroupRegExp.test(u))&&!d;if((g||h)&&!TS.permissions.members.canAtChannelOrGroup()){var S=h?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");c="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{key_word}</strong> messages.","shared")({key_word:S})+"</p>";l(c);return false}if(!d&&TS.ui.needToShowAtChannelWarning(t.id,n)){TS.ui.at_channel_warning_dialog.startInMessagePane(t.id,n);return false}return true}})()},2906:function(e,t){(function(){TS.registerModule("teams",{added_sig:new signals.Signal,rename_sig:new signals.Signal,changed_sig:new signals.Signal,unlinked_sig:new signals.Signal,changed_icon_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,unknown_resolution_rebuild_sig:new signals.Signal,onStart:function e(){TS.client&&TS.client.login_sig.add(t);TS.teams.changed_icon_sig.add(r);TS.teams.rename_sig.add(r);TS.teams.added_sig.add(a);TS.team.team_name_changed_sig.add(a)},getTeamById:function e(t,n){if(!_.isString(t))return null;return TS.redux.teams.getTeamById(t,n)||TS.redux.teams.getTeamByEnterpriseId(t)||null},isExternal:function e(t){if(!_.isObject(t))return false;if(t.id===TS.model.team.id)return false;if(t._other_account)return false;var n=c();return!(n&&n===t.enterprise_id)},getAllExternalTeams:function e(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isExternal)},isPartOfMyOrg:function e(t){if(!_.isObject(t))return false;var n=c();return n&&n===t.enterprise_id},getAllEnterpriseTeams:function e(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isPartOfMyOrg)},getEnterpriseTeams:function e(t){t=_.isObject(t)?t:{};var n=TS.teams.getAllEnterpriseTeams();t.only_member_of&&(n=_.pickBy(n,function(e){return TS.model.user.enterprise_user.teams.indexOf(e.id)>-1}));t.exclude_current_team&&(n=_.omitBy(n,function(e){return e.id===TS.model.team.id}));return n},getTeamByDomain:function e(t){if(!_.isString(t))return null;return TS.redux.teams.getTeamByDomain(t)},getTeamByMsg:function e(t){if(!_.isObject(t))return null;var n=t.source_team_id;if(!n)return null;var r=TS.teams.getTeamById(n);if(r)return r;return null},getTeamNameByMember:function e(t){if(!_.isObject(t))return null;var n=TS.teams.getTeamById(t.team_id);return TS.interop.rules.teams.getTeamDisplayName(n)},getTeamNameByMemberId:function e(t){if(!_.isString(t))return null;var n=TS.interop.members.getMemberById(t);if(!n)return null;var r=TS.teams.getTeamById(n.team_id);return TS.interop.rules.teams.getTeamDisplayName(r)},getTeamNameById:function e(t){var n=TS.teams.getTeamById(t);return TS.interop.rules.teams.getTeamDisplayName(n)},updateTeamName:function e(t){if(!t.name)return;var n=false;var r=TS.teams.getTeamById(t.source_team,n);if(!r)return;r=_.clone(r);r.name=t.name;TS.teams.upsertAndSignal(r)},updateTeamIcon:function e(t){if(!t.icon)return;var n=false;var r=TS.teams.getTeamById(t.source_team,n);if(!r)return;r=_.clone(r);r.icon=t.icon;TS.teams.upsertAndSignal(r)},upsertAndSignal:function e(t){var n=TS.teams.upsertTeam(t);if("CHANGED"===n.status){-1!=n.what_changed.indexOf("icon")&&TS.teams.changed_icon_sig.dispatch(n.team);-1!=n.what_changed.indexOf("name")&&TS.teams.rename_sig.dispatch(n.team);-1!=n.what_changed.indexOf("unlinked")&&TS.teams.unlinked_sig.dispatch(n.team)}else"ADDED"===n.status&&TS.teams.added_sig.dispatch(n.team);return n},upsertTeam:function e(t){var n=false;var r=TS.teams.getTeamById(t.id,n);var i="NOOP";var a=[];if(r){r=_.assign({},r);t.hasOwnProperty("_other_account")||(t._other_account=false);for(var s in t)if("icon"===s){if(t[s]&&!TS.utility.areSimpleObjectsEqual(t[s],r[s])){r[s]=t[s];i="CHANGED";a.push(s)}}else if(r[s]!=t[s]&&("boolean"!==typeof t[s]||!t[s]!=!r[s])){r[s]=t[s];i="CHANGED";a.push(s)}t=r}else i="ADDED";"NOOP"===i?TS.interop.teams.markObjectsAsFresh([t.id]):TS.redux.teams.upsertTeam(t);return{status:i,team:t,what_changed:a}},ensureTeamsArePresent:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsArePresent";if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var i=_.filter(t,function(e){var t=false;var n=TS.teams.getTeamById(e,t);return!n||n._other_account});if(!i.length)return Promise.resolve();return n(i,r)},ensureTeamsInDataArePresent:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsInDataArePresent";var r=TS.interop.utility.extractAllTeamIds(t);return TS.teams.ensureTeamsArePresent(r,n)},ensureSharedTeamsForMember:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureSharedTeamsForMember";if(!t)return Promise.resolve();return TS.teams.ensureTeamsArePresent(s(t),n)},getSharedTeamsForMember:function e(t){if(!t)return[];return _.map(s(t),function(e){return TS.teams.getTeamById(e)})},getTeamIdsConnectedOnlyByModelOb:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.getTeamIdsConnectedOnlyByModelOb";return TS.interop.api.call("conversations.info",{channel:t.id,include_external_connections:true,_x_reason:n}).then(function(e){var n=_.get(e,"data.channel.external_connections");if(_.isObject(n))return t.shared_team_ids.filter(function(e){return 1===n[e]});return[]})},promiseToSearchTeams:function e(t){if(!c())return Promise.resolve(t);return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e=o(e);if(e._is_new||e.num_remaining>0)return u(e);return Promise.resolve(e)})},test:function e(){var t={_getSharedTeamIdsForMember:s};Object.defineProperty(t,"_readyTeamSearcher",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(t,"_promiseToSearchTeamsWorker",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(t,"_buildPromiseToSearchTeamsArguments",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(t,"_getTeamsByIdFromApi",{get:function e(){return n},set:function e(t){n=t}});return t}});var e=100;var t=function e(){TS.boot_data&&_.isObject(TS.boot_data.other_accounts)&&_.each(TS.boot_data.other_accounts,function(e){var t={id:e.team_id,domain:TS.interop.url.getTeamSubdomain(e.team_url),icon:e.team_icon,name:e.team_name,url:e.team_url,_other_account:true};TS.teams.upsertTeam(t)})};var n=function e(t,n){if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var r=250;var i=_.chunk(t,r);return Promise.map(i,function(e){return TS.interop.api.callExpedited("team.info",{teams:e,_x_reason:n}).then(function(t){var n=[];t.data.teams.forEach(function(t){t&&t.id&&"E"===t.id.charAt(0)?TS.warn("EVALUE-1721: team.info response included an Enterprise org of "+t.id+". NOT adding to model. Client requested teams="+e.join(", ")+"."):n.push(TS.teams.upsertAndSignal(t).team)});return n}).catch(function(t){TS.error("_getTeamsByIdFromApi failed with "+(t.data&&t.data.error||"unknown error")+", when requesting teams="+e.join(", "))})}).then(function(e){return _.compact(_.flatten(e))})};var r=function e(t){t.id!==TS.model.team.id&&i(t);a(t)};var i=function e(t){if(!_.isObject(t))return;var n=TS.utility.teams.getMembersForTeam(t);if(!n.length)return;_.forEach(n,function(e){TS.members.changed_profile_sig.dispatch(e)})};var a=function e(t){if(!_.isObject(t))return;var n=TS.shared.legacyGetActiveModelOb();if(!TS.interop.rules.channels.isExternallySharedChannel(n))return;var r=TS.utility.teams.getTeamsForModelOb(n,{include_pending:true});_.indexOf(r,t)>-1&&TS.channels.shared_teams_updated_sig.dispatch(n)};var s=function e(t){if(!t)return[];if(_.get(t,"enterprise_user"))return _.intersection(_.get(t,"enterprise_user.teams",[]),_.get(TS.model.user,"enterprise_user.teams",[]));if(_.get(t,"team_id")===_.get(TS.model.user,"team_id"))return[t.team_id];return[]};var o=function e(t){t=t||{};t._is_new=false;t.hasOwnProperty("query")||(t.query="");t.hasOwnProperty("additional_args")||(t.additional_args={});if(t._last_query!==t.query){t.hasOwnProperty("_searcher_p")&&t._searcher_p.cancel();t._last_query=t.query;t._is_new=true;t._cursor_mark=null;t.items=[]}if(!_.isEqual(t._last_additional_args,t.additional_args)){t.hasOwnProperty("_searcher_p")&&t._searcher_p.cancel();t._last_additional_args=_.assign({},t.additional_args);t._is_new=true;t._cursor_mark=null;t.items=[]}return t};var l=function t(n){var r=[TS.utility.search.makeClause("is","team")];n.query&&r.push(TS.utility.search.makeClause("fuzzy",n.query));_.get(n,"included_ids.length")&&(1===n.included_ids.length?r.push(TS.utility.search.makeClause("id",_.head(n.included_ids))):r.push(TS.utility.search.makeConjunction("or",_.map(n.included_ids,function(e){return TS.utility.search.makeClause("id",e)}))));var i={count:n.max_api_results||e,query:r.length>1?JSON.stringify(TS.utility.search.makeConjunction("and",r)):JSON.stringify(_.head(r))};_.isEmpty(_.get(n,"additional_args"))||(i=_.merge(i,n.additional_args));n._cursor_mark&&(i.cursor_mark=n._cursor_mark);return i};var u=function e(t){var n=function e(){return d(t)};t._is_new?t._searcher_p=n():t._searcher_p=t._searcher_p.then(n);return t._searcher_p};var d=function e(t){var n=_.get(t,"endpoint","search.enterprise");var r=_.get(t,"response_key","items");return TS.interop.api.call(n,l(t)).then(function(e){if(!t._cursor_mark){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}if(!e.data[r].length)return Promise.resolve(t);t.num_remaining-=e.data[r].length;t._cursor_mark=e.data.next_cursor_mark;var n=_.keyBy(t.omitted_ids,_.identity);var i=_(e.data[r]).filter(function(e){return!n[e.id]}).map(function(e){return TS.teams.upsertTeam(e)}).map("team").value();t.num_found-=e.data[r].length-i.length;t.items=_.concat(t.items,i);return Promise.resolve(t)})};var c=function e(){return _.get(TS.model,"team.enterprise_id",TS.boot_data.enterprise_id)}})()},2907:function(e,t){(function(){TS.registerModule("utility.teams",{isMemberGuest:function e(t){if(!_.isObject(t))return false;if(t.is_external||t.is_restricted)return true;return false},isMsgFromOtherTeam:function e(t){if(!_.isObject(t))return false;if(!t.source_team_id)return false;if(t.source_team_id&&TS.model.team.id!=t.source_team_id)return true;return false},getMembersForTeam:function e(t){if(!_.isObject(t))return;if(!t.id)return;var n=_.filter(TS.model.members,{team_id:t.id});return n},getTeamsForModelOb:function e(t,n){var r=[];if(!_.isObject(t))return r;n=n||{};if(!TS.interop.rules.channels.isExternallySharedChannel(t)&&!TS.interop.rules.channels.isPendingExternallySharedChannel(t))return r;!n.only_pending&&t.shared_team_ids&&t.shared_team_ids.length&&(r=r.concat(t.shared_team_ids));(n.only_pending||n.include_pending)&&t.pending_shared&&t.pending_shared.length&&(r=_.uniq(r.concat(t.pending_shared)));return _.compact(_.map(r,function(e){return TS.teams.getTeamById(e)}))}})})()},2908:function(e,t){(function(){TS.registerModule("apps.permissions",{onStart:function e(){TS.boot_data.feature_bots_not_members||TS.client&&TS.client.login_sig.addOnce(t)},xoxa_apps_installed_sig:new signals.Signal,areXoxaAppsInstalled:function t(){if(TS.boot_data.feature_bots_not_members)return true;return e}});var e=false;var t=function t(){if(!TS.boot_data.feature_app_permissions_backend_enterprise&&TS.boot_data.page_needs_enterprise)return;var n=function t(){return TS.interop.Flannel.query("user_counts_request").then(function(t){e=_.get(t,"counts.apps",0)>0;if(e)TS.apps.permissions.xoxa_apps_installed_sig.dispatch();else{var n=function t(n){if(n.is_app_user){e=true;TS.apps.permissions.xoxa_apps_installed_sig.dispatch();TS.members.joined_team_sig.remove(t)}};TS.members.joined_team_sig.add(n)}})};if(!TS.boot_data.feature_degraded_send)return n();return n().catch(function(){return TS.redux.socket.promiseToHaveOpenWebSocket().finally(n)})}})()},2909:function(e,t){(function(){TS.registerModule("apps.splash",{onStart:$.noop,create:function t(n){if(!n||n&&0===n.length)return;if(TS.boot_data.feature_app_directory_home_page_redesign){l.drive.headline=TS.interop.i18n.t("Share and search files...","pages_apps_directory")();l.drive.image_alt_text=TS.interop.i18n.t("New Hire Onboarding document shared from {app_name}.","pages_apps_directory")({app_name:"Google Drive"});l.zoom.headline=TS.interop.i18n.t("Start an instant meeting...","pages_apps_directory")();l.zoom.image_alt_text=TS.interop.i18n.t("{app_name}: Bruce started a meeting. Summer Offsite Prep","pages_apps_directory")({app_name:"Zoom"});l.jira.headline=TS.interop.i18n.t("Preview issues and get updates...","pages_apps_directory")();l.jira.image_alt_text=TS.interop.i18n.t("{app_name}. Issue-123: Update rocketship fins. Status: Ready for QA.","pages_apps_directory")({app_name:"Jira Cloud"});l.salesforce.headline=TS.interop.i18n.t("Quickly find account details...","pages_apps_directory")();l.salesforce.image_alt_text=TS.interop.i18n.t("{app_name}: Sunny Farms Account. Show Account.","pages_apps_directory")({app_name:"Salesforce"})}return new e(n)}});function e(e){this.$element=e;this.$buttons=e.find(".splash_interactive__button");this.icons=["drive","zoom","jira","salesforce"];this.active_index=0;this.timeouts=[];this.$buttons.on("click",r.bind(this));n.bind(this)();this.timeouts.push(setInterval(n.bind(this),6e3));o()}function t(e){$("[data-window-link]").unbind("click");$("[data-window-link]").on("click",function(){var t=l[e].link;TS.interop.clog.track("APP_DIRECTORY_HOME_SPLASH",{link_to:t,data_tag_identifier:"splash_interactive__window_link",contexts:{ui_context:{step:"app_directory_home",action:"click",ui_element:e}}});t&&(window.location=t)})}function n(){var e=this.icons[this.active_index];i.bind(this,e)();a.bind(this,e)();this.active_index+=1;this.active_index===this.icons.length&&(this.active_index=0)}function r(e){if(this.timeouts.length){s(this.timeouts);this.timeouts=[]}var t=$(e.target).data("icon");i.bind(this,t)();a.bind(this,t)()}function i(e){this.$buttons.removeClass("splash_interactive__button--active");$(".splash_interactive__button--"+e).addClass("splash_interactive__button--active")}function a(e){var n=l[e];var r=$("[data-js='window_content_container']");var i=$("[data-js='window_message']");var a=$("[data-js='window_response']");var s=$("[data-js='window_message_content_text']");var o=$("[data-js='splash_color_border']");var u=$("[data-window-link]");var d=$("[data-js='window_headline']");var c=$("[data-js='window_message_content_username']");var _=$("[data-js='window_message_image']");r.addClass("splash_interactive__window_content_container--hide");i.removeClass("splash_interactive__window_message--show");a.removeClass("splash_interactive__window_response--show");s.removeClass("splash_interactive__window_message_content_text--typing");s.removeClass("splash_interactive__window_message_content_text--drive");o.removeClass("splash_color_border--filled");a.removeClass("splash_interactive__window_response--drive");u.attr({href:n.link});t(e);this.timeouts.push(setTimeout(function(){d.html(n.headline);c.html(n.message_profile_name);s.find("span").html(n.message_content);_.css({"background-image":"url("+n.message_profile_image_url+")"});a.attr({srcset:n.response_image_url_1x+" 1x, "+n.response_image_url_2x+" 2x",src:n.response_image_url_2x,alt:n.image_alt_text});i.addClass("splash_interactive__window_message--show");a.addClass("splash_interactive__window_response--show");r.removeClass("splash_interactive__window_content_container--hide");if(n.use_typing_animation){s.addClass("splash_interactive__window_message_content_text--typing");setTimeout(function(){s.removeClass("splash_interactive__window_message_content_text--typing")},2e3)}else{a.addClass("splash_interactive__window_response--drive");s.addClass("splash_interactive__window_message_content_text--drive")}},400))}function s(e){return e.map(function(e){return clearInterval(e)&&clearTimeout(e)})}function o(){$("[data-track]").map(function(e,t){var n=_.get($(t).data(),"track");var r=$(t).attr("href")?$(t).attr("href"):"no_link";n||(n="splash_log_error");return TS.interop.clog.trackClick('[data-track="'+n+'"]',"APP_DIRECTORY_HOME_SPLASH",{link_to:r,data_tag_identifier:n,contexts:{ui_context:{step:"app_directory_home",action:"click",ui_element:n}}})})}var l={drive:{headline:"Share and search files...",message_profile_image_url:"/img/apps/profile_drive@2x.png",message_profile_name:"Lisa Zhang",message_content:"shared this file",response_image_url_1x:"/img/apps/response_drive_2.0@1x.png",response_image_url_2x:"/img/apps/response_drive_2.0@2x.png",link:"https://slack.com/apps/A6NL8MJ6Q-google-drive",use_typing_animation:false,image_alt_text:"New Hire Onboarding document shared from Google Drive."},zoom:{headline:"Start an instant meeting...",message_profile_image_url:"/img/apps/profile_zoom@2x.png",message_profile_name:"Bruce Olson",message_content:"/zoom meeting Summer Offsite Prep",response_image_url_1x:"/img/apps/response_zoom_4.0@1x.png",response_image_url_2x:"/img/apps/response_zoom_4.0@2x.png",link:"https://slack.com/apps/A5GE9BMQC-zoom",use_typing_animation:true,image_alt_text:"Zoom: Bruce started a meeting. Summer Offsite Prep"},jira:{headline:"Preview issues and get updates...",message_profile_image_url:"/img/apps/profile_jira_2.0@2x.png",message_profile_name:"Angela Zamfir",message_content:"Can we get ISSUE-123 prioritized today?",response_image_url_1x:"/img/apps/response_jira_2.0@1x.png",response_image_url_2x:"/img/apps/response_jira_2.0@2x.png",link:"https://slack.com/apps/A2RPP3NFR-jira-cloud",use_typing_animation:true,image_alt_text:"Jira Cloud. Issue-123: Update rocketship fins. Status: Ready for QA."},salesforce:{headline:"Quickly find account details...",message_profile_image_url:"/img/apps/profile_salesforce@2x.png",message_profile_name:"Arcadio Buend\xeda",message_content:"/salesforce sunny farms",response_image_url_1x:"/img/apps/response_salesforce_2.0@1x.png",response_image_url_2x:"/img/apps/response_salesforce_2.0@2x.png",link:"https://slack.com/apps/A2DAS7NNR-salesforce",use_typing_animation:true,image_alt_text:"Salesforce: Sunny Farms Account. Show Account."}};e.prototype.destroy=function(){this.$element.off();this.$element.remove()}})()},291:function(e,t,n){var r=n(98);var i=n(132);var a=n(111);e.exports=function(e){var t=r(e);var n=i.f;if(n){var s=n(e);var o=a.f;var l=0;var u;while(s.length>l)o.call(e,u=s[l++])&&t.push(u)}return t}},2910:function(e,t){(function(){TS.registerModule("bots",{changed_sig:new signals.Signal,legacyBatchUpsertAndSignal:function e(t){var n=TS.interop.bots.getBotState();TS.redux.bots.bulkUpsertBots(t);var r=TS.interop.bots.getBotState();n!==r&&TS.bots.changed_sig.dispatch()},legacyEnsureBotsInDataArePresent:function e(t){var n=TS.interop.utility.extractAllBotIds(t);return TS.interop.bots.ensureBotsArePresent(n)},legacyFetchAndUpsertBotsWithQuery:function e(t){return TS.interop.Flannel.fetchRawMembersWithQuery(t).then(function(e){e.objects=TS.shared.legacyBatchUpsertObjects(e.objects);return e})}})})()},2911:function(e,t){(function(){TS.registerModule("search",{search_dispatched_sig:new signals.Signal,quick_search_results_fetched_sig:new signals.Signal,all_search_results_fetched_sig:new signals.Signal,message_search_results_fetched_sig:new signals.Signal,file_search_results_fetched_sig:new signals.Signal,autosuggest_search_results_fetched_sig:new signals.Signal,search_filter_set_sig:new signals.Signal,search_filetype_filter_set_sig:new signals.Signal,search_sort_set_sig:new signals.Signal,search_channel_set_sig:new signals.Signal,search_group_set_sig:new signals.Signal,search_member_set_sig:new signals.Signal,message_search_more_results_fetched_sig:new signals.Signal,query:"",query_string:"",query_string_for_display:"",last_search_query:"",previous_query:"",sort:"timestamp",filter:"all",filetype:"all",results:{},submit_tim:0,delay:500,suggestions:[],input:"",from_regex:/from:[@*\-.\w]+/gi,member:null,from:null,in_regex:/in:[#*\-.\w]+/gi,channel:null,group:null,im:null,per_page:-1,keyword_modifiers:["after","before","bot","during","from","to","has","in","on"],keyword_modifier_pair_regex:null,keyword_modifier_extract_regex:null,search_query_max_length:250,skip_next_search:false,refinement_version:1,onStart:function e(){TS.search.keyword_modifier_pair_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\S+$");TS.search.keyword_modifier_extract_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\w*");TS.search.per_page=parseInt(TS.qs_args.search_count,10)||20;TS.client&&(TS.search.delay=10);TS.client?TS.client.login_sig.add(TS.search.loggedIn,TS.search):TS.web&&TS.web.login_sig.add(TS.search.loggedIn,TS.search);TS.search.search_channel_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_group_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_member_set_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_my_channels_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_current_team_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_exclude_bots_changed_sig.add(TS.search.searchAll,TS.search);TS.files.team_file_changed_sig.add(f);TS.qs_args.delay&&(TS.search.delay=TS.qs_args.delay);"treatment"==TS.interop.experiments.getGroupForUser("sli_all_tab")&&(TS.search.filter="messages");TS.search.input=$("#search_terms");var t=[];TS.search.autocomplete||(t=["members"]);TS.utility.contenteditable.create(TS.search.input,{modules:{slacksearch:true,tabcomplete:{completers:t,isSearchInput:true,matchOptions:{allowed_preceding_symbols:[":"]},searchOptions:{include_deleted:true},onEnter:function e(){TS.search.submitSearch();TS.search.autocomplete.triggerInputEvent("on-enter")},positionMenu:function e(t){var n=$(TS.search.input);var r=n.offset();var i=355;var a=31;var s=i-n.outerWidth();var o=r.left-s+a;var l=12;var u=r.top+n.height()+l;t.style.width=i+"px";t.style.top=u+"px";t.style.left=o+"px"},render:function e(t,n,r){var i=_.filter(r,function(e){if(e.is_usergroup)return false;return true});var a=_.remove(i,function(e){return e.deleted});var s={menu_type:"user",noResults:!i&&!a,users:i,users_deleted:a,show_ja_modifier_subtitle:"ja-JP"==TS.interop.i18n.locale};return TS.templates.search_menu(s)},onRender:function e(){TS.tips.texty.hide();TS.utility.rAF(function(){$("#chat_input_tab_ui").addClass("search_menu");p()})}},keyboard:{useFormattingCommands:false}},singleLineInput:true,placeholder:TS.interop.i18n.t("Search","page_client")(),ariaLabel:TS.interop.i18n.t("Search","page_client")(),onFocus:function e(){$("#client-ui").addClass("search_focused");TS.utility.contenteditable.setCursorAtEnd(TS.search.input);if(TS.interop.searchUi.getVisible())return;TS.search.autocomplete.setUpMenu();TS.search.autocomplete.triggerInputEvent("focus")},onBlur:function e(){$("#client-ui").removeClass("search_focused");TS.search.autocomplete.maybeLogSearchInputBlur();TS.search.autocomplete.triggerInputEvent("blur")},onEnter:function e(){TS.search.autocomplete.triggerInputEvent("on-enter");TS.search.skip_next_search||TS.search.submitSearch();TS.search.skip_next_search=false;return true},onTextChange:function e(){var t=TS.utility.contenteditable.isEmpty(TS.search.input);$("#header_search_form").toggleClass("active",!t)},onEscape:function e(){$(".search_menu").is(":visible")||TS.utility.contenteditable.blur(TS.search.input);TS.search.autocomplete.triggerInputEvent("on-escape")},onTab:function e(){TS.search.autocomplete.triggerInputEvent("on-tab");return true}})},loggedIn:function e(){"recency"===TS.interop.experiments.getGroupForUser("sli_default_sorting")?TS.search.sort="timestamp":"relevance"===TS.interop.experiments.getGroupForUser("sli_default_sorting")?TS.search.sort="score":TS.search.sort="timestamp"},startSearchTimer:function e(t,n,r,i,a){clearTimeout(TS.search.submit_tim);TS.search.submit_tim=setTimeout(TS.search.dispatchSearch,TS.search.delay,t,n,r,i,null,a);TS.search.search_dispatched_sig.dispatch()},getNextPageOfSearchResults:function e(t,n,r){TS.search.dispatchSearch(t,n,TS.search.per_page,TS.search.onSearchAll,r,null)},getNextPageOfMessageResults:function e(t,n,r){u("search.messages",t,n,TS.search.per_page,r,d,null)},getNextPageOfFileResults:function e(t,n,r){u("search.files",t,n,TS.search.per_page,r,c,null)},extractNonModifierSearchTxt:function e(t){var n="";var r=t.split(" ");r.forEach(function(e){if(e.match(TS.search.keyword_modifier_extract_regex))return;n+=" "+e});n=$.trim(n);return n},dispatchSearch:function e(t,n,r,i,a,s){TS.interop.console.info("SEARCH","Entering dispatchSearch");if(TS.isPartiallyBooted()){if(!l){var o=this;var d=function e(){TS.search.dispatchSearch.apply(o,l);l=void 0};TS.redux.socket.connectedSig.addOnce(d)}l=arguments;TS.interop.console.info("SEARCH","In dispatchSearch returning as boot is not complete");return}TS.interop.console.info("SEARCH","In dispatchSearch after boot is complete");if(!a||1===a){var c=TS.search.extractNonModifierSearchTxt(t);c&&TS.interop.desktop.writeFindString(c)}TS.search.updateSessionsUponSearch();if(TS.search.separateMessagesAndFiles()){a&&1!==a||(TS.search.results[t]=null);var _=m();u("search.messages",t,n,r,a,_.msgs,s);u("search.files",t,n,r,a,_.files,s)}else u("search.all",t,n,r,a,i,s)},setFilter:function e(t){TS.search.filter=t;TS.search.search_filter_set_sig.dispatch()},setFiletypeFilter:function e(t){TS.search.filetype=t;TS.search.search_filetype_filter_set_sig.dispatch()},getModuleSort:function e(){if("files"==TS.search.filter)return"auto";if("messages"==TS.search.filter)return TS.search.sort;return null},getLastRequestId:function e(){if("files"==TS.search.filter)return TS.search.last_files_request_id;if("messages"==TS.search.filter||"all"==TS.search.filter)return TS.search.last_request_id;return null},hasCachedRelevantResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"modules.score")},hasCachedRecentResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"timestamp_messages")},topResultsFeedback:function e(t,n){var r=[":bow:"];if("top_results_useful"===n){var i=Math.floor(5*Math.random())+2;r=[":tada:",":raised_hands::skin-tone-"+i+":"]}var a=r[Math.floor(Math.random()*r.length)];$(t).closest(".top_results_feedback").html("Thanks for your feedback! "+TS.emoji.graphicReplace(a));TS.interop.clog.track("SEARCH_FEEDBACK",{search_feedback_value:n,request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId()})},setSort:function e(t,n){if(TS.search.sort===t)return;$(".search_toggle").toggleClass("active");TS.search.sort=t;TS.search.search_sort_set_sig.dispatch();"score"!==t&&"model"!==t&&(t="timestamp");TS.prefs.setPrefByAPI({name:"search_sort",value:t});"timestamp"===t&&TS.search.hasCachedRecentResults()?TS.search.switchToRecent():"score"===t&&TS.search.hasCachedRelevantResults()?TS.search.switchToRelevant():n||TS.search.searchAll()},setChannel:function e(t){var n=TS.interop.channels.getPublicChannelById(t);if(n){TS.search.channel=n;TS.search.group=null;TS.search.im=null}else TS.search.channel=null;TS.search.search_channel_set_sig.dispatch()},setGroup:function e(t){var n=TS.interop.channels.getGroupById(t);if(n){TS.search.group=n;TS.search.channel=null;TS.search.im=null}else TS.search.group=null;TS.search.search_group_set_sig.dispatch()},setMember:function e(t){var n=TS.interop.members.getMemberById(t);if(n)TS.search.member=n;else{TS.search.member=null;TS.search.from=null;var r=TS.utility.contenteditable.value(TS.search.input).trim();var i=r.match(TS.search.from_regex);if(i){$.each(i,function(e,t){r=$.trim(r.replace(t,""))});TS.utility.contenteditable.value(TS.search.input,r)}}TS.search.search_member_set_sig.dispatch()},searchAll:function e(t,n){TS.interop.console.info("SEARCH","Entering searchAll");if(window.desktop&&desktop.teams&&desktop.teams.getCurrentTeam&&TS.boot_data.page_needs_enterprise&&desktop.teams.getCurrentTeam().team_id&&desktop.teams.getCurrentTeam().team_id!=TS.model.team.id){TS.interop.console.info("SEARCH","In searchAll current team id "+desktop.teams.getCurrentTeam().team_id+" and "+TS.model.team.id+" differ");return}TS.client||clearTimeout(TS.search.widget.key_tim);TS.search.previous_query=TS.search.query;TS.search.query_string=t?_.trim(t):_.trim(TS.utility.contenteditable.value(TS.search.input));TS.search.query=TS.interop.texty.convertContentsStringForEncodedMembers(TS.search.query_string,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});TS.search.query=TS.interop.search_conversions.convertContentsStringForEncodedChannels(TS.redux.getState(),TS.search.query);TS.search.query_string_for_display=TS.interop.texty.convertContentsStringToDisplayString(TS.search.query_string,TS.interop.prefs.getHighlightWords());if(TS.search.query_string){TS.interop.console.info("SEARCH","In searchAll startSearchTimer for TS.search.onSearchAll");TS.search.startSearchTimer(TS.search.query,TS.search.query_string,TS.search.per_page,TS.search.onSearchAll,n)}else{TS.interop.console.info("SEARCH","In searchAll with empty query");TS.client?TS.search.autocomplete.stopSpinner():TS.search.widget.stopSpinner()}},onSearchAll:function e(t,n,r){TS.interop.console.info("SEARCH","Entering onSearchAll");if("1"===TS.qs_args.force_search_fail){window.failed_once=true;t=false;n={ok:false,error:"solr_failed"}}if(!t){var i=n&&n.error?n.error:"unknown_error";n||(n={ok:false,error:i});TS.interop.console.error("SEARCH","In onSearchAll search failed with "+i);n.query=n.query||r.query;n.messages=n.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]};n.files=n.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(r.query!==TS.search.query&&(!TS.search.results[r.query]||!TS.search.results[r.query].error)){TS.interop.console.info("SEARCH","In onSearchAll returning from same last query");return}TS.search.last_search_query=r.query;TS.client&&TS.search.upsertFiles(n);TS.search.expandChannelsAndCheckForMsgsInModel(n);if(1===r.page){TS.search.results[r.query]=n;TS.search.results[r.query]._time_of_search=Date.now();TS.search.all_search_results_fetched_sig.dispatch(n,r);TS.search.getNextPageOfSearchResults(r.query,r.query_string,2)}else{var a=TS.search.results[r.query];a.messages.matches&&(n.messages.matches=a.messages.matches.concat(n.messages.matches));a.files.matches&&(n.files.matches=a.files.matches.concat(n.files.matches));TS.search.results[r.query]=n;TS.search.all_search_results_fetched_sig.dispatch(n,r)}},searchSuggest:function e(t){var n=TS.search.getQuerySessionId();var r=(new Date).getTime();TS.interop.api.call("search.autocomplete",{query:t,client_request_id:n,search_session_id:TS.search.getSearchSessionId()}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;TS.search.onSearchSuggest&&TS.search.onSearchSuggest(s,t,i,a);TS.interop.clog.track("SEARCH_AUTOCOMPLETE",{client_request_id:n,search_session_id:TS.search.getSearchSessionId(),request_duration_ms:(new Date).getTime()-r});return{data:t,args:i,request_id:a}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.search.onSearchSuggest&&TS.search.onSearchSuggest(i,t,n,r);return{data:t,args:n,request_id:r}})},onSearchSuggest:function e(t,n,r,i){if(!TS.client&&TS.search.widget.suppress_suggestions){TS.search.widget.suppress_suggestions=false;return}if(!t)return;TS.search.suggestions=[];if(n.suggestions[0]===TS.search.query&&1===n.suggestions.length)TS.search.suggestions=[];else{var a=/<@([^>]+)>/gi;var s=[];n.suggestions.forEach(function(e){e.replace(a,function(e,t){s.push(t)})});s=_.uniq(s);TS.interop.members.ensureMembersArePresent(s).then(function(){for(var e=0;e<n.suggestions.length;e+=1){var t=n.suggestions[e];t=t.replace(a,function(e,t){var n=TS.interop.members.getMemberById(t);if(n)return TS.interop.texty.getMemberAsContentsString(n);return e});TS.search.suggestions[e]={value:t,highlighted:TS.search.highlightSuggestion(_.escape(t))};n.suggestions[e]=t}TS.search.autosuggest_search_results_fetched_sig.dispatch(n,r,i)})}},highlightSuggestion:function e(t){var n=TS.utility.contenteditable.value(TS.search.input);var r=new RegExp("("+TS.utility.preg_quote(n)+")","gi");var i=t.replace(r,"<b>$1</b>");return i},expandChannelsAndCheckForMsgsInMatch:function e(t){var n;var r=t.channel.id;var i;o(t,r);s.forEach(function(e){if(!t[e])return;o(t[e],r)});i=TS.rxns.getExistingRxnsByKey(t._rxn_key);i&&!t.reactions?TS.warn("msg:"+t.ts+" has reactions in local model, but we got an object in search results that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);n=TS.redux.channels.getEntityById(r);if(n){"im"!==t.type||TS.interop.channels.isImWithDeletedMember(n)||(t.im_exists=true);n.msgs?t.is_loaded=!!TS.utility.msgs.getMsg(t.ts,n.msgs):TS.client&&TS.warn(n.id+" has no msgs");t.channel=n;t.permalink||(t.permalink=TS.utility.msgs.constructMsgPermalink(n,t.ts))}},expandChannelsAndCheckForMsgsInModel:function e(t){var n;var r;if(!t.messages||!t.messages.matches)return;for(r=0;r<t.messages.matches.length;r+=1){n=t.messages.matches[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}if(t.messages.modules&&t.messages.modules.score){for(r=0;r<t.messages.modules.score.matches.length;r+=1){n=t.messages.modules.score.matches[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}if(t.messages.modules.score.top_results)for(r=0;r<t.messages.modules.score.top_results.length;r+=1){n=t.messages.modules.score.top_results[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}}},upsertFiles:function e(t){if(!t.files||!t.files.matches)return;for(var n=0;n<t.files.matches.length;n+=1){if(t.files.matches[n].preview){t.files.matches[n].preview_search=t.files.matches[n].preview;delete t.files.matches[n].preview}var r=null;if(t.files.matches[n].title){r=t.files.matches[n].title;t.files.matches[n].title=t.files.matches[n].title.replace(/[\ue000\ue001]/g,"")}var i=null;if(t.files.matches[n].name){i=t.files.matches[n].name;t.files.matches[n].name=t.files.matches[n].name.replace(/[\ue000\ue001]/g,"")}t.files.matches[n]=$.extend({},TS.files.upsertFile(t.files.matches[n],"upsertFilesSearch").file,{title:r||t.files.matches[n].title,name:i||t.files.matches[n].name})}},getResultsByQuery:function e(t){return TS.search.results[t]},getMatchByQueryAndTs:function e(t,n){return TS.search.getMatchByQueryByThings(t,n)},getMatchByQueryAndChannelAndTs:function e(t,n,r){return TS.search.getMatchByQueryByThings(t,r,n)},getMatchByQueryAndChannelAndTsAndModule:function e(t,n,r,i,a){var s=TS.search.getResultsByQuery(n);if(!s){TS.error("WTF no results?");return null}if(!s.messages.modules){TS.error("WTF no results.messages.modules?");return null}s.messages.modules[a]||TS.error("WTF no results.messages.modules."+a+"?");var o;for(var l=0;l<s.messages.modules[a].top_results.length;l+=1){o=s.messages.modules[a].top_results[l];if(!o){TS.error("WTF no match?");continue}if((!r||o.channel.id===r)&&o.ts===i){if(t)return{match:o,index:l};return o}}return null},getMatchByQueryByThings:function e(t,n,r){var i=TS.search.getResultsByQuery(t);if(!i){TS.error("WTF no results?");return null}return TS.search.getMatchFromResultsByThings(true,i,n,r)},getMatchFromResultsByThings:function e(t,n,r,i){if(!n){TS.error("WTF no results?");return null}if(!n.messages){TS.error("WTF no results.messages?");return null}if(!n.messages.matches){TS.error("WTF no results.messages.matches?");return null}var a;for(var s=0;s<n.messages.matches.length;s+=1){a=n.messages.matches[s];if(!a){TS.error("WTF no match?");continue}if((!i||a.channel.id===i)&&a.ts===r){if(t)return{match:a,index:s};return a}}return null},truncateQuery:function e(t){if(t.length>TS.search.search_query_max_length)return t.substring(0,TS.search.search_query_max_length);return t},resetSearchOptions:function e(){TS.search.channel=null;TS.search.group=null;TS.search.im=null;TS.search.member=null;TS.search.from=null;TS.search.searchAll()},saveSearch:function e(t,n){if(!t.terms)return;t.terms=$.trim(t.terms);if(TS.search.keyword_modifier_pair_regex.test(t.terms))return;TS.interop.api.call("search.save",t).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}})},separateMessagesAndFiles:function e(){return!!TS.client},setInputVal:function e(t){TS.utility.contenteditable.value(TS.search.input,t);TS.utility.contenteditable.focus(TS.search.input)},submitSearch:function e(){TS.search.input.closest("form").trigger("submit")},searchSessionExpired:function n(){var r=e;e=new Date;return!r||Date.now()-r>t},querySessionExpired:function e(){return TS.search.searchSessionExpired()},getSearchSessionId:function e(){(TS.search.searchSessionExpired()||null==n)&&(n=TS.interop.utility.uuidv4());return n},maybeSetQuerySessionId:function e(){if(null==i||TS.search.querySessionExpired()){i=TS.interop.utility.uuidv4();TS.interop.clog.track("SEARCH_QUERY_SESSION",{request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId(),client_request_id:i})}},getQuerySessionId:function e(){TS.search.maybeSetQuerySessionId();return i},getSearchSessionIdForResults:function t(){TS.search.getSearchSessionId()==r&&(e=new Date);return r},getQuerySessionIdForResults:function e(){return a},querySessionEnd:function e(){i=null},searchSessionEnd:function e(){n=null;TS.search.querySessionEnd()},updateSessionsUponSearch:function e(){a=TS.search.getQuerySessionId();r=TS.search.getSearchSessionId();TS.search.querySessionEnd()},debugQuery:function e(t,n){var r="/mc/search_eval_query.php?team_id="+t+"&user_id="+n+"&query="+encodeURIComponent(TS.search.query);window.open(r)},debugFileQuery:function e(t,n){var r="/mc/search_eval_file_query.php?team_id="+t+"&user_id="+n+"&active_cid="+TS.model.active_cid+"&query="+encodeURIComponent(TS.search.query);window.open(r)},getSort:function e(t){return"search.files"===t?"auto":TS.search.sort},shouldGetTopResults:function e(t){if("recency"===TS.interop.experiments.getGroupForUser("sli_default_sorting"))return false;if("relevance"===TS.interop.experiments.getGroupForUser("sli_default_sorting"))return false;return 1==t?1:0}});var e;var t=3e5;var n=null;var r=null;var i=null;var a=null;var s=["next","next_2","previous","previous_2"];var o=function e(t,n){t._rxn_key=TS.rxns.getRxnKey("message",t.ts,n);TS.utility.msgs.processAttachments(t.attachments);t.extracts&&t.extracts.length&&t.extracts.forEach(function(e){e._rxn_key=t._rxn_key})};var l;var u=function e(t,n,r,i,a,s,o){TS.interop.console.info("SEARCH","Entering _callSearchPerSe "+t);var l=t.replace(".","_");var u="start_dispatch_"+l;TS.metrics.mark(u);var d=a||1;var c={query:TS.emoji.maybeGetCanonicalEmojiString(n),query_string:r,highlight:true,count:i,types:[TS.search.filetype],sort:TS.search.getSort(t),page:d,extracts:1,extra_message_data:1,max_extract_len:150,highlight_attachments:1,active_cid:TS.model.active_cid,top_results:TS.search.shouldGetTopResults(d),experts:1==d?1:0,locale:TS.interop.i18n.isPseudoLocale?"pseudo":TS.interop.i18n.locale,search_tab_open:"search"==TS.model.ui.active_tab_id,search_tab_filter:TS.search.filter,search_tab_sort:TS.search.getModuleSort(TS.search.filter),client_req_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults(),no_user_profile:true};"search.all"===t&&(c.no_posts=1);"search.files"!==t&&(c.more_matches=true);if("search.messages"===t){TS.boot_data.feature_search_query_refinements&&(c.refinement_version=TS.search.refinement_version);if(o){o.refinement_client_request_id&&(c.refinement_client_request_id=o.refinement_client_request_id);o.refinement_iid&&(c.refinement_iid=o.refinement_iid);o.refinement_session_id&&(c.refinement_session_id=o.refinement_session_id);o.refinement_request_id&&(c.refinement_request_id=o.refinement_request_id);o.suppress_refinements&&(c.suppress_refinements=1)}}if(TS.boot_data.page_needs_enterprise&&TS.boot_data.enterprise_api_token){c.enterprise_token=TS.boot_data.enterprise_api_token;"search.messages"===t&&(c.team=TS.model.team.id)}TS.boot_data.feature_search_skip_context&&(c.skip_context=1);TS.interop.api.call(t,c).then(function(e){var t=e.data,n=e.args,r=e.request_id;TS.metrics.measure(l+"_response",u);var i=true;s&&s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;TS.interop.console.error("SEARCH","_callSearchPerSe failed");var i=false;s&&s(i,t,n,r);return{data:t,args:n,request_id:r}})};var d=function e(t,n,r,i){if(!t||!n.messages){var a=n&&n.error?n.error:"unknown_error";n||(n={ok:false,error:a});n.query=n.query||r.query;n.messages=n.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(r.query!==TS.search.query&&(!TS.search.results[r.query]||!TS.search.results[r.query].error))return;TS.search.last_search_query!==r.query&&delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=r.query;TS.search.last_request_id=i;TS.search.expandChannelsAndCheckForMsgsInModel(n);var s=TS.search.results[r.query];if(1==r.page){if(s)$.extend(s,n);else{TS.search.results[r.query]=n;s=n}s.initial_messages_total=n.messages.total;s.messages.pages=[{start:0,count:_.get(n.messages,"matches.length",0)}];_.has(s,"messages.modules.score.matches")&&(s.messages.modules.score.pages=[{start:0,count:_.get(s.messages.modules.score,"matches.length",0)}]);s._time_of_search=Date.now();TS.search.message_search_results_fetched_sig.dispatch(s,r)}else{if(s.messages&&s.messages.matches){n.messages.matches=s.messages.matches.concat(n.messages.matches);n.messages.pages=s.messages.pages.concat([{start:s.messages.matches.length,count:_.get(n.messages,"matches.length",0)}])}$.extend(s,n);TS.search.message_search_results_fetched_sig.dispatch(s,r)}};var c=function e(t,n,r,i){if(!t||!n.files){var a=n&&n.error?n.error:"unknown_error";n||(n={ok:false,error:a});n.query=n.query||r.query;n.files=n.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query);r.query=TS.emoji.maybeGetLocalizedEmojiString(r.query);if(r.query!==TS.search.query&&(!TS.search.results[r.query]||!TS.search.results[r.query].error))return;TS.search.last_search_query!==r.query&&delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=r.query;TS.search.last_files_request_id=i;TS.client&&TS.search.upsertFiles(n);var s=TS.search.results[r.query];if(1===r.page){if(s)$.extend(s,n);else{TS.search.results[r.query]=n;s=n}s.initial_files_total=n.files.total;s._time_of_search=Date.now();TS.search.file_search_results_fetched_sig.dispatch(s,r)}else{s.files&&s.files.matches&&(n.files.matches=s.files.matches.concat(n.files.matches));$.extend(s,n);TS.search.file_search_results_fetched_sig.dispatch(s,r)}};var m=function e(){var t=false;var n=false;var r=function e(){t&&n&&TS.search.all_search_results_fetched_sig.dispatch()};return{msgs:function e(){t=true;d.apply(this,arguments);r()},files:function e(){n=true;c.apply(this,arguments);r()}}};var f=function e(t){var n=$("#search_results_items");var r=TS.files.containerHasFileListItem(t,n);var i=!TS.interop.files.isObjectFresh(t.id);if(i&&r){TS.files.getFileById(t.id);return}r&&TS.files.updateFileListItem(t,n)};var p=function e(){var t=$(".reveal_hidden_items");t.one("click enter",function(e){var n=$(".results .deleted");if(n){e.stopPropagation();n.removeClass("deleted");t.remove()}})}})()},2912:function(e,t){(function(){TS.registerModule("ms.msg_handlers",{getMsgHandlers:function e(){return TS.ms.msg_handlers},onStart:function e(){i=!!window.performance;if(TS.client&&TS.client.stats){TS.client.stats.start_collecting_sig.add(function(){f.enableStatsCollecting()});TS.client.stats.stop_collecting_sig.add(function(){f.disableStatsCollecting()})}if(TS.web&&!TS.web.space)return;T()&&TS.shouldLog(2017)&&setInterval(function(){TS.log(2017,"**Periodic** getIdletimeInMs reads: "+window.desktop.app.getIdleTimeInMs())},15e3)},message:function e(t){if(!TS.client)return;TS.has_pri[p]&&TS.log(p,"recved message type "+t.type);t.is_ephemeral&&!t.ts&&(t.ts=TS.interop.datetime.makeTsStamp());var n;if("message_changed"===t.subtype||"message_deleted"===t.subtype||"message_replied"===t.subtype||"channel_history_changed"===t.subtype||"group_history_changed"===t.subtype||"im_history_changed"===t.subtype||"mpim_history_changed"===t.subtype)return;i&&(n=f.start(t.type));var r=TS.interop.messages.preprocessImsg(t,t.channel);if(TS.interop.channels.getImById(t.channel)){if("start_profile_AAAAAA"===t.text)TS.model.profiling_keys=true;else if("end_profile_AAAAAA"===t.text){TS.model.profiling_keys=false;if(TS.model.profiling_key_times){TS.files.upload({text:JSON.stringify(TS.model.profiling_key_times,null,"\t"),title:"auto profile",filetype:"javascript",channels:[t.channel],initial_comment:""});delete TS.model.profiling_key_times}}TS.ims.legacyAddMsg(t.channel,r)}else TS.interop.channels.getMpimById(t.channel)?TS.mpims.legacyAddMsg(t.channel,r):TS.interop.channels.getGroupById(t.channel)?TS.groups.legacyAddMsg(t.channel,r):TS.channels.legacyAddMsg(t.channel,r);TS.interop.sendMessage.resolveMessage(TS.redux.getState,TS.redux.dispatch,r,t);var a=TS.redux.channels.getEntityById(t.channel);var s=TS.interop.members.getMemberById(r.user);s&&a&&TS.redux.dispatch(TS.interop.typing.memberEndedTyping({channelId:a.id,memberId:s.id}));n&&n()},channel_updated:function e(t){if(TS.boot_data.feature_m11n_channel_updated_rtm_event_handler)return;if(!t.channel){TS.error("No channel id sent");return}var n=TS.interop.channels.getPublicChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel);return}if(!t.updates){TS.error('nothing changed in channel: "'+t.channel);return}var r=t.updates;r.id=t.channel;if(TS.interop.rules.channels.isPrivateChannel(r)&&!n.is_member){TS.redux.dispatch(TS.interop.redux.models.channels.removeChannels({ids:[n.id]}));TS.channels.deleted_sig.dispatch(n);return}n=TS.interop.channels.upsertChannel(r);if(TS.interop.rules.channels.isExternallySharedChannel(n)&&!TS.interop.rules.channels.isPendingExternallySharedChannel(n)){TS.channels.shared_invite_accepted_sig.dispatch(n);var i=TS.shared.legacyGetActiveModelOb();i.id===n.id&&TS.channels.converted_to_shared_sig.dispatch(n)}else TS.interop.rules.channels.isPendingExternallySharedChannel(n)&&r.pending_shared.length?TS.channels.shared_invite_pending_sig.dispatch(n):TS.interop.rules.channels.isExternallySharedChannel(n)||TS.interop.rules.channels.isPendingExternallySharedChannel(n)?TS.interop.rules.channels.isPrivateChannel(r)&&TS.channels.renamed_sig.dispatch(n):TS.channels.unshared_sig.dispatch(n)},channel_converted_to_shared:function e(t){if(!TS.boot_data.page_needs_enterprise)return;if(TS.boot_data.feature_channel_converted_to_shared_rtm_handler)return;if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}var n=TS.interop.channels.getPublicChannelById(t.channel.id);if(!n){TS.error('unknown channel: "'+t.channel.id);return}delete t.channel.is_member;TS.interop.channels.upsertChannel(t.channel);n._name_lc!==_.toLower(t.channel.name)&&TS.channels.channelRenamed(t.channel);var r=TS.shared.legacyGetActiveModelOb();r.id===n.id&&TS.channels.converted_to_shared_sig.dispatch(n)},channel_unshared:function e(t){if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var n=TS.interop.channels.upsertChannel(t.channel);TS.channels.unshared_sig.dispatch(n)},group_converted_to_shared:function e(t){if(!TS.boot_data.page_needs_enterprise)return;if(TS.boot_data.feature_channel_converted_to_shared_rtm_handler)return;if(!t.group||!t.group.id){TS.error("No group info sent");return}var n=TS.interop.channels.getGroupById(t.group.id);if(!n){TS.error('unknown group: "'+t.group.id);return}n.is_member&&(t.group.is_member=true);TS.interop.channels.upsertChannel(t.group);var r=TS.shared.legacyGetActiveModelOb();r.id===n.id&&TS.groups.converted_to_shared_sig.dispatch(n)},teams_joined_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("org-shared channel event sent to non-enterprise team:"+t.channel);return}var n=TS.interop.channels.getPublicChannelById(t.channel);n||(n=TS.interop.channels.getGroupById(t.channel));if(!n){TS.error('unknown channel or group: "'+t.channel);return}if(!TS.interop.rules.channels.isOrgShared(n)){TS.error("org-shared channel event sent for non-org-shared channel:"+t.channel);return}TS.channels.temp_list_of_removed_channels[n.id]&&delete TS.channels.temp_list_of_removed_channels[n.id];if(t.is_global_shared)n.is_global_shared=t.is_global_shared;else{var r=_(n.shared_team_ids).concat(t.teams).uniq().value();TS.redux.dispatch(TS.interop.channels.updateOrgAccessForChannel({channelId:n.id,teamIds:r,orgWide:t.is_global_shareds}))}var i=TS.shared.legacyGetActiveModelOb();if(!i.id===n.id)return;n.is_group?TS.groups.shared_teams_updated_sig.dispatch(n):TS.channels.shared_teams_updated_sig.dispatch(n)},teams_left_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("org-shared channel event sent to non-enterprise team:"+t.channel);return}var n=TS.interop.channels.getPublicChannelById(t.channel);n||(n=TS.interop.channels.getGroupById(t.channel));if(!n){TS.error('unknown channel or group: "'+t.channel);return}if(!TS.interop.rules.channels.isOrgShared(n)){TS.error("org-shared channel event sent for non-org-shared channel:"+t.channel);return}if(t.teams.indexOf(TS.model.team.id)<0){TS.redux.dispatch(TS.interop.redux.models.channels.removeChannels({ids:[n.id]}));return}TS.redux.dispatch(TS.interop.channels.updateOrgAccessForChannel({channelId:n.id,teamIds:t.teams,orgWide:t.is_global_shareds}));var r=TS.shared.legacyGetActiveModelOb();if(!r.id===n.id)return;n.is_group?TS.groups.shared_teams_updated_sig.dispatch(n):TS.channels.shared_teams_updated_sig.dispatch(n)},channel_history_changed:function e(t){if(TS.boot_data.feature_history_changed_modern_rtm_handlers)return;if(t._from_evt_log&&TS.boot_data.feature_detect_history_changed_events_via_api)return;v(t)},mpim_history_changed:function e(t){if(TS.boot_data.feature_history_changed_modern_rtm_handlers)return;if(t._from_evt_log&&TS.boot_data.feature_detect_history_changed_events_via_api)return;w(t)},group_open:function e(t){var n=TS.interop.channels.getGroupById(t.channel);n&&TS.logError({},"handled a group_open MS event unexpectedly. channelId: "+t.channel,"group_open")},group_history_changed:function e(t){if(TS.boot_data.feature_history_changed_modern_rtm_handlers)return;if(t._from_evt_log&&TS.boot_data.feature_detect_history_changed_events_via_api)return;b(t)},im_history_changed:function e(t){if(TS.boot_data.feature_history_changed_modern_rtm_handlers)return;if(t._from_evt_log&&TS.boot_data.feature_detect_history_changed_events_via_api)return;y(t)},pref_change:function e(t){if(TS.boot_data.feature_prefs_modernization)return;TS.prefs.legacyOnPrefChanged(t)},team_pref_change:function e(t){if(TS.boot_data.feature_team_prefs_modernization)return;TS.prefs.legacyOnTeamPrefChanged(t)},team_profile_change:function e(t){if(TS.boot_data.feature_team_profile_rtm_handlers)return;TS.team.upsertAndSignal({profile:t.profile})},team_profile_reorder:function e(t){if(TS.boot_data.feature_team_profile_rtm_handlers)return;TS.team.upsertAndSignal({profile:t.profile})},team_profile_delete:function e(t){if(TS.boot_data.feature_team_profile_rtm_handlers)return;TS.team.upsertAndSignal({profile:t.profile})},file_created:function e(t){var n=TS.files.getFileById(t.file.id);n?TS.warn("we already know about this file, which probably means the files.upload response came in before this message (so np) "+t.file.id):TS.files.upsertAndSignal(t.file,"MSFileCreated")},file_comment_added:function e(t){var n=TS.files.getFileById(t.file_id);if(!n)return;TS.files.editCommentOnFile(t.comment,n)||TS.files.addCommentToFile(t.comment,n)},file_comment_edited:function e(t){var n=TS.files.getFileById(t.file_id);if(!n)return;TS.files.editCommentOnFile(t.comment,n)},file_comment_deleted:function e(t){if(TS.boot_data.feature_file_comment_deleted_rtm_handler)return;var n=TS.files.getFileById(t.file_id);if(!n)return;TS.files.deleteCommentOnFile(t.comment,n)},team_join:function e(t){var n=t.user;TS.info(n.id+" joined the team");TS.members.legacyUpsertMember(n);n=TS.interop.members.getMemberById(n.id);if(!n){TS.error("team_join: wtf no member "+n.id+"?");S("team_join");return}g("team_join");TS.members.joined_team_sig.dispatch(n);TS.client&&TS.view.showProperTeamPaneFiller()},star_added:function e(t){if(TS.boot_data.feature_modern_starred_items)return;if(!t.item){TS.error(t.type+" has no item");return}var n=TS.redux.members.hasMemberWithId(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');S("star_added");return}g("star_added");if(!n.is_self)return;TS.stars.userStarStatusHasChanged(true,t.item,t.type);TS.stars.maybeUpdateUserStarredList({delta:1})},star_removed:function e(t){if(TS.boot_data.feature_modern_starred_items)return;if(!t.item){TS.error(t.type+" has no item");return}var n=TS.redux.members.hasMemberWithId(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');return}if(!n.is_self)return;TS.stars.userStarStatusHasChanged(false,t.item,t.type);TS.stars.maybeRemoveStarredListItem(t.item)},team_rename:function e(t){if(TS.boot_data.feature_team_rename_m11n)return;if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamName(t);else{$("#team_name").text(t.name);document.title=document.title.replace(TS.model.last_team_name,t.name);TS.ui.growls.original_document_title&&(TS.ui.growls.original_document_title=TS.ui.growls.original_document_title.replace(TS.model.last_team_name,t.name));TS.model.team.name=t.name;TS.model.last_team_name=TS.model.team.name;TS.team.team_name_changed_sig.dispatch(TS.model.team);TS.interop.desktop.teamNameChanged(t.name)}},team_icon_change:function e(t){if(TS.boot_data.feature_team_icon_m11n)return;if(!t.icon)return;if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamIcon(t);else{TS.model.team.icon=t.icon;TS.teams.changed_icon_sig.dispatch(TS.model.team);TS.client&&TS.client.updateTeamIcon()}},emoji_changed:function e(t){if(TS.boot_data.feature_sonic_emoji)return;switch(t.subtype){case"add":if(!t.hasOwnProperty("name")||!t.hasOwnProperty("value")){TS.warn("Bad emoji_changed__add event; expected `name` and `value` to be present");return}TS.emoji.addCustomEmoji(t.name,t.value,t.event_ts);break;case"remove":if(!_.isArray(t.names)){TS.warn("Bad emoji_changed__remove event; expected `names` to be an array");return}t.names.forEach(function(e){TS.emoji.removeCustomEmoji(e,t.event_ts)});break;case"rename":if(!t.hasOwnProperty("old_name")||!t.hasOwnProperty("new_name")||!t.hasOwnProperty("value")){TS.warn("Bad emoji_changed__rename event; expected `old_name`, `new_name` and `value` to be present");return}TS.emoji.renameCustomEmoji(t.old_name,t.new_name,t.value,t.event_ts);break;default:TS.logError("error_updating_emoji","Recieved emoji_changed event without a recognized subtype: "+t.subtype+".")}},commands_changed:function e(t){if(!t.commands_removed&&!t.commands_updated){n("commands_changed",t.event_ts,function(e){e&&(TS.model.commands_cache_ts=e);TS.cmd_handlers.resetUpCmds()});return}var i=Promise.resolve();r&&r.isPending()&&(i=r.catch(TS.interop.console.error));r=i.then(function(){return Promise.delay(_.random(0,1e4))}).then(function(){_.isArray(t.commands_removed)&&t.commands_removed.forEach(function(e){TS.cmd_handlers.removeCommand(e.name,t.event_ts)});_.isArray(t.commands_updated)&&t.commands_updated.forEach(function(e){TS.cmd_handlers.updateCommand(e,t.event_ts)})})},pin_added:function e(t){if(TS.boot_data.feature_modern_rtm_pins)return;var n=false;var r=TS.redux.channels.getEntityById(t.channel_id,n);if(r){TS.pins.pinStatusHasChanged(true,t.item,t.item.type,r,t.pin_count,t.pinned_info);r.has_pins=true}},pin_removed:function e(t){if(TS.boot_data.feature_modern_rtm_pins)return;var n=false;var r=TS.redux.channels.getEntityById(t.channel_id,n);if(r){TS.pins.pinStatusHasChanged(false,t.item,t.item.type,r,t.pin_count);false===t.has_pins&&(r.has_pins=false)}},subteam_updated:function e(t){if(TS.boot_data.feature_modern_user_groups_rtm)return;TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_members_changed:function e(t){if(TS.boot_data.feature_modern_user_groups_rtm)return;if(!TS.boot_data.feature_subteam_members_diff)return;TS.info("TS.ms.msg_handlers.subteam_members_changed",t);TS.interop.userGroups.userGroupMembersChanged(t)},subteam_created:function e(t){if(TS.boot_data.feature_modern_user_groups_rtm)return;TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_deleted:function e(t){if(TS.boot_data.feature_modern_user_groups_rtm)return;TS.user_groups.removeUserGroupAndSignal(t.subteam)},subteam_self_added:function e(t){if(TS.boot_data.feature_modern_user_groups_rtm)return;TS.interop.userGroups.upsertSelfUserGroup(t.subteam_id)},subteam_self_removed:function e(t){if(TS.boot_data.feature_modern_user_groups_rtm)return;TS.interop.userGroups.removeSelfUserGroup(t.subteam_id)},apps_installed:function e(t){t.app&&t.app.app_user_id&&TS.shared.legacyGetActiveModelOb().is_im&&TS.shared.legacyGetActiveModelOb().user==t.app.app_user_id&&TS.view.checkIfInputShouldBeDisabledAndPopulate()},dnd_updated:function e(t){if(TS.boot_data.feature_sonic_dnd_rtm)return;var n=TS.redux.members.hasMemberWithId(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');return}TS.dnd.updateUserPropsAndSignal(n.id,t.dnd_status)},dnd_updated_user:function e(t){if(TS.boot_data.feature_sonic_dnd_rtm)return;var n=TS.redux.members.hasMemberWithId(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.log(2002,'unknown member in dnd_updated_user: "'+t.user+'"');S("dnd_updated_user");return}g("dnd_updated_user");TS.dnd.updateUserPropsAndSignal(n.id,t.dnd_status)},thread_subscribed:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadSubscribed(n.channel,n.thread_ts,n)},thread_unsubscribed:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadUnsubscribed(n.channel,n.thread_ts,n)},thread_marked:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadMarked(n.channel,n.thread_ts,n.last_read,n.unread_count)},update_thread_state:function e(t){if(!TS.client)return;TS.client.threads.updateThreadState(t.has_unreads,t.mention_count,t.timestamp,t.mention_count_by_channel);TS.replies.updateThreadStateReceived()}});var e=function e(t){var n=false;var r=TS.redux.channels.getEntityById(t.channel,n);if(!r){TS.error('unknown model_ob: "'+t.channel+'"');return}TS.redux.messages.channelHistoryChanged(r.id)};var t={};var n=function e(n,r,i){t[n]=t[n]||{};var a=t[n];r&&(a.cache_ts=r);if(a.timer)return;var s=_.random(0,5e3);TS.info("Waiting "+s+" ms before handling "+n+" event");a.timer=setTimeout(function(){delete t[n];i(a.cache_ts)},s)};var r;var i=false;var a=false;var s=1e3;var o=null;var l=6e4;var u={};var d={};var c=0;var m=0;var f={start:function e(t,n){if(!a)return;n=n&&parseInt(n,10)||s;var r={start:performance.now(),end:0};var i=function e(i){i=!!i;r.end=performance.now();var a=r.end-r.start;a>n&&TS.warn("'"+t+"' msg_handler took "+_.round(a,2)+"ms"+(n!==s?" (threshold = "+n+")":""));f.count(t,a,i)};return i},count:function e(t,n,r){d.start_time||(d.start_time=performance.now());u[t]||(u[t]={call_count:0,elapsed_time:0,async:!!r});r&&(u[t].async=r);u[t].call_count+=1;u[t].elapsed_time+=n;f.maybeReport()},report:function e(){f.finish();if(_.size(u)){var t=_.sum(_.map(u,"call_count"));TS.has_pri[h]&&TS.log(h,"\ud83c\udfd4\ufe0f MS message stats: "+t+" handler calls in "+parseInt(d.elapsed_time/1e3,10)+"s window, "+c+" imsgs since "+new Date(m),u);f.beacon()}f.reset()},beacon:function e(){var t="ms_handler_";_.each(u,function(e,n){n=e.async?t+"async_"+n:t+n;TS.metrics.count(n+"_count",e.call_count);TS.metrics.store(n+"_time",e.elapsed_time)});TS.metrics.store(t+"imsgs_received_total",c,{is_count:true})},finish:function e(){d.end_time=performance.now();d.elapsed_time=d.end_time-d.start_time},reset:function e(){u={};d={};o=null},maybeReport:function e(){if(o)return;o=window.setTimeout(f.report,l)},enableStatsCollecting:function e(){TS.has_pri[h]&&TS.log(h,"\ud83c\udfd4\ufe0f MS message handler stat collecting enabled");a=true},disableStatsCollecting:function e(){TS.has_pri[h]&&TS.log(h,"\ud83c\udfd4\ufe0f MS message handler stat collecting disabled");a=false}};var p=2;var h=808;var g=function e(t){TS.utility.enableFeatureForUser(1)&&TS.metrics.count("ms_event_handled_"+t)};var S=function e(t){TS.utility.enableFeatureForUser(1)&&TS.metrics.count("ms_event_dropped_"+t)};var T=function e(){return window.desktop&&window.desktop.app&&window.desktop.app.getIdleTimeInMs};var v=function t(n){TS.info("channel_history_changed for "+n.channel);return e(n)};var b=function t(n){if(n.is_mpim)return;TS.info("group_history_changed for "+n.channel);return e(n)};var y=function t(n){TS.info("im_history_changed for "+n.channel);return e(n)};var w=function t(n){TS.info("mpim_history_changed for "+n.channel);return e(n)}})()},2913:function(e,t){(function(){TS.registerModule("ds",{last_pong_time:0,sent_map:{},connected_sig:new signals.Signal,disconnected_sig:new signals.Signal,trouble_sig:new signals.Signal,reconnecting_sig:new signals.Signal,pong_sig:new signals.Signal,on_msg_sig:new signals.Signal,reconnect_requested_sig:new signals.Signal,onStart:function e(){b(TS.model.ui.is_window_focused||false);TS.ui.window_focus_changed_sig.add(b);setInterval(function(){if(!TS.model.ds_connected)return;if(TS.model.rtd_start_throttler<1)return;TS.model.rtd_start_throttler-=1},6e4)},send:function e(t,n,r){g+=1;t.id=g;TS.ds.sent_map[t.id.toString()]={msg:t,handler:n,ts:Date.now(),temp_ts:r};"ping"===t.type||"pong"===t.type?TS.has_pri[H]&&TS.log(H,"DS TS.ds ping --\x3e\n"+JSON.stringify(t,null,"  ")):TS.has_pri[H]&&TS.log(H,"TS.ds --\x3e\n"+JSON.stringify(t,null,"  "));h&&TS.model.ds_connected?h.send(JSON.stringify(t)):TS.ds.Q.push(t);return t.id},Q:[],sendTyping:function e(t){var n='{"type":"typing", "channel":"'+t+'"}';h.send(n)},handleMsg:function e(t){var n=t.reply_to&&!("ok"in t)&&"message"===t.type;var r;if(t.reply_to)if(t.reply_to.toString()in TS.ds.sent_map){r=TS.ds.sent_map[t.reply_to];t.SENT_MSG=r.msg;delete TS.ds.sent_map[t.reply_to]}else n||TS.error('received msg "'+t.reply_to+'" with type "'+t.type+'" but we have no record of it in sent_map');if("ping"===t.type||"pong"===t.type){if(TS.has_pri[H]){TS.log(H,"DS msg "+t.type+" time: "+(Date.now()-r.ts)+"ms");TS.log(H,"DS TS.ds ping <--\n"+JSON.stringify(t,null,"  "))}TS.ds.last_pong_time=Date.now();TS.ds.pong_sig.dispatch();S=false}else{if(r){var i=t.type||t.SENT_MSG.type||"";TS.has_pri[H]&&TS.log(H,"msg "+(i?'"'+i+'" ':"")+"rsp time "+(Date.now()-r.ts)+"ms")}TS.has_pri[H]&&TS.log(H,"TS.ds <-- \n"+JSON.stringify(t,null," "))}if("error"===t.type)O(t);else if(!t.reply_to){TS.ds.on_msg_sig.dispatch(t);"hello"===t.type&&D(t)}if(r){t.ok||(t.error=t.error||{code:0,msg:"unknown error (not specified by MS)"});n&&(t.ok=true);r.handler&&r.handler(t.ok,t)}},onFailure:function t(r){r&&I("You got disconnected, so here are some details:\n>>>"+r);S=false;M();if(TS.model.ds_connected){TS.info("Disconnected from DS, TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler);TS.ds.logConnectionFlow("on_connected_failure");TS.model.ds_reconnect_ms=100;TS.ds.disconnect()}else{TS.ds.logConnectionFlow("on_notconnected_failure");TS.model.ds_reconnect_ms=1.3*(TS.model.ds_reconnect_ms+1e3);var i=TS.model.ds_reconnect_ms;TS.model.ds_reconnect_ms>4e3&&(TS.model.ds_reconnect_ms=_.random(i,i+i/3));TS.model.ds_reconnect_ms=Math.min(TS.model.ds_reconnect_ms,3e5)}if(TS.model.rtd_start_throttler>5){var a=2e3*TS.model.rtd_start_throttler;if(TS.model.ds_reconnect_ms<a){TS.info("because TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler+" we are increasing time until next login call");TS.model.ds_reconnect_ms=a}}if(TS.model.ds_connected){TS.model.ds_connected=false;TS.ds.disconnected_sig.dispatch()}TS.model.ds_connected=false;clearInterval(n);clearInterval(e);if(TS.model.ds_asleep){TS.warn("NOT doing startReconnection(), we are asleep");return}TS.ds.startReconnection()},startReconnection:function e(){TS.model.ds_reconnect_time=Date.now()+TS.model.ds_reconnect_ms;TS.info("Attempting to reconnect in "+TS.model.ds_reconnect_ms+"ms");clearInterval(m);m=setInterval(A,f);A();clearTimeout(p);p=setTimeout(function(){TS.model.window_unloading||TS.ds.reconnect_requested_sig.dispatch()},TS.model.ds_reconnect_ms)},manualReconnectNow:function e(){TS.ds.logConnectionFlow("manual_reconnect");clearTimeout(p);clearInterval(m);clearTimeout(i);v=0;if(!TS.model.window_unloading){TS.ds.reconnect_requested_sig.dispatch();TS.ds.reconnecting_sig.dispatch(0)}},disconnect:function e(){if(h&&TS.model.ds_connected){TS.ds.logConnectionFlow("disconnect");h.close()}else TS.warn("TS.ds.disconnect called, but _websocket="+h+" TS.model.ds_connected="+TS.model.ds_connected)},logConnectionFlow:function e(t){var n=TS.model.ds_conn_log;var r=Date.now();n.push({name:t,time:r,delta:n.length?r-n[n.length-1].time:0});TS.has_pri[H]&&TS.log(H,"logConnectionFlow "+t+" "+n[n.length-1].delta)},getConnectionFlowLog:function e(){var t=TS.model.ds_conn_log;var n=[];for(var r=0;r<t.length;r+=1)n.push(encodeURIComponent(t[r].name+"-"+(t[r].delta?Math.round(t[r].delta/1e3):0)+"-"+Math.round(t[r].time/1e3)));TS.dir(2,TS.model.ds_conn_log);var i="_x_connection_log="+n.join(",");return i},connect:function e(){window.WebSocket||(window.WebSocket=window.MozWebSocket);if(window.WebSocket){var t;try{TS.ds.logConnectionFlow("connect");t=TS.web.space.login_data.ws;var n=1==TS.qs_args.simulate_old_token?"&TRIGGER_OLD_TOKEN=1":"";t+="?version_uid="+TS.boot_data.version_uid+n;t=TS.utility.appendLogToUrlWithLimit(t,TS.ds.getConnectionFlowLog());TS.info("Connecting to: "+t);if(1==TS.qs_args.simulate_first_connect_failure&&!window.already_simulated_first_connect_failure){t=t.replace("e","w");TS.info("simulate_first_connect_failure url:"+t);window.already_simulated_first_connect_failure=true}a=window.WEB_SOCKET_USING_FLASH?o:s;clearTimeout(i);i=setTimeout(P,a);TS.ds.last_url=t;TS.ds.last_start_ms=Date.now();M();h=new WebSocket(t)}catch(e){TS.warn("failed to create new WebSocket");TS.error(e);TS.ds.onFailure("failed to create new WebSocket");return}TS.model.ds_connecting=true;1==TS.qs_args.simulate_first_connect_timeout&&v<1?TS.info("simulate_first_connect_timeout url:"+t):h.onopen=w;h.onclose=C;h.onerror=F}else alert(TS.interop.i18n.t("Your browser does not support Web Sockets.","ds")())},sleep:function e(){if(TS.model.ds_asleep)return;if(!TS.model.ds_connected)return;TS.model.ds_asleep=true;TS.ds.disconnect()},wake:function e(){if(!TS.model.ds_asleep)return;TS.model.ds_asleep=false;TS.ds.startReconnection()}});var e=0;var t=3e3;var n=0;var r=1e4;var i=0;var a=0;var s=1e4;var o=2e4;var l=0;var u=3e4;var d=0;var c=5e3;var m=0;var f=1e3;var p=0;var h=null;var g=0;var S=false;var T=0;var v=0;var b=function e(t){T=t?1e4:6e4;T+=r;TS.has_pri[H]&&TS.log(H,"DS _pong_timeout_ms set to:"+T+" has_focus:"+t)};var y=function e(t){var n=JSON.parse(t.data);TS.ds.handleMsg(n)};var w=function e(){clearTimeout(i);v=0;if(1!=TS.qs_args.simulate_hello_timeout||window.already_simulated_hello_timeout)h.onmessage=y;else{TS.info("simulate_hello_timeout");window.already_simulated_hello_timeout=true}TS.model.ds_conn_log.length=0;TS.info("DS WS connected!");TS.ds.logConnectionFlow("on_connect");clearTimeout(l);l=setTimeout(E,u)};var k=function e(){if(!S)return;var t=Date.now()-TS.ds.last_pong_time;TS.has_pri[H]&&TS.log(H,"DS MS since_last_pong_ms:"+t+" pong_timeout_ms:"+T);if(t<T)return;TS.warn("since_last_pong_ms too long! "+t+" > "+T);TS.warn("calling disconnect(), expect to get an onDisconnect() callback");TS.ds.logConnectionFlow("on_ping_timeout");TS.ds.trouble_sig.dispatch();S=false;I("You are on team Tiny Speck, so here are some pong details:\n>>>since_last_pong_ms too long! "+t+" > "+T+" ... calling disconnect(), expect to get an onDisconnect() callback");try{TS.ds.disconnect();clearTimeout(d);d=setTimeout(function(){TS.info("called disconnect, no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now");C(null,"since_last_pong_ms too long! then called disconnect, but no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now")},c)}catch(e){TS.info("since_last_pong_ms too long! then an error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now");TS.warn(e);C(null,"error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now")}};var x=function e(){TS.ds.send({type:"ping"});S=true};var C=function e(t,n){n=n||"_onDisconnect called with event:"+t;TS.info("DS WS disconnected");TS.ds.logConnectionFlow("on_disconnect");clearTimeout(d);clearTimeout(l);clearTimeout(i);t?TS.info("_onDisconnect event.code:"+t.code):TS.info("no event");TS.ds.onFailure(n)};var I=function e(t){TS.warn("_reportDisconnect reason_str:"+t)};var M=function e(){if(!h)return;h.onmessage=null;h.onopen=null;h.onerror=null;h.onclose=null;try{h.close()}catch(e){}};var A=function e(){var t=TS.model.ds_reconnect_time-Date.now();var n=Math.round(t/1e3);n>=0&&TS.ds.reconnecting_sig.dispatch(n);TS.model.window_unloading&&clearInterval(m)};var E=function e(){var t="socket received no hello msg "+u+"ms after connection";TS.warn(t);TS.ds.logConnectionFlow("_onHelloTimeout");TS.ds.onFailure(t)};var P=function e(){v+=1;var t="socket not connected "+a+"ms after creation. _connect_timeout_count:"+v;TS.warn(t);TS.ds.logConnectionFlow("_onConnectTimeout");if(3==v){$();return}if(2==v)if(window.WEB_SOCKET_USING_FLASH);else if(TS.model.is_chrome_desktop){s=2e4;return}TS.ds.onFailure(t)};var F=function e(t){var n="";if(t){t.name&&(n+=" e.name="+t.name);t.message&&(n+=" e.message="+t.message);t.data&&(n+=" e.data="+t.data)}TS.warn("_onError err_str: "+n);TS.dir(0,t)};var O=function e(t){if(t.error)if(1==t.error.code)TS.ds.logConnectionFlow("msg_error_code_1");else{TS.info("_onErrorMsg websocket is connected but we got an error message: "+JSON.stringify(t));TS.ds.onFailure("_onErrorMsg imsg.error:"+t.error)}else TS.info("_onErrorMsg: "+(t?JSON.stringify(t):"no imsg?"))};var D=function i(){clearTimeout(l);var a=Date.now()-TS.ds.last_pong_time;TS.info("Hello msg recvd, since_last_pong_ms:"+a);TS.ds.logConnectionFlow("on_hello");clearInterval(m);S=true;TS.ds.last_pong_time=Date.now();clearInterval(e);e=setInterval(k,t);clearInterval(n);n=setInterval(x,r);TS.model.ds_connecting=false;TS.model.ds_connected=true;var s;for(var o=0;o<TS.ds.Q.length;o+=1){s=TS.ds.Q.shift();TS.has_pri[H]&&TS.log(H,"TS.ds (Q) --\x3e\n"+JSON.stringify(s,null,"  "));h.send(JSON.stringify(s))}TS.ds.connected_sig.dispatch();x()};var H=2;var $=function e(){TS.info("Showing connection trouble dialog :(");var t;t=TS.model.is_our_app?TS.interop.i18n.t("We\u2019ve seen this problem clear up with a restart of Slack, a solution which we suggest to you now only with great regret and self-loathing.","ms")():TS.interop.i18n.t("We\u2019ve seen this problem clear up with a restart of your browser, a solution which we suggest to you now only with great regret and self-loathing.","ms")();TS.generic_dialog.start({title:TS.interop.i18n.t("Connection trouble","ms")(),body:TS.interop.i18n.t("<p>Apologies, we\u2019re having some trouble with your connection.</p>","ms","a00c9a13414e9cafbb6ddbf08b69577824180035")()+"<p>"+t+"</p>",show_cancel_button:false,go_button_text:TS.interop.i18n.t("OK","ms")(),esc_for_ok:true,onGo:function e(){TS.reload(null,"Connection trouble")}})}})()},2914:function(e,t){(function(){TS.registerModule("templates",{onStart:function t(){n();TS.members&&TS.members.user_color_changed_sig.add(TS.templates.memberUserColorChanged,TS.templates);TS.prefs&&TS.prefs.sidebar_behavior_changed_sig.add(TS.templates.sidebarBehaviorPrefChanged,TS.templates);TS.environment.retina_changed_sig.add(e)},makeUnreadMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_messages_"+t.id)},makeRxnKeyDomClass:function e(t){return TS.utility.makeSafeForDomId("rxns_key_"+t)},makeUnreadGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_group_messages_"+t.id)},makeUnreadDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_dms_"+t.id)},makeSentMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_messages_"+t.id)},makeSentGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_group_messages_"+t.id)},makeIssueListDomId:function e(t){return"issue_list_"+t},makeSentDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_dms_"+t.id)},makeMsgDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t)},makeMsgLabelDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t+"_label")},makeMsgAttachmentTextExpanderDomId:function e(t,n){return TS.utility.makeSafeForDomId("msg_rest_text_expander_"+t+"_"+n)},makeMSRDomId:function e(t){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts)},makeMSRDomIdWithModule:function e(t,n){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts+"_"+n)},makeChannelDomId:function e(t){return"channel_"+t.id},makeChannelDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,is_channel:t.is_channel||false,is_group:t.is_group||false,is_im:t.is_im||false,is_mpim:t.is_mpim||false,is_self_im:TS.interop.rules.channels.isYou(t)||false,is_slackbot_im:TS.interop.rules.channels.isSlackbot(t)||false,purpose:t.purpose?t.purpose.value:"",topic:t.topic?t.topic.value:""})},makeFileDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,title:t.title,mimetype:t.mimetype,filetype:t.filetype,size:t.size})},makeDayDividerDomId:function e(t){return TS.utility.makeSafeForDomId("day_divider_"+t)},makeGroupDomId:function e(t){return"group_"+t.id},makePriorityIconDomId:function e(t){return"priority_"+t.id},makeStarredIconDomId:function e(t){return"starred_"+t.id},makeMutedIconDomId:function e(t){return"muted_"+t.id},makeMemberDomId:function e(t){if(!t)return;return TS.templates.makeMemberDomIdById(t.id)},makeMemberDomIdById:function e(t){if(!t)return;return"member_"+t},makeMpimDomId:function e(t){return"mpim_"+t.id},makeChannelListDomId:function e(t){return"channel_"+t.id+"_member_list"},makeFileDomId:function e(t){return"file_"+t.id},makeFileCommentsDomId:function e(t){return"file_comments_"+t.id},makeFileContentsDomId:function e(t){return"file_contents_"+t.id},makeUnreadMsgsDomId:function e(t){return"unread_msg_"+t.id},makeUnreadHighlightDomId:function e(t){if(!t)return;return"unread_highlight_"+t.id},makeMemberPresenceDomClass:function e(t){return"member_presence_"+t},makeMemberPresenceStateClass:function e(t){var n=TS.redux.presence.getPresenceByMemberId(t.id);TS.dnd.isMemberInDnd(t)&&(n+=" dnd");return n},makeMemberPresenceStateAriaLabel:function e(t){var n=TS.redux.presence.getPresenceByMemberId(t.id);var r="";"active"===n?r+="active":"away"===n&&(r+="away");TS.dnd.isMemberInDnd(t)&&(r+=", do not disturb");return r},makeMemberPresenceIcon:function e(t){if(t.deleted)return"";var n=TS.templates.makeMemberPresenceDomClass(t.id);var r="ts_icon_presence";var i=TS.redux.presence.getPresenceByMemberId(t.id);var a="active"===i?TS.interop.i18n.t("active","templates_helpers")():TS.interop.i18n.t("away","templates_helpers")();if(t.is_ultra_restricted){n+=" ura";r="ts_icon_presence_ura"}else if(t.is_restricted){n+=" ra";r="ts_icon_presence_ra"}else if(TS.interop.members.isExternal(t)){n+=" external";r="ts_icon_presence_external"}else t.is_slackbot&&(r="ts_icon_heart");var s='<i aria-hidden="true" class="ts_icon '+r+' presence_icon"></i>';var o=TS.templates.makeMemberPresenceStateClass(t);var l='<span data-member-presence="'+t.id+'" class="presence '+o+" "+n+'" title="'+a+'">'+s+"</span>";return l},makeMemberStatusDomClass:function e(t){return"member_status_"+t},memberUserColorChanged:function e(t){var n="color_"+t.id;if(t.color==t.member_color){var r="color_rule_"+n;var i=$("#"+r);i.remove();return}TS.templates.makeUserColorRule(t)},makeUserColorRule:function e(t){var n="color_"+t.id;var r="#"+_.escape(t.member_color);var i;i=TS.client?"\t\t\t\t."+n+":not(.nuc), \t\t\t\t#col_channels ul li:not(.active):not(.away) > ."+n+":not(.nuc) {\t\t\t\t\tcolor:"+r+";\t\t\t\t}\t\t\t":"\t\t\t\t."+n+":not(.nuc) {\t\t\t\t\tcolor:"+r+";\t\t\t\t}\t\t\t";var a="color_rule_"+n;var s=$("#"+a);s.length?s.text(i):$('<style type="text/css" id="'+a+'">'+i+"</style>").appendTo("body")},sidebarBehaviorPrefChanged:function e(){TS.templates.makeSidebarBehaviorRule()},makeSidebarBehaviorRule:function e(){var t;var n="sidebar_behavior";var r=$("#"+n);"hide_read_channels"===TS.prefs.getPref("sidebar_behavior")?t="\t\t\t\t.channels_list_holder ul li:not(.unread):not(.active):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}":"hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&(t="\t\t\t\t.channels_list_holder div:not(#starred_div)>ul li:not(.unread):not(.active):not(.is_starred):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}");t?r.length?r.text(t):$('<style type="text/css" id="'+n+'">'+t+"</style>").appendTo("head"):$("#"+n).remove()},makeMsgDomIdInConversation:function e(t){return TS.templates.makeMsgDomId(t)+"_conversation"},makeMsgDomIdInSearch:function e(t,n){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(n)},makeMsgDomIdInSearchTopResults:function e(t,n,r){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(n)+"_"+r},makeMsgDomIdInUnreadView:function e(t){return TS.templates.makeMsgDomId(t)+"_unread_view"},makeMsgDomIdInThreadsView:function e(t){return TS.templates.makeMsgDomId(t)+"_threads_view"},promiseToRenderAsync:function e(t,n){if(!t)return Promise.reject(new Error("No template to render"));return Promise.resolve(n).then(function(e){return t(e)})}});var e=function e(){var t;var n;var r;var i;$(".member_image").each(function(){i=$(this);t=i.data("member-id");n=i.data("thumb-size");r=!i.is("a");t&&n&&$(this).replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(t,n,false,r))});i=null};var t=/{{\s*i18n_ns\s*('|")[a-zA-Z0-9]+('|")\s*}}/;var n=function e(){Object.keys(TS.raw_templates).forEach(function(e){TS.templates[e]=r(e,TS.raw_templates[e]);Handlebars.registerPartial(e,TS.templates[e])});delete TS.raw_templates};var r=function e(n,r){if(!r){TS.warn(n+" was passed no html");return null}t.test(r)&&(r+=" {{_i18n_ns_end}}");var i=Handlebars.compile(r);return function(e){e=e||{};var t=Math.floor(1e3*Math.random());var r=1==t;if(r)try{var a={contexts:{ui_context:{action:"impression",ui_properties:{element_name:n+".hbs"}}}};TS.interop.clog.track("HANDLEBARS_TEMPLATE_LOGS",a)}catch(e){}return i(e)}}})()},2915:function(e,t,n){(function(){TS.registerModule("templates.builders.msgs",{buildHTML:function n(r,i){i&&TS.dir(0,r);try{var a=r.msg;var s=r.model_ob;var o=r.prev_msg;var l=!!r.highlight;var u=!!r.no_attachments;var d=!!r.standalone;var c=!!(d||r.hide_actions);var m=!!r.full_date;TS.prefs.getPref("fuller_timestamps")&&!m&&(m=!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(a.ts),new Date));var f=!!r.relative_ts;var p=r.jump_link?new Handlebars.SafeString(r.jump_link):"";var h=!!r.starred_items_list;var g=r.starred_items_actions;var S=r.container_id?"#"+r.container_id:"";var T=!!r.enable_slack_action_links;var v=!!(r&&r.highlight_as_new);var b="";var y=TS.utility.members.getEntityFromMessage(a);var w=true;var k=TS.interop.datetime.toDateObject(a.ts);var x=false;var C=false;var I=!!a.is_pending;var M=a.user;var A;var E=a.is_ephemeral;var P=TS.templates.makeMsgDomId(a.ts);var F=TS.utility.msgs.getMsgActions(a,s);M||(M=TS.templates.builders.getBotIdentifier(a));var O=TS.utility.msgs.shouldHaveBotLabel(a,y);var D;var H;var j;var B;P=r.msg_dom_id||P;var L=!!r.is_in_conversation;var N=!!r.is_threads_view;false;if(O){var R=TS.interop.bots.getBotInfoByMsg(a);if(R){D=_.get(R,"appId");H=_.get(R,"botId");j=_.get(R,"teamId")?R.teamId:_.get(a,"source_team_id")}B=true}if(o){A="file_comment"===o.subtype&&o.comment?o.comment.user:o.user;A||(A=TS.templates.builders.getBotIdentifier(o))}if(!a.no_display&&!d)if(o){var U=TS.interop.datetime.toDateObject(o.ts);a.subtype&&"file_comment"===a.subtype&&a.comment&&(M=a.comment.user);var G=TS.interop.rules.messages.isAutomatedSubtype(a.subtype);if(G||"thread_broadcast"===a.subtype)w=true;else if(A==M&&!G)if(!a.subtype&&o.subtype&&"file_comment"===o.subtype)w=true;else{if(!o.subtype||TS.templates.builders.getBotIdentifier(o)){var q=o.thread_ts||o.ts;var W=a.thread_ts==q;var z=!a.thread_ts&&!o.thread_ts;(W||z)&&(w=false)}!TS.interop.rules.messages.isTempMsg(a)||"bot_message"!==a.type&&"USLACKBOT"!==a.user||(w=true)}if(!I&&!TS.interop.datetime.isSameDay(k,U)&&!L){x=true;var K=$(S+" div.day_divider");if(K.length>0){var V;var Y=$(K[K.length-1]);if(Y.length){V="";try{V=TS.templates.messages_day_divider({ts:Y.data("ts")})}catch(e){e.message||(e.message="");e.message+=" $last_divider.data('ts'):"+Y.data("ts");TS.info("Problem with TS.templates.messages_day_divider 2.1: "+JSON.stringify(e))}Y.replaceWith(V)}if(K.length>1){var J=$(K[K.length-2]);if(J.length){V="";try{V=TS.templates.messages_day_divider({ts:J.data("ts")})}catch(e){e.message||(e.message="");e.message+=" $second_last_divider.data('ts'):"+J.data("ts");TS.info("Problem with TS.templates.messages_day_divider 3.1: "+JSON.stringify(e))}J.replaceWith(V)}}}}!I&&TS.interop.datetime.distanceInMinutes(k,U)>TS.model.msg_activity_interval&&(C=true)}else L||(C=true);C&&(w=true);"message"!==a.type&&(w=true);("me_message"===a.subtype||o&&"me_message"===o.subtype)&&(w=true);var Q=true;d&&(Q=false);var X=false;var Z=TS.rxns.getExistingRxnsByKey(a._rxn_key);Z&&(X=true);r.for_mention_rxn_display&&(w=false);var ee;var te;var ne="#msgs_div"===S||"#unread_msgs_div"===S;if(TS.client&&TS.client.highlights&&!d){ee=ne&&TS.client.highlights.msgIsHighlight(s.id,a.ts);te=ne&&TS.client.highlights.msgIsHighlightUnfurl(s.id,a.ts)}c=!!(c||I);var re={msg:a,model_ob:s,member:y,actions:F,show_user:w,unprocessed:I,highlight:l,do_inline_imgs:Q,msg_dom_id:P,standalone:d,hide_actions:c,full_date:m,relative_ts:f,jump_link:p,show_resend_controls:a.ts in TS.model.display_unsent_msgs,starred_items_list:h,starred_items_actions:g,no_attachments:u,is_ephemeral:E,enable_slack_action_links:T,is_bot:O,bot_id:H,app_id:D,team_id:j,is_app_data_enabled:B,highlight_as_new:v,show_star:false,has_rxns:X,for_mention_display:r.for_mention_display,for_mention_rxn_display:r.for_mention_rxn_display,for_search_display:r.for_search_display,for_top_results_search_display:r.for_top_results_search_display,ts_tip_delay_class:"ts_tip_delay_600",is_root_msg:r.is_root_msg,is_in_conversation:L,is_threads_view:N,file_title_only:"file_reaction"===a.subtype,is_slackbot_response:"slackbot_response"===a.subtype,show_channel_highlight:ee,is_highlighted_unfurl:te,show_briefing_feedback:r.briefing||l};var ie=TS.utility.msgs.getFilesOnMsg(a);var ae=_.first(ie);(F.add_rxn||F.add_file_rxn||F.add_file_comment_rxn)&&(re.show_rxn_action=true);re.star_components=TS.templates.builders.buildStarComponents("message",a,s);var se=true;d&&(se=false);TS.interop.rules.messages.isFile(a)&&(se=false);re.selectable=se;L&&(re.msg_dom_id=TS.templates.makeMsgDomIdInConversation(a.ts));if(TS.interop.messages.isReply(a))re.show_reply_action=false;else{var oe=true;re.show_reply_action=TS.replies.canReplyToMsg(s,a,oe)&&!r.is_root_msg;!re.show_reply_action&&TS.interop.rules.messages.isFile(a)&&ae&&(re.show_comment_action=true)}var le=a.ts==a.thread_ts;if((le||!a.thread_ts)&&L&&TS.client){re.format_for_thread_root=!TS.boot_data.feature_file_threads;s.is_im||s.is_mpim?re.model_ob_name=TS.interop.i18n.t("Direct message","messages")():re.model_ob_name=TS.interop.i18n.t("in {channel_display_name}","messages")({channel_display_name:TS.interop.rules.channels.getDisplayNameForChannel(s)})}!le||!a.reply_count||L||d||r.for_search_display||r.for_top_results_search_display||r.is_threads_view||(re.show_reply_bar=true);re.is_tombstone="tombstone"===a.subtype;re.is_new_reply=!!r.is_new_reply;if(TS.interop.messages.isReply(a)&&"thread_broadcast"===a.subtype&&!L&&!d&&!r.is_threads_view){re.is_broadcast=true;re.show_reply_action=true}if(re.is_broadcast&&a.root){re.root_repliers_summary=new Handlebars.SafeString(TS.templates.builders.buildBroadcastRepliersSummaryHTML(a.root));if("tombstone"!==a.root.subtype){var ue=a.root.text;var de=_.first(a.root.attachments);if(_.get(de,"is_msg_unfurl")){var ce=de.from_url&&a.root.text==="<"+de.from_url+">";ue&&!ce||(ue=de.text)}if(ue){var _e=TS.format.formatBroadcastExcerpt(ue,a.root);_e.length>150&&(_e=TS.utility.truncateHTML(_e,150));re.root_excerpt=new Handlebars.SafeString(_e)}}}re.show_broadcast_indicator=TS.boot_data.feature_broadcast_indicator&&"thread_broadcast"===a.subtype&&(L||N);var me;me="file_share"===a.subtype||"file_mention"===a.subtype||TS.boot_data.feature_file_threads&&!a.subtype&&ae?ae:"file_comment"===a.subtype?a.comment:a;me&&me.pinned_to&&me.pinned_to.length>0?re.is_pinned=_.some(me.pinned_to,function(e){return e===s.id}):re.is_pinned=false;re.is_pinned?re.pin_html=TS.templates.builders.buildPinInfoHtml(a):re.pin_html="";if(TS.client&&TS.client.highlights&&!d){re.is_recap=ee;if(TS.client.highlights.shouldRenderHighlightsUI(s.id,a.ts)){var fe=TS.client.highlights.getHighlight(s.id,a.ts);var pe=fe.justification;re.highlights_html=TS.templates.builders.buildHighlightsInfoHtml({recap:{data:TS.client.highlights.getHighlight(s.id,a.ts),justification:pe?TS.format.formatWithOptions(pe||"",void 0,{no_linking:true}):"",isLeavingFeedback:TS.client.highlights.msgIsLeavingFeedback(s.id,a.ts)}})}re.show_recap_debug=TS.client.highlights.canShowRecapDebug(s.id,a.ts);re.highlight_is_leaving_feedback=TS.client.highlights.msgIsLeavingFeedback(s.id,a.ts)}TS.highlights_briefing&&r.briefing&&(re.show_recap_debug="sli_debug_info"===TS.highlights_briefing.sli_recaps_debug_group);!a.subtype&&(r.for_search_display||r.for_top_results_search_display)&&ae&&(a.comment?re.star_components=TS.templates.builders.buildStarComponents("file_comment",a.comment,ae):re.star_components=TS.templates.builders.buildStarComponents("file",ae,null));if(!TS.interop.rules.messages.isTempMsg(a)&&!a.is_ephemeral){re.permalink=TS.utility.msgs.constructMsgPermalink(s,a.ts,a.thread_ts);re.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(s,a.ts,a.thread_ts)}if((r.for_top_results_search_display||r.for_search_display)&&TS.boot_data.page_needs_enterprise){re.abs_permalink=a.permalink;re.archive_link=a.permalink;re.permalink=a.permalink}if("file_share"===a.subtype||"file_mention"===a.subtype||"file_reaction"===a.subtype||TS.interop.messages.shouldRenderFileThread(a)&&ae){ae&&$.extend(re,e({file:ae,msg:a,starred_items_list:h,model_ob:s}));var he=TS.templates.builders.msgs.buildFileShareMetaText(a);re.file_share_html=new Handlebars.SafeString(he)}else if("file_comment"===a.subtype){o&&!o.no_display&&o.file&&ae&&ae.id==o.file.id&&(x||(re.is_file_convo_continuation=true));re.show_comment_quote_icon=true;if(o&&!o.no_display&&o.file&&ae&&ae.id==o.file.id){(TS.boot_data.feature_file_threads&&!a.subtype||"file_share"===o.subtype)&&o.upload&&o.file.initial_comment&&(x||(re.show_comment_quote_icon=false));"file_comment"===o.subtype&&(x||(re.show_comment_quote_icon=false))}re.file=ae;re.icon_class=TS.utility.getImageIconClass(ae,"thumb_40");re.comment=a.comment;re.member=TS.utility.members.getEntityFromMessage(a);ae&&ae.user!=a.comment.user&&(re.uploader=TS.utility.members.getEntityFromFile(ae));h||(re.star_components=TS.templates.builders.buildStarComponents("file_comment",a.comment,ae))}re.render_file_thread=TS.interop.messages.shouldRenderFileThread(a);re.files=ie&&ie.map(function(t){return e({file:t,msg:a,starred_items_list:h,model_ob:s})});var ge=t(a,re);re.msg_classes=ge.join(" ");re.addDirectionAttr=parseInt(a.ts,10)>1541628e3;b+=TS.templates.message(re);b=TS.format.replaceHighlightMarkers(b);return b}catch(e){var Se="";if(a){Se="msg.ts:"+a.ts;delete r.model_ob;try{r.msg=_.cloneDeep(a);r.msg.text="REDACTED";r.msg.attachments&&(r.msg.attachments="REDACTED");r.prev_msg&&(r.prev_msg=r.prev_msg.ts);r.msg.channel&&r.msg.channel.id&&(r.msg.channel=r.msg.channel.id);Se+=" "+JSON.stringify(r,null,"  ")}catch(e){}}e.message||(e.message="");e.message+=" "+Se;TS.warn("Problem in TS.templates.builders.msgs.buildHTML with args: "+JSON.stringify(e.message));e.stack&&TS.info(e.stack);if(TS.boot_data.feature_tinyspeck)return TS.templates.message_failed({subtype:a&&a.subtype?a.subtype:"",msg_ts:a?a.ts:"",model_ob_id:s?s.id:""});return""}},buildFileShareMetaText:function e(t,i){if(!t)return"";var a=TS.utility.msgs.getFileOnMsg(t);if(!a)return"";var s=(TS.boot_data.feature_file_threads&&!t.subtype||"file_share"===t.subtype)&&t.upload;var o=a.user!=t.user&&!s;var l=!n(t);var u=TS.interop.files.getFileMetaTemplate(a);var d;if(o&&l)if(("file_share"===t.subtype||TS.boot_data.feature_file_threads&&!t.subtype)&&t.upload)if(a.initial_comment)d=r.test(a.mode)?u.addedCommentedPossessive:u.uploadedCommentedPossessive;else{if(!r.test(a.mode))return u.uploadedPossessive;d=u.addedPossessive}else d="file_mention"===t.subtype?u.mentionedPossessive:u.sharedPossessive;else d=("file_share"===t.subtype||TS.boot_data.feature_file_threads&&!t.subtype)&&t.upload?a.initial_comment?r.test(a.mode)?u.addedCommented:u.uploadedCommented:r.test(a.mode)?u.added:u.uploaded:"file_mention"===t.subtype?u.mentioned:u.shared;var c=TS.utility.members.getEntityFromFile(a);var _;if(i){var m=TS.interop.members.getPrefCompliantMemberName(c);_=TS.interop.i18n.fullPossessiveString(m)}else{var f=TS.templates.builders.makeMemberPreviewLink(c,false);var p=TS.interop.i18n.possessive(TS.interop.members.getPrefCompliantMemberName(c));var h="client"===TS.boot_data.app?'target="'+a.permalink+'" ':"";var g='<a href="'+a.permalink+'" '+h+'data-file-id="'+a.id+'">';var S=TS.interop.i18n.t("{uploader_name}{uploader_name_affix}","message")({uploader_name:TS.interop.i18n.safeString(f),uploader_name_affix:p});_="</a> "+S+g}return d({uploader_name_possessive_html:TS.interop.i18n.safeString(_),file_pretty_name:t&&a&&a.pretty_type?a.pretty_type:""})}});function e(e){var t=e.file,n=e.msg,r=e.starred_items_list,i=e.model_ob;var a={};a.file=t;a.edit=TS.files.getFileActions(t).edit;a.download=!("snippet"===t.mode||"post"===t.mode||"space"===t.mode||t.is_external);a.new_window=!a.edit&&!a.download;a.abs_permalink=t.permalink;r||(a.star_components=TS.templates.builders.buildStarComponents("file",t,null));$.extend(a,TS.files.getFileTemplateArguments(t,360));a.is_message=true;a.lightbox=true;if(("file_share"===n.subtype||TS.boot_data.feature_file_threads)&&n.upload){"email"===t.mode&&(a.is_added=true);a.icon_class=TS.utility.getImageIconClass(t,"thumb_80")}else t.user!=n.user&&(a.uploader=TS.utility.members.getEntityFromFile(t));!TS.interop.messages.shouldRenderFileThread(n)&&"file_share"===n.subtype&&n.upload&&t.initial_comment&&(a.show_initial_comment=true);TS.files.isFileAuthorExternal(t)&&(a.show_comment_action=false);TS.interop.messages.shouldRenderFileThread(n)&&(a.can_remove_file=TS.interop.rules.messages.canRemoveFileFromMessage(TS.redux.getState(),{channel:i,message:n,file:t}));return a}function t(e,t){var n=["message"];e.subtype&&("channel_join"===e.subtype||"group_join"===e.subtype||"app_conversation_join"===e.subtype||"app_conversation_created"===e.subtype?n.push("joined","automated"):"channel_leave"===e.subtype||"group_leave"===e.subtype||"app_conversation_leave"===e.subtype?n.push("left","automated"):"channel_topic"===e.subtype||"group_topic"===e.subtype?n.push("topic","automated"):"channel_name"===e.subtype||"group_name"===e.subtype?n.push("rename","automated"):"channel_purpose"===e.subtype||"group_purpose"===e.subtype?n.push("purpose","automated"):"channel_archive"===e.subtype||"group_archive"===e.subtype?n.push("archived","automated"):"channel_unarchive"===e.subtype||"group_unarchive"===e.subtype?n.push("unarchived","automated"):"bot_message"===e.subtype||"thread_broadcast"===e.subtype&&e.bot_id?n.push("bot_message"):"sh_room_shared"===e.subtype?n.push("sh_shared","automated"):"sh_room_created"===e.subtype?n.push("sh_created","automated"):"bot_add"===e.subtype||"bot_remove"===e.subtype||"bot_enable"===e.subtype||"bot_disable"===e.subtype?n.push("bot_change","automated"):"reminder_add"!==e.subtype&&"reminder_delete"!==e.subtype||n.push("reminder_change","automated"));e.alert_type&&"shared_channel_join"===e.alert_type&&n.push("highlight_yellow_bg");TS.boot_data.feature_fix_files&&n.push("feature_fix_files");e.no_display&&n.push("hidden");t.for_search_display&&n.push("for_search_display");t.for_top_results_search_display&&n.push("for_top_results_search_display");t.starred_items_list&&n.push("for_star_display");t.for_mention_display&&n.push("for_mention_display");t.for_mention_rxn_display&&n.push("for_mention_rxn_display");t.is_ephemeral&&n.push("ephemeral");t.unprocessed&&n.push("unprocessed");t.show_resend_controls&&n.push("resend");t.highlight&&n.push("highlight");t.highlight_as_new&&n.push("new");t.app_id&&n.push("is_app");t.is_pinned&&n.push("is_pinned");t.show_broadcast_indicator&&n.push("show_broadcast_indicator");t.show_channel_highlight&&n.push("show_recap");t.is_highlighted_unfurl&&n.push("is_recap_unfurl");t.highlight_feedback_options&&n.push("has_feedback_options");t.highlight_is_leaving_feedback&&n.push("is_leaving_feedback");t.highlight_has_left_feedback&&n.push("has_left_feedback");t.standalone?n.push("standalone"):n.push("dirty_hover_container");if(t.show_user)n.push("first");else{t.file&&n.push("first");t.is_in_conversation&&n.push("first")}if(t.file){n.push("file_reference");t.is_mention?n.push("file_mention"):n.push("file_share")}t.comment&&(t.is_file_convo_continuation?n.push("comment_continuation"):n.push("first"));t.is_root_msg&&n.push("selected");t.is_root_msg&&TS.boot_data.feature_file_threads&&n.push("feature_file_threads");t.is_new_reply&&n.push("new_reply");t.is_tombstone&&n.push("deleted");if(t.is_recap){n.push("is_recap");n.push("show_recap_highlight")}t.show_recap_debug&&n.push("show_recap_debug");t.is_broadcast&&n.push("thread_broadcast");_.get(t.member,"is_unknown")&&n.push("member_is_unknown");return n}function n(e){var t=TS.utility.msgs.getFileOnMsg(e);if(!t)return false;return t.name===TS.utility.welcome_post.WELCOME_POST_NAME&&"USLACKBOT"===e.user&&t.user===TS.model.user.id}var r=/(snippet)/})()},2916:function(e,t){(function(){TS.registerModule("utility.date",{fake_ts_unique_padder:"x",do24hrTime:function e(){return TS.model.user&&TS.prefs.prefs_loaded&&TS.prefs.getPref("time24")},memberUTCOffset:function t(n){var r=e(n);var i=r/60/60;if(i<0)return"(UTC"+i+")";if(i>0)return"(UTC+"+i+")";return"(UTC)"}});var e=function e(t){var n=-28800;(t&&t.tz_offset&&"undefined"!==typeof t.tz_offset||0===t.tz_offset)&&(n=t.tz_offset);return n}})()},2917:function(e,t){(function(){var e={};TS.registerModule("utility.members",{checkMemberMatch:function e(t,n,r){return!r&&t.profile&&t.profile.email&&t.profile.email.match(n)||t.profile&&t.profile.real_name_normalized&&t.profile.real_name_normalized.match(n)||t.profile&&t.profile.real_name&&t.profile.real_name.match(n)||t.profile&&t.profile.display_name_normalized&&t.profile.display_name_normalized.match(n)||t.profile&&t.profile.display_name&&t.profile.display_name.match(n)},filterMembersByQuery:function e(t,n){n=_.toString(n).trim().toLowerCase().replace(/^@/,"");if(!n)return t;var r=new RegExp(TS.utility.regexpEscape(n),"i");return t.filter(function(e){return TS.utility.members.checkMemberMatch(e,r)})},getBroadcastKeywordsForUser:function t(){var n=TS.shared.legacyGetActiveModelOb();if(!n)return[];var r=TS.interop.broadcast_keywords.getBroadcastKeywordsForUser(n.id);var i=r.filter(function(e){return"BKchannel"===e.id||"BKhere"===e.id});var a=TS.boot_data.page_needs_enterprise&&TS.interop.rules.channels.isRequired(n)&&TS.interop.rules.channels.isOrgShared(n);if(!i.length&&TS.model.user.is_admin&&(n.is_channel||n.is_group)&&!e[n.id]){e[n.id]=true;TS.logError({model_ob:n.id,is_channel:n.is_channel,is_group:n.is_group,is_general:n.is_general,is_enterprise_required_channel:a,who_can_at_channel:TS.prefs.getTeamPref("who_can_at_channel"),canAtChannelOrGroup:TS.permissions.members.canAtChannelOrGroup(n.id),canAtMentionEveryone:TS.permissions.members.canAtMentionEveryone(n.id)},"getBroadcastKeywordsForUser no channel_keywords for admin","getBroadcastKeywordsForUser_empty_v2")}return r},isMemberRelevantToModel:function e(t,n){_.isObject(t)||(t=TS.interop.members.getMemberById(t));if(!t)return false;if(TS.interop.rules.members.isSlackbotOrTeambot(t,TS.boot_data.feature_teambot))return true;if(t.deleted)return false;_.isObject(n)||(n=TS.redux.channels.getEntityById(n)||TS.shared.legacyGetActiveModelOb());return true},isMemberElement:function e(t){if(t.hasAttribute("data-member-id"))return true;if(t.classList.contains("internal_member_link"))return true;return false},isMemberNonBotNonDeletedNonSelf:function e(t){var n=t&&!t.deleted&&!t.is_bot&&!TS.interop.rules.members.isSlackbotOrTeambot(t,TS.boot_data.feature_teambot);return n&&!t.is_self},getEntityFromMessage:function e(t){if(!t)return false;var n;var r=TS.utility.msgs.getFilesOnMsg(t);var i=_.first(r);n="USLACKBOT"===t.user&&i&&i.bot_id?TS.utility.members.getEntityFromFile(i):t.comment?TS.redux.members.getPotentiallyUnknownMemberById(t.comment.user):TS.redux.members.getPotentiallyUnknownMemberById(t.user);return n},getUsernamesMentionedInString:function e(t){var n=_.toLower(t).match(/\B@\w+/g);if(!n)return[];return _(n).map(function(e){return e.replace(/^@/,"")}).uniq().compact().value()},getEntityFromFile:function e(t){if(!t)return false;var n;if("USLACKBOT"===t.user&&t.bot_id){n=TS.interop.bots.getBotById(t.bot_id);n||(n={});n.is_bot=true;n.is_service=true}else n=TS.redux.members.getPotentiallyUnknownMemberById(t.user);return n}})})()},2918:function(e,t){(function(){TS.registerModule("format",{hex_rx:/(\W|^)(#[A-Fa-f0-9]{6})(\b)/g,onStart:function e(){t()},replaceHighlightMarkers:function e(t,n,r){if(!t)return"";n=n||"";r=r||"";return t.replace(/\ue000/g,n).replace(/\ue001/g,r)},hasOnlyValidMemberIds:function e(t){if(!_.isString(t))return true;return _.every(t.match(i),function(e){return TS.interop.members.getMemberById(e)})},cleanMsg:function e(t){return TS.interop.format.cleanMessageTextWithState(TS.redux.getState(),t,{isInternalMessage:false})},cleanInternalMsg:function e(t){return TS.interop.format.cleanMessageTextWithState(TS.redux.getState(),t,{isInternalMessage:true})},legacyDoEmoticonConversion:function e(t){c.length=0;t=t.replace(a,p);t=t.replace(s,p);t=t.replace(o,p);t=TS.emoji.legacyReplaceEmoticons(t);t=TS.format.deTokenizeStr(c,t);return t},tokenizeStr:function e(t,n,r){if(!n)return"";r=r||"";var i=0===n.indexOf("\n")?"\n":"";var a=T(i+f+(m+=1)+Date.now());a=r+a+r;t.push({str:n,token:a});return a},deTokenizeStr:function e(t,n){var r;var i=t.length-1;for(i;i>-1;i-=1){r=t[i];n=n.replace(r.token,r.str.replace(/\$/g,"$$$$"))}return n},unFormatMsg:function e(t,n){return TS.format.formatWithOptions(t,n,{for_edit:true})},formatJustText:function e(t){return TS.format.formatWithOptions(t)},formatDefault:function e(t,n){return TS.format.formatWithOptions(t,n)},formatNoHighlightsNoSpecials:function e(t,n){return TS.format.formatWithOptions(t,n,{no_highlights:true,no_specials:true})},formatNoHighlightsNoSpecialsNoInlineImgs:function e(t,n){return TS.format.formatWithOptions(t,n,{no_highlights:true,no_specials:true,do_inline_imgs:false})},formatNoHighlightsNoInlineImgs:function e(t,n){return TS.format.formatWithOptions(t,n,{do_inline_imgs:false,no_highlights:true})},formatNoSpecials:function e(t,n){return TS.format.formatWithOptions(t,n,{no_specials:true})},formatNotification:function e(t,n){return TS.format.formatWithOptions(t,n,{for_growl:true})},formatCurrentStatus:function e(t,n,r){r=r||{};return TS.format.formatWithOptions(t,n,_.assign({no_jumbomoji:true,no_linking:true,no_specials:true,no_highlights:true,no_emoji_text:true,prevent_copy_paste:true},r))},formatBroadcastExcerpt:function e(t,n){var r="&hellip;<br>";var i=r+'<span class="multiline_block">';var a="</span>";var s=TS.format.formatWithOptions(t,n,{no_highlights:true,no_hex_colors:true,do_inline_imgs:false,enable_slack_action_links:false,do_theme_install_buttons:false,no_jumbomoji:true,no_linking:true,custom_linebreak:r,token_overrides:{"<PRE:START>":i,"<PRE:END>":a,"<QUOTE:START>":i,"<QUOTE:END>":a,"<CODE:START>":"<span>","<CODE:END>":"</span>","<PARA:BREAK>":r}});_.startsWith(s,r)&&(s=s.substring(r.length));return s},extractIds:function e(t){var n=[];var r=[];if(!t)return{c_ids:n,m_ids:r};var i=t.match(/<[#@]+(.*?)>/g);i&&i.forEach(function(e){var t;var i;if(0===e.indexOf("<@")){t=e.replace(/<|>/g,"");i=TS.utility.msgs.getMemberIdFromMemberMarkup(t);TS.interop.utility.looksLikeMemberId(i)&&TS.utility.ensureInArray(r,i)}else{t=e.replace(/<|>|#/g,"");i=t.split("|")[0];TS.interop.utility.looksLikeChannelId(i)&&TS.utility.ensureInArray(n,i)}});return{c_ids:n,m_ids:r}},calculateOptions:function e(t,n){return v(t,n)},formatWithOptions:function e(t,n,r){if(!$.trim(t))return"";var i=v(n,r);var a=b(t,n,i);return a},applyStringifyTransformsToChildren:function e(t,n,r){if(!t)return false;_.isObject(n)||(n={});if(!t.childElementCount)return false;var i=!r&&1===t.childNodes.length&&1===t.firstChild.nodeType&&t.firstChild.hasAttribute("data-stringify-requires-siblings");if(i)return;"PRE"!==t.tagName&&_.each(t.querySelectorAll("pre br"),function(e){e.parentElement.replaceChild(document.createTextNode("\n"),e)});var a=_.filter(t.querySelectorAll("*"),function(e){if(!F(e))return false;if(_.isFunction(n.excludeFn)&&n.excludeFn(e))return false;e.childElementCount&&TS.format.applyStringifyTransformsToChildren(e,n,true);var r;r=_.isFunction(n.customFn)&&n.customFn(e)?n.customFn(e):TS.format.stringifyNode(e);var i=r!==e.textContent;i&&("IMG"===e.tagName?t.replaceChild(document.createTextNode(r),e):e.textContent=r);return i});return a.length>0},formatSelection:function e(t,n){if(!t||!t.rangeCount)return;_.isObject(n)||(n={});var r=TS.selection.combineRanges(t);if(!r)return;var i;if(_.isElement(r.commonAncestorContainer)){if($(r.commonAncestorContainer).is(".ql-editor"))return t.toString();if(TS.model.is_safari_desktop){var a=r.commonAncestorContainer.querySelectorAll("ts-message");if(a.length>1)return}var s=r.commonAncestorContainer.cloneNode();s.appendChild(r.cloneContents());s.classList.add("offscreen","user_select_text");r.commonAncestorContainer.parentElement.appendChild(s);var o="\ufeff";s.innerHTML=s.innerHTML.replace(/&nbsp;/g,o);!s.lastChild||s.lastChild.textContent||F(s.lastChild)||s.removeChild(s.lastChild);var l=s.getElementsByClassName("para_break");if(l.length){_.eachRight(l,function(e){var t=document.createElement("br");e.parentElement.replaceChild(t,e);var n=document.createElement("br");t.parentElement.insertBefore(n,t.nextSibling)});s.innerHTML=s.innerHTML.replace(/<br>((<br>){2,})/g,"$1")}_.each(s.querySelectorAll([".ts_tip_tip",".c-message_list__unread_divider",".unread_divider",".c-message_list__day_divider__label",".c-reaction_bar",".c-message__reply_bar",".c-message__broadcast_repliers",".c-file__slide",".c-file__actions",".c-file_container__expand_container",".c-button",".c-message_attachment__row--actions",".c-message_attachment__border",".c-message_attachment__media_trigger",".c-message__label",".c-message--adjacent .c-message__gutter"].join(",")),function(e){e&&e.parentNode&&e.parentNode.removeChild(e)});TS.format.applyStringifyTransformsToChildren(s,n);var u=TS.selection.snapshot();t=TS.selection.selectNodeContents(s);i=t.toString();var d=new RegExp(o,"g");i=i.replace(/ {2}/g," ").replace(d," ");s.parentElement.removeChild(s);u()}else i=t.toString();i=TS.interop.format.replaceUnicodeDoppelgangers(i);i=i.replace(/^\n+/,"");i=i.replace(/\n+$/,"");return i},stringifyNode:function e(t){if(!t)return"";if(!F(t))return t.textContent;var n=t.textContent;_.each(l,function(e,r){t.hasAttribute(r)&&(n=e(t,n))});return n},shouldAllowIntraWordFormatting:function e(){return TS.boot_data.feature_allow_intra_word_formatting},test:function e(){var t={encodeSpecialFormattingChars:S,encodeSpecialFormattingCharsAndColon:T,getTokenMap:u,getUserGroupDisplayName:C,doUserGroupHighlighting:h,doHighlighting:g,maybeRenderUnknownOrNonExistentUserGroup:I};Object.defineProperty(t,"_hasStringifyTransformations",{get:function e(){return F},set:function e(t){F=t}});Object.defineProperty(t,"doHighlighting",{get:function e(){return g},set:function e(t){g=t}});Object.defineProperty(t,"doUserGroupHighlighting",{get:function e(){return h},set:function e(t){h=t}});return t}});var e=[];var t=function t(){TS.interop.broadcast_keywords.getAllBroadcastKeywords().forEach(function(t){e.push(t.ms_name);t.alias&&e.push(t.alias)})};var n=/((?:#[A-Fa-f0-9]{6} {0,}, {0,}){7})(#[A-Fa-f0-9]{6})(\b)/g;var r=/((?:#[A-Fa-f0-9]{6} {0,}, {0,}){8})(#[A-Fa-f0-9]{6})(\b)/g;var i=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|\u201c|\u2018|')(@([^~`!@#$%^&*()+=[\]{}\\|;:'"\u201d\u2019,<>\/?\s]+))/g;var a=/(^|\s|[_*?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])```([\s\S]*?)?```(?=$|\s|[_*?.,\-!^;:})\]%$#+=\u2000-\u206F\u2E00-\u2E7F\u2026"])/g;var s=/(^|\s|[?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])`([^`]*?\S *)?`/g;var o=/(^|\n)&gt;(?![\W_](?:&lt;|&gt;|[|\/\\[\]{}()Dpb](?=\s|$)))(([^\n]*)(\n&gt;[^\n]*)*)/g;var l={"data-stringify-text":function e(t){return t.getAttribute("data-stringify-text")},"data-stringify-prefix":function e(t,n){var r=t.getAttribute("data-stringify-prefix");return TS.interop.format.surroundTextWith({text:n,prefix:r})},"data-stringify-suffix":function e(t,n){var r=t.getAttribute("data-stringify-suffix");return TS.interop.format.surroundTextWith({text:n,suffix:r})}};var u=function e(){var t={"<QUOTE:START>":'<div class="special_formatting_quote"><div class="quote_bar"><div class="shim"></div></div><div class="content dynamic_content_max_width">',"<QUOTE:PREFIX>":'<span class="copyonly">&gt;</span>',"<LONGQUOTE:PREFIX>":'<span class="copyonly">&gt;&gt;&gt;</span>',"<QUOTE:END>":"</div></div>","<LINK:END>":"</a>","<LINE:BREAK>":"<br>","<PARA:BREAK>":'<span class="para_break"><i class="copy_only"><br></i></span>',"<SPACE:HARD>":"&nbsp;"};var n="ja-JP"===TS.interop.i18n.locale?"\uff0a":"*";var r="ja-JP"===TS.interop.i18n.locale?"\uff3f":"_";var i="ja-JP"===TS.interop.i18n.locale?"\uff40":"`";var a="ja-JP"===TS.interop.i18n.locale?"\uff40\uff40\uff40":"```";t["<B:START>"]='<b data-stringify-prefix="'+n+'" data-stringify-suffix="'+n+'" data-stringify-requires-siblings>';t["<B:END>"]="</b>";t["<STRIKE:START>"]='<strike data-stringify-prefix="~" data-stringify-suffix="~" data-stringify-requires-siblings>';t["<STRIKE:END>"]="</strike>";t["<CODE:START>"]='<code class="special_formatting" data-stringify-prefix="'+i+'" data-stringify-suffix="'+i+'" data-stringify-requires-siblings>';t["<CODE:END>"]="</code>";t["<I:START>"]='<i data-stringify-prefix="'+r+'" data-stringify-suffix="'+r+'" data-stringify-requires-siblings>';t["<I:END>"]="</i>";t["<PRE:START>"]='<pre class="special_formatting" data-stringify-prefix="'+a+'" data-stringify-suffix="'+a+'" data-stringify-requires-siblings>';t["<PRE:END>"]="</pre>";return t};var d=u();var c=[];var m=0;var f="^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}".split("").sort(function(){return.5-Math.random()}).join("");var p=function e(t,n){var r=t.slice(n.length);return n+TS.format.tokenizeStr(c,r)};var h=function e(t){if(!TS.boot_data.feature_lazy_user_groups)return g("@"+t.handle);var n=t.id;if(TS.interop.userGroups.isUserGroupMember(n))return'<span class="mention">@'+t.handle+"</span>";return"@"+t.handle};var g=function e(t){var n=TS.interop.format.locateHighlightWords(t,TS.interop.prefs.getHighlightWords());_.forEachRight(n,function(e){var n=e.index;var r=n+e.length;var i=t.slice(n,r);var a=t.slice(0,n);var s='<span class="mention">'+i+"</span>";var o=t.slice(r);t=a+s+o});return t};var S=function e(t){if(!t)return"";return t.replace(/\*/g,"&ast;").replace(/_/g,"&#95;").replace(/`/g,"&#96;")};var T=function e(t){if(!t)return"";return S(t).replace(/:/g,"&#58;")};var v=function e(t,n){n=n||{};var r=!!n.do_inline_imgs||void 0;var i=!!n.for_growl||void 0;var a=!!n.for_edit||void 0;var s=!!n.no_highlights||void 0;var o=!!n.no_specials||void 0;var l=!!n.enable_slack_action_links||void 0;var u=!!n.no_jumbomoji||void 0;var d=!!n.no_preformatted||void 0;var c=n.custom_linebreak||void 0;var m=!!n.stop_animations||void 0;var f=!!n.no_emoji_text||void 0;var p=!!n.transform_missing_emoji||void 0;var h=!!n.show_icon_for_emoji_in_as_text_mode||void 0;var g=!!n.ignore_emoji_mode_pref||void 0;var S=!!n.prevent_copy_paste||void 0;var T=!!n.no_linking||void 0;var v=n.token_overrides||void 0;var b=n.emoji_mode;!_.isString(b)&&TS.prefs.prefs_loaded&&(b=TS.interop.rules.emoji.getEmojiMode());true!==u&&(u=!TS.prefs.getPref("jumbomoji"));s=t&&"no_highlights"in t?!!t.no_highlights:!!s;_.isBoolean(o)||(o=!!(t&&"mrkdwn"in t)&&false===t.mrkdwn);a&&(o=true);var y=t&&t.no_emoji;var w=!(r&&(!t||"bot_message"!==t.subtype));true!==w&&(w=!!TS.prefs.getPref("hide_hex_swatch"));var k=!w&&TS.client&&TS.model.team;var x="NORMAL";o&&(x="NOMRKDWN");i&&(x="GROWL");a&&(x="EDIT");return{tsf_mode:x,no_highlights:s,no_emoji:y,no_hex_colors:w,do_inline_imgs:r,enable_slack_action_links:l,do_theme_install_buttons:k,no_jumbomoji:u,no_preformatted:d,custom_linebreak:c,stop_animations:m,no_emoji_text:f,transform_missing_emoji:p,show_icon_for_emoji_in_as_text_mode:h,ignore_emoji_mode_pref:g,prevent_copy_paste:S,no_linking:T,token_overrides:v,emoji_mode:b}};var b=function e(t,i,a){var s=a.tsf_mode;var o=a.no_highlights;var l=a.no_emoji;var u=a.no_hex_colors;var c=a.do_inline_imgs;var m=a.enable_slack_action_links;var f=a.do_theme_install_buttons;var p=a.no_jumbomoji;var h=a.no_preformatted;var S=a.custom_linebreak;var T=a.stop_animations;var v=a.no_emoji_text;var b=a.transform_missing_emoji;var C=a.show_icon_for_emoji_in_as_text_mode;var I=a.ignore_emoji_mode_pref;var F=a.prevent_copy_paste;var D=a.no_linking;var H=a.token_overrides;var j=a.emoji_mode;var B=d;if(S||H){var L=H||{};S&&(L["<LINE:BREAK>"]=S);B=_.extend({},B,L)}var N=[];if(f){var R=TS.useGlobalNav()?r:n;var U=(t.match(R)||[]).length;var G=[];var q=0;t=t.replace(R,function(e,t,n){q+=1;var r=U>1?A(e,q):A(e);G.push(r);var i=U>1?" ("+q+")\t":"";return t+TS.format.tokenizeStr(N,"<nobr>",",")+n+i+TS.format.tokenizeStr(N,"</nobr>")});t+=TS.format.tokenizeStr(N,E(G))}var W=TSF.getTokensArray($.trim(t),s,{jumbomoji:!p,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});h&&(W=W.map(P));D&&(W=_.reject(W,O));var z="";var K;var V;var Y;var J;var Q;var X;var Z;var ee;var te;var ne;var re;var ie;var ae;var se;var oe;var le;var ue;var de;var ce;if("GROWL"===s||"EDIT"===s)for(J=0;J<W.length;J+=1){Y=W[J];if(0===Y.indexOf("<"))if(B[Y])TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got something in the formatting map? '+Y);else if(0===Y.indexOf("<!"))z+=x(s,Y);else if(0===Y.indexOf("<@")){ce=k(s,Y);z+=ce}else 0===Y.indexOf("<#")?z+=y(s,Y):TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got '+Y);else if(-1==Y.indexOf("<"))if("EDIT"===s){TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE||TS.utility.contenteditable.inlineEmojiIsEnabled()||(Y=TS.emoji.maybeGetLocalizedEmojiString(Y));z+=_.unescape(Y)}else if(TS.utility.platformSupportsHtmlNotifications())z+=TS.emoji.graphicReplace(Y,{force_img:true,stop_animations:T});else{var _e=_.unescape(Y);_e=TS.emoji.maybeUnifiedReplace(_e);TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(Y=TS.emoji.maybeGetLocalizedEmojiString(Y));z+=_e}else TS.error("token has a < in it but it is not the first character!\n"+Y)}else{var me="";var fe;var pe;var he;for(J=0;J<W.length;J+=1){Y=W[J];if(0===Y.indexOf("<"))if(B[Y]){z+=B[Y];if(Y==TSF.LINK_END){z+=me;me=""}}else if(0===Y.indexOf("<!"))z+=x(s,Y,o,D);else if(0===Y.indexOf("<@")){ce=k(s,Y,o,D);z+=ce}else if(0===Y.indexOf("<#"))z+=y(s,Y,D);else if(0===Y.indexOf(TSF.LINK_START.split(" ")[0])){var ge=function(e){var t=$.trim(e.replace(TSF.LINK_START.split(" ")[0],""));return t.substr(0,t.length-1)}(Y);if(TS.boot_data.feature_hide_unfurl_urls){var Se=i&&_.some(i.attachments,{from_url:ge,is_msg_unfurl:true});var Te=J===W.length-3;if(Se&&Te)break}var ve=TS.interop.utility.getBotIdFromUrl(ge);var be;var ye="";var we;var ke="";if(ve){we=TS.interop.bots.getBotById(ve);if(!we){TS.warn("No bot found for "+ve);if(TS.interop.rules.channels.isExternallySharedChannel(TS.shared.legacyGetActiveModelOb())&&i.user){be=_.get(TS.interop.members.getMemberById(i.user),"profile.team");we={id:ve,name:TS.interop.bots.getBotNameByBotLink(i.text)?TS.interop.bots.getBotNameByBotLink(i.text):"",source_team_id:be}}}}if(!ve||!we||we.is_unknown||we.isUnknown||we.isNonExistent)if(0===ge.indexOf(""+TS.utility.msgs.old_api_url_prefix))z+='<a class="api_url muted">(Disabled) ';else if(0===ge.indexOf(TS.utility.msgs.new_api_url_prefix))if(m){fe=_.escape(JSON.stringify(""+ge));z+='<a onclick="TS.utility.msgs.doNewApiUrl('+fe+')" class="api_url">'}else z+='<a class="api_url muted">(Disabled) ';else if(0===ge.indexOf("javascript:"))z+='<a onclick="TS.client.msg_pane.maybeClick(this)" data-maybe-click="'+ge.replace("javascript:","")+'">';else if(TS.client&&TS.client.core_url&&0===ge.indexOf(TS.client.core_url))z+='<a target="_self" href="'+ge+'">';else{var xe=TS.utility.getFileIDFromURL(ge);var Ce=false;if(xe&&TS.model&&TS.model.user&&TS.model.user.is_primary_owner){var Ie=!!TS.files&&TS.files.getFileById(xe);Ie&&TS.utility.welcome_post&&Ie.name==TS.utility.welcome_post.WELCOME_POST_NAME&&(Ce=true)}var Me=Ce?"file_new_window_link welcome_post_slackbot_message":"file_preview_link";var Ae=xe?' class="no_jumbomoji '+Me+'"':"";var Ee=xe?' data-file-id="'+xe+'"':"";z+="<a "+TS.utility.makeRefererSafeLink(ge)+' target="_blank"'+Ae+Ee+">";me&&TS.error("WTF we should have no attach_html");me="";var Pe;if(i&&i.ts&&c){Pe=TS.inline_attachments.getAttachmentByFromUrl(i.attachments,ge);Pe&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(Pe,i))&&(me=TS.templates.builders.buildAttachmentHTML({attachment:Pe,url:ge,msg:i,show_initial_caret:true}))}}else{he=true;ee=TS.utility.shouldLinksHaveTargets()?'target="'+ge+'" ':"";pe=o?we.name:g(we.name);W[J+1]&&W[J+1]==ge&&(pe=ge);pe=pe.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");we.app_id&&(ye=we.app_id);we.source_team_id&&(ke="data-team-id="+we.source_team_id+" ");z+='<a href="'+ge+'" '+ee+'data-bot-id="'+ve+'" data-app-id="'+ye+'" '+ke+'class="internal_bot_link app_preview_link">'+pe}}else 0===Y.indexOf(TSF.JUMBOMOJI_COLONS.split(" ")[0])?z+=w(Y,{tsf_mode:s,no_emoji:l,do_jumbomoji:!p,stop_animations:T,no_emoji_text:v,transform_missing_emoji:b,show_icon_for_emoji_in_as_text_mode:C,ignore_emoji_mode_pref:I,emoji_mode:j}):0===Y.indexOf(TSF.EMOJI_COLONS.split(" ")[0])?z+=w(Y,{tsf_mode:s,no_emoji:l,do_jumbomoji:false,stop_animations:T,no_emoji_text:v,transform_missing_emoji:b,show_icon_for_emoji_in_as_text_mode:C,ignore_emoji_mode_pref:I,emoji_mode:j}):0===Y.indexOf(TSF.HEX_BLOCK.split(" ")[0])?z+=M(s,Y,u):TS.error("markup token not handled:"+Y);else if(-1===Y.indexOf("<"))if(he)he=false;else{o||(Y=g(Y));F&&(Y=_.map($.parseHTML(Y),function(e){if(e.nodeType===Node.TEXT_NODE)return'<span class="prevent_copy_paste" aria-label="'+_.escape(e.textContent)+'"></span>';return e.outerHTML}).join(""));z+=Y}else TS.error("token has a < in it but it is not the first character!\n"+Y)}}if(i&&("sh_room_created"===i.subtype||"sh_room_shared"===i.subtype)){var Fe=TS.ui.growls.extractFromNameFromCorGMessage(i);if(Fe){("GROWL"!==s||TS.utility.platformSupportsHtmlNotifications())&&(Fe=_.escape(Fe));Fe+=": "}z="sh_room_created"===i.subtype?TS.interop.i18n.t("{from_name} Started a call","string_format")({from_name:Fe}):TS.interop.i18n.t("{from_name} Shared a call","string_format")({from_name:Fe})}z=TS.format.deTokenizeStr(N,z);return z};var y=function e(t,n,r){var i=n.replace(/<|>|#/g,"");var a=i.split("|");var s=a[0];var o=a[1];var l=TS.redux.channels.getEntityById(s);if(l&&TS.interop.rules.channels.isUnknown(l)&&"EDIT"!==t&&"GROWL"!==t)return TS.templates.unknown_channel({id:s});var u;var d;var c;var _;var m;if(l){d=TS.interop.rules.channels.isPrivateChannel(l);_=TS.interop.rules.channels.isPublicChannel(l);c=TS.interop.rules.channels.isNonExistent(l);m=TS.interop.rules.channels.isFromAnotherTeam(l);(d||_)&&(u=l.name)}var f=TS.interop.format.formatChannelName({fallbackName:o,channelName:u,isPrivate:d,isNonExistent:c});if(!l||!_||c||"GROWL"===t||"EDIT"===t||r||m)return f;var p=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+l.id+'"':"";return'<a href="/archives/'+l.id+'" '+p+' data-channel-name="'+l.name+'" data-channel-id="'+l.id+'" class="internal_channel_link">'+f+"</a>"};var w=function e(t,n){n=n||{};var r=t.split(" ")[1].replace(">","");if(n.no_emoji)return r;var i;var a=TS.emoji.isValidName(r);i=n.transform_missing_emoji&&!a?TS.emoji.MISSING_EMOJI_HTML:n.show_icon_for_emoji_in_as_text_mode&&"as_text"===n.emoji_mode?TS.emoji.graphicReplace(r,{show_icon_for_emoji_in_as_text_mode:true}):TS.emoji.graphicReplace(r,{obey_emoji_mode_pref:!n.ignore_emoji_mode_pref,include_title:true,include_text:!n.no_emoji_text,jumbomoji:n.do_jumbomoji,stop_animations:n.stop_animations});i&&-1!==i.indexOf(">>")&&TS.warn("TS.emoji.graphicReplace may be malformed: "+i);return i};var k=function e(t,n,r,i){var a=n.replace(/<|>/g,"");var s=TS.utility.msgs.getMemberIdFromMemberMarkup(a);if(!TS.interop.utility.looksLikeMemberId(s))return a;var o=TS.utility.msgs.getMemberFromMemberMarkup(a);if(o&&"EDIT"!==t&&"GROWL"!==t){if(o.is_unknown)return TS.templates.unknown_member({id:o.id});if(o.is_non_existent&&TS.interop.utility.looksLikeMemberId(o.id))return TS.templates.message_member_non_existent({id:o.id})}if(!o){if("GROWL"===t)return n;var l=a.split("|");if(l.length>1&&l[1])return"@"+l[1];return a}var u=["internal_member_link"];var d={"member-id":o.id,"stringify-text":"@"+o.id};if(o.is_bot&&o.profile){var c=_.get(o.profile,"bot_id");if(c){d["bot-id"]=c;var m=TS.interop.bots.getBotById(c);_.get(m,"app_id")&&(d["app-id"]=m.app_id)}u=_.pull(u,"internal_member_link");u.push("app_preview_link");u.push("app_preview_link_slug")}var f="";_.forEach(d,function(e,t){f+="data-"+t+'="'+e+'" '});var p=_.escape("@"+TS.interop.members.getMemberMentionName(o));u.push("ts_tip ts_tip_top ts_tip_lazy ts_tip_float ts_tip_member");f+='data-tip-member="'+o.id+'" ';if("EDIT"===t)return"<@"+o.id+"|"+p+">";if("GROWL"===t||!TS.permissions.members.canUserSeeMember(o))return"@"+TS.interop.members.getMemberMentionName(o);var h=TS.utility.shouldLinksHaveTargets()?'target="/team/'+o.id+'" ':"";o.id==TS.model.user.id&&u.push("mention");if(i)return p;f+='data-member-label="'+p+'" ';return'<a href="/team/'+o.id+'" '+h+f+'class="'+u.join(" ")+'">'+p+"</a>"};var x=function t(n,r,i,a){if(TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_default_shared_channels){var s=TS.shared.legacyGetActiveModelOb()||{};if(TS.interop.rules.channels.isOrgShared(s)&&TS.interop.rules.channels.isOrgDefaultChannel(s)){i=true;a=true}}var o=r.replace(/<|>/g,"");var l=o.split("|");var u=l[0].substr(1);if(_.includes(e,u)){var d=TS.interop.format.formatBroadcastCommand({type:u,tsfMode:n});if("GROWL"===n||"EDIT"===n||a)return d;return'<b class="mention" data-broadcast-id="BK'+u+'" data-stringify-text="'+d+'">'+d+"</b>"}var c=l[1]?l[1]:u;if(-1===u.indexOf("^")){if("GROWL"===n||"EDIT"===n)return"<"+c+">";return"&lt;"+c+"&gt;"}var m=u.split("^");u=m.shift();if("date"===u&&m.length>=2){var f=m[0];var p=m[1];var h=TS.interop.datetime.formatDate(f,p,{fallbackString:c});var g=m.length>2?m[2]:"";if("GROWL"===n||"EDIT"===n||!g||a)return h;return"<a "+TS.utility.makeRefererSafeLink(g)+' target="_blank">'+h+"</a>"}if("team"===u&&1===m.length){var S=c;var T=TS.teams.getTeamById(m[0]);T&&(S=TS.interop.rules.teams.getTeamDisplayName(T));if("GROWL"===n||"EDIT"===n)return"*"+S+"*";return TS.templates.format_team({team:T,fallback:S})}if("subteam"!==u||1!==m.length){if("GROWL"===n||"EDIT"===n)return"<"+c+">";return"&lt;"+c+"&gt;"}var v=TS.interop.userGroups.getUserGroupById(m[0]);if(TS.boot_data.feature_lazy_user_groups){var b=I({user_group:v,tsf_mode:n,cmd_label:c});if(b)return b}if(v&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(v)&&v.handle){var y=TS.utility.shouldLinksHaveTargets()?'target="/usergroups/'+v.id+'" ':" ";var w=_.escape(v.handle);var k=C({no_highlights:i,tsf_mode:n,userGroup:v});var x=["internal_user_group_link"];if("GROWL"===n||"EDIT"===n){if("EDIT"===n)return"<@"+v.id+"|"+k+">";return"@"+v.handle}if(a)return k;k="@"+w;TS.boot_data.feature_lazy_user_groups?TS.interop.userGroups.isUserGroupMember(v.id)&&x.push("mention"):i||-1===TS.interop.prefs.getHighlightWords().indexOf("@"+w+">")||x.push("mention");return'<a data-qa="user_group_message_mention" href="/usergroups/'+v.id+'" '+y+'data-user-group-id="'+v.id+'" class="'+x.join(" ")+'" data-stringify-text="@'+w+'">'+k+"</a>"}if("GROWL"!==n&&"EDIT"!==n)return c;return""};var C=function e(t){var n=t.no_highlights,r=t.tsf_mode,i=t.userGroup,a=void 0===i?{}:i;var s=_.escape(a.handle);if(n||"EDIT"===r)return"@"+s;if(TS.boot_data.feature_lazy_user_groups)return h(a);return g("@"+s)};var I=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.user_group,r=t.tsf_mode,i=t.cmd_label;if(!TS.boot_data.feature_lazy_user_groups)return"";if(n&&"EDIT"!==r&&"GROWL"!==r){if(TS.interop.rules.user_groups.isUnknown(n))return TS.templates.unknown_usergroup({id:n.id,handle:i});if(TS.interop.rules.user_groups.isNonExistent(n)&&TS.interop.utility.looksLikeUserGroupId(n.id))return TS.templates.nonexistent_usergroup({id:n.id,label:n.handle?"@"+n.handle:i})}return""};var M=function e(t,n,r){var i=n.split(" ")[1].replace(">","");if(!r)return' <div class="inline_color_block" style="background:'+i+';"></div>';return""};var A=function e(t,n){var r=TS.interop.i18n.t("Switch sidebar theme","string_format")();n&&(r+=" ("+n+")");return'<a data-theme="'+_.escape(t)+'" class="btn btn_small btn_outline very_small_top_margin very_small_bottom_margin tiny_right_margin theme_installer_btn">'+r+"</a>"};var E=function e(t){if(t&&t.length)return'<br/><span class="theme_install_btns">'+t.join(" ")+"</span>";return""};function P(e){switch(e){case TSF.PRE_START:return TSF.CODE_START;case TSF.PRE_END:return TSF.CODE_END;default:break}return e}var F=function e(t){if(!t||t instanceof Text)return false;return _.some(l,function(e,n){return t.hasAttribute(n)})};var O=function e(t){D||(D=TSF.LINK_START.split(" ")[0]);if(_.startsWith(t,D))return true;if(t===TSF.LINK_END)return true;return false};var D})()},2919:function(e,t){(function(){TS.registerModule("menu",{$menu:null,$submenu:null,$submenu_origin:null,$submenu_parent:null,$menu_header:null,$menu_items:null,$menu_list_container:null,$menu_list:null,$menu_footer:null,menu_lazy_load:null,user_group:null,end_tim:0,$target_element:null,$secondary_target_element:null,members_html_cache:null,large_list_trigger:1500,large_dom_trigger:500,watching_members_model:false,menu_items_hidden:true,has_submenu:false,menu_closed_sig:new signals.Signal,onStart:function e(){},buildIfNeeded:_.once(function(){TS.menu.$menu=$(TS.templates.menu());var e=TS.menu.$menu;if("mobile"!==TS.boot_data.app&&"0"!=TS.qs_args.new_scroll){TS.client?e.appendTo($("#client-ui")):e.appendTo($("body"));if(!TS.environment.supports_custom_scrollbar){var t="1"==TS.qs_args.debug_scroll;e.find("#menu_items_scroller").monkeyScroll({debug:t})}e.detach()}TS.menu.$menu_header=e.find("#menu_header");TS.menu.$menu_body=e.find(".menu_body");TS.menu.$menu_list_container=e.find("#menu_list_container");TS.menu.$menu_list=e.find("#menu_list");TS.menu.$menu_items=e.find("#menu_items");TS.menu.$menu_footer=e.find("#menu_footer")}),handleTopicKeydown:function e(t){var n=TS.utility.keymap;if(t.which==n.enter&&!t.shiftKey&&!t.altKey){var r=$(t.target);var i=TS.shared.legacyGetActiveModelOb();var a=$.trim(r.val());if(i.topic.value===a){TS.menu.end();return}TS.interop.channels.submitChannelTopic(i.id,a).catch(TS.channels.legacyAlertSetTopicError);TS.menu.end()}},startWithList:function e(t,n,r){if(!n||!n.length)return;if(TS.menu.isRedundantClick(t))return;r=r||{};TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(n.html());TS.menu.$menu.addClass(r.menu_class);(r.close_on_click||r.onClick)&&TS.menu.$menu_items.on("click.menu","li",function(e){"function"===typeof r.onClick&&r.onClick(e);r.close_on_click&&TS.menu.end()});TS.menu.start(t,void 0,r);if(r.attach_to_target_at_full_width)TS.menu.$menu.css({width:"100%",top:"calc(100% + 3px)",left:"0"});else{var i=s(r.align_right);TS.menu.positionAt(TS.menu.$target_element,i.left,i.top)}},startWithDatePicker:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_date_picker_items());TS.menu.$menu_items.on("click.menu","li",TS.menu.onDatePickerItemClick);TS.menu.$menu.attr("data-qa","date_picker_menu");var n=$("#date_picker_cal_container");TS.ui.date_picker.startJumpToDatePicker(n);TS.menu.$menu.addClass("date_picker")},onDatePickerItemClick:function e(t){var n=$(this).attr("id");var i=TS.shared.legacyGetActiveModelOb();if($(this).hasClass("disabled")){TS.menu.end();return}if("date_picker_back_item"===n){t.preventDefault();r=true;i.is_channel||i.is_mpim?TS.menu.channel.startWithChannel(t,i.id):i.is_im?TS.menu.member.startWithMember(t,i.user,false,false,true):i.is_group&&TS.menu.group.startWithGroup(t,i.id);TS.menu.$menu.removeClass("date_picker");return}TS.warn("not sure what to do with clicked element id:"+n)},startWithMessageActions:function e(t,n,r,i){if(TS.client&&(!TS.redux.socket.isConnected()&&!TS.boot_data.feature_degraded_send||!TS.interop.connectivity.isOnline()&&TS.boot_data.feature_degraded_send)){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();i=i||TS.shared.legacyGetActiveModelOb();var a=TS.redux.messages.getMessageByTimestamp(i.id,n);a||(a=TS.ui.replies.getActiveMessage(i,n));!a&&TS.model.threads_view_is_showing&&(a=TS.client.threads.getMessage(i,n));!a&&TS.model.unread_view_is_showing&&(a=TS.client.unread.getMessage(i,n));var s=$(t.target);var o=TS.interop.constants.MESSAGE_CONTAINERS.MESSAGE_PANE;s.closest("ts-conversation").length>0?o=TS.interop.constants.MESSAGE_CONTAINERS.THREADS_FLEXPANE:s.closest("#threads_msgs").length>0?o=TS.interop.constants.MESSAGE_CONTAINERS.THREADS_VIEW:s.closest("#sli_briefing").length?o=TS.interop.constants.MESSAGE_CONTAINERS.SLI_BRIEFING:s.closest("#unread_msgs_div").length>0&&(o=TS.interop.constants.MESSAGE_CONTAINERS.UNREAD_VIEW);TS.ui.react_message_menu.showMessageMenu(t,{channel:i,message:a,message_container_type:o})},onMessageActionClick:function e(t){t.preventDefault();if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var n=$(this);var r=n.attr("id");var i=n.data("msg-ts");var a=n.data("model-ob-id");var s=n.data("rxn-key");var o=a?TS.redux.channels.getEntityById(a):TS.shared.legacyGetActiveModelOb();var l;if("edit_link"===r){var u=n.data("edit-state");TS.msg_edit.startEdit(i,o,u);f("edit_message_button")}else if("delete_link"===r){TS.msg_edit.startDelete(i,o);f("delete_message_button")}else if("open_in_channel"===r){l=n.attr("data-thread-ts");TS.client.ui.tryToJump(o.id,l);f("open_in_channel_button")}else if("open_thread_in_flexpane"===r){var d=TS.utility.msgs.findMsg(i,o.id);if(d&&TS.replies&&TS.replies.canReplyToMsg(o,d)){l=d.thread_ts||d.ts;TS.ui.replies.openConversation(o,l)}}else if("toggle-subscription-status"===r){var c=n.data("subscribed");var m;var p=TS.utility.msgs.findMsg(i,a);p&&p.latest_reply?m=p.latest_reply:p&&p.replies&&p.replies.length&&(m=_.last(p.replies).ts);n.addClass("disabled");TS.replies.setSubscriptionState(a,i,!c,m);var h=c?"THREADS_UNFOLLOW_CLICKED":"THREADS_FOLLOW_CLICKED";var g=n.data("context");var S=_.get(p,".reply_count",0)+1;TS.ui.thread.trackEvent(a,i,g,h,{num_msg_in_thread:S});f(c?"unfollow_message_button":"follow_message_button")}else if("pin_link"===r){TS.pins.startPinMessage(i,o);f("pin_to_this_conversation_button")}else if("unpin_link"===r){TS.pins.unPinMessage(i,o);f("unpin_from_this_conversation_button")}else if("rxn_link"===r){TS.ui.react_emoji_menu.start({e:t,rxn_key:s});f("add_reaction_button")}else if("mark_unread"===r){if(TS.model.unread_view_is_showing)TS.client.ui.unread.setUnreadPoint(i);else{TS.info("setting unread point on "+o.id+" due to message action click ("+i+")");TS.client.msg_pane.setUnreadPoint(i)}f("mark_unread_button")}else if("copy_link"===r){TS.clipboard.writeText($(this).data("permalink"));var T=TS.menu.$secondary_target_element;var v={message_timestamp:i,channel_id:a,channel_type:a[0]||"",member_id:T.data("member-id"),app_id:T.data("app-id"),bot_id:T.data("bot-id")};TS.interop.clog.track("MSG_LINK_COPY",v);f("copy_link_button")}else if("open_original_link"===r);else if("share_message_link"===r){TS.ui.share_message_dialog.start(i,o);f("share_message_button")}else if("remove_broadcast_link"===r){TS.msg_edit.startRemoveBroadcast(i,o);f("remove_from_conversation_button")}else if("remind_me"===r)return;TS.menu.end()},onMessageRemindClick:function e(t,n,r,i){var a=$(i.target).data("msg-action");if("remind"===a){var s={time:$(i.target).data("remind-length"),message_channel:t.id,message_ts:n.ts};"thread_broadcast"!==n.subtype||r||(s.respond_in_channel=true);var o=function e(){};TS.interop.api.call("reminders.addFromMessage",s).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}});f("remind_me_button")}TS.menu.end()},startWithCommentActions:function e(t,n,r){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.files.getFileById(n);if(!i)return;var a=TS.files.getFileCommentById(i,r);if(!a)return;var s=TS.shared.legacyGetActiveModelOb();var o=TS.files.getFileCommentActions(a,i);TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_comment_action_items({model_ob:s,file:i,comment:a,actions:o}));var l=$(t.target);TS.menu.$menu_items.on("click.menu","li",function(e){var t=l.closest(".comment_actions");TS.menu.onCommentActionClick(e,t)});TS.menu.start(t);var u=0;var d=-(TS.menu.$menu.width()+10);var c=TS.menu.$menu.find("#edit_file_comment");0===c.length&&(c=TS.menu.$menu.find("#rxn_file_comment"));if(c.length>0){var _=TS.menu.$menu.offset().top;var m=c.offset().top;u=-(m-_+c.height()/2-5)}TS.menu.positionAt(l,d,u);TS.menu.keepInBounds()},onCommentActionClick:function e(t,n){t.preventDefault();var r=$(t.target).closest("[id]");var i=r.attr("id");var a=r.data("rxn-key");var s=TS.shared.legacyGetActiveModelOb();if("edit_file_comment"===i)TS.ui.comments.startEdit(r.data("file-id"),r.data("comment-id"),n);else if("delete_file_comment"===i)TS.ui.comments.startDelete(r.data("file-id"),r.data("comment-id"));else if("rxn_file_comment"===i)TS.ui.react_emoji_menu.start({e:t,rxn_key:a});else if("pin_comment"===i&&s)TS.pins.startPinFileComment(r.data("comment-id"),r.data("file-id"),s);else{if("unpin_comment"!==i||!s){TS.warn("not sure what to do with clicked element id:"+i);return}TS.pins.unPinFileComment(r.data("comment-id"),r.data("file-id"),s)}TS.menu.end()},startWithSpaceWeb:function e(t,n,r){var i=5;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var a=TS.files.getFileById(n);if(!a)return;var s=TS.files.getFileActions(a);var o=a.channels.concat(a.groups).concat(a.ims);var l=a.user==r&&o.length&&"uneditable"!==a.state;var u={file:a,actions:s,can_write_to_clipboard:TS.clipboard.canWriteText(),can_enable_collab_editing:l,collab_enabled:"locked"!==a.state&&"uneditable"!==a.state};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_space_action_items(u));TS.menu.$menu_items.on("click.menu","li",TS.menu.onSpaceClickWeb);TS.kb_nav.setSubmitItemHandler(TS.menu.onSpaceClickWeb);TS.menu.start(t);var d=$(".space_btn_more");$("#toggle_input").bind("change",function(){t.preventDefault();var e=$("#toggle_collab_editing");var n=$(this);e.addClass("disabled");n.prop("disabled",true);TS.web.space.lockEditingPrivilegesWithCallback(n.prop("checked"),function(t){var r=t&&t.data;var i=r?"locked"!==r.state:!n.prop("checked");e.removeClass("disabled");n.prop("disabled",false);n.prop("checked",i)})});var c=-TS.menu.$menu.outerWidth()+d.outerWidth();var _=d.outerHeight()+i;TS.menu.positionAt(d,c,_)},onSpaceClickWeb:function e(t){var n=$(this).attr("id");var r=TS.files.getFileById($(this).data("file-id"));if(!r)return;if("keyboard_shortcuts"===n){t.preventDefault();TS.ui.shortcuts_dialog.start(true)}else if("learn_more"===n);else if("feedback"===n){t.preventDefault();TS.web.space.provideFeedback()}else if("delete_space"===n){t.preventDefault();TS.web.file.deleteFile(r.id)}else if("copy_space_link"===n){t.preventDefault();TS.clipboard.canWriteText()?TS.clipboard.writeText(r.permalink):TS.warn("User clicked copy link, but we can't write to the clipboard right now")}else if("create_public_space_link"===n){t.preventDefault();TS.files.createPublicURL(r)}else if("view_public_space_link"===n){t.preventDefault();TS.web.space.showPublicUrlDialog()}else{if("print_space"!==n){if("toggle_collab_editing"===n)return;t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}window.print();t.preventDefault()}TS.menu.end()},startWithTeamAndUser:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.startWithTeamAndUserRebuild(t);if(TS.boot_data.page_needs_enterprise){TS.menu.listenForRebuildWorthiness(t);o(t)}},did_start_slack_menu_signal_listeners:false,listenForRebuildWorthiness:function e(t){TS.menu.did_start_slack_menu_signal_listeners=true;if(TS.client){u=TS.members.user_added_to_team_sig.add(function(){return l(t)});d=TS.members.user_removed_from_team_sig.add(function(){return l(t)})}},stopListeningForRebuildWorthiness:function e(){TS.menu.did_start_slack_menu_signal_listeners=false;if(TS.client){if(u){u.detach();u=null}if(d){d.detach();d=null}}},startWithTeamAndUserRebuild:function n(r){TS.menu.clean();TS.menu.submenu_template_args={};t=!!TS.prefs.getTeamPref("all_users_can_purchase");var i=TS.model&&TS.model.team&&TS.boot_data.feature_tinyspeck;var a=TS.environment.is_dev;var s=i||a;var o=TS.boot_data.qa_messages_count||TS.model.team.messages_count;var l=!!TS.redux.enterprise.getEnterpriseId();var u=TS.interop.desktop.isAppStoreBuild();var d=TS.model.team.plan&&_.includes(["std","plus","enterprise"],TS.model.team.plan)&&"treatment"==TS.interop.experiments.getGroupForUser("plan_awareness_team_menu_paid")||!TS.model.team.plan&&"treatment"==TS.interop.experiments.getGroupForUser("plan_awareness_team_menu_free");var f=!u;var p=TS.model.user.is_admin;var h=TS.ui.admin_invites.canInvite();var g=TS.ui.admin_invites.userCanViewSharedInvitesModal();var S=TS.model.team.plan&&(TS.model.user.is_owner||TS.prefs.getPref("purchaser"));var T=!u&&!TS.model.team.plan;var v=TS.model.user.is_admin||!TS.prefs.getTeamPref("stats_only_admins")&&!TS.model.user.is_restricted;var b=!TS.model.team.plan&&v&&!l&&o>=200;var y=TS.model.user.is_admin||!TS.model.user.is_restricted&&(!TS.prefs.getTeamPref("emoji_only_admins")||!TS.prefs.getTeamPref("slackbot_responses_only_admins")||!TS.prefs.getTeamPref("loading_only_admins"));var w=TS.interop.apps.isAppSpaceEnabled()&&TS.interop.members.isAppmin()&&l;var k={user:TS.model.user,team:TS.model.team,team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team),logout_url:TS.boot_data.logout_url,signin_url:TS.boot_data.signin_url,help_url:TS.boot_data.help_url,show_version_info:s,current_team_is_in_enterprise:false,current_team_gets_logout_url:true,is_in_plan_awareness_experiment:d,show_plan_info:f,show_admin_link:p,show_invite_link:h,show_shared_invites:g,show_limit_meters:b,show_apps_link:w,show_customize_link:y,show_statistics_link:v,show_billing_link:S,show_paid_plans_link:T,anyone_can_buy:t,is_our_app:TS.model.is_our_app,messages_count:o,messages_count_str:TS.utility.number.formatNumberWithAbbreviation(o,{precision:2,decimal_places:1,lowercase:true}),hidden_messages_count_str:TS.utility.number.formatNumberWithAbbreviation(o-1e4,{decimal_places:1,lowercase:true})};if(d&&f){var x;var C;switch(TS.model.team.plan){case"std":x=TS.interop.i18n.t("Standard","menu")();C="/pricing/standard";break;case"plus":x=TS.interop.i18n.t("Plus","menu")();C="/pricing/plus";break;case"enterprise":x=TS.interop.i18n.t("Enterprise","menu")();C="/pricing/enterprise-grid";break;default:C="/pricing";break}k.current_team_plan=x;k.current_team_plan_a_tag="<a class='inline_menu_link' href="+C+"?ui_step=61&ui_element=5' target='_blank' tabindex='1'>"}var I=Object.keys(TS.boot_data.other_accounts).length;I&&(k.other_accounts=TS.boot_data.other_accounts);TS.model.team.enterprise_id&&(k.current_team_is_in_enterprise=true);var M=false;var A=_.merge({},TS.boot_data.other_accounts);var E={};TS.boot_data.page_needs_enterprise&&_.get(TS.model.user,"enterprise_user.teams.length")>1&&(A[TS.model.team.id]=TS.model.team);_.each(A,function(t){if(t.enterprise_id){if(!k.other_enterprise_accounts){M=true;k.other_enterprise_accounts=_(A).filter("enterprise_id").groupBy("enterprise_id").map(function(t){var n={};n.enterprise_id=t[0].enterprise_id;n.enterprise_name=t[0].enterprise_name;TS.model.user.enterprise_user&&n.enterprise_id===TS.model.user.enterprise_user.enterprise_id?n.enterprise_teams=_(_.get(TS.model.user,"enterprise_user.teams",[])).without(TS.model.team.id).map(function(e){return TS.teams.getTeamById(e)}).compact().slice(0,e).map(function(e){return{team_id:e.id,team_url:TS.utility.enterprise.buildTeamUrl(e.domain),team_name:TS.interop.rules.teams.getTeamDisplayName(e)}}).sortBy("team_name").value():n.enterprise_teams=t.slice(0,e);n.is_currently_logged_into=false;if(n.enterprise_id===TS.model.team.enterprise_id){n.is_enterprise_currently_logged_into=true;n.needs_enterprise_teams_dialog=_.get(TS.model.user,"enterprise_user.teams.length")>e;k.current_team_is_in_enterprise&&(k.current_team_gets_logout_url=false);k.enterprise_logout_url=TS.boot_data.enterprise_logout_url;k.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{n.needs_other_enterprise_logout=true;n.logout_url=TS.enterprise.workspaces.createLogoutURL(n.enterprise_id,TS.boot_data.logout_url)}return n}).value();TS.model.user.enterprise_user&&(k.other_enterprise_accounts=k.other_enterprise_accounts.sort(function(e,t){if(e.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return-1;if(t.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return 1;return 0}))}}else{t.logout_url=TS.enterprise.workspaces.createLogoutURL(t.team_id,TS.boot_data.logout_url);E[t.team_id]=t}});M&&(Object.keys(E).length?k.other_accounts=E:Object.keys(k.other_enterprise_accounts).length&&delete k.other_accounts);if(k.current_team_is_in_enterprise){k.current_team_gets_logout_url=false;k.enterprise_logout_url=TS.boot_data.enterprise_logout_url;k.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}if(TS.boot_data.page_needs_enterprise){(M||k.current_team_is_in_enterprise)&&(k.other_enterprise_accounts&&Object.keys(k.other_enterprise_accounts).length||k.other_accounts&&Object.keys(k.other_accounts).length)&&(k.show_switch_teams_submenu=true);k.can_show_leave_workspace=TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,TS.model.team)}k.show_shared_channels=TS.boot_data.page_needs_enterprise&&!TS.model.user.is_restricted;k.show_shared_channels_open_beta_controls=TS.permissions.members.canManageParticipationInSharedChannelsOpenBeta();TS.menu.$menu.addClass("team_menu slack_menu");TS.menu.$menu.attr("data-qa","team_menu");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_body.html(TS.templates.menu_slack_menu(k));TS.menu.$menu_items.addClass("hidden");var P=TS.menu.$menu_body;P.off("click.menu mouseenter.section_header");P.on("click.menu","li",TS.menu.onTeamAndUserItemClick);P.on("click.menu",".member_preview_link",function(e){e.preventDefault();TS.client.ui.previewMember(TS.model.user.id)});P.on("mouseenter.section_header","> div.section_header",TS.kb_nav.clearHighlightedItem);TS.kb_nav.setSubmitItemHandler(TS.menu.onTeamAndUserItemClick);if(TS.boot_data.page_needs_enterprise){TS.menu.submenu_template_args.administration={};TS.menu.submenu_template_args.switch_teams=k}var F=55;TS.model.is_electron&&TS.model.is_mac&&TS.interop.desktop.isMainWindowFrameless()&&(F+=7);TS.menu.start(r,void 0,{needs_to_remain_open:function e(){return TS.ui.react_emoji_menu.is_showing}});TS.menu.positionAt($("#team_menu"),10,F);TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();P.on("highlighted","li:not(.divider)",TS.menu.onTeamAndUserItemMouseenter);b&&c(o);p&&m("#administration",{ui_element:"admin_link"});h&&m("#team_invitations",{ui_element:"invite_link"});if(b){var O=["UPGRDEXP_LIMIT_METER"];T?O.push("GROWTH_PRICING"):O.push("UPGRADEXP_TEAM_ANALYTICS");m("#limit_meter",{event_ids:O,ui_element:"limit_meter",clog_args:{limit_meter_messages_count:o}})}w&&m("#team_services",{ui_element:"apps_link"});y&&m("#team_customize",{ui_element:"customize_link"});v&&m("#team_statistics",{event_ids:["UPGRADEXP_TEAM_ANALYTICS"],ui_element:"analytics_link"});S&&m("#team_billing",{event_ids:["GROWTH_PRICING"],ui_element:"billing_link"});T&&m("#team_pricing",{event_ids:["GROWTH_PRICING"],ui_element:"pricing_link"})},onTeamAndUserItemMouseenter:function e(t){if((!$(this).hasClass("has_submenu")||"member_current_status_item"===$(this).attr("id"))&&TS.menu._current_status_input&&TS.menu._current_status_input.isEdited())return;TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");if($(t.currentTarget).hasClass("has_submenu")){var n=$(this).attr("id")||$(this).data("action");var r=TS.menu.$menu_body;var i={};TS.menu.submenu_template_args[n]&&(i=TS.menu.submenu_template_args[n]);switch(n){case"administration":if(TS.model.user.enterprise_user&&(TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner)){i.show_org_settings=true;i.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{var a=TS.interop.desktop.isAppStoreBuild();var s=(TS.model.user.is_owner||TS.prefs.getPref("purchaser"))&&!a;TS.interop.apps.isAppSpaceEnabled()&&TS.interop.members.isAppmin()?i.show_apps_link=true:s&&(i.show_billing_link=s);TS.prefs.getPref("seen_administration_menu")||TS.prefs.setPrefByAPI({name:"seen_administration_menu",value:true});i.can_create_shared_channel=TS.permissions.members.canCreateSharedChannel()}TS.menu.$submenu_parent=r.find("#administration");TS.menu.$submenu_parent.submenu({items_html:TS.templates.administration_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"switch_teams":TS.menu.$submenu_parent=r.find("#switch_teams");TS.menu.$submenu_parent.submenu({items_html:TS.templates.switch_teams_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"team_invitations":if(TS.ui.admin_invites.userCanViewSharedInvitesModal())return;t.preventDefault();TS.ui.admin_invites.start();TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;default:}}},onTeamAndUserItemSubmenuClick:function e(t){var n=$(t.target).closest("li");var r=n.attr("id")||n.data("action");switch(r){case"team_settings":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_TEAM_SETTINGS_BTN"});break;case"team_services":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_TEAM_SERVICES_BTN"});break;case"org_settings":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_ORG_SETTINGS_BTN"});break;case"switch_team":case"logout":case"enterprise_logout":break;case"enterprise_teams_dialog":t.preventDefault();TS.ui.enterprise_teams_dialog.show(TS.model.user);break;case"connected_workspaces":t.preventDefault();TS.interop.mountConnectedWorkspaces(TS.boot_data.team_id,{referringUiElement:"TEAM_MENU_ADMINISTRATION_MANAGE_SHARED_CHANNELS_BTN"});break;case"manage_team":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_MANAGE_TEAM_BTN"});if(TS.boot_data.feature_admin_in_client){t.preventDefault();TS.interop.mountAdminMemberModal(TS.boot_data.team_id)}break;default:t&&t.target&&"_blank"===t.target.getAttribute("target")||t.preventDefault();return}TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");TS.menu.end()},onTeamAndUserItemClick:function e(t){clearTimeout(TS.menu.end_time);var n=$(this);if(n.is("[disabled]")||n.hasClass("disabled")){t.preventDefault();return}var r=n.attr("id");!r&&n.hasClass("switch_team")&&(r="switch_team");switch(r){case"leave_workspace":t.preventDefault();TS.ui.leave_team_dialog.start(TS.model.team.id);break;case"workspaces":t.preventDefault();TS.ui.workspaces.start();break;case"shared_channels":t.preventDefault();TS.ui.enterprise_shared_channels_invites.start();break;case"shared_channels_open_beta":t.preventDefault();TS.ui.shared_channels_open_beta_modal.showModal();break;case"version_info":t.preventDefault();TS.ui.showVersionInfo();break;case"member_account_item":t.preventDefault();TS.client.ui.previewMember(TS.model.user.id);break;case"team_settings":case"manage_team":case"team_billing":case"team_pricing":case"team_services":case"team_customize":case"team_statistics":case"limit_meter":case"sli_trending_dashboard":break;case"team_apps":TS.metrics.count("team_menu_download_apps");t.preventDefault();TS.magic_login.execute({fallback_to_browser:true,browser_uri:"/downloads",app_uri:"/ssb/open"});break;case"team_invitations":if(TS.ui.admin_invites.userCanViewSharedInvitesModal())return;t.preventDefault();TS.ui.admin_invites.start();TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;case"member_prefs_item":t.preventDefault();TS.boot_data.feature_react_prefs?TS.redux.dispatch(TS.interop.redux.actions.openPrefsModal()):TS.ui.prefs_dialog.start();break;case"team_help":t.preventDefault();i("team_menu");break;case"add_team":case"enterprise_login":if(TS.interop.desktop.isDesktop){TS.interop.desktop.signInTeam();t.preventDefault()}break;case"member_presence":t.preventDefault();TS.redux.presence.toggleUserPresence();TS.menu.end_time=setTimeout(TS.menu.end,1e3);return;case"logout":t.preventDefault();TS.client&&TS.client.windows.closeAll();if(TS.interop.desktop.isDesktop&&TS.interop.desktop.canSignOut()){TS.interop.desktop.signOutTeam(window.teamId);break}TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url);break;case"enterprise_logout":break;case"switch_team":var a=$(this).data("user-id");if(TS.interop.desktop.isDesktop){TS.interop.desktop.displayTeam(a);t.preventDefault()}else{var s=$(this).find("a").attr("href");s&&-1==s.indexOf("?")&&$(this).find("a").attr("href",[s,TS.getQsArgsForUrl()].join("?"))}break;case"member_current_status_item":$(".team_name_caret").focus();TS.redux.dispatch(TS.interop.redux.actions.openCustomStatusDialog());break;case"member_current_status_clear_item":var o={status_text:"",status_emoji:"",status_text_canonical:"",status_expiration:0};TS.interop.members.updateCurrentMemberProfile({profile:o});break;default:t.preventDefault();return}TS.menu.end()},startWithNotificationsMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var n=TS.dnd.memberDndStatus();var r=TS.shared.legacyGetActiveModelOb();var i;i=r.is_mpim?TS.mpims.legacyGetDisplayName(r,false,false):r.is_channel||r.is_group?"#"+r.name:r.name;var a={user:TS.model.user,model_ob:r,model_ob_name:i,in_dnd:n.in_dnd,is_snoozing:n.snoozed,readable_end_time:n.readable_end_time,cmd_key:TS.model.is_mac?"\u2318":"ctrl",meta_key:TS.model.is_mac?"opt":"alt",unread_view_is_showing:TS.model.unread_view_is_showing};TS.menu.has_submenu=true;TS.menu.$menu.addClass("notifications_menu");TS.menu.$menu_header.html(TS.templates.notifications_header(a));TS.menu.$menu_items.html(TS.templates.notifications_items(a));TS.menu.$menu_items.on("click.menu","li",TS.menu.onNotificationsMenuItemClick);var s=TS.menu.$menu_items.find("#adjust_snooze_time");s.on("highlighted",function(){s.submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick})}).on("unhighlighted",function(){TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active")&&s.submenu("destroy")});TS.menu.start(t);TS.menu.positionAt($("#team_menu .notifications_menu_btn"),-10,24)},onNotificationsMenuItemClick:function e(t){var n=$(t.target).closest("[data-dnd-menu-action]");if(!n.length)return;var r=n.data("dnd-menu-action");var i=TS.dnd.memberDndStatus();if("turn_off"===r)i.snoozed?TS.dnd.endSnooze():i.in_dnd&&TS.dnd.endDnd();else if("snooze"===r){var a=parseInt(n.data("snooze-length"),10);a&&!isNaN(a)&&TS.dnd.setSnooze(a)}else if("dnd_schedule"===r)TS.ui.prefs_dialog.start("notifications","#prefs_dnd");else if("channel_settings"===r){var s=TS.shared.legacyGetActiveModelOb();TS.ui.channel_prefs_dialog.start(s.id)}else"notif_prefs"===r&&TS.ui.prefs_dialog.start("notifications");TS.menu.end()},startWithFlexMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();var n;n=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("Organization Directory","menu")():TS.interop.i18n.t("Workspace Directory","menu")();TS.menu.$menu_items.html(TS.templates.menu_flexpane_items({special_flex_panes:TS.boot_data.special_flex_panes,show_downloads:TS.model.supports_downloads,is_enterprise:TS.boot_data.page_needs_enterprise,show_user_groups:""!==TS.model.team.plan&&!TS.model.user.is_restricted,directory_title:n}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onFlexMenuItemClick);TS.menu.start(t);TS.menu.$menu.addClass("flex_menu");TS.menu.$menu.attr("data-qa","flex_menu");var r=$("#flex_menu_toggle");var i=-(TS.menu.$menu.width()-r.width());var a=6+r.height();TS.menu.positionAt(r,i,a);TS.help.updateIcon();TS.client.whats_new.updateIcon();$("#flex_menu_toggle").addClass("menu_open");$("#flex_menu_callout").bind("click",function(){TS.menu.end()})},onFlexMenuItemClick:function e(t){var n=200;var r=$(this);var a=$(this).data("tab-id");var s="";if(a){s=a;setTimeout(function(){if("files"===s){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList("all")}else if("team"===s)TS.client.ui.showTeamList();else if("groups"===s)TS.client.ui.showGroupsList();else{if("whats_new"===s){var e=!r.find("#whats_new_count").hasClass("hidden");e?TS.interop.clog.track("WHATSNEW_ACTION",{action:"open_pane_badged",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()}):TS.interop.clog.track("WHATSNEW_ACTION",{action:"open_pane",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()})}TS.client.ui.flex.openFlexTab(s)}},n)}else if($(this).data("filetype")){var o=$(this).data("filetype");s="files";o&&(s="files_"+o);var l=$("#file_list");l.length&&l.children().length||TS.view.files.last_files_html&&(TS.view.files.last_files_html="");setTimeout(function(){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList(o);TS.view.files.setButtonState(o)},n)}else{var u=$(this).attr("id");s=u;if("help"===u){t.preventDefault();setTimeout(function(){i("flex_menu")},n)}}TS.interop.clog.track("FLEX_MENU_ITEM_CLICK",{flex_name:s});TS.interop.clog.track("GLOBAL_NAV",{contexts:{ui_context:{action:"CLICK",ui_component:"CHANNEL_HEADER",ui_element:"NAV_FLEX_MENU_ITEM"}},flex_name:s});TS.menu.end()},startWithUserGroupMenu:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.user_group=TS.interop.userGroups.getUserGroupById(n);TS.menu.$menu.addClass("no_min_width");var r=TS.permissions.members.canCreateAndDeleteUserGroups()&&!TS.menu.user_group.date_delete;var i=TS.permissions.members.canCreateAndDeleteUserGroups()&&TS.menu.user_group.date_delete;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.user_group_items({show_user_groups_edit:TS.permissions.members.canEditUserGroups(),show_user_groups_disable:r,show_user_groups_enable:i}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onUserGroupMenuItemClick);TS.menu.start(t);TS.menu.positionAt($("#user_group_menu_toggle"),-(TS.menu.$menu.width()-$("#user_group_menu_toggle").width()),37)},onUserGroupMenuItemClick:function e(){var t=$(this).data("action");"edit_info"===t?TS.ui.admin_user_groups.editInfo(TS.menu.user_group):"edit_members"===t?TS.ui.admin_user_groups.editMembers(TS.menu.user_group):"disable"===t?TS.ui.admin_user_groups.disable(TS.menu.user_group):"enable"===t?TS.ui.admin_user_groups.enable(TS.menu.user_group):"delete"===t&&TS.ui.admin_user_groups.remove(TS.menu.user_group);TS.menu.end()},startWithSearchFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n={search_exclude_bots:TS.prefs.getPref("search_exclude_bots"),search_only_my_channels:TS.prefs.getPref("search_only_my_channels"),search_only_current_team:TS.prefs.getPref("search_only_current_team"),result_type:"files"===TS.search.filter?"files":"messages",is_enterprise:TS.boot_data.page_needs_enterprise};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_search_filter_items(n));TS.menu.start(t);a();var r=$("#search_filter_menu_label");TS.menu.positionAt(r,-8,r.height()+10);$("#search_only_my_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_my_channels",value:!$(this).prop("checked")})});$("#search_exclude_bots_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_exclude_bots",value:!$(this).prop("checked")})});$("#search_only_current_team_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_current_team",value:!$(this).prop("checked")})});TS.menu.search_filter_is_showing=true;$("#search_filter_menu_label").addClass("active")},startWithMentionsFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n={exclude_at_channels:TS.prefs.getPref("mentions_exclude_at_channels"),exclude_at_user_groups:TS.prefs.getPref("mentions_exclude_at_user_groups"),show_user_group_filter:true};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_mentions_filter_items(n));TS.menu.start(t);a();var r=$("#mentions_filter_menu_label");TS.menu.positionAt(r,-8,r.height()+10);$("#exclude_at_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_channels",value:!$(this).prop("checked")})});$("#exclude_at_user_groups_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_user_groups",value:!$(this).prop("checked")})});$("#mentions_filter_menu_label").addClass("active")},startWithEditTeamProfileListActions:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var i=$(t.target);var a=TS.team.getTeamProfileFieldById(i.data("id"));var s={id:a.id,hidden:!!(a&&a.is_hidden),is_scim:r.is_scim};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.admin_menu_edit_team_profile_list_action_items(s));TS.menu.$menu_items.on("click.menu","li",n);TS.menu.start(t);TS.menu.positionAt(i.find('[data-action="edit_team_profile_list_menu"]'),-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},startWithAllUnreadsSortOrderMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var n={sort_order:TS.client.unread.getSortOrder(),is_paid_team:""!==TS.model.team.plan};TS.menu.has_submenu=true;TS.menu.$menu.addClass("all_unreads_sort_order_menu selectable");TS.menu.$menu_items.html(TS.templates.unread_sort_order_menu(n));TS.menu.$menu_items.on("click.menu","li",TS.menu.onAllUnreadsSortOrderMenuItemClick);TS.menu.addSubmenu(".priority",TS.templates.menu_help_submenu({icon:"ts_icon_emoji_objects",title:TS.interop.i18n.t("Sorted by science","all_unreads")(),message:TS.interop.i18n.t("This sorts your unreads based on how you use Slack.","all_unreads")()}),_.noop,true);TS.menu.start(t);TS.menu.positionAt($(".channel_header_info_count"),105,20)},onAllUnreadsSortOrderMenuItemClick:function e(t){var n=$(t.target).closest("[data-sort-order]");if(!n.length)return;var r=n.data("sortOrder");if(r===TS.client.unread.getSortOrder()){TS.menu.end();return}TS.prefs.setPrefLocal("all_unreads_sort_order",r);TS.prefs.setPrefByAPI({name:"all_unreads_sort_order",value:r});TS.prefs.all_unreads_sort_order_changed_sig.dispatch(r);TS.client.ui.unread.updateChannelHeader();TS.client.unread.reload();TS.menu.end()},startWithSearchableMemberListFilter:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i={everyone_count:0,admins_count:0,guests_count:0,enterprise_filter_options:TS.boot_data.page_needs_enterprise,bots_count:0};TS.boot_data.page_needs_enterprise&&_.merge(i,{is_enterprise:true,org_name:TS.model.team.enterprise_name,team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team),everyone_count:0,org_members_count:0,org_admins_count:0,org_guests_count:0,org_bots_count:0});_.each(n,function(e,t){i[t+"_count"]=e});TS.boot_data.feature_bots_not_members&&(i.everyone_count=n.people);var a=[];_.each(n.external_teams,function(e,t){a.push({id:t,name:TS.teams.getTeamNameById(t)})});a.length>0&&_.merge(i,{ext_teams:a.sort(TS.interop.i18n.mappedSorter("name"))});TS.menu.$menu.width($(t.target).outerWidth());TS.menu.$menu.addClass("searchable_member_list_filter_menu");TS.menu.$menu_items.html(TS.templates.searchable_member_list_filter_items(i));TS.menu.$menu_items.on("click.menu","li",function(e){TS.menu.end();r(e)});TS.menu.start(t);TS.menu.positionAt($(".searchable_member_list_filter"),16,56)},startWithSoundsMenu:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var r=TS.boot_data.notification_sounds;r=_.reject(r,{value:"none"});var i={notification_sounds:r};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_sound_items(i));TS.menu.start(t);TS.menu.$menu_items.on("click.menu",'[data-action="set_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();n(t);TS.menu.end()}).on("click.menu",'[data-action="play_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();TS.sounds.play(t,{ignore_mute:true})});TS.menu.keepInBounds()},legacyStartWithChannelsMenu:function e(t,n){if(!n)return;var r=TS.interop.channels.getEntityById(n);if(!r)return;t.persist&&t.persist();if(r.is_im&&r.user)return TS.menu.member.startWithMember(t,r.user,false,false,true);r.is_channel||r.is_mpim?TS.menu.channel.startWithChannel(t,n):r.is_group&&TS.menu.group.startWithGroup(t,n)},startWithGeneric:function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var a="";_.each(n,function(e){a+=TS.templates.menu_generic_item({label:e.label,value:e.value})});TS.menu.clean();TS.menu.$menu_header.empty();i.header_text?TS.menu.$menu_header.html(TS.templates.menu_generic_header({header_text:i.header_text})):TS.menu.$menu_header.addClass("hidden");TS.menu.$menu_items.html(a);var s={};s.menu_class=i.menu_class;TS.menu.start(t,void 0,s);TS.menu.$menu_items.on("click.menu","a[data-value]",function(){t.preventDefault();r($(this).data("value"));TS.menu.end()});TS.menu.keepInBounds()},positionAt:function e(t,n,r){n=n||0;r=r||0;var i=t.offset();var a=i.left+n;var s=i.top+r;TS.menu.$menu.css({top:s,left:a})},isRedundantClick:function e(t){if(TS.isPartiallyBooted()){t.preventDefault();TS.incremental_boot.userDidInteractWithUI();return true}if(t&&TS.menu.last_e&&(t.target==TS.menu.last_e.target||t.currentTarget==TS.menu.last_e.currentTarget))return true;return false},isLarge:function e(){return TS.menu&&TS.menu.$menu&&TS.menu.$menu.find("li").length>TS.menu.large_dom_trigger},start:function e(t,i,a){a=a||{};TS.menu.last_e=t;if(!r){var s=$(t.target).offset();var o=s.left+$(t.target).width()+10;var l=s.top;if(i){o=t.pageX+10;l=t.pageY+10}}_.isFunction(a.needs_to_remain_open)&&(TS.menu.needs_to_remain_open=a.needs_to_remain_open);$(".tooltip").hide();TS.tips.hideAll();$(t.currentTarget).addClass("active");TS.menu.$target_element=$(t.currentTarget);TS.model.menu_is_showing=true;var u=TS.menu.$menu;a.onClose&&u.one("closed",a.onClose);a.menu_class&&u.addClass(a.menu_class);var d=TS.menu.isLarge();r||u.css({top:l,left:o});var c=u.find("#menu_items_scroller");c.scrollTop(0);a.attach_to_target_at_full_width?TS.menu.$target_element.after(u):TS.client?u.appendTo($("#client-ui")):u.appendTo($("body"));a.keep_menu_open_if_target_clicked_again&&TS.menu.$menu.addClass("keep_menu_open_if_target_clicked_again");if(d||r)u.css("opacity",1);else{u.css("opacity",0);u.stop().transition({opacity:1},200)}u.find(".menu_close").on("click",TS.menu.end);a.ignore_bounds||TS.menu.keepInBounds();TS.ui.utility.updateClosestMonkeyScroller(c,true);TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents&&TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=TS.menu.$menu_items.find(".lazy").lazyload({container:$("#menu_items_scroller"),all_images_same_size:true,throttle:250});a.ignore_bounds||$(window).bind("resize",TS.menu.keepInBounds);$(window.document).bind("keydown",TS.menu.onKeyDown);$("html").bind("mousedown touchstart",TS.menu.onMouseDown);var m=u.find(".menu_list");var f=m.length?m:u.find("#menu_items");TS.menu.has_submenu?TS.kb_nav.start(f,"li:not(.divider)",u,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists}):TS.kb_nav.start(f,"li:not(.divider)");var p=m.length?m.first().find("a, button").first():null;TS.ui&&TS.ui.a11y&&TS.ui.a11y.focusAndAddTabindex(p);r=false;n=a.on_esc},clean:function e(){TS.menu.$menu_footer.empty();TS.menu.$menu_header.removeClass("hidden");TS.menu.$menu.removeClass("no_min_width no_max_width profile_preview flex_menu search_filter_menu popover_menu no_icons team_menu member_menu file_menu notifications_menu all_unreads_sort_order_menu searchable_member_list_filter_menu selectable member_file_filter_menu app_card keep_menu_open_if_target_clicked_again member_file_filter_menu").css("max-height","");TS.menu.$menu.removeAttr("data-qa");TS.menu.$menu.find("#menu_items_scroller").css("max-height","");TS.menu.$menu.find(".arrow, .arrow_shadow").remove();TS.menu.$menu_items.off("mouseenter.section_header");TS.menu.$menu.removeClass("narrow_menu");TS.menu.$menu_body.off("mouseenter.section_header");TS.menu.needs_to_remain_open=void 0;TS.menu.$menu.removeClass("date_picker");if(TS.boot_data.page_needs_enterprise){TS.menu.$menu_list_container.html('<div id="menu_list" role="menu"></div>').removeClass("populated");TS.menu.$menu_list=TS.menu.$menu.find("#menu_list");TS.menu.$menu.off("keydown","#file_member_filter .member_filter")}TS.menu.$menu.removeAttr("data-model-ob-id");TS.menu.$menu.removeAttr("data-thread-ts");if(TS.SearchableMemberList&&TS.SearchableMemberList.get("member_file_filter_menu")){TS.menu.$menu.find(".searchable_member_list").remove();TS.SearchableMemberList.get("member_file_filter_menu").destroy()}if(TS.menu.$menu.find(".member_item")){TS.menu.$menu.find(".member_item").remove();TS.menu.$menu.find(".list_items").css("height",0)}n=null},end:function e(){if(_.isFunction(TS.menu.needs_to_remain_open)&&TS.menu.needs_to_remain_open())return;TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");TS.menu.$menu.width("");TS.model.menu_is_showing=false;TS.menu.menu_items_hidden=true;TS.menu.has_submenu=false;TS.menu.$submenu_parent=null;TS.menu.submenu_template_args={};TS.menu.did_start_slack_menu_signal_listeners&&TS.menu.stopListeningForRebuildWorthiness();var t=TS.menu.$menu;var n=function e(){if(TS.model.menu_is_showing)return;setTimeout(function(){TS.model.menu_is_showing||(TS.menu.last_e=null)},50);t.detach();TS.menu.$menu_header.empty();TS.menu.$menu_footer.empty();TS.menu.$menu_items.empty();TS.menu.$menu_items.removeClass("hidden");TS.menu.$menu_body.empty();TS.menu.clean()};TS.menu.isLarge()||r?n():t.stop().transition({opacity:0},200,n);t.trigger("closed");if(TS.menu.$target_element){TS.menu.$target_element.removeClass("active");TS.menu.$target_element=null}if(TS.menu.$secondary_target_element){TS.menu.$secondary_target_element.removeClass("active");TS.menu.$secondary_target_element=null}TS.menu.user_group=null;TS.menu.$menu_header.unbind("click.menu");TS.menu.$menu_items.off("click.menu");TS.menu.$menu_body.off("click.menu");$(window).unbind("resize",TS.menu.keepInBounds);$(window.document).unbind("keydown",TS.menu.onKeyDown);$("html").unbind("mousedown touchstart",TS.menu.onMouseDown);TS.members.view.team_filter_changed_sig.remove(TS.kb_nav.clearHighlightedItem);$(".file_list_item.active").removeClass("active");TS.tips.unhideAll();TS.menu.search_filter_is_showing=false;$("#search_filter_menu_label").removeClass("active");$("#mentions_filter_menu_label").removeClass("active");$("#flex_menu_toggle").removeClass("menu_open");$("#channel_actions_toggle").removeClass("active");$("#menu_member_dm_input").length&&TS.utility.contenteditable.unload($("#menu_member_dm_input"));t.removeClass("narrow_menu");setTimeout(function(){TS.menu.file.file_list_menu_up=false;$(".inline_file_preview_container.file_menu_open, .file_container.file_menu_open").removeClass("file_menu_open")},100);if(TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents){TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=null}TS.kb_nav.end();TS.client&&"team"!==TS.model.ui.active_tab_id&&"details"!==TS.model.ui.active_tab_id&&TS.client.flex_pane.stopLocalTimeInterval();TS.menu.menu_closed_sig.dispatch()},onKeyDown:function e(t){var r=TS.utility.keymap;var i=t.which;var a=t.metaKey||t.ctrlKey||t.altKey;if(i==r.esc){if(TS.utility.contenteditable.hasFocus($("#menu_member_dm_input")))return;t.stopPropagation();t.preventDefault();TS.menu.end();n&&n()}else if(!a&&!TS.utility.isArrowKey(i)&&i!=r.tab&&i!=r.enter&&i!=r.shift){TS.kb_nav.clearHighlightedItem();TS.utility.contenteditable.focus($("#menu_member_dm_input"))}},onLeftKeyDownIfSubmenuExists:function e(){var t=false;if(TS.menu.$submenu&&TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu_origin);var n=TS.menu.$menu.find(".menu_list");var r=n.length?n:TS.menu.$menu.find("#menu_items");TS.kb_nav.start(r,"li:not(.divider)",TS.menu.$menu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists});-1===["member_current_status_item","switch_teams"].indexOf(TS.menu.$submenu_origin.attr("id"))&&TS.menu.$submenu_origin.submenu("destroy");t=true}return t},onRightKeyDownIfSubmenuExists:function e(){var t=false;TS.kb_nav.getHighlightedItem()&&TS.kb_nav.getHighlightedItem().data("has-submenu")&&(TS.menu.$submenu||TS.kb_nav.getHighlightedItem().submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick}));if(TS.menu.$submenu){if(TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.menu.end()}else{TS.menu.$submenu.addClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu.find("li:not(.divider)").first());TS.kb_nav.start(TS.menu.$submenu.find("ul"),"li:not(.divider)",TS.menu.$submenu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists})}t=true}return t},onMouseDown:function e(t){var n=$(t.target);if(TS.menu.$menu&&TS.menu.$menu.hasClass("keep_menu_open_if_target_clicked_again")&&n.is(TS.menu.$target_element))return;(0===n.closest("#menu, .submenu, .trap_menu_clicks").length||n.hasClass("popover_mask"))&&TS.menu.end()},keepInBounds:function e(){window.requestAnimationFrame?TS.utility.rAF(TS.menu.keepInBoundsThrottled):TS.menu.keepInBoundsThrottled()},keepInBoundsThrottled:function e(){var t=TS.menu.$menu;var n=10;var r=t.dimensions_rect();var i={top:0+n,right:$(window).width()-n,bottom:$(window).height()-(n+14),left:0+n};if(TS.utility.doesRectContainRect(i,r))return;r.left<i.left?t.css("left",i.left):r.right>i.right&&t.css("left",Math.max(i.left,i.right-r.width));r.top<i.top?t.css("top",i.top):r.bottom>i.bottom&&t.css("top",Math.max(i.top,i.bottom-r.height+$(window).scrollTop()))},addSubmenu:function e(t,n,r,i){var a=TS.menu.$menu_items.find(t);a.on("highlighted",function(){a.submenu({items_html:n,onclick:r,help:i})}).on("unhighlighted",function(){TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active")&&a.submenu("destroy")})}});var e=3;var t;var r=false;var i=function e(t){TS.help_modal.start();TS.interop.clog.track("HELP_MODAL_ACTION",{action:"open_modal",trigger:t})};var a=function e(){var t=TS.menu.$menu;t.addClass("popover_menu");t.prepend('<span class="arrow"></span><span class="arrow_shadow"></span>')};var s=function e(t){var n=3;var r=TS.menu.$target_element.outerHeight()+n;var i=0;t&&(i=TS.menu.$target_element.outerWidth()-TS.menu.$menu.outerWidth());return{left:i,top:r}};var o=function t(n){var r=_.without(_.get(TS.model.user,"enterprise_user.teams",[]),TS.model.team.id);if(!r.length)return;var i=false;var a=_.partition(r,function(e){return TS.teams.getTeamById(e,i)});var s=a[0];var o=a[1];var u=o.slice(0,Math.max(0,e-s.length));if(!u.length)return;var d="TS.menu._maybeEnsureTeamsAndRebuild";TS.teams.ensureTeamsArePresent(u,d).then(function(){if(!TS.model.menu_is_showing||!TS.menu.did_start_slack_menu_signal_listeners)return;l(n)})};var l=function e(t){var n=$(".menu.submenu").data("origin-id");r=true;TS.menu.startWithTeamAndUserRebuild(t);r=false;n&&$("#"+n).trigger("highlighted")};var u;var d;var c=function e(t){var n=1e4;var r=$("#limit_meter");var i=$("#limit_meter_circle_progress");var a;var s="rgba(0, 0, 0, .1)";var o;var l={r:69,g:186,b:133};var u={r:255,g:197,b:101};var d={r:243,g:61,b:95};if(t<=n){a=t/n;s="rgba(0, 0, 0, .1)";var c=_.mergeWith(l,u,function(e,t){return Math.floor(e*(1-a)+t*a)});o="rgb("+c.r+", "+c.g+", "+c.b+")"}else{a=Math.atan((t-n)/2500-3)/Math.PI+.5;s="rgb("+u.r+", "+u.g+" , "+u.b+")";o="rgb("+d.r+", "+d.g+", "+d.b+")"}i.circleProgress({value:a,size:50,animation:{duration:20},thickness:4,fill:{color:o},emptyFill:s,startAngle:.425*-Math.PI});r.on("click",function(){TS.interop.clog.track("UPGRDEXP_LIMIT_METER",{limit_meter_messages_count:t,contexts:{ui_context:{action:"click",step:"slack_menu"}}})})};var m=function e(t,n){var r=["SIDEBAR_TEAM_MENU"];var i="slack_menu";var a=n.clog_args||{};n.event_ids&&(r=r.concat(n.event_ids));_.each(r,function(e){var r=_.defaults({contexts:{ui_context:{action:"impression",step:i,ui_element:n.ui_element}}},a);var s=_.defaults({contexts:{ui_context:{action:"click",step:i,ui_element:n.ui_element}}},a);TS.interop.clog.track(e,r);TS.interop.clog.trackClick(t,e,s)})};$.widget("TS.submenu",{_create:function e(){this.element.data("has-submenu",true);var t=TS.interop.i18n.t("submenu","menu_source")();var n='<div class="menu submenu'+(this.options.help?" submenu_help":"")+'" data-origin-id="'+this.element.attr("id")+'" data-model-ob-id="'+this.element.data("modelObId")+'"><ul aria-hidden="true" aria-label="'+t+'">'+this.options.items_html+"</ul></div>";var r=-13;var i=11;var a=TS.menu.$menu.offset().left+TS.menu.$menu.width()+r;var s=this.element.offset().top-i;this.$submenu=$(n);this.$submenu.appendTo("body");TS.menu.$submenu=this.$submenu;TS.menu.$submenu_origin=this.element;if(a+this.$submenu.width()>window.innerWidth){var o=TS.menu.$menu.offset().left-r;var l=window.innerWidth-a;o>l&&(a=TS.menu.$menu.offset().left-this.$submenu.width()-r)}if(s+this.$submenu.height()>window.innerHeight){var u=s;var d=Math.abs(window.innerHeight-(s+this.$submenu.height()));s=u>d?window.innerHeight-this.$submenu.height()-i:i}this.$submenu.css({position:"absolute",left:a+"px",top:s+"px"});var c=this.options.onclick;c&&this.$submenu.on("click",function(e){c.call(this,e)})},_destroy:function e(){TS.menu.$submenu=null;TS.menu.$submenu_origin=null;this.options.ondestroy&&this.options.ondestroy();this.$submenu.remove()}});var f=function e(t){var n={action:"click",step:"more_actions_menu",ui_element:t};TS.interop.clog.track("MSG_ACTION",{contexts:{ui_context:n}})}})();var n},292:function(e,t,n){var r=n(114);e.exports=Array.isArray||function e(t){return"Array"==r(t)}},2920:function(e,t){(function(){TS.registerModule("menu.app",{onStart:function e(){},active_app:null,active_app_bot_id:null,app_item_click_sig:new signals.Signal,startWithApp:function t(n,r,i,a,s,o,l){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;if(!s){TS.menu.buildIfNeeded();TS.menu.clean()}i||(i=TS.model.user.team_id);if(!o){var u=n&&n.target;return TS.interop.apps.openAppProfileCard(r,i,l,u)}TS.menu.app.active_app_bot_id=r;TS.menu.app.active_app_team_id=i;TS.menu.app.active_app_member_id=_.get(n,"target.dataset.memberId",null);function d(e){var t=_.get(e,"bot_user.id");var n=TS.shared.legacyGetActiveModelOb();if(t&&(TS.model.active_channel_id||TS.model.active_group_id))return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(n.id,[t]).then(function(){return e});return e}function c(t){TS.menu.app.active_app=t;s?TS.menu.app_team_id?TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id):TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id):e(n,a,o)}return TS.apps.promiseToGetFullAppProfile(r,i,null,true).then(d).then(c)},onAppItemClick:function e(t){var n=$(this);var r=n.data("action");var i=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");if("view_details"===r)TS.interop.apps.isAppSpaceEnabled()&&i?TS.ims.legacyStartImByMemberId(i).then(function(){TS.client.ui.app_space.toggleView("about")}):TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);else if("files"===r){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(i)}else if("invite_to_channel"===r){t.preventDefault();TS.ui.invite.showInviteMemberToChannelDialog(i)}else if("app_support"===r)TS.help_modal.start();else if("settings"===r){var a="CHANNEL_SETTINGS";var s={action:"CLICK",ui_element:"LINK_APP_SETTINGS"};TS.interop.clog.track(a,{contexts:{ui_context:s}});if(TS.menu.app.active_app.is_xoxa_app){t.preventDefault();TS.redux.dispatch(TS.interop.openAppManagementModal({appProfile:TS.menu.app.active_app,serviceId:TS.menu.app.active_app_bot_id,referringEventId:a,referringUiContext:s}))}}TS.interop.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()},end:function e(){TS.menu.app.active_app=null;TS.menu.end()}});var e=function e(t,n,r){var i;if(r){i={app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id,support_url:TS.menu.app.active_app.support_url,is_xoxa_app:TS.menu.app.active_app.is_xoxa_app,homepage_url:TS.menu.app.active_app.url,is_distributed:TS.menu.app.active_app.is_distributed,is_slack_integration:TS.menu.app.active_app.is_slack_integration,is_custom_integration:_.get(TS.menu.app.active_app,"config.is_custom_integration"),hide_im_menu_items:!TS.menu.app.active_app.is_installed||TS.menu.app.active_app.is_external||TS.model.user.is_restricted,is_uninstalled:!TS.menu.app.active_app.is_installed};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_app_items(i));TS.menu.$menu_footer.addClass("hidden").empty();TS.menu.start(t,n);var a=$("#channel_actions_toggle");TS.menu.positionAt(a,6,a.height())}else{i=TS.apps.constructTemplateArgsForCardAndProfile(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_member_id,TS.menu.app.active_app_team_id);var s=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");if(!s){var o=TS.interop.members.getMemberById(TS.menu.app.active_app_member_id);o&&o.is_bot&&(s=o.id)}TS.menu.$menu_header.html(TS.templates.menu_app_card_header(i));TS.menu.$menu_items.html(TS.templates.menu_app_card_items(i));TS.menu.$menu_footer.html(TS.templates.menu_app_card_footer(i));TS.menu.$menu_header.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)});TS.menu.start(t,n,{menu_class:"app_card"});if(s){var l=false;var u=$("[data-js=app_card_dm]");var d=TS.interop.i18n.t("Message {name}","menu")({name:i.name});TS.utility.contenteditable.create(u,{modules:{tabcomplete:{completers:["channels","emoji","members"],positionMenu:function e(t){t.style.width=u.outerWidth()+"px";t.style.minWidth="0";TS.tabcomplete.positionUIRelativeToInput(t,u)}}},enableBroadcastKeywords:false,singleLineInput:true,onEnter:function e(t){var n=_.trim(TS.utility.contenteditable.value(u));if(!_.keys(t).length&&!l&&n.length){TS.ims.legacyStartImByMemberId(s,false,n);TS.menu.member.end();l=true;TS.interop.clog.track("USER_CARD_DM",{})}return false},onEscape:function e(){TS.menu.end()},placeholder:d,ariaLabel:d.replace(/&#39;/g,"'")});TS.utility.contenteditable.enable(u)}i.hide_link_to_app_profile?TS.menu.$menu_header.off():TS.menu.$menu_header.on("click",function(){var e=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");TS.interop.apps.isAppSpaceEnabled()&&e?TS.ims.legacyStartImByMemberId(e).then(function(){TS.client.ui.app_space.toggleView("about")}):TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);TS.menu.$menu_header.off();TS.interop.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app?TS.menu.app.active_app.id:"",bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()});TS.menu.$menu_items.on("click.menu","[data-member-profile-link]",function(e){e.preventDefault();TS.client.ui.previewMember($(this).data("member-profile-link"))});TS.menu.keepInBounds()}TS.menu.$menu_items.on("click.menu","li",TS.menu.app.onAppItemClick)}})()},2921:function(e,t){(function(){TS.registerModule("menu.file",{onStart:function e(){},reported_no_file_reader:false,startWithNewFileOptions:function e(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.model_ob_id,o=a.thread_ts;if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var l=_.noop;if(TS.boot_data.feature_file_threads){n=s;r=o;l=function e(){n=null;r=null}}TS.menu.$menu.addClass("file_menu");TS.menu.$menu_header.addClass("hidden").empty();var u=window.File&&"disable_all"!==TS.prefs.getTeamPref("disable_file_uploads");var d=TS.utility.box.isBrowserSupported()&&TS.prefs.getPref("box_enabled");var c=window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled");var m=TS.prefs.getTeamPref("gdrive_enabled_team");var f=TS.boot_data.feature_onedrive_picker&&TS.prefs.getTeamPref("onedrive_enabled_team");var p=TS.boot_data.feature_docs&&"friends"===TS.interop.experiments.getGroupForUser("friends_of_docs");var h=TS.boot_data.feature_file_threads&&o;var g=0;d&&(g+=1);c&&(g+=1);m&&(g+=1);f&&(g+=1);var S=g>1;var T=TS.interop.i18n.t("Add from\u2026","menu_file")();var v;var b;if(u)if("disable_all_except_images"===TS.prefs.getTeamPref("disable_file_uploads")){v=g?T:TS.interop.i18n.t("Add an image from\u2026","menu_file")();b=TS.interop.i18n.t("an image","menu_file")()}else{v=TS.interop.i18n.t("Add a file from\u2026","menu_file")();b=TS.interop.i18n.t("a file","menu_file")()}else{if(!TS.menu.file.reported_no_file_reader){TS.menu.file.reported_no_file_reader=true;TS.info("TS.menu: No File support?  navigator.userAgent: "+navigator.userAgent)}v=T;b=""}var y={should_hide_new_file_menu:h,should_show_upload_file:u,should_show_box:d,should_show_dropbox:c,should_show_gdrive:m,should_show_onedrive:f,should_show_docs:p,add_from:v,file_type:b,use_cloud_submenu:S};var w;w=h?TS.templates.menu_file_new_file_add_from_items(y):TS.templates.menu_file_new_file_items(y);TS.menu.$menu_items.html(w);if(m){TS.menu.addSubmenu("#gdrive_create_submenu",TS.templates.menu_file_gdrive_doc_type_items(),TS.menu.file.onGDriveDocumentTypeItemClick);TS.menu.has_submenu=true}if(S){var k=TS.templates.menu_file_cloud_service_items({should_show_box:d,should_show_dropbox:c,should_show_gdrive:m,should_show_onedrive:f});TS.menu.addSubmenu("#cloud_submenu",k,TS.menu.file.onNewFileOptionsItemClick);TS.menu.has_submenu=true}TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onNewFileOptionsItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.file.onNewFileOptionsItemClick);var x=i&&"primary_file_button"===i.attr("id");var C=i&&i.is(".inline_file_upload");var I;if(TS.client&&x){I=function e(){TS.utility.contenteditable.focus(TS.client.msg_input.$input)};TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_button"}}})}TS.menu.start(t,false,{on_esc:I,onClose:l});TS.menu.$menu.attr("data-qa","file_menu");x||C?TS.menu.positionAt(i,1,-(TS.menu.$menu.height()+6)):TS.menu.positionAt(i,i.width()-TS.menu.$menu.width(),i.outerHeight()+10)},onGDriveDocumentTypeItemClick:function i(a){var s=$(a.target);var o=s.data("doc-type");var l=s.data("doc-display-type");if(!o)return;var u=TS.templates.loading_indicator();t.remove();e.append(u);TS.files.gdrive.createAndShare(o,l,n,r);TS.menu.file.end();e.toggleClass("active",true);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_gdrive_"+o.toLowerCase()}}})},onOneDriveDocumentTypeItemClick:function e(t){TS.log(9999,"boop");TS.log(9999,t)},onGDriveCreateComplete:function n(r,i,a){r&&i&&!a&&$("#allow_popups_banner").is(":visible")&&TS.client.ui.addEphemeralBotMsg({text:TS.interop.i18n.t("It looks like your browser is blocking popups so here\u2019s a link to your <{url}|document>","menu_file")({url:i.data.url}),ephemeral_type:"created_google_drive_document"});e.find(".ts_icon").remove();e.toggleClass("active",false).append(t)},onNewFileOptionsItemClick:function e(t){var i=$(this).closest("[data-which]");i.length||(i=$(t.target).closest("[data-which]"));var a=i.data("which");var s;if("choose"===a){t.preventDefault();TS.client.ui.files.chooseFile(n,r)}else if("email"===a);else if("snippet"===a){t.preventDefault();TS.client.msg_input.startSnippet();TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_snippet"}}})}else if("post"===a)TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_post"}}});else if("box"===a){t.preventDefault();TS.files.openBoxChooser(n,r);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_box"}}})}else if("dropbox"===a){t.preventDefault();TS.files.openDropboxChooser(n,r);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_dropbox"}}})}else if("gdrive_import"===a){t.preventDefault();TS.files.gdrive.openPickerWindow(n,r);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_gdrive"}}})}else if("gdrive_create_submenu"===a)t.preventDefault();else if("onedrive_import"===a){t.preventDefault();TS.files.onedrive.openPickerWindow(n,r);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_onedrive"}}})}else if("cloud_submenu"===a)t.preventDefault();else if("space"===a){t.preventDefault();s=TS.interop.utility.isCmdKey(t);TS.files.createAndOpenNewSpace(null,s);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_space"}}})}else if("docs"===a){t.preventDefault();s=TS.interop.utility.isCmdKey(t);TS.files.createAndOpenNewDocs(null,s);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_docs"}}})}else{t.preventDefault();TS.warn("not sure what to do with clicked element:"+a)}TS.menu.file.end()},startWithFileFilter:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var r="all";TS.model.file_list_types&&(r=TS.model.file_list_types[0]);var i=TS.model.team.plan;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_file_filter_items({active_type:r,show_email_item:i}));n?TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onSearchFileFilterItemClick):TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileFilterItemClick);TS.menu.start(t);n?TS.menu.positionAt($("#search_file_list_heading"),0,20):TS.menu.positionAt($("#file_list_container"),8,44)},onFileFilterItemClick:function e(t){t.preventDefault();TS.client.ui.files.filterFileList($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},onSearchFileFilterItemClick:function e(t){t.preventDefault();TS.search.setFiletypeFilter($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},startWithFileMemberPromiseFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.append(TS.templates.menu_file_member_filter());TS.menu.$menu.addClass("member_file_filter_menu");TS.menu.start(t);TS.menu.positionAt($("#file_list_toggle_user"),0,35);var n=new TS.SearchableMemberList({$container:$(".member_file_filter_menu .searchable_member_list"),id:"member_file_filter_menu",show_filter_bar:false,compact_results:true,prevent_member_click_handler:true,suppress_presence:true});n.showInitial();n.member_clicked_sig.add(function(e,t){TS.client.ui.files.toggleFileList(t.id);TS.menu.file.end()})},onFileMemberFilterItemClick:function e(t){t.preventDefault();var n=$(t.currentTarget).data("member-id");TS.client.ui.files.toggleFileList(n);TS.menu.file.end()},onSearchFileMemberFilterItemClick:function e(t){t.preventDefault();var n=$(t.currentTarget).data("member-id");TS.search.setMember(n);TS.menu.file.end()},file_list_menu_up:false,startWithFileActions:function e(t,n){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var r=TS.files.getFileById(n);if(!r)return;var i=TS.files.getFileActions(r);if(TS.boot_data.feature_file_threads){i.comment=false;i.rxn_file=false;i.pin_file=false;i.unpin_file=false}var a=$(t.target);var s=a.closest(".file_actions");i.comment&&s.data("exclude-comment")&&(i.comment=false);i.download&&s.data("exclude-download")&&(i.download=false);i.open_original&&s.data("exclude-original")&&(i.open_original=false);i.rxn_file&&s.data("exclude-rxn")&&(i.rxn_file=false);i.pin_file&&(s.data("exclude-pin")||s.data("exclude-pin-file"))&&(i.pin_file=false);i.unpin_file&&(s.data("exclude-pin")||s.data("exclude-unpin-file"))&&(i.unpin_file=false);i.edit&&s.data("exclude-edit")&&(i.edit=false);i.edit_title&&s.data("exclude-edit-title")&&(i.edit_title=false);i.print&&s.data("exclude-print")&&(i.print=false);i.create_public_link&&s.data("exclude-create-public-link")&&(i.create_public_link=false);i.revoke_public_link&&s.data("exclude-revoke-public-link")&&(i.revoke_public_link=false);i.star=true;i.open_in_flexpane=true;s.data("include-open-file-page")&&(i.open_file_page=true);s.data("include-view-public-link")&&(i.view_public_link=true);var o=a.closest(".file_list_item").length>0;if(o){"details"!==TS.model.ui_state.flex_name&&(i.share=false);TS.menu.file.file_list_menu_up=true}var l=a.closest(".inline_file_preview_container, .file_container");if(l.length>0){l.addClass("file_menu_open");i.new_window=false}TS.menu.$menu_header.addClass("hidden").empty();var u=false;(i.edit||TS.client&&i.edit_title||i.create_public_link||i.revoke_public_link||i.print||i.save_to_dropbox||i.refresh)&&(u=true);var d={file:r,actions:i,is_refreshing:TS.files.waiting_for_refresh[r.id],model_ob:TS.shared.legacyGetActiveModelOb(),show_workflow_divider:u,external_file_author:TS.files.isFileAuthorExternal(r)};if(TS.model.unread_view_is_showing){d.source_model_ob_id=a.closest(".unread_group").data("modelId");d.source_model_ob_id&&(d.model_ob=TS.redux.channels.getEntityById(d.source_model_ob_id))}TS.client&&(d.info_pane_visible="details"===TS.model.ui_state.flex_name);TS.menu.$menu_items.html(TS.templates.menu_file_action_items(d));TS.boot_data.feature_fix_files&&TS.menu.$menu.addClass("no_icons");TS.web?TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickWeb):TS.client&&TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickClient);TS.menu.start(t);a.closest(".file_list_item").addClass("active");TS.menu.positionAt(a,-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},onFileActionClickClient:function e(t){var n=$(this).attr("id");var r=$(this).data("rxn-key");var a=TS.files.getFileById($(this).data("file-id"));var s=TS.shared.legacyGetActiveModelOb();var o=$(this).data("sourceModelId");TS.model.unread_view_is_showing&&o&&(s=TS.redux.channels.getEntityById(o));if(!a){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===n){t.preventDefault();i();TS.view.files.shareInCurrentChannelOrIM(a.id,o)}else if("edit_file_snippet"===n){if(!a.is_truncated){t.preventDefault();TS.ui.snippet_dialog.startEdit(a.id)}}else if("edit_file_post"===n);else if("edit_file_space"===n||"open_new_window"===n)TS.client.windows.openFileWindow(a.id)&&t.preventDefault();else if("edit_file_arugula"===n);else if("edit_file_title"===n){t.preventDefault();if(TS.boot_data.feature_file_threads)TS.redux.dispatch(TS.interop.redux.actions.openRenameFileDialog({file:a}));else{TS.client.ui.files.previewFile(a.id,"file_list");TS.files.editFileTitle(a.id)}}else if("delete_file"===n){t.preventDefault();TS.view.files.delete(a.id)}else if("create_public_link"===n){t.preventDefault();if(TS.prefs.getTeamPref("disallow_public_file_urls")){var l;l=TS.boot_data.feature_external_files?TS.interop.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")():TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(l);return}TS.files.createPublicURL(a,function(e,t){if(e){TS.model.previewed_file_id&&$("#file_preview_scroller").find(".file_actions_link").scrollintoview({duration:500,offset:"top",px_offset:-50});$(".file_public_link_"+a.id).highlightText();TS.ui.file_share.fileShowPublicUrlDialog(t.file)}})}else if("revoke_public_link"===n){t.preventDefault();TS.ui.file_share.fileRevokePublicLink(a.id)}else if("view_public_link"===n){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(a)}else{if("refresh_file"===n){t.preventDefault();TS.files.refreshFile(a.id);TS.menu.$menu.find("#refresh_file .item_label").text(TS.interop.i18n.t("Refreshing...","menu_file")()).end();return}if("download_file"===n){var u=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);TS.client&&TS.client.downloads.startDownload(a,u)&&t.preventDefault()}else if("open_original_file"===n);else if("comment_file"===n){t.preventDefault();TS.model.previewed_file_id!=a.id?TS.client.ui.files.previewFile(a.id,"file_list",false,true):TS.utility.contenteditable.focus($("#file_comment"))}else{if("save_to_dropbox"===n){var d=function e(t,n){t&&Dropbox.save(n.url,a.name)};return TS.interop.api.callExpedited("files.getTempURL",{file:a.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d(i,t,n,r);return{data:t,args:n,request_id:r}})}if("rxn_file"===n){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:r})}else if("share_private_file"===n){t.preventDefault();i();TS.ui.share_dialog.start(a.id)}else if("pin_file"===n&&s){t.preventDefault();TS.pins.startPinFile(a.id,s)}else if("unpin_file"===n&&s){t.preventDefault();TS.pins.unPinFile(a.id,s)}else if("open_in_flexpane"===n){t.preventDefault();i();TS.client.ui.files.previewFile(a.id)}else if("copy_file_link"===n){t.preventDefault();TS.clipboard.writeText(a.permalink);var c=TS.interop.members.getMemberById(a.user);var _={};if(c&&c.is_bot){var m=c.profile.bot_id;var f=TS.interop.bots.getBotById(m);_.app_id=f?f.app_id:"";_.bot_id=m}TS.interop.clog.track("MSG_LINK_COPY",_)}else{if("star_file"!==n){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}t.preventDefault();TS.stars.checkForStarClick(t)}}}TS.menu.file.end()},onFileActionClickWeb:function e(t){var n=$(this).attr("id");var r=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.legacyGetActiveModelOb();if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===n){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("share_private_file"===n){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("edit_file_snippet"===n);else if("edit_file_post"===n);else if("edit_file_space"===n||"open_new_window"===n);else if("edit_file_title"===n);else if("delete_file"===n){t.preventDefault();TS.web.file.deleteFile(i.id)}else if("create_public_link"===n){t.preventDefault();if(!TS.prefs.getTeamPref("disallow_public_file_urls")){var s=function e(t,n){if(t){var r=$(".file_public_link_shared");r.slideToggle(100);TS.files.upsertAndSignal({id:i.id,public_url_shared:true},"createPublicLink");0===r.length&&TS.ui.file_share.fileShowPublicUrlDialog(i)}else if(n.error&&"not_allowed"===n.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);var a;a=TS.boot_data.feature_external_files?TS.interop.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")():TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(a)}};TS.interop.api.callExpedited("files.sharedPublicURL",{file:i.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}}else if("revoke_public_link"===n){t.preventDefault();TS.web.file?TS.web.file.revokePublicURL(i):TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===n){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else{if("refresh_file"===n){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text("Refreshing...").end();return}if("download_file"===n);else if("print_file"===n){window.print();t.preventDefault()}else if("open_original_file"===n);else if("comment_file"===n){t.preventDefault();TS.utility.contenteditable.focus($("#file_comment"))}else{if("save_to_dropbox"===n){var o=function e(t,n){t&&Dropbox.save(n.url,i.name)};return TS.interop.api.callExpedited("files.getTempURL",{file:i.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})}if("rxn_file"===n){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:r})}else if("pin_file"===n&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===n&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("copy_file_link"===n){t.preventDefault();TS.clipboard.writeText(i.permalink)}else if("open_file_page"!==n){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}}}TS.menu.file.end()},clean:function e(){TS.menu.clean()},end:function e(){TS.menu.end()}});var e=$('[data-js="primary_file_button"]');var t=e.find(".ts_icon_plus_thick");var n;var r;var i=function e(){if(!TS.ui.fs_modal.isShowing())return;var t=true;TS.ui.fs_modal.close(t)}})()},2922:function(e,t){(function(){TS.registerModule("menu.group",{onStart:function e(){},group:null,startWithGroup:function t(n,r){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;TS.model.menu_is_showing||(e=void 0);TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.group.group=TS.interop.channels.getGroupById(r);var i=TS.menu.group.group;TS.menu.$menu_header.addClass("hidden").empty();var a={group:i,user:TS.model.user,leave_action:TS.interop.rules.channels.getLeaveAction(TS.redux.getState(),i),show_export_history:TS.permissions.members.canExportMessageHistory(i)};0!==i.purpose.last_set||TS.model.user.is_ultra_restricted||(a.show_purpose_item=true);TS.notifs.isCorGMuted(i.id)&&(a.group_is_muted=true);a.show_advanced_item=true;if(TS.boot_data.page_needs_enterprise){var s=TS.permissions.members.canCreateConvertOrgSharedChannels();s?a.show_advanced_item=true:i.creator!==TS.model.user.id&&i.is_org_shared&&(a.show_advanced_item=false)}TS.permissions.channels.canSeeDataRetentionChannelOption(i)&&(a.show_message_retention=true);TS.apps.permissions.areXoxaAppsInstalled()&&(a.show_add_apps=true);TS.menu.$menu_items.html(TS.templates.menu_group_items(a));TS.menu.$menu_header.bind("click.menu",TS.menu.group.onGroupHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.group.onGroupItemClick);TS.menu.start(n);TS.menu.$menu.attr("data-qa","group_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();$("#menu_group_topic_input").bind("keydown",TS.menu.handleTopicKeydown);var o="#channel_name";var l="#channel_actions_toggle";e||(e=$(n.target).closest(o).length);var u=e?$(o):$(l);var d=u.height();var c=e?d+6:d;var _=18;var m=e?_:6;TS.menu.positionAt(u,m,c)},onGroupHeaderClick:function e(t){t.preventDefault()},onGroupItemClick:function e(t){var n=$(this).attr("id");if($(this).hasClass("disabled")){TS.menu.end();return}if("group_display_item"===n){t.preventDefault();TS.groups.legacyDisplayGroup({id:TS.menu.group.group.id})}else if("group_details_item"===n){t.preventDefault();TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name?$("#details_tab").highlight(null,"channel_page_details_highlighter"):TS.client.ui.flex.openFlexTab("details")}else if("group_star_item"===n){t.preventDefault();TS.stars.checkForStarClick(t)}else if("group_mute_item"===n){t.preventDefault();TS.notifs.muteOrUnmuteCorG(TS.menu.group.group.id)}else if("group_email_item"===n);else if("group_files_item"===n){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var r="in:"+TS.shared.legacyGetActiveModelOb().name+" ";TS.search.setInputVal(r)}else if("group_leave_item"===n){t.preventDefault();TS.channels.leave(TS.menu.group.group.id)}else if("group_unarchive_item"===n){t.preventDefault();TS.interop.api.call("conversations.unarchive",{channel:TS.menu.group.group.id})}else if("group_archives_item"===n);else{if("group_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);return}if("group_advanced_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id)}else if("group_convert_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"manage_teams")}else if("group_invite_item"===n){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.group.group.id)}else if("group_prefs"===n){t.preventDefault();TS.ui.channel_prefs_dialog.start(TS.menu.group.group.id)}else if("group_message_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"retention")}else if("group_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"export")}else if("group_add_service_item"===n);else{if("group_add_apps_item"!==n){TS.warn("not sure what to do with clicked element id:"+n);return}t.preventDefault();var i="CHANNEL_SETTINGS";var a={action:"CLICK",ui_element:"BTN_ADD_APPS"};TS.interop.clog.track(i,{contexts:{ui_context:a}});TS.ui.apps_browser.startAddApps(i,a)}}TS.menu.end()}});var e})()},2923:function(e,t){(function(){TS.registerModule("menu.member",{member:null,member_item_click_sig:new signals.Signal,onStart:function n(){e=new TS.PresenceList;t=TS.interop.mountToast},startWithMember:function t(s,l,u,d,c){if(TS.menu.isRedundantClick(s))return;if(TS.client.ui.checkForEditing(s))return;TS.model.menu_is_showing||(n=void 0);TS.menu.buildIfNeeded();TS.menu.member.member=TS.interop.members.getMemberById(l);var m=TS.menu.member.member;if(!m)return;if(!TS.permissions.members.canUserSeeMember(m))return;if((m.is_bot||m.is_app_user)&&_.get(m.profile,"bot_id")){var f=TS.interop.bots.getTeamIdFromBotAppUser(m,TS.boot_data.team_id);return TS.menu.app.startWithApp(s,_.get(m.profile,"bot_id"),f,false,false,c,l)}TS.menu.clean();e.add(l);TS.menu.menu_closed_sig.addOnce(function(){e.clear()});var p=r(m,{is_header_menu:d,is_im_menu:c});TS.boot_data.feature_tinyspeck&&(p.user_mc_url=o(m));if(p.channel_kick_name&&p.channel_kick_hidden){var h=TS.shared.legacyGetActiveModelOb();TS.interop.membership.ensureChannelMembershipIsKnownForUsers(h.id,[m.id]).then(function(){if(!TS.model.menu_is_showing)return;if(TS.menu.last_e!==s)return;var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(h.id,m.id);e.is_member&&TS.menu.$menu_items.find("#member_kick_channel_item").removeClass("hidden")})}if(c)TS.menu.$menu_header.addClass("hidden").empty();else{TS.menu.$menu_header.html(TS.templates.menu_member_header(p));TS.client.flex_pane.startLocalTimeInterval()}m.is_stranger&&!TS.redux.channels.getImByMemberId(m.id)||TS.menu.$menu_items.html(TS.templates.menu_member_items(p));c||m.deleted||TS.interop.clog.track("USER_CARD_DISPLAY",{});if(l==TS.model.user.id){var g="";c||(g+=TS.templates.menu_member_footer({member:m}));TS.menu.$menu_footer.html(g)}else c||TS.menu.$menu_footer.html(TS.templates.menu_member_footer({member:m}));TS.menu.start(s,u,{menu_class:"member_menu"});var S=false;var T=$("#menu_member_dm_input");var v=TS.interop.members.getPrefCompliantMemberName(m,true);var b=TS.interop.i18n.t("Message {name}","menu")({name:TS.interop.i18n.safeString(v)});TS.utility.contenteditable.create(T,{modules:{tabcomplete:{completers:["channels","emoji","members"],positionMenu:function e(t){t.style.width=T.outerWidth()+"px";t.style.minWidth="0";TS.tabcomplete.positionUIRelativeToInput(t,T)}}},enableBroadcastKeywords:false,singleLineInput:true,onEnter:function e(t){var n=_.trim(TS.utility.contenteditable.value(T));if(!_.keys(t).length&&!S&&n.length){TS.ims.legacyStartImByMemberId(m.id,false,n);TS.menu.member.end();S=true;TS.interop.clog.track("USER_CARD_DM",{})}return false},onEscape:function e(){TS.menu.end()},placeholder:b,ariaLabel:b.replace(/&#39;/g,"'")});TS.utility.contenteditable.enable(T);m.is_self&&TS.menu.$menu_header.find(".member_timezone_value a").on("click.timezone",function(e){e.preventDefault();TS.menu.member.end()});TS.menu.$menu_header.bind("click.menu",i);TS.menu.$menu_items.on("click.menu","li",a);TS.kb_nav.setSubmitItemHandler(a);if(c){var y="#channel_name";var w="#channel_actions_toggle";n||(n=$(s.target).closest(y).length);var k=n?$(y):$(w);var x=k.height();var C=n?x+6:x;var I=18;var M=n?I:6;TS.menu.positionAt(k,M,C);TS.menu.$menu.attr("data-qa","member_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs()}c||TS.menu.keepInBounds()},startWithMemberPreview:function e(t,n,r,i){if(TS.menu.isRedundantClick(t))return;if(TS.client&&TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var s=$(t.target).closest(".member_preview_menu_target");n||(n=s.closest("[data-member-id]").data("member-id"));TS.menu.member.member=TS.interop.members.getMemberById(n);var l=TS.menu.member.member;var u=TS.redux.channels.getImByMemberId(n);var d={member:l,is_team_directory:true,im_id:u&&u.id,hide_view_profile:i,show_user_id:true,can_write_to_clipboard:TS.clipboard.canWriteText(),member_is_self:l.is_self};TS.boot_data.feature_tinyspeck&&(d.user_mc_url=o(l));TS.menu.$menu_header.addClass("hidden").empty();if(!l.deleted&&!TS.interop.rules.members.isSlackbotOrTeambot(l,TS.boot_data.feature_teambot)&&n!=TS.model.user.id&&!TS.interop.members.isExternal(l)){TS.model.user.is_ultra_restricted||l.is_ultra_restricted||(d.show_channel_invite=true);if(TS.boot_data.page_needs_enterprise){var c=TS.model.team;c&&c.id!==l.team_id&&(d.show_call_action=false)}}if(r)TS.menu.$menu_items.html(TS.templates.menu_member_items_short(d));else{TS.menu.$menu_items.html(TS.templates.menu_member_items(d));TS.menu.$menu_items.on("click.menu","li",{is_member_preview:i},a)}TS.menu.start(t,null,{menu_class:"member_menu"});TS.kb_nav.setSubmitItemHandler(a);var _=s.outerWidth()-TS.menu.$menu.width()-1;TS.menu.positionAt(s,_,s.outerHeight()+5);TS.menu.keepInBounds()},startWithEditMemberProfilePhotoActions:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var r=true===TS.model.user.profile.is_custom_image;var i=$(t.target);var a=i.is(".btn");var s={show_delete:r&&!a,is_iOS:TS.model.is_iOS};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_edit_member_profile_photo_action_items(s));TS.menu.$menu_items.on("click.menu","li",n);TS.menu.start(t,null,{menu_class:"member_menu"});a?TS.menu.positionAt(i,0,i.outerHeight()+5):TS.menu.positionAt(i.closest('[data-action="edit_member_profile_photo_menu"]'),36,156);TS.menu.keepInBounds()},startWithEnterpriseMemberHeader:function e(t){var n=15;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var r={enterprise_name:$("[data-enterprise-name]").val(),signout_url:TS.boot_data.signout_url};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_enterprise_member_header(r));TS.menu.$menu_items.on("click.menu","li",s);TS.kb_nav.setSubmitItemHandler(s);TS.menu.start(t,null,{menu_class:"member_menu"});var i=$("[data-header-menu-toggle]");var a=-TS.menu.$menu.outerWidth()+i.outerWidth();var o=i.outerHeight()+n;TS.menu.positionAt(i,a,o);t.preventDefault()},end:function e(){TS.menu.member.member=null;TS.menu.end();TS.menu.clean()},test:function e(){var e={};Object.defineProperty(e,"_getTemplateArguments",{get:function e(){return r},set:function e(t){r=t}});return e}});var e;var t;var n;var r=function e(t,n){n=n||{};var r={member:t,show_dm_item:!n.is_im_menu,is_im_menu:n.is_im_menu,show_admin_info:t.is_admin&&t.team_id===TS.model.user.team_id,can_write_to_clipboard:TS.clipboard.canWriteText(),member_is_self:t.is_self};if(n.is_im_menu){var i=TS.redux.channels.getImByMemberId(t.id);r.im=i;!TS.apps.permissions.areXoxaAppsInstalled()||TS.interop.rules.channels.isSlackbotOrTeambot(i,TS.boot_data.feature_teambot)||t.deleted||(r.show_add_apps=true)}if(n.is_header_menu&&t.id===TS.model.user.id){r.other_accounts=TS.boot_data.other_accounts;r.logout_url=TS.boot_data.logout_url;r.signin_url=TS.boot_data.signin_url}t.deleted||TS.interop.rules.members.isSlackbotOrTeambot(t,TS.boot_data.feature_teambot)||t.id===TS.model.user.id||TS.interop.members.isExternal(t)||TS.model.user.is_ultra_restricted||t.is_ultra_restricted||(r.show_channel_invite=true);var a=TS.shared.legacyGetActiveModelOb();if(TS.permissions.channels.canMemberBeRemovedFromChannel(a,t)){var s=TS.interop.membership.getCachedChannelMembershipInfoForUser(a.id,t.id);var o={show_tooltip:false,inherit_font_size:true};if(s.is_known)s.is_member&&(r.channel_kick_name=new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(a,o)));else{r.channel_kick_name=new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(a,o));r.channel_kick_hidden=true}}if("USLACKBOT"===t.id&&!TS.boot_data.feature_teambot){var l=false;TS.model.user.is_admin?l=true:TS.prefs.getTeamPref("slackbot_responses_disabled")||TS.prefs.getTeamPref("slackbot_responses_only_admins")||(l=true);r.show_slackbot_responses_item=l}if("UTEAMSBOT"===t.id&&TS.boot_data.feature_teambot){var u=1532380126;var d=u+2592e3;var c=Math.floor(Date.now()/1e3);var _=false;var m=false;var f=true;TS.model.user.is_restricted||(TS.model.user.is_admin?_=true:TS.prefs.getTeamPref("slackbot_responses_disabled")||TS.prefs.getTeamPref("slackbot_responses_only_admins")?!TS.prefs.getTeamPref("slackbot_responses_disabled")&&TS.prefs.getTeamPref("slackbot_responses_only_admins")&&(m=true):_=true);r.show_slackbot_responses_create_item=_;r.show_slackbot_responses_view_item=m;r.dont_view_files_teambot=true;r.teambot_learn_more=true;var p=false;var h=false;TS.model.user.created<u&&c<d?p=true:h=true;r.teambot_profile_info_new=p;r.teambot_profile_info=h;r.member_teambot=f}if(TS.utility.calls.isEnabled()&&!t.is_bot&&!TS.interop.rules.members.isSlackbotOrTeambot(t,TS.boot_data.feature_teambot)){r.show_call_action=true;t.is_stranger&&(r.show_call_action=false)}TS.permissions.channels.canSeeDataRetentionChannelOption(a)&&(r.show_dm_retention=true);r.show_export_history=TS.permissions.members.canExportMessageHistory(a);return r};var i=function e(t){t.preventDefault();TS.client.ui.previewMember(TS.menu.member.member.id,"menu_member_header");TS.interop.clog.track("USER_CARD_CLICK");TS.menu.member.end()};var a=function e(t){var n=$(this).attr("id");clearTimeout(TS.menu.end_time);if("member_photo_item"===n);else if("member_details_item"===n){t.preventDefault();TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name?$("#details_tab").highlight(null,"channel_page_details_highlighter"):TS.client.ui.flex.openFlexTab("details")}else if("member_dm_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.legacyGetActiveModelOb().id,"retention")}else if("member_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.legacyGetActiveModelOb().id,"export")}else if("member_archives_item"===n);else{if("member_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);TS.menu.member.member_item_click_sig.dispatch(n);return}if("member_star_item"===n){t.preventDefault();TS.stars.checkForStarClick(t)}else if("member_email_item"===n);else if("member_skype_item"===n);else if("member_account_item"===n);else if("member_prefs_item"===n){t.preventDefault();TS.generic_dialog.is_showing&&TS.generic_dialog.cancel();TS.ui.prefs_dialog.start()}else if("member_files_item"===n){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(TS.menu.member.member.id)}else if("member_im_files_item"===n){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var r="in:"+TS.shared.legacyGetActiveModelOb().name+" ";TS.search.setInputVal(r)}else if("member_dm_item"===n){t.preventDefault();TS.ims.legacyStartImByMemberId(TS.menu.member.member.id)}else if("member_invite_channel_item"===n){t.preventDefault();if(TS.client.channel_page.members_dialog.isShowing()){var i=TS.generic_dialog.current_setting;TS.generic_dialog.cancel()}TS.ui.invite.showInviteMemberToChannelDialog(TS.menu.member.member.id);i&&TS.generic_dialog.start(i)}else if("member_create_group_item"===n){t.preventDefault();TS.ui.new_channel_modal.start("",false,[TS.menu.member.member.id])}else if("member_profile_item"===n){t.preventDefault();if(TS.menu.member.member.is_self){TS.generic_dialog.is_showing&&TS.generic_dialog.cancel();TS.ui.edit_member_profile.start()}else TS.client.ui.previewMember(TS.menu.member.member.id)}else{if("member_presence"===n){t.preventDefault();TS.redux.presence.toggleUserPresence();TS.menu.end_time=setTimeout(function(){TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(n)},1e3);return}if("logout"===n){t.preventDefault();TS.client&&TS.client.windows.closeAll();TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url)}else if($(this).hasClass("switch_team")){t.preventDefault();var a=$(this).data("team-id");if(TS.interop.desktop.isDesktop){TS.interop.desktop.displayTeam(a);t.preventDefault()}else{var s=$(this).find("a").attr("href");s&&-1==s.indexOf("?")&&$(this).find("a").attr("href",s+="?"+TS.getQsArgsForUrl())}}else if("member_kick_channel_item"===n){t.preventDefault();TS.client.channel_page.members_dialog.isShowing()&&TS.generic_dialog.cancel();TS.model.active_channel_id?TS.channels.legacyKickMember(TS.model.active_channel_id,TS.menu.member.member.id):TS.model.active_group_id&&TS.groups.kickMember(TS.model.active_group_id,TS.menu.member.member.id)}else if("member_slackbot_responses"===n);else if("member_call_item"===n)TS.utility.calls.startCallInModelOb(TS.menu.member.member);else if("member_add_apps_item"===n){t.preventDefault();var o="CHANNEL_SETTINGS";var u={action:"CLICK",ui_element:"BTN_ADD_APPS"};TS.interop.clog.track(o,{contexts:{ui_context:u}});TS.ui.apps_browser.startAddApps(o,u)}else if("member_copy_id"===n)TS.clipboard.canWriteText()&&TS.clipboard.writeText(TS.menu.member.member.id);else if("member_copy_profile_url"===n){var d=TS.interop.enterprise.getOrgURL()+"user/@"+TS.menu.member.member.id;TS.clipboard.canWriteText()&&TS.clipboard.writeText(d);l()}else if("member_mc_link"!==n){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}}}t.data&&t.data.is_member_preview?TS.interop.clog.track("USER_PROFILE_CLICK"):TS.interop.clog.track("USER_CARD_CLICK");TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(n)};var s=function e(t){var n=$(this).attr("id");if("sign_out"===n)return;if("view_account"===n)return;t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n)};var o=function e(t){return"https://"+window.location.host+"/god/user.php?id="+t.id+"&team_id="+t.team_id};var l=function e(){var n;n=TS.boot_data.feature_enterprise_dm_deeplink?TS.interop.i18n.t("Copied to clipboard!","menu")():"Copied to clipboard!";t({children:n,icon:"check_circle_o",iconClassName:"sk_seafoam_green"})}})()},2924:function(e,t){(function(){TS.registerModule("inline_attachments",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,shouldExpand:function e(t,n){if(TS.model.expandable_state["attach_"+t+n.from_url])return true;if(false===TS.model.expandable_state["attach_"+t+n.from_url])return false;return true},legacyShouldShow:function e(t,n){if(t.is_share)return true;if(n&&"reply_broadcast"===n.subtype)return true;if("twitter"===t.service_name&&"bot_message"===n.subtype)return true;if(!t.from_url)return true;if(n.standalone_attachment)return true;if(n&&n.text&&-1==n.text.indexOf(t.from_url)){if(!TS.model.ampersands_are_inconsistent_in_from_urls)return true;if(-1==n.text.indexOf(t.from_url.replace(/&/g,"&amp;")))return true}if(TS.prefs.getPref("expand_inline_imgs")){if(t.audio_html)return true;if(t.other_html)return true;if(t.video_html)return true;if(t.image_url)return true;if(t.service_name&&"twitter"===t.service_name.toString().toLowerCase())return true}return!!TS.prefs.getPref("expand_non_media_attachments")},expandAllInCurrent:function e(){TS.inline_attachments.no_scrolling=true;$(".msg_inline_attachment_expander").trigger("click");TS.inline_attachments.no_scrolling=false},collapseAllInCurrent:function e(){$(".msg_inline_attachment_collapser").trigger("click")},expand:function e(t,n){TS.model.expandable_state["attach_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==n};var o=i.find(".inline_attachment").filter(s);o.removeClass("hidden");i.find(".msg_inline_attachment_expander").filter(s).addClass("hidden");i.find(".msg_inline_attachment_collapser").filter(s).removeClass("hidden");o.css("opacity",0).stop().animate({opacity:1},300);TS.inline_attachments.no_scrolling||(TS.client&&a?i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"}):o.scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"}));TS.inline_attachments.expand_sig.dispatch(t)},collapse:function e(t,n){TS.model.expandable_state["attach_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=function e(){return $(this).data("real-src")==n};var s=i.find(".inline_attachment").filter(a);s.length||(s=i.find(".msg_inline_attachment_holder").filter(a));s.css("visibility","hidden");i.find(".msg_inline_attachment_expander").filter(a).removeClass("hidden");i.find(".msg_inline_attachment_collapser").filter(a).addClass("hidden");TS.inline_attachments.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineAttachmentClick:function e(t){if(!t.target)return;var n=$(t.target);var r;var i;var a=n.closest(".message");i=a.data("ts");r=a.attr("id");var s=n.closest(".msg_inline_attachment_expander");if(s.length){t.preventDefault();if(!r)return;TS.inline_attachments.expand(r,s.data("real-src"))}var o=n.closest(".msg_inline_attachment_collapser");if(o.length){t.preventDefault();if(!r)return;TS.inline_attachments.collapse(r,o.data("real-src"))}var l=n.closest(".rest_text_expander");if(l.length){t.preventDefault();var u=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var d=l.parent().find(".short_text");var c;var _=l.parent().find(".more_text");if(l.data("show-text")){if(_.length){_.addClass("hidden");c=l.find("a span");l.data("hide-text",c.text());c.text(l.data("show-text"));l.data("show-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_down").addClass("ts_icon_caret_right")}}else{var m=d.attr("data-all-text");if(m){d.html(m);d.data("all-text","")}_.length&&_.removeClass("hidden");if(_.length&&l.data("hide-text")){c=l.find("a span");l.data("show-text",c.text());c.text(l.data("hide-text"));l.data("hide-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_right").addClass("ts_icon_caret_down")}else l.css("display","none")}d.css("opacity",0).transition({opacity:1},300);TS.inline_attachments.rest_texts_expanded[l.attr("id")]=true;TS.client&&TS.ui.utility.updateClosestMonkeyScroller(d);TS.client&&u&&d.scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}var f=n.closest(".delete_attachment_link");if(f.length){t.preventDefault();var p=f.data("attachment-id").toString();var h=a.attr("data-model-ob-id");TS.inline_attachments.promptForDeletingAttachment(h,i,p)}},promptForDeletingAttachment:function e(t,n,r){var i=TS.redux.channels.getEntityById(t);if(!i){TS.warn("missing model_ob");return}if(!r){TS.warn("missing attachment-id");return}var a=i.id;var s=TS.utility.msgs.findMsg(n,t);if(!s){TS.error("Attachment removing failed: msg not found anywhere!");var o=TS.interop.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(o);return}var l="";if(TS.model.user.is_admin){var u=_.find(s.attachments,{id:r});if(u&&u.from_url){var d=TS.inline_attachments.makeBlackListSelect(u.from_url);var c=TS.interop.i18n.t("Disable future attachments from this website?","inline_attachments")();l='<p class="large_left_margin '+(d&&"no_bottom_margin")+'">';l+='<label class="checkbox normal" style="font-size: 16px;">';l+='<input id="attachment_blacklist_cb" type="checkbox" class="small_right_margin" />';l+=c;l+="</label>";d&&(l+=d);l+="</p>"}}var m=TS.interop.i18n.t("Are you sure you wish to remove this attachment from the message?","inline_attachments")();var f='<p class="'+(l?"small_bottom_margin":"")+'">'+m+"</p>"+l;TS.generic_dialog.start({title:TS.interop.i18n.t("Remove attachment","inline_attachments")(),body:f,go_button_text:TS.interop.i18n.t("Yes, remove","inline_attachments")(),onShow:function e(){$("#attachment_blacklist_cb").bind("change",function(){var e=!!$("#attachment_blacklist_cb").prop("checked");e?$("#attachment_blacklist_select").prop("disabled",false):$("#attachment_blacklist_select").prop("disabled",true)})},onGo:function e(){if(s.is_ephemeral){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,r);TS.utility.msgs.replaceMsg(i,s,false,true)}else{var t=!!$("#attachment_blacklist_cb").prop("checked");var o=t?$("#attachment_blacklist_select").val():"none";var l=t?$("#attachment_blacklist_select").find(":selected").data("url"):"";var u={channel:a,ts:n,attachment:r,blacklist_type:o,blacklist_url:l};TS.dir(0,u);var d=function e(t){if(t){if(TS.web){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,r);TS.utility.msgs.replaceMsg(i,s)}}else{var n;n=TS.boot_data.feature_attachment_removing_failed?{title:TS.interop.i18n.t("Couldn't remove attachment","inline_attachments")(),body:TS.interop.i18n.t("Only Org Admins can remove attachments from a shared channel.","inline_attachments")(),cancel_button_text:TS.interop.i18n.t("Close","inline_attachments")(),go_button_text:TS.interop.i18n.t("View {orgName} admins","inline_attachments")({orgName:TS.model.team.name}),onGo:function e(){TS.client.ui.showTeamList("admins")}}:{body:TS.interop.i18n.t("Attachment removing failed!","inline_attachments")()};TS.generic_dialog.start(n)}};TS.interop.api.call("chat.deleteAttachment",u).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d(i,t,n,r);return{data:t,args:n,request_id:r}})}}})},makeBlackListSelect:function e(t){if(!t)return"";t=_.escape(t).replace("https://","").replace("http://","");var n="";var r=t.split("/");var i=r[0];var a=r[r.length-1];var s=TS.interop.i18n.t("All links from {host}","inline_attachments")({host:i});var o=TS.interop.i18n.t("Just the link {url}","inline_attachments")({url:t});n+='<label class="select small full_width">\r';n+='<select id="attachment_blacklist_select" disabled="disabled" class="small" style="margin-bottom: 4px;">\r';n+='<option value="all" data-url="'+i+'">'+s+"</option>\r";n+='<option value="just" data-url="'+t+'">'+o+"</option>\r";if(a!=i){TS.info(a);var l=r.concat();l.length-=1;var u=l.join("/");if(u!=i){u+="/";var d=TS.interop.i18n.t("All links under {host_path}","inline_attachments")({host_path:u});n+='<option value="under" data-url="'+u+'">'+d+"</option>\r"}}n+="</select>\r";n+="</label>\r";return n},rest_texts_expanded:{},shouldExpandText:function e(t){return!!TS.inline_attachments.rest_texts_expanded[t]},renderStandaloneAttachment:function e(t){TS.inline_attachments.massageAttachment(t,0);if(t.image_url&&!TS.model.inline_imgs[t.from_url]){t.from_url||(t.from_url=t.image_url);TS.inline_imgs.makeInternalInlineImg(t.from_url,{link_url:t.from_url,bytes:t.image_bytes,src:t.image_url,width:isNaN(t.image_width)?null:t.image_width,height:isNaN(t.image_height)?null:t.image_height,should_expand:true})}t.video_html&&!TS.model.inline_videos[t.from_url]&&TS.inline_videos.makeInternalInlineVideo(t.from_url,{src:t.thumb_url,html:t.video_html,proxied_src:t.proxied_thumb_url,title:t.title,display_h:t.video_html_height,display_w:t.video_html_width,thumbnail:{link_url:t.from_url,url:t.thumb_url,height:t.thumb_height,width:t.thumb_width}});var n=TS.interop.datetime.makeTsStamp();var r=TS.templates.builders.buildAttachmentHTML({attachment:t,msg:{enable_slack_action_links:false,text:t.from_url,ts:n,url:t.from_url,standalone_attachment:t.standalone_attachment||false},can_delete:false,maybe_show_file_viewer:false,has_content:TS.utility.attachments.hasContent(t),from_post:true,model_ob:TS.redux.channels.getEntityById(t.channel_id)});var i=TS.templates.makeMsgDomId(n);return'<div class="message standalone-attachment" id="'+i+'" data-ts="'+n+'">'+r+"</div>"},massageAttachment:function e(t,n){t._index=n;"id"in t&&(t.id=t.id.toString());t.text&&(t._short_text=TS.inline_attachments.legacyTruncateAttachmentText(t.text));t._floated_thumb_display_height=75;t._floated_thumb_display_width=75;t.thumb_height&&t.thumb_width&&(t.thumb_height>t.thumb_width?t._floated_thumb_display_width=parseInt(t.thumb_width*(t._floated_thumb_display_height/t.thumb_height),10):t._floated_thumb_display_height=parseInt(t.thumb_height*(t._floated_thumb_display_width/t.thumb_width),10));var r=TS.utility.getImgProxyURL(t.thumb_url,t._floated_thumb_display_width,t._floated_thumb_display_height);r!=t.thumb_url?t.proxied_thumb_url=r:delete t.proxied_thumb_url},legacyTruncateAttachmentText:function e(t){var n=500;var r=3;var i="";var a=0;var s="";var o="";var l="";var u;var d=0;var c=false;for(var _=0;_<t.length;_+=1){u=t.charAt(_);if(o||"<"===u){o+=u;(l||"|"===u)&&(l+=u);if(">"===u){i+=o;a+=l.length-2;a>n&&(c=true);o="";l=""}}else{"\n"===u&&(d+=1);if(d>r+1){s=t.replace(i,"");break}i+=u;a+=1;a>n&&(c=true);if(c&&" "===u){s=t.replace(i,"");break}}}var m=i.trim()==t.trim()?"":i;var f=i.match(/```/g);var p=s.match(/```/g);f&&p&&(m+="```");return m},getAttachmentByFromUrl:function e(t,n){if(!t)return null;for(var r=0;r<t.length;r+=1){if(!t[r]){TS.info(n);TS.dir(0,t);continue}if(!t[r].from_url)continue;if(t[r].from_url==n)return t[r];if(TS.model.ampersands_are_inconsistent_in_from_urls&&t[r].from_url.replace(/&/g,"&amp;")==n)return t[r]}return null},getAttachmentBySlackFileId:function e(t,n){if(!t)return null;if(!n)return null;for(var r=0;r<t.length;r+=1){if(!t[r])continue;if(t[r].slack_file_id==n)return t[r]}return null},removeAttachmentById:function e(t,n){if(!t)return null;var r=[];for(var i=0;i<t.length;i+=1)t[i].id!=n&&r.push(t[i]);return r}})})()},2925:function(e,t){(function(){TS.registerModule("inline_others",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){},shouldExpand:function e(t,n){if(TS.model.expandable_state["vid_"+t+n.src])return true;if(false===TS.model.expandable_state["vid_"+t+n.src])return false;if(n.internal_file_id)return TS.prefs.getPref("expand_internal_inline_imgs");return TS.prefs.getPref("expand_inline_imgs")},expandAllInCurrent:function e(){var t=$(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)");if(!t.length)return;TS.inline_others.no_scrolling=true;t.trigger("click");TS.inline_others.no_scrolling=false},collapseAllInCurrent:function e(){$(".msg_inline_media_toggler[data-media-type=other].expanded").trigger("click")},expand:function e(t,n){TS.model.expandable_state["vid_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==n};var o=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(s):null;o&&o.length||(o=i.find(".msg_inline_other_holder").filter(s));o.removeClass("hidden");i.find(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)").filter(s).addClass("expanded");TS.client&&TS.client.ui.checkInlineImgsAndIframesEverywhere();o.css("opacity",0).stop().animate({opacity:1},300);TS.inline_others.no_scrolling||(TS.client&&a?i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"}):i.find(".msg_inline_other").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"}));TS.inline_others.expand_sig.dispatch(t);TS.client&&TS.client.ui.checkInlineImgsAndIframesEverywhere()},collapse:function e(t,n){TS.model.expandable_state["vid_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=function e(){return $(this).data("real-src")==n};var s=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(a):null;s&&s.length||(s=i.find(".msg_inline_other_holder").filter(a));s.css("visibility","hidden");i.find(".msg_inline_media_toggler[data-media-type=other].expanded").filter(a).removeClass("expanded");s.find(".msg_inline_other_iframe_div").html("");TS.inline_others.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineOtherClick:function e(t){if(!t.target)return;var n=$(t.target);var r;var i=n.closest(".message");r=i.attr("id");if(!r)return;var a=n.closest(".msg_inline_media_toggler[data-media-type=other]");if(a.length){t.preventDefault();var s=a.data("real-src");a.hasClass("expanded")?TS.inline_others.collapse(r,s):TS.inline_others.expand(r,s)}},makeInternalInlineOther:function t(n){var r=400;var i=500;if(n.other_html_width>r){n.other_html_height=parseInt(n.other_html_height*(r/n.other_html_width),10);n.other_html_width=r}if(n.other_html_height>i){n.other_html_width=parseInt(n.other_html_width*(i/n.other_html_height),10);n.other_html_height=i}var a;n.google_map_config&&(a=TS.utility.parseJSONOrElse(n.google_map_config,void 0));if(a&&a.center&&"string"!==typeof a.center.lat){a.scrollwheel=false;var s="googmap_"+(e+=1);n.other_html='<div class="google-maps" id="'+s+'" style="width:100%; min-width:'+_.escape(n.other_html_width)+"px; height:"+_.escape(n.other_html_height)+'px;"></div>\t\t\t<script>TS.inline_others.runGoogleMapCode("'+s+"\", '"+JSON.stringify(a)+"')<\/script>";n.safe_other_html=n.other_html}else{if(-1==n.other_html.indexOf("oldwidth")){n.other_html=n.other_html.replace(" width=",' width="'+n.other_html_width+'" oldwidth=');n.other_html=n.other_html.replace(" height=",' height="'+n.other_html_height+'" oldheight=')}n.safe_other_html=n.other_html;n.safe_other_html=TS.utility.swapInRedirUrlForIframe(n.safe_other_html);n.safe_audio_html=TS.utility.setCssFromHeightAndWidthAttrs(n.safe_audio_html)}TS.model.inline_others[n.other_html]={src:_.escape(n.other_html),attachment:n}},runGoogleMapCode:function e(t,n){if(!window.google)return;if(!n)return;var r=JSON.parse(n);var i=new google.maps.Map(document.getElementById(t),r);if(!r.query)return;var a=new google.maps.Geocoder;var s="number"===typeof r.max_results?r.max_results:10;s<0&&(s=Number.MAX_VALUE);var o=function e(){google.maps.event.clearListeners(i,"bounds_changed");var t=i.getBounds();var n=0;var o=function e(t){new google.maps.Marker({map:i,position:t.geometry.location});n+=1};var l=function e(a,l){var u=false;l==google.maps.GeocoderStatus.OK?a.slice(0,s).forEach(function(e){o(e);u=u||!e.partial_match}):TS.warn("Geocoder failed due to: "+l);if(!u&&n<s){var d=new google.maps.places.PlacesService(i);var c=function e(t,r){r==google.maps.places.PlacesServiceStatus.OK?t.slice(0,s-n).map(o):TS.warn("PlacesService failed due to: "+r)};d.nearbySearch({bounds:t,name:r.query},c)}};a.geocode({address:r.query,bounds:t},l)};google.maps.event.addListener(i,"bounds_changed",o)}});var e=0})()},2926:function(e,t){(function(){TS.registerModule("ui.fs_modal",{is_showing:false,transition_duration:250,start:function s(l){if(TS.ui.fs_modal.is_showing){k(l);return}f=_.defaults({},l,p);TS.ui.fs_modal.is_showing=true;TS.tips.hideAll();h();f.modal_class&&e.addClass(f.modal_class);f.modal_bg_class&&t.addClass(f.modal_bg_class);f.modal_contents_container_class&&e.find(".contents_container").addClass(f.modal_contents_container_class);r=e.find(".contents");i=e.find("#fs_modal_sidebar");a=e.find("#fs_modal_header");o=e.find("#fs_modal_footer_content");var u;if(f.body_template_html){u=f.body_template_html;f.body&&TS.warn("Both body and body_template_html were passed in settings to TS.ui.fs_modal.start(). Using body_template.")}else u=TS.templates.fs_modal_generic_contents({settings:f,fs_modal_header:_.includes(f.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(f.modal_class,"fs_modal_footer")});r.html(u);f.header_html&&a.replaceWith(f.header_html);f.footer_html&&o.html(f.footer_html);f.sidebar_html&&i.html(f.sidebar_html);f.modal_gallery&&C();l.title&&e.attr("aria-label",l.title);!l.title&&a&&e.attr("aria-labelledby","fs_modal_header");TS.boot_data.feature_accessible_fs_dialogs&&$("#client-ui").attr("aria-hidden",true);e.on("click",".dialog_go",g);e.on("click",".dialog_secondary_go",S);e.on("click",".dialog_cancel",b);$(window.document).off(".fs_modal");$(window.document).on("keydown.fs_modal",T);$(window.document).on("focusin.fs_modal",v);n.on("click",function(){f.esc_for_ok?g():b()});$("html").addClass("fs_modal_active");setTimeout(function(){t&&t.addClass("active");e&&e.addClass("active")},0);e.find("input").length?e.find("input").first().focus():document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur();f.onShow&&f.onShow();if(f.onShowComplete||TS.model.is_our_app&&TS.interop.desktop.areDragRegionsRequired()){var d=false;var m=x();c=setTimeout(function(){d=true;I();f.onShowComplete&&f.onShowComplete();e.off(m+".fs_modal_show_complete")},600);e.one(m+".fs_modal_show_complete",function(){if(!d){I();clearTimeout(c);f.onShowComplete&&f.onShowComplete()}})}},close:function e(t){b(t)},bindBackButton:function e(t){$("#fs_modal_back_btn").off("click.fs_modal").on("click.fs_modal",t)},unbindBackButton:function e(){$("#fs_modal_back_btn").off("click.fs_modal")},showBackButton:function e(){$("#fs_modal_back_btn").removeClass("hidden")},hideBackButton:function e(){$("#fs_modal_back_btn").addClass("hidden")},activate:function n(){e.addClass("active");t.addClass("active")},deactivate:function n(){e.removeClass("active");t.removeClass("active")},setHeaderTitle:function t(n){if(!a.length)return;var r=TS.templates.fs_modal_header({title:n});a.replaceWith(r);a=e.find("#fs_modal_header")},showFooter:function t(){if(!s.length)return;e.addClass("fs_modal_footer");s.removeClass("hidden")},hideFooter:function t(){if(!s.length)return;e.removeClass("fs_modal_footer");s.addClass("hidden")},isShowing:function e(){return TS.ui.fs_modal.is_showing}});var e;var t;var n;var r;var i;var a;var s;var o;var l=0;var u=false;var d;var c;var m=".modal,[role=dialog]:not(.modal),[role=alertdialog]:not(.modal)";var f=null;var p={title:"",body:"",body_template_html:null,show_go_button:true,show_secondary_go_button:false,show_cancel_button:true,go_button_text:TS.interop.i18n.t("OK","fs_modal")(),go_button_class:"",secondary_go_button_text:TS.interop.i18n.t("OK 2","fs_modal")(),secondary_go_button_class:"",cancel_button_text:TS.interop.i18n.t("Cancel","fs_modal")(),disable_default_controls:false,disable_esc:false,onGo:null,onSecondaryGo:null,onCancel:null,onEnd:null,esc_for_ok:false,onShow:null,enter_always_gos:false,fullscreen:false,modal_class:null,modal_bg_class:null,modal_contents_container_class:null,modal_gallery:null,sidebar_html:null,header_html:null,footer_html:null,full_height_contents:false};var h=function l(){t=null;e=null;a=null;s=null;o=null;n=null;r=null;i=null;var u={settings:f,fs_modal_header:_.includes(f.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(f.modal_class,"fs_modal_footer"),fs_modal_sidebar:_.includes(f.modal_class,"fs_modal_sidebar"),disable_default_controls:f.disable_default_controls};var d=TS.templates.fs_modal(u);$("body").append(d);t=$("#fs_modal_bg");e=$("#fs_modal");a=$("#fs_modal_header");s=$("#fs_modal_footer");n=$("#fs_modal_close_btn")};var g=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}f.onGo?false!==f.onGo()&&b():b()};var S=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}f.onSecondaryGo?false!==f.onSecondaryGo()&&b():b()};var T=function e(t){if(t.which!=TS.utility.keymap.enter||"BODY"!==TS.utility.getActiveElementProp("NODENAME")&&!f.enter_always_gos){if(t.which==TS.utility.keymap.esc){if(f.disable_esc)return;if(f.esc_for_ok)g();else{b();f.clog_name&&TS.interop.clog.track(f.clog_name+"_ACTION",{action:"close_modal",trigger:"esc_key"})}}}else if(f.show_go_button){g();t.preventDefault()}};var v=function t(n){if(!TS.boot_data.feature_accessible_fs_dialogs)return;if(!TS.boot_data.feature_trap_kb_within_fs_modals)return;var r=$(m).filter(function(){return"none"!==$(this).css("display")}).toArray();var i=_.sortBy(r,function(e){return parseInt($(e).css("z-index"),10)}).pop();if(!e.is(i))return;var a=n.target;e.is(a)||e.has(a).length||e.focus()};var b=function n(r){if(E(r)){e&&e.removeClass("active");t&&t.removeClass("active");setTimeout(function(){$("html").removeClass("fs_modal_active")},TS.ui.fs_modal.transition_duration);f.onCancel&&f.onCancel();w()}};var y=function n(){e.removeAttr("aria-label");e.removeAttr("aria-labelledby");e.remove();t.remove();TS.ui.fs_modal.is_showing=false;M()};var w=function t(){setTimeout(function(){y();TS.boot_data.feature_accessible_fs_dialogs&&$("#client-ui").removeAttr("aria-hidden")},TS.ui.fs_modal.transition_duration);$(window.document).off("keydown.fs_modal");$(window.document).off("focusin.fs_modal");clearTimeout(c);e.off(x()+".fs_modal_show_complete");f.onEnd&&f.onEnd();TS.tips.unhideAll()};var k=function n(r){e.removeClass("active");f.onCancel&&f.onCancel();var i=t.attr("id",null).addClass("fs_modal_bg");setTimeout(function(){e.remove();TS.ui.fs_modal.is_showing=false;TS.ui.fs_modal.start(r);setTimeout(i.remove.bind(i),TS.ui.fs_modal.transition_duration)},TS.ui.fs_modal.transition_duration)};var x=function t(){var n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(var r in n)if(void 0!==e[0].style[r])return n[r]};var C=function t(){var n=e.find("[data-modal-items]");l=f.modal_gallery.index;TS.ui.fs_modal.hideFooter();l?e.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden"):e.find("[data-modal-gallery-index]").first().removeClass("hidden");e.on("click","[data-modal-gallery-direction]",function(){var e=$(this).data("modal-gallery-direction");l+=e;n.find("[data-modal-gallery-index]").addClass("hidden");n.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden");A()});A()};var I=function e(){if(!TS.model.is_our_app||!TS.interop.desktop.areDragRegionsRequired())return;if(_.get(window,"desktop.app.updateDragRegion")){window.desktop.app.updateDragRegion([]);return}TS.interop.desktop.updateNoDragRegion([]);var t=$("#fs_modal").find("header").find("button, a").toArray();if(!u){TSSSB.nodrag.updateElements(t);u=true}d=_.debounce(function(){window.requestIdleCallback(function(){return TSSSB.nodrag.updateElements(t)},{timeout:200})},400);$(window).off("resize.setupNoDragFSM").on("resize.setupNoDragFSM",d)};var M=function e(){if(!TS.model.is_our_app||!TS.interop.desktop.areDragRegionsRequired())return;u=false;$(window).off("resize.setupNoDragFSM");TS.interop.desktop.updateNoDragRegion([]);TS.client.channel_header.calculateNoDragRegions();TS.search.autocomplete.calculateNoDragRegions()};var A=function t(){var n=e.find('[data-modal-gallery-direction="-1"]');var r=e.find('[data-modal-gallery-direction="1"]');var i=e.find("[data-modal-slideshow-count]");var a=e.find("[data-modal-slideshow-total]");var s=f.modal_gallery.total_items;0===l?n.prop("disabled",true):n.prop("disabled",false);l===s?r.prop("disabled",true):r.prop("disabled",false);i.html(l+1);a.html(s+1)};var E=function e(t){if(t)return true;if(TS.ui.lazy_filter_select.is_list_open)return false;if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.dialog_is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;return true}})()},2927:function(e,t){(function(){TS.registerModule("ui.admin_edit_team_profile",{onStart:function e(){$("body").on("click",'[data-action="edit_team_profile_modal"]',TS.ui.admin_edit_team_profile.start)},start:function e(){C()&&a()}});var e;var t;var n;var r=[];var i=50;var a=function e(){var t={body_template_html:TS.templates.admin_edit_team_profile_modal(),onShow:s,onCancel:o};TS.ui.fs_modal.start(t)};var s=function n(){e=$("#edit_team_profile_container");t=$("body");e.on("click",'[data-action="edit_team_profile_to_custom"]',v);e.on("click",'[data-action="edit_team_profile_to_add"]',T);e.on("click",'[data-action="edit_team_profile_to_edit"]',b);e.on("click",'[data-action="edit_team_profile_to_hide"]',y);e.on("click",'[data-action="edit_team_profile_to_delete"]',w);e.on("click",'[data-action="edit_team_profile_cancel"]',S);e.on("click",'[data-action="edit_team_profile_confirm_edit"]',h);e.on("click",'[data-action="edit_team_profile_confirm_hide"]',m);e.on("click",'[data-action="edit_team_profile_confirm_delete"]',c);e.on("click",'[data-action="edit_team_profile_remove_option"]',E);e.on("click",'[data-action="edit_team_profile_add_option"]',P);e.on("focusin",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',D);e.on("focusout",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',H);e.on("input",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',O);e.on("click",'[data-action="edit_team_profile_list_menu"]',N);e.on("input","input",V);t.on("keydown.admin_submit",l);u().then(S).catch(TS.error)};var o=function i(){I(true);e=null;r=[];n=null;t.off("keydown.admin_submit");t=null;TS.web&&TS.web.account_profile&&TS.web.account_profile.render()};var l=function e(t){if(t.which==TS.utility.keymap.enter){$(n).find('button[type="submit"]').trigger("click");return false}};var u=function e(){return TS.team.ensureTeamProfileFields()};var d=function e(t,n){if(!t)return;return TS.interop.api.call(t,n).then(function(e){"team.profile.delete"===t?TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:JSON.parse(n.profile)})):TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},e.data));return Promise.resolve(e)},function(e){return Promise.reject(e)})};var c=function e(t){var n=$(t.target);var r=n.data("id");r||(n=n.closest("[data-id]"));r=n.data("id");if(!r)return;var i=TS.team.getTeamProfileFieldById(r);if(!i)return;g("team.profile.delete",[r]).then(S,_.noop)};var m=function e(t){p(t,true)};var f=function e(t){p(t,false)};var p=function e(t,n){var r=$(t.target);var i=r.data("id");i||(r=r.closest("[data-id]"));i=r.data("id");if(!i)return;var a=TS.team.getTeamProfileFieldById(i);if(!a)return;a=$.extend({},a);a.is_hidden=n;n&&(a.ordering=a.ordering||L());function s(){S();K(i)}g("team.profile.set",[a]).then(s,_.noop)};var h=function t(n){var r=e.find("#edit_team_profile_edit");if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);Ladda.stopAll();$("#edit_team_profile_confirm_edit_btn").addClass("disabled");return}var i=$(n.target);var a=i.data("id");a||(i=i.closest("[data-id], [data-type]"));a=i.data("id");var s=e.find('input[name="label"]');var o=e.find('input[name="hint"]');var l=TS.team.getTeamProfileFieldById(a)||{};var u=JSON.stringify(l);l=$.extend({},l);l.type=l.type||i.data("type")||"text";l.label=s.val().trim();l.hint=o.val().trim();l.ordering=l.ordering||L();"options_list"===l.type&&(l.possible_values=e.find('input[name^="option_"]').map(function(){return $(this).val().trim()}).toArray());function d(){S();K(a)}if(JSON.stringify(l)==u){d();Ladda.stopAll()}else g("team.profile.set",[l]).then(d,_.noop)};var g=function e(t,n){n=n&&n.length?n:TS.model.team.profile.fields;var r={profile:JSON.stringify({fields:n})};return d(t,r).catch(function(e){if("no_perms"!==e.data.error&&"missing_scope"!==e.data.error){if("field_bad_order"===e.data.error){TS.error("Failed to create profile field: "+e.data.error);return TS.generic_dialog.alert(TS.interop.i18n.t("Apologies, but the maximum number of profile fields you can add is {max_no_of_fields, number}. Please remove some existing fields if you\u2019d like to add different ones.","team_profile")({max_no_of_fields:i}))}TS.error("Failed to customize profile: "+e.data.error);return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","team_profile")())}TS.generic_dialog.start({body:TS.interop.i18n.t("Sorry! An owner in your workspace has restricted who can customize your members\u2019 profile.","team_profile")(),show_cancel_button:false,esc_for_ok:true,fullscreen:false,onEnd:TS.ui.fs_modal.close})}).finally(Ladda.stopAll)};var S=function t(){r.length=0;r.push({back:t});var n={};n.team_profile_fields=G();n.hidden_team_profile_fields=q();n.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_list(n);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Customize profile","team_profile")()).removeClass("hidden center_and_narrow");var a;a=TS.model.team.profile&&TS.model.team.profile.fields.length>=50?'<div class="alert alert_info"><i class="ts_icon ts_icon_info_circle"></i>'+TS.interop.i18n.t("You have reached the maximum number of fields that can be added to profiles.","team_profile")()+"</div>":TS.interop.i18n.t("Expand your members\u2019 profiles by adding additional fields below","team_profile")();e.find("#edit_team_profile_value_note").html(a).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_list").html(i);U("#edit_team_profile_list");B();x();I(true)};var T=function t(){r.push({back:t});var n={};n.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_add(n);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Select a field type","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_add").html(i);U("#edit_team_profile_add");x();I()};var v=function t(){r.push({back:t});var n=TS.templates.admin_edit_team_profile_custom();e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Create a new field","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").text(TS.interop.i18n.t("Which type of field would you like to create?","team_profile")()).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_custom").html(n);U("#edit_team_profile_custom");x();I();j()};var b=function t(n){var i=$(n.target);if(i.hasClass("ts_icon_grabby_patty"))return false;var a=i.data("id");a||(i=i.closest("[data-id], [data-type]"));a=i.data("id");var s={};var o;if(a){s=TS.team.getTeamProfileFieldById(a);if(!s)return;o=TS.interop.i18n.t("Edit profile field","team_profile")()}else{s.type=i.data("type");s.label=i.data("label");o=TS.interop.i18n.t("Customize profile field","team_profile")()}n.stopPropagation();r.push({back:t,event:n});var l=TS.templates.admin_edit_team_profile_edit(s);e.find("#edit_team_profile_header").text(o).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_edit").html(l);U("#edit_team_profile_edit");M();A();j();Ladda.bind("#edit_team_profile_confirm_edit_btn");x();I();V()};var y=function t(n){var i=$(n.target);var a=i.data("id");a||(i=i.closest("[data-id]"));a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;n.stopPropagation();r.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_hide({id:s.id,can_delete:!_.get(s,"options.is_scim",false)});var l=TS.interop.i18n.t('Hide "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.interop.i18n.t("All data entered for this field will no longer be visible on your members\u2019 profiles. You can un-hide it later.","team_profile")();e.find("#edit_team_profile_value_note").text(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_hide").html(o);U("#edit_team_profile_hide");Ladda.bind("#edit_team_profile_confirm_hide_btn");k();I()};var w=function t(n){var i=$(n.target);var a=i.data("id");a||(i=i.closest("[data-id]"));a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;n.stopPropagation();r.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_delete(s);var l=TS.interop.i18n.t('Delete "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.interop.i18n.t("<strong>Are you sure?</strong> All data associated with this field will be permanently deleted. This <strong>cannot be undone</strong>.","team_profile")();e.find("#edit_team_profile_value_note").html(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_delete").html(o);U("#edit_team_profile_delete");Ladda.bind("#edit_team_profile_confirm_delete_btn");k();I()};var k=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var x=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var C=function e(){if(!(TS.model.team&&TS.model.team.plan))return false;var t=TS.model.user;if(!t)return false;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var I=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){r.pop();var e=r.pop();e.back(e.event)});TS.ui.fs_modal.showBackButton()}};var M=function t(){var n=e.find(".option_row");n.length>=3?n.addClass("show_remove_action"):n.removeClass("show_remove_action")};var A=function t(){O({target:e.find('.option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]')})};var E=function e(t){$(t.target).closest(".row.option_row").remove();V();M();A();F()};var P=function t(){var n=TS.templates.admin_edit_team_profile_option_row({index:e.find(".row.option_row").length});e.find("#option_rows").append(n).find(".row.option_row").last().find("input").focus();V();M();F()};var F=function t(){50===e.find(".row.option_row").length?e.find('[data-action="edit_team_profile_add_option"]').addClass("hidden").next().removeClass("hidden"):e.find('[data-action="edit_team_profile_add_option"]').removeClass("hidden").next().addClass("hidden")};var O=function t(n){var r=$(n.target);var i=r.val();i&&(i=i.trim());void 0===i||i.length||(i=r.data("default"));e.find('.profile_field_preview [data-id="'+r.data("target")+'"]').text(i)};var D=function t(n){var r=e.find('.profile_field_preview [data-id="'+$(n.target).data("target")+'"]');var i=r.closest("select");i.length&&(r=i);r.addClass("highlight_yellow_bg")};var H=function t(n){var r=e.find('.profile_field_preview [data-id="'+$(n.target).data("target")+'"]');var i=r.closest("select");i.length&&(r=i);r.removeClass("highlight_yellow_bg")};var j=function t(){var n=e.find(".edit_team_profile_lazy_filter_select");if(!n.length)return;var r="USLACKBOT";TS.boot_data.feature_deprecate_get_member_by_name||(r=TS.interop.members.getMemberByName("slackbot").id);var i={append:true,classes:"disabled",preselected_ids:[r]};TS.ui.people_picker.make(n,i)};var B=function t(){e.find("#edit_team_profile_list_drag_and_drop_area").sortable({items:".visible_row[data-id]",handle:".ts_icon_grabby_patty",forcePlaceholderSize:true}).on("sortupdate",function(e){e.stopPropagation();var t=[];$(this).find(".row[data-id]").each(function(e){var n=TS.team.getTeamProfileFieldById($(this).data("id"));if(n&&n.ordering!=e){n.ordering=e;t.push({id:n.id,ordering:e})}});var n=TS.team.sortTeamProfileFieldsByOrdering(TS.model.team.profile.fields);TS.teams.upsertTeam(_.assign({},TS.model.team,{profile:{fields:n}}));g("team.profile.reorder",t)})};var L=function e(){if(!TS.model.team.profile.fields.length)return 0;return _.max(TS.model.team.profile.fields.map(function(e){return e.ordering}))+1};var N=function e(t){t.stopPropagation();var n=$(t.target).closest("[data-id]").get(0);var r={};r.is_scim=$(t.target).closest("[data-is-scim]").data("is-scim");var i=jQuery.Event("click",{target:n,currentTarget:n});TS.menu.startWithEditTeamProfileListActions(i,R,r)};var R=function e(t){t.preventDefault();var n=$(t.target).closest("[data-id]");n.is('[data-action="edit_team_profile_to_show"]')?f(t):n.is('[data-action="edit_team_profile_to_hide"]')?y(t):n.is('[data-action="edit_team_profile_to_delete"]')&&w(t);TS.menu.end()};var U=function t(r){var i=["#edit_team_profile_loading","#edit_team_profile_list","#edit_team_profile_add","#edit_team_profile_custom","#edit_team_profile_edit","#edit_team_profile_hide","#edit_team_profile_delete"].filter(function(e){return e!==r}).join(", ");e.find(i).addClass("hidden");e.find(r).removeClass("hidden");n=r};var G=function e(){var t=TS.team.getVisibleTeamProfileFields();return t.length?t:null};var q=function e(){var t=TS.team.getHiddenTeamProfileFields();return t.length?t:null};var W=function e(){return TS.model.team.profile.fields.reduce(function(e,t){e[t.label.toLowerCase()]=true;return e},{})};var z=function e(){var t=W();var n=[{type:"text",label:TS.interop.i18n.t("Address","team_profile")()},{type:"date",label:TS.interop.i18n.t("Birthdate","team_profile")()},{type:"user",label:TS.interop.i18n.t("Direct Reports","team_profile")()},{type:"link",label:TS.interop.i18n.t("Facebook","team_profile")()},{type:"link",label:TS.interop.i18n.t("Flickr","team_profile")()},{type:"link",label:TS.interop.i18n.t("GitHub","team_profile")()},{type:"link",label:TS.interop.i18n.t("Instagram","team_profile")()},{type:"link",label:TS.interop.i18n.t("LinkedIn","team_profile")()},{type:"user",label:TS.interop.i18n.t("Manager","team_profile")()},{type:"link",label:TS.interop.i18n.t("Pinterest","team_profile")()},{type:"text",label:TS.interop.i18n.t("Skype","team_profile")()},{type:"link",label:TS.interop.i18n.t("SoundCloud","team_profile")()},{type:"date",label:TS.interop.i18n.t("Start Date","team_profile")()},{type:"link",label:TS.interop.i18n.t("Tumblr","team_profile")()},{type:"link",label:TS.interop.i18n.t("Twitter","team_profile")()},{type:"link",label:TS.interop.i18n.t("YouTube","team_profile")()}].filter(function(e){return!t[e.label.toLowerCase()]});return n.length?n:[]};var K=function t(n){var r=n?"[data-id="+n+"]":".visible_row[data-id]";var i=e.find("#edit_team_profile_list").find(r).last();var a=-2*i.outerHeight();i.highlight(1500,"",null,0);i.scrollintoview({duration:200,px_offset:a,direction:"y"})};var V=function t(){$("#edit_team_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e.find("#edit_team_profile_edit"),{quiet:true,fast:true}))}})()},2928:function(e,t){(function(){TS.registerModule("ui.edit_member_profile",{onStart:function e(){TS.members.changed_profile_sig.add(z);TS.view&&TS.view.resize_sig.add(J);$("body").on("click",'[data-action="edit_member_profile_modal"]',function(e){e.preventDefault();TS.ui.edit_member_profile.start();TS.interop.clog.track("USER_PROFILE_CLICK")})},start:function e(){d()}});var e;var t;var n;var r;var i;var a;var s;var o=[];var l;var u="UPLOAD_PROFILE_IMAGE";var d=function e(){var t={};t.custom_username_policy=TS.prefs.getTeamPref("username_policy");var n={body_template_html:TS.templates.edit_member_profile_modal(t),onShow:c,onGo:H,onCancel:m,go_button_text:TS.interop.i18n.t("Save Changes","edit_profile")(),go_button_class:"edit_member_profile_confirm_edit_btn ladda-button",modal_class:"fs_modal_header fs_modal_footer",title:TS.interop.i18n.t("Edit your profile","edit_profile")()};TS.ui.fs_modal.start(n)};var c=function n(){e=$("#edit_member_profile_container");t=$("body");X()&&$("#fs_modal_footer").prepend(TS.templates.edit_member_profile_footer({can_edit_team_profile:true}));e.on("click",'[data-action="edit_member_profile_cancel_photo"]',M);e.on("click",'[data-action="edit_member_profile_confirm_photo_delete"]',h);e.on("click",'[data-action="edit_member_profile_confirm_photo_crop"]',g);e.on("click",'[data-action="edit_member_profile_photo_menu"]',L);e.on("click",'[data-action="edit_member_profile_upload_image"]',N);e.on("click",'[data-action="edit_member_profile_to_delete"]',R);t.on("change.photo",'[data-action="edit_member_profile_upload_photo"]',S);t.on("keydown.member_submit",f);e.on("input","input",q).on("change","select",q).on("keyup","#custom_status_input_for_edit_profile",q);e.on("input",'[data-plastic-type="date"]',Q);p().then(M).catch(TS.error)};var m=function a(){C();e=null;n=null;r=null;i=null;o=[];s=null;if(t){t.off("change.photo");t.off("keydown.member_submit");t=null}TS.web&&TS.web.account_profile&&TS.web.account_profile.render()};var f=function e(t){if(t.which==TS.utility.keymap.enter){var n=$(s).find('button[type="submit"]');n.length?n.trigger("click"):H();return false}};var p=function e(){return TS.team.ensureTeamProfileFields()};var h=function e(){$("#edit_member_profile_cancel_photo_delete_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.deletePhoto",function(e){e.stopPropagation()});TS.interop.api.call("users.deletePhoto").then(function(){if(TS.web)return TS.interop.api.call("users.info",{user:TS.model.user.id,_x_reason:"web_edit_member_profile"}).then(function(e){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data.user);TS.members.legacyUpsertMember(t);z();M()},M);M()}).catch(function(e){TS.warn("Unable to delete profile photo");TS.error(e);return I()}).finally(function(){Ladda.stopAll();t.off("keydown.deletePhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_delete_btn").removeClass("disabled")})};var g=function e(){TS.interop.console.info(u,"Begin to upload photo");r&&r.disable();$("#edit_member_profile_cancel_photo_crop_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.uploadPhoto",function(e){e.stopPropagation()});var n=$("#edit_member_profile_photo");var i=$("#cropbox");var a=i.data("dimensions");a.id=n.data("src_id");TS.interop.console.info(u,"Upload photo using users.setPhoto endpoint");TS.interop.api.call("users.setPhoto",a).then(function(e){TS.interop.console.info(u,"Call to users.setPhoto is ok? "+(e&&e.data&&e.data.ok));if(TS.web||TS.boot_data.feature_degraded_send){var t=_.merge(TS.model.user,{profile:e.data.profile});TS.members.legacyUpsertAndSignal(t);z()}M()}).catch(function(e){TS.interop.console.warn(u,"Unable to upload cropped profile photo");TS.error(e);return I()}).finally(function(){Ladda.stopAll();t.off("keydown.uploadPhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_crop_btn").removeClass("disabled");i.removeData("dimensions");TS.interop.console.info(u,"Attempt to upload profile photo complete")})};var S=function t(n){var r="change"===n.type?$(this):void 0;TS.interop.console.info(u,"Begin to preprocess profile photo");if(r){if(!r.val()){TS.model.is_iOS&&TS.menu.end();return}n=r.get(0).files}if(n){TS.model.is_iOS&&TS.menu.end();if(!n.length)return;P();V(0);T(n[0]).then(v).then(b).then(y).then(w).then(k).catch(x);e.find('[data-action="edit_member_profile_upload_photo"]').val("")}else TS.interop.console.info(u,"No files found to process, returning early")};var T=function e(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(n){TS.interop.console.info(u,"Photo successfully read");e({file:t,src:n.target.result})};r.onabort=function(){TS.interop.console.info(u,"Profile photo file read aborted");n(new Error("abort"))};r.onerror=function(e){TS.interop.console.warn(u,"Unable to read profile photo file");TS.error(e);n(e)};l=function e(){try{r.abort()}catch(e){TS.error(e)}};r.readAsDataURL(t)})};var v=function e(t){if(t.file.type.match(/image\/(?:gif|png|jpeg)/i)){TS.interop.console.info(u,"Photo format valid");return Promise.resolve(t)}TS.interop.console.warn(u,"Photo format invalid");Promise.reject(new Error("format"))};var b=function e(t){return new Promise(function(e,n){i=new Image;i.onload=function(){TS.interop.console.info(u,"Photo size valid");e(t)};i.onerror=function(e){TS.interop.console.warn(u,"Unable to set profile photo file image src when validating size");TS.error(e);n(e)};i.src=t.src})};var y=function e(t){var n=TS.model.api_url+"users.preparePhoto";var r=new FormData;r.append("image",t.file);r.append("token",TS.model.api_token);TS.interop.console.info(u,"Begin preparing photo on server");return new Promise(function(e,t){var i=$.ajax({url:n,data:r,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable)V(e.loaded/e.total);else{TS.info("Upload length not computable");V(1)}},false);return e}}).fail(function(e,n,r){l=null;TS.interop.console.warn(u,"Preparing photo on server failed");t(new Error(r))}).done(function(n){l=null;if(n.ok){TS.interop.console.info(u,"Preparing photo on server succeeded");e(n)}else{TS.interop.console.warn(u,"Preparing photo on server resolved with an error");t(new Error(n.error))}});l=i.abort})};var w=function e(t){return new Promise(function(e,n){var r=$("#edit_member_profile_photo");var a=r.get(0);TS.interop.console.info(u,"Begin setting up photo for crop");var s=function n(){i.src=t.url;$("#edit_member_profile_photo_preview").css("background","url("+t.url+")");r.css("opacity",0);E();d();TS.interop.console.info(u,"Photo set up for crop");e()};var o=function e(t){TS.interop.console.warn(u,"Unable to set crop photo file image src");TS.error(t);d();n(t)};var d=function e(){a.removeEventListener("load",s);a.removeEventListener("error",o)};l=function t(){d();e()};r.attr("src",t.url).data("src_id",t.id);a.addEventListener("load",s);a.addEventListener("error",o)})};var k=function e(){function t(e){if(!i)return;TS.interop.console.info(u,"Update photo preview");var t=o.width();var n=t*i.width/e.crop_w;var r=t*i.height/e.crop_w;var a=n*e.crop_x*-1/i.width;var s=r*e.crop_y*-1/i.height;o.css({"background-size":n+"px","background-position":a+"px "+s+"px"})}function n(e){if(!i)return;TS.interop.console.info(u,"Update photo selection");var n={crop_x:Math.round(e.x),crop_y:Math.round(e.y),crop_w:Math.min(Math.round(e.w),i.height)};s.data("dimensions",n);t(n)}function a(){r.animateTo(_,function(){var e=this.tellSelect();e.w=i.width;n(e)});r.focus();TS.interop.console.info(u,"Photo crop complete")}TS.interop.console.info(u,"Begin photo crop");var s=$("#cropbox");var o=$("#edit_member_profile_photo_preview");var l=$("#edit_member_profile_photo");var d=l.width();var c=l.height();var _;if(!i)return;var m=Math.min(i.width,i.height);t({crop_x:(i.width-m)/2,crop_y:(i.height-m)/2,crop_w:m});$("#edit_member_profile_photo").css("opacity",0);l.Jcrop({aspectRatio:1,allowSelect:false,boxWidth:d,boxHeight:c,onSelect:n,onRelease:a,bgColor:"white",trueSize:[i.width,i.height]},function(){r=this;var e=this.getBounds();var t=Math.min(e[0],e[1]);var n=(e[0]-t)/2;var i=(e[1]-t)/2;_=[n,i,t,t];a()})};var x=function e(t){TS.interop.console.warn(u,"Catching upload photo failure");switch(t&&t.message){case"abort":TS.interop.console.warn(u,"Upload photo aborted");break;case"format":case"bad_image":case"too_many_frames":TS.interop.console.warn(u,"Photo format error: "+t.message);O();break;case"too_large":TS.interop.console.warn(u,"Photo too large");D();break;default:TS.interop.console.warn(u,"Unexpected error when processing photo");TS.interop.console.error(JSON.stringify(t,null,2));return I()}};var C=function e(){if(l){l();l=null}};var I=function e(){return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")()).then(M)};var M=function t(){o.length=0;o.push({back:t});Y();C();i=null;var n=!e.find("#edit_member_profile_list").children().first().length;if(n){var r={member:TS.model.user,team:TS.model.team,team_member_profile_fields:TS.team.getVisibleTeamProfileFieldsForMember(TS.model.user,true)};var a=[];_.each(TS.boot_data.slack_timezones,function(e){a.push({label:e[0],val:e[1]})});r.timezone_options=a;r.member_tz=TS.model.user.tz||TS.boot_data.default_tz;r.custom_username_policy=TS.prefs.getTeamPref("username_policy");r.lock_display_name=false;"normal"!==TS.prefs.getTeamPref("auth_mode")&&false===TS.prefs.getTeamPref("sso_choose_username")&&(r.lock_display_name=true);var s=TS.templates.edit_member_profile_list(r);e.find("#edit_member_profile_list").html(s);TS.ui.validation.validate(e,{fast:true})}U("#edit_member_profile_list");TS.ui.fs_modal.showFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Edit your profile","edit_profile")());Ladda.bind(".edit_member_profile_confirm_edit_btn");q();W();B();G(true)};var A=function e(){return true===TS.model.user.profile.is_custom_image};var E=function e(){o.push({back:M});U("#edit_member_profile_photo_crop");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Crop your photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_crop_btn");B();G()};var P=function e(){o.push({back:M});n||K();U("#edit_member_profile_photo_upload");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Uploading your photo\u2026","edit_profile")());B();G()};var F=function e(){o.push({back:e});U("#edit_member_profile_photo_delete");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Remove profile photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_delete_btn");j();G()};var O=function e(){o.push({back:M});U("#edit_member_profile_photo_format_error");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Oh cripes","edit_profile")());B();G()};var D=function e(){o.push({back:M});U("#edit_member_profile_photo_oversize_error");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Dang","edit_profile")());B();G()};var H=function t(){if(!TS.ui.validation.validate(e,{quiet:true,fast:true})){TS.ui.validation.validate(e);Ladda.stopAll();$(".edit_member_profile_confirm_edit_btn").addClass("disabled");return false}var n=["real_name","display_name","title","phone"];var r={};n.forEach(function(t){var n;var i;n=e.find('input[name="'+t+'"]');i=n.val();r[t]=i&&i.trim()});(TS.model.team.profile.fields||[]).filter(function(e){return!e.is_hidden}).forEach(function(t){var n=TS.model.user.profile.fields||{};var i=Z(n[t.id]);var a=Z(i.value);var s=Z(i.alt);var o=e.find('input[name="'+t.id+'"], select[name="'+t.id+'"]');var l=e.find('input[name="'+t.id+'_alt"]');var u=Z(o.val());var d=Z(l.val());r.fields=r.fields||{};a===u&&s===d||(r.fields[t.id]={value:u&&u.trim(),alt:d&&d.trim()});"text"===t.type&&"skype"===t.label.toLocaleLowerCase()&&(r.skype=u&&u.trim());o.val("").val(u);l.val("").val(d)});var i=[];_.each(r.fields,function(e,t){e.value&&e.value.length||i.push(t)});i.length&&TS.warn("EVALUE-1371: Calling users.profile.set with emptied fields: "+i.join(" "));var a={profile:JSON.stringify(r)};var s=e.find('[name="tz"]').val();if(s!==TS.model.user.tz){if(TS.web){TS.model.user.tz=s;TS.model.user.tz_offset=TS.boot_data.dst_offsets[s].tz_offset}TS.prefs.setPrefByAPI({name:"tz",value:s,_x_reason:"tz_edit_member_profile"})}TS.interop.api.call("users.profile.set",a).then(function(e){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if(TS.web||TS.boot_data.feature_degraded_send){TS.model.user.profile=e.data.profile;TS.web?TS.members.legacyUpsertMember(TS.model.user):TS.members.legacyUpsertAndSignal(TS.model.user)}TS.ui.fs_modal.close()}).catch(function(t){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if("ratelimited"===t.data.error)return TS.generic_dialog.alert(TS.interop.i18n.t("You\u2019re changing your profile too often! You might have better luck if you try again in a few minutes.","edit_profile")());t.data.error=TS.ui.validation.maybeConvertNameErrorCode(t.data.error);var n=TS.ui.validation.getErrorMessage(t.data.error,{maxlength:80});if("real_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"real_name_profile_field_warnings",should_truncate:false});return false}if("display_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"display_name_profile_field_warnings",should_truncate:false});return false}TS.ui.fs_modal.close();TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")())}).finally(Ladda.stopAll);return false};var j=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var B=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var L=function t(n){n.stopPropagation();TS.interop.console.info(u,"Maybe open upload photo menu");A()&&!$(n.target).is(".btn")||TS.model.is_iOS?TS.menu.member.startWithEditMemberProfilePhotoActions(n,N):e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click")};var N=function t(n){var r=$(n.target).closest("li");if(r.is('[data-action="edit_member_profile_upload_image"]')){if(!TS.model.is_iOS){n.preventDefault();TS.interop.console.info(u,"User clicked edit profile image menu option");e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click");TS.menu.end()}}else if(r.is('[data-action="edit_member_profile_to_delete"]')){n.preventDefault();TS.interop.console.info(u,"User clicked delete profile image menu option");F();TS.menu.end()}};var R=function e(t){var n=$(t.target).closest("li");if(n.is('[data-action="edit_member_profile_to_delete"]')){t.preventDefault();F();TS.menu.end()}};var U=function t(n){var r=["#edit_member_profile_loading","#edit_member_profile_list","#edit_member_profile_photo_upload","#edit_member_profile_photo_crop","#edit_member_profile_photo_delete","#edit_member_profile_photo_format_error","#edit_member_profile_photo_oversize_error"].filter(function(e){return e!==n}).join(", ");e.find(r).addClass("hidden");e.find(n).removeClass("hidden");s=n};var G=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){o.pop();var e=o.pop();e.back()});TS.ui.fs_modal.showBackButton()}};var q=function t(){$(".edit_member_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e,{quiet:true,fast:true}))};var W=function t(){e.find(".edit_member_profile_lazy_filter_select").each(function(e,t){var n=$(t);var r=n.val().split(/\s*,\s*/);TS.ui.people_picker.make(n,{preselected_ids:r});n.on("change",function(){var e=TS.ui.people_picker.value(n).map(function(e){return e.member.id}).join(",");n.val(e);q()})})};var z=function t(){if(!e)return;$("#edit_member_profile_photo_container .member_image").replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,192,false,true))};var K=function e(){n=$("#edit_member_profile_progress_circle").circleProgress({value:0,size:64,fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2})};var V=function e(t){var r=parseFloat(t);isNaN(r)||n.circleProgress({value:r.toFixed(2)})};var Y=function e(){if(!r)return;r.destroy();r=null;$("#edit_member_profile_photo").css({width:"auto",height:"auto",display:"block",visibility:"visible",opacity:1})};var J=function e(){if(r&&r.getOptions().disabled)return;Y();a&&clearTimeout(a);a=setTimeout(function(){i&&!r&&k()},300)};var Q=function e(t){var n=$(t.target);var r=$('input[name="'+n.attr("name")+'_alt"]');var i=n.val();i&&(i=i.trim());TS.ui.validation.validate(n,{quiet:true,fast:true})&&r.val(TS.interop.datetime.convertISOtoUTCReadableDate(i))};var X=function e(){if(!TS.model.team.plan)return false;var t=TS.model.user;if(!t)return false;if(TS.model.user.enterprise_user)return TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var Z=function e(t){return _.isUndefined(t)?"":t}})()},2929:function(e,t){(function(){TS.registerModule("ui.validation",{completed_sig:new signals.Signal,onStart:function e(){o();$("body").on("input.validation paste.validation change.validation","[data-validation]",TS.utility.debounce(function(e){$(e.target).is(".ql-editor")||$(e.target).is(".ql-clipboard")?c($(e.target).closest(".ql-container"),{},e):c($(e.target),{},e)},500));$("body").on("input.channel-name-validation paste.channel-name-validation change.channel-name-validation",'[data-validation*="channel_name"]',function(e){var t=$(e.target);if(!t.is('input[type="text"]'))return;var n={query:K(t),count:1};TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:n})});$("body").on("submit.validation","form[data-validation-form]",function(e){var t=$(e.target);var n=TS.ui.validation.validate(t);n||e.preventDefault();TS.ui.validation.completed_sig.dispatch(t,{event:e,passed:n})})},validate:function e(t,n){n=n||{};var r=document;if(t){if(t.is("[data-validation]")){if(1===t.length)return c(t,n);return t.toArray().every(function(e){return c($(e),n)})}r=t.get(0)}var i=Array.prototype.slice.call(r.querySelectorAll("[data-validation]"));if(n&&n.fast)return i.every(function(e){return c($(e),n)});if(n&&n.verbose){var a={};i.forEach(function(e){a[e.name]=c($(e),n)});return a}return i.reduce(function(e,t){return c($(t),n)&&e},true)},register:function e(t,n){if(d[t]){TS.warn(t+" cannot be registered because that key is already in use.");return}if("function"!==typeof n){TS.warn("Only functions can be registered as validators.");return}d[t]=n},showCustomValidation:function e(t,n,r,i){B(t,r.error_message||n,r.class,r,i)},getErrorMessage:function e(t,n){switch(t){case"invalid_name_required":return r.required;case"invalid_name_punctuation":return r.punctuation;case"invalid_name_maxlength":return r.maxlength;case"invalid_name_specials":return r.specials;case"name_taken":return r.name_taken({name:n.name});case"restricted_action":return s.restricted_action;case"name_invalid_name_required":return a.required;case"invalid_starts_with_at":return a.at_sign;case"name_invalid_name_maxlength":case"too_long":return a.maxlength;case"invalid_reserved_word":return a.reserved;case"name_invalid_name_specials":return a.specials;case"invalid_emoji_not_allowed":return V(n.name||"");case"display_name_not_allowed":return a.sso_display_name;case"invalid_email":return l.invalid;case"url_in_message":return u.url_in_message;default:return TS.interop.i18n.t("For some weird reason, that didn\u2019t work. Please try again to continue.","ui_validation")()}},maybeConvertNameErrorCode:function e(t){if("invalid_name_specials"===t)return"name_invalid_name_specials";if("invalid_name_maxlength"===t)return"name_invalid_name_maxlength";if("invalid_name_required"===t)return"name_invalid_name_required";return t},showError:function e(t,n,r,i){B(t,r.error_message||n,"validation_error",r,i)},showWarning:function e(t,n,r,i){B(t,r.warning_message||n,"validation_warning",r,i)},showSuccess:function e(t,n,r,i){B(t,r.success_message||n,"validation_success",r,i)},test:function e(){return{validations:d}}});var e=80;var t=TS.boot_data.feature_longer_channel_names?80:21;var n=21;var r={name_taken:TS.interop.i18n.t("{name} is already taken by a channel, username, or user group.","ui_validation"),lowercase:TS.interop.i18n.t("Channel names must be all lowercase. Try again?","ui_validation")(),maxlength:TS.interop.i18n.t("Blerg, that\u2019s a bit too long! Channel names must be fewer than {max_length_plus_one} characters.","ui_validation","3f4713bbc10b7768aaeebf4f68de6de1d08753d1")({max_length_plus_one:t+1}),required:TS.interop.i18n.t("Don\u2019t forget to name your channel.","ui_validation")(),specials:TS.interop.i18n.t("Channel names can\u2019t contain spaces, periods, or most punctuation. Try again?","ui_validation")(),punctuation:TS.interop.i18n.t("Names can\u2019t consist solely of punctuation. Please elaborate!","ui_validation")()};var i={firstalphanumeric:TS.interop.i18n.t("Usernames must start with a letter or number. Sorry about that!","ui_validation")(),lowercase:TS.interop.i18n.t("Sorry, usernames must be lowercase!","ui_validation")(),maxlength:TS.interop.i18n.t("Sorry, that\u2019s a bit too long! Usernames must be fewer than {max_length_plus_one} characters.","ui_validation","10f62c929475d76c2b47d666c9703843310ef356")({max_length_plus_one:n+1}),required:TS.interop.i18n.t("Please fill in a username.","ui_validation")(),specials:TS.interop.i18n.t("Usernames can\u2019t contain special characters. Sorry about that!","ui_validation")()};var a={required:TS.interop.i18n.t("Unfortunately, you can\u2019t leave this blank.","ui_validation")(),at_sign:TS.interop.i18n.t("Names can\u2019t start with the @ sign \u2014\xa0that\u2019s how your teammates will mention you in conversation.","ui_validation")(),maxlength:TS.interop.i18n.t("Unfortunately, names can\u2019t be longer than {maxlength} characters.","ui_validation")({maxlength:e}),reserved:TS.interop.i18n.t("That name\u2019s already being used by Slack.","ui_validation")(),specials:TS.interop.i18n.t("Mostly, names can\u2019t contain punctuation. (Apostrophes, spaces, and periods are fine.)","ui_validation")(),emoji:TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),sso_display_name:TS.interop.i18n.t("Display names are automatically set by your organization.","ui_validation")()};var s={};var o=function e(){s={restricted_action:TS.interop.i18n.t("Sorry! An admin in your workspace has restricted who can create private channels.","ui_validation")()}};var l={invalid:TS.interop.i18n.t("This doesn\u2019t seem like an email address. Sorry!","ui_validation")()};var u={url_in_message:TS.interop.i18n.t("Unfortunately, custom messages can\u2019t contain URLs.","ui_validation")()};var d={dateandformat:x,firstalphanumeric:M,hasnourl:S,isurl:g,lowercase:C,maxcsv:w,maxlength:v,mincsv:y,minlength:T,nospace:I,required:f,reservedwords:p,keywords:h,username:A,channel_name:P,team_name:F,is_email:O,membername:E};var c=function e(t,n,r){n=n||{};t.is("[data-validation-for]")&&(n.custom_for=t.attr("data-validation-for"));n.success_message=TS.interop.i18n.t("Nice, thanks!","ui_validation")();t.is("[data-validation-success]")&&(n.success_message=t.attr("data-validation-success"));t.is("[data-validation-warning]")&&(n.warning_message=t.attr("data-validation-warning"));t.is("[data-validation-error]")&&(n.error_message=t.attr("data-validation-error"));q(t)&&G(t,n);var i=m(t).every(function(e){if(-1===e.indexOf("="))return d[e.trim()](t,n);var r=e.split("=");return d[r[0]](t,n,r[1])});TS.ui.validation.completed_sig.dispatch(t,{event:r,passed:i});j(t,i,n)&&TS.ui.validation.showSuccess(t,n.success_message,n,3e3);t.attr("aria-invalid",!i);return i};var m=function e(t){if(t.is("[data-validation]"))return _.compact(t.attr("data-validation").replace(/\s*(,|=)\s*/g,"$1").split(/\s+/));return[]};function f(e,t){if(e.is('input[type="radio"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(e.is('input[type="checkbox"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select at least one option","ui_validation")(),t)}else if(e.is("select")){if(e.val())return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(q(e)){if(W(e).trim())return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t be empty","ui_validation")(),t)}else TS.error("Error: cannot validate")}function p(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var r=W(e).trim().toLowerCase();var i=n.split(",");if(-1===i.indexOf(r))return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t('"{word}" is a reserved word. Try something else!',"ui_validation")({word:TS.interop.i18n.safeString(_.escape(r))}),t)}else TS.error("WTF: cannot validate")}function h(e,t){return p(e,t,TS.model.RESERVED_KEYWORDS.join(","))}function g(e,t,n){var r=W(e);var i=TS.interop.i18n.t("This doesn\u2019t seem like a proper link. Sorry!","ui_validation")();var a;var s=false;var o=false;if(!r)return true;if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!q(e)){TS.error("Error: cannot validate");return}if(n){a=n.split(",");-1!=a.indexOf("https")&&(i=TS.interop.i18n.t("Please use https (for security).","ui_validation")());-1!=a.indexOf("http")&&-1==a.indexOf("https")&&a.push("https");for(var l=0;l<a.length;l+=1)0===r.indexOf(a[l]+"://")&&(s=true)}else{s=true;-1==r.indexOf("://")&&(r="http://"+r)}o=TS.interop.url.simpleIsUrl(r);if(o&&s)return true;TS.ui.validation.showWarning(e,i,t)}function S(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var n=W(e);if(!n)return true;if(!TS.interop.url.findUrlsInString(n).length)return true;TS.ui.validation.showWarning(e,u.url_in_message,t)}else TS.error("Error: cannot validate")}function T(e,t,n,r){return b(e,"minlength",t,n,r)}function v(e,t,n,r){return b(e,"maxlength",t,n,r)}function b(e,t,n,r,i){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var a=W(e);r=+r;if(void 0===a||isNaN(r)){TS.error("Error: no length to validate");return}if("minlength"===t){if(TS.interop.utility.getStringLength(a)>=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be less than {minlength, plural, =1{# character}other{# characters}}","ui_validation")({minlength:r}),n)}else if("maxlength"===t){i||R(e,a.length,r,n);if(TS.interop.utility.getStringLength(a)<=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be more than {maxlength, plural, =1{# character}other{# characters}}","ui_validation")({maxlength:r}),n)}}else TS.error("Error: cannot validate")}function y(e,t,n){return k(e,"mincsv",t,n)}function w(e,t,n){return k(e,"maxcsv",t,n)}function k(e,t,n,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var i=W(e).trim();r=+r;if(void 0===i||isNaN(r)){TS.error("Error: no length to validate");return}if("mincsv"===t){if(i.split(/\s*,\s*/).length>=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have less than {minlength, plural, =1{# value}other{# values}}","ui_validation")({minlength:r}),n)}else if("maxcsv"===t){if(i.split(/\s*,\s*/).length<=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have more than {maxlength, plural, =1{# value}other{# values}}","ui_validation")({maxlength:r}),n)}}else TS.error("Error: cannot validate")}function x(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var r=W(e).trim();if(!r)return true;var i;var a;var s;var o;switch(n){case"Y-m-d":i="YYYY-MM-DD";a=r.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===r;s&&(o=H(r+"T00:00:00.000Z"));break;case"m-d":i="MM-DD";a=r.match(/^[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===r;s&&(o=H("0000-"+r+"T00:00:00.000Z"));break;default:TS.error("Error: cannot validate");return}if(s&&o)return true;s?o||TS.ui.validation.showWarning(e,TS.interop.i18n.t("{value} doesn\u2019t appear to be a valid date. Sorry!","ui_validation")({value:TS.interop.i18n.safeString(_.escape(r))}),t):TS.ui.validation.showWarning(e,TS.interop.i18n.t("This needs to be in the format {pattern}. Sorry!","ui_validation")({pattern:i}),t)}else TS.error("Error: cannot validate")}function C(e,t){var n=q(e)?W(e):e.val();var r=n===n.toLocaleLowerCase();if(r)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field must be lowercase only","ui_validation")(),t)}function I(e,t){var n=q(e)?W(e):e.val();var r=/\s/.test(n);if(!r)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t contain spaces","ui_validation")(),t)}function M(e,t){var n=q(e)?W(e):e.val();var r=/^[^\W_]/.test(n);if(r)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This first character must be a letter or number","ui_validation")(),t)}function A(e,t){var r=$.extend({},t,{quiet:true});if(f(e,r))if(v(e,r,n,true))if(I(e,r))if(D(e,r,/^[\w._-]+$/))if(M(e,r)){if(C(e,r))return!!p(e,t,TS.interop.constants.RESERVED_USERNAMES.join(","));TS.ui.validation.showWarning(e,i.lowercase,t)}else TS.ui.validation.showWarning(e,i.firstalphanumeric,t);else TS.ui.validation.showWarning(e,i.specials,t);else TS.ui.validation.showWarning(e,i.specials,t);else TS.ui.validation.showWarning(e,i.maxlength,t);else TS.ui.validation.showWarning(e,i.required,t)}function E(t,n,i){var s=$.extend({},n,{quiet:true});if(t.is('input[type="radio"]')||t.is('input[type="checkbox"]')||t.is("select"))return true;if(!q(t)){TS.error("Error: cannot validate");return}var o=_.trim(W(t));var l=TS.interop.i18n.deburr(o.toLowerCase());var u=z(i);if(_.includes(u,"required")&&!f(t,s)){TS.ui.validation.showWarning(t,a.required,n);return false}if(!v(t,s,e,true)){TS.ui.validation.showWarning(t,a.maxlength,n);return false}var d=TS.interop.constants.RESERVED_USERNAMES.concat(TS.model.RESERVED_KEYWORDS).map(function(e){return TS.interop.i18n.deburr(e)});if(-1!==d.indexOf(l)){TS.ui.validation.showWarning(t,a.reserved,n);return false}if("@"===o.charAt(0)){TS.ui.validation.showWarning(t,a.at_sign,n);return false}if(D(t,s,/^[-_.'\u2018\u2019",(){}[\]\/;]+$/)){TS.ui.validation.showWarning(t,r.punctuation,n);return false}if(D(t,s,/[`~!@#$%^&*+=\\:"<>?|]/)){TS.ui.validation.showWarning(t,a.specials,n);return false}if(TS.emoji.hasUnifiedEmoji(o)){TS.ui.validation.showWarning(t,V(o),n);return false}return true}function P(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!q(e)){TS.error("Error: cannot validate");return}var r=W(e);var i=z(n);var a=_.includes(i,"fix");a&&(r=K(e));var s=TS.validation.channel_name_with_errors(r);if(true!==s){TS.ui.validation.showWarning(e,s.error_message,t);return false}return true}function F(e,t){t=t||{};var n=W(e).trim();var r=TS.validation.team_name(n);if(true!==r){t.should_truncate=false;"empty"===r.error_key?TS.ui.validation.showCustomValidation(e,r.error_message,t):TS.ui.validation.showError(e,r.error_message,t);return false}return true}function O(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var n=W(e);if(!n)return true;var r=n.match(TS.utility.email_regex);if(r&&1===r.length&&r[0]===n)return true;TS.ui.validation.showWarning(e,l.invalid,t)}else TS.error("Error: cannot validate")}function D(e,t,n){var r=q(e)?W(e):e.val();if(n.test(r))return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field contains invalid characters","ui_validation")(),t)}var H=function e(t){if(!isNaN(Date.parse(t))){var n=new Date(t);return!n.toISOString().indexOf(t)}};var j=function e(t,n,r){var i=$(document.querySelector('label[for="'+(r.custom_for||t.attr("name"))+'"]'));if(!i.length)return;return!(r&&r.quiet)&&n&&false===i.data("validation-ephemeral")};var B=function e(t,n,r,i,a){i=i||{};_.isUndefined(i.should_truncate)&&(i.should_truncate=true);if(i&&i.quiet)return;var s=$(document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]'));if(!s.length)return;var o=s.data("validation-timeout");clearTimeout(o);var l=s.find(".validation_message");if(!l.length){l=$("<span />").addClass("validation_message").toggleClass("overflow_ellipsis",i.should_truncate);t.is("select")?l.insertBefore(s.find("select")):l.appendTo(s)}N(t,s,r);if(!n){l.remove();return}l.get(0).title=n;l.fadeIn(100);s.data("validation-ephemeral",!!a);a&&s.data("validation-timeout",setTimeout(function(){s.removeData("validation-ephemeral").removeData("validation-timeout");l.fadeOut(100,function(){N(t,s);l.remove()})},a))};var L=["validation_error","validation_warning","validation_success"];var N=function e(t,n,r){if(n.hasClass(r))return;t.removeClass(L.join(" "));t.addClass(r);n.removeClass(L.join(" "));n.addClass(r)};var R=function e(t,n,r,i){r-n<=6?U(t,n,r,i):G(t,i)};var U=function e(t,n,r,i){var a=document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]');if(!a)return;var s=[n,r].join("/");$(a).attr("data-countdown",s).addClass("countdown");var o=window.getComputedStyle(a,":after");var l=parseFloat(o.width)||9*s.length;if(t.hasClass("no_validation_padding"))return;t.data("countdown-padding-right")||t.data("countdown-padding-right",parseFloat(t.css("padding-right")));t.css("padding-right",l+parseFloat(o.right)+t.data("countdown-padding-right"))};var G=function e(t,n){var r=document.querySelector('label[for="'+(n.custom_for||t.attr("name"))+'"]');if(!r)return;$(r).removeClass("countdown");t.removeData("countdown-padding-right");t.css("padding-right","")};var q=function e(t){if(TS.interop&&TS.interop.utility)return t.is("input")||t.is("textarea")||TS.interop.utility.isContentEditableElement(t);return t.is("input")||t.is("textarea")};var W=function e(t){if(TS.utility&&TS.utility.contenteditable)return TS.utility.contenteditable.value(t);return t.val()};var z=function e(t){if(!_.isString(t))return[];return _(t).split(",").map(_.trim).compact().value()};var K=function e(t){var n=W(t);var r=n.toLowerCase().replace(/^#+/,"");r=r.replace(/^\s+/,"");r=r.replace(/\s+$/,"");r=r.replace(/\s/g,"-");if(r&&n!==r){var i=TS.utility.contenteditable.cursorPosition(t).start;r.length<n.length&&(i-=n.length-r.length);t.val(r);TS.utility.contenteditable.cursorPosition(t,i)}return r};var V=function e(t){if(TS.boot_data.feature_i18n_channels_validate_emoji){var n=/(?:\uD83D\uDCA9)/;var r=[TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),TS.interop.i18n.t("Using emoji for names makes some sense, but sadly, not enough. Try again?","ui_validation","29a0641ffb224418f796bb16c7f79013ec377a4c")(),TS.interop.i18n.t("For technical reasons, emoji are not allowed in names. Try again?","ui_validation")(),TS.interop.i18n.t("Of course you want a name with an emoji. Sadly, it is not to be. Try letters?","ui_validation")()];if(t.match(n))return TS.interop.i18n.t("For reasons of party-pooping, names cannot contain emoji. Try again?","ui_validation")();return _.sample(r)}return a.emoji}})()},293:function(e,t){},2930:function(e,t){(function(){TS.registerModule("enterprise.workspaces",{onStart:function e(){},joinTeam:function e(n){var r=TS.teams.getTeamById(n);if(!r)return TS.generic_dialog.alert(TS.interop.i18n.t("Invalid workspace","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());if(!r.is_open&&!r.is_assigned)return TS.generic_dialog.alert(TS.interop.i18n.t("This workspace is not available to join.","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());var i={team:r.id};"client"===TS.boot_data.app&&(i.enterprise_token=TS.model.enterprise_api_token);var a=function e(n,r,i){var a=TS.teams.getTeamById(i.team);var s=new Handlebars.SafeString(emoji.replace_colons(":sparkles:")+TS.interop.i18n.t(" You\u2019ve successfully joined <strong>{team_name}</strong>","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(a)))}));if(n){TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(i.team),{joined_date:r.joined_date}));t("success",s);return true}if("user_already_team_member"===r.error){t("success",s);return true}if("team_is_not_open"===r.error){t("error",TS.interop.i18n.t("This workspace is not open to join.","enterprise_dashboard")());return false}t("error",TS.interop.i18n.t('Joining workspace failed with error "{error}"',"enterprise_dashboard")({error:r.error}));return false};return TS.interop.api.call("enterprise.teams.join",i).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}})},requestToJoinTeam:function e(n,r){var i={team:n};r&&(i=_.merge({},i,r));"client"===TS.boot_data.app&&(i.enterprise_token=TS.model.enterprise_api_token);var a=function e(n,r,i){var a=TS.teams.getTeamById(i.team);var s=new Handlebars.SafeString(TS.interop.i18n.t("Request to join <strong>{team_name}</strong> sent!","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(a)))}));if(n){TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(i.team),{has_join_request:true}));t("success",s);return true}t("error",TS.interop.i18n.t("Your request couldn\u2019t be sent. Try again later, or contact the Workspace Admin for help.","enterprise_dashboard")({error:r.error}));return false};return TS.interop.api.call("enterprise.teams.joinrequests.create",i).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}})},createLogoutURL:function e(t,n){var r=document.createElement("a");r.href=n;var i=r.protocol+"//"+r.host+"/signout/"+t+r.search+r.hash;r=null;return i},recordTeamLeave:function t(n,r,i){i||(i="");var a={anchor_page:r,entity_key:"leave_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeaveConfirm:function t(n,r,i){i||(i="");var a={anchor_page:r,entity_key:"leave_workspace_confirm",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},showRequestDialog:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.displayModernToast,r=void 0===n?_.noop:n;var i="#generic_dialog";var a=".dialog_go";var s="enterprise.teams.creationrequests.create";var o="#input_ws_team_name";var l="#textarea_ws_team_message";var u;var d;function c(){var e=$(i);var t=e.find(a);if(u&&d){t.removeAttr("disabled");return true}t.attr("disabled",true);return false}TS.generic_dialog.start({title:TS.interop.i18n.t("Request creation of a new workspace","enterprise_workspaces")(),body:TS.templates.ws_request_dialog(),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Send Request","enterprise_workspaces")(),onGo:function e(){var t=$(i);var n=$(o);var u=n.val();var d=$(l);var c=d.val();var _=t.find(a);_.addClass("ladda-button");_.attr("data-style","expand-right");var m=Ladda.create(_[0]);m.start();var f={name:u,reason:c};"client"===TS.boot_data.app&&(f.enterprise_token=TS.model.enterprise_api_token);TS.interop.api.callExpedited(s,f).then(function(){r({type:"success",teamName:u});TS.generic_dialog.end();TS.generic_dialog.cancel()}).catch(function(e){if(!e||!e.data){TS.error("WTF: error, but no response or data on "+s+"?",e);return}var t=e.data;r({type:"error",errorType:t.error,teamName:u});TS.error(s+" failed with error: "+(t.error||"undefined"));m.stop()});return false}});$(o).on("keyup change",function(){u=TS.ui.validation.validate($(o));c()});$(l).on("keyup change",function(){d=TS.ui.validation.validate($(l));c()});$(o).focus();$(i).find(a).attr("disabled",true)}});var e="ENTERPRISE_DISCOVER_WORKSPACES";var t=function e(t,n){TS.ui.toast.show({type:t,message:n})}})()},2931:function(e,t){(function(){TS.registerModule("help",{issues_sorted_sig:new signals.Signal,issues:[],more_url:null,fake_api_rsps:false,max_title_chars:100,onStart:function e(){if(!TS.client)return;TS.redux.socket.connectedSig.addOnce(function(){TS.interop.api.call("help.issues.list",{}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.help.onListIssues&&TS.help.onListIssues(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.help.onListIssues&&TS.help.onListIssues(i,t,n,r);return{data:t,args:n,request_id:r}})})},getIssueById:function e(t){var n;for(var r=0;r<TS.help.issues.length;r+=1){n=TS.help.issues[r];if(n.id==t)return n}return null},onListIssues:function e(t,n){if(TS.help.fake_api_rsps){TS.help.more_url="/help";TS.help.issues=[{id:"T00001",title:"issue 1",ts:"1111111111",short_text:"blah blah blah blah blah",state:"resolved"},{id:"T00002",title:"issue 2",ts:"1141111111",short_text:"I think this is ok",state:"open"},{id:"T00003",title:"issue 3",ts:"1121111111",short_text:"but I am not so sure abotu this",state:"unread"},{id:"T00004",title:"issue 4",ts:"1161111111",short_text:"what about that?",state:"open"},{id:"T00005",title:"issue 5",ts:"1151111111",short_text:"fuck it all to hell",state:"open"},{id:"T00006",title:"issue 6",ts:"1171111111",short_text:"MORE BATTRY PLZ",state:"read"},{id:"T00007",title:"issue 7",ts:"1191111111",short_text:"halp",state:"unread"},{id:"T00008",title:"issue 8",ts:"191111111",short_text:"halp",state:"unread"},{id:"T00009",title:"issue 9",ts:"181111111",short_text:"halp",state:"unread"},{id:"T000010",title:"issue 10",ts:"171111111",short_text:"halp halp halp halp halp halp halp halp halp halp ...",state:"unread"}]}else t&&(TS.help.issues=n.issues);TS.help.sortIssues();TS.help.updateIcon()},sortIssues:function e(){var t={unread:4,open:3,read:2,resolved:1};var n;for(var r=0;r<TS.help.issues.length;r+=1){n=TS.help.issues[r];n._sorter=parseFloat((t[n.state]||5)+"."+n.ts)}TS.help.issues.sort(function e(t,n){if(t._sorter<n._sorter)return 1;if(t._sorter>n._sorter)return-1;return 0});TS.help.issues_sorted_sig.dispatch()},updateIcon:function e(){var t="normal";var n=0;var r;for(var i=0;i<TS.help.issues.length;i+=1){r=TS.help.issues[i];if("unread"===r.state){t="unread";n+=1}}$("#flex_menu_toggle").removeClass("normal open unread").addClass(t);$("#help_icon_circle_count, .help_icon_circle_count").addClass("hidden");n>9&&(n="9+");n&&$("#help_icon_circle_count, .help_icon_circle_count").removeClass("hidden").text(n)},createIssue:function e(t,n){var r=t.title;var i=t.text;if(!r)return;i=i||"";var a={title:r,text:i};t.tags&&(a.tags=t.tags);var s=function e(t,a){if(!t&&TS.help.fake_api_rsps){var s={id:Date.now(),title:r,ts:Date.now()/1e3,short_text:i.substr(0,50),state:"open"};setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_created",issue:s}))},2e3)}n&&n(t,TS.help.makeErrStr(a))};TS.interop.api.call("help.issues.create",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})},fetchIssueDetails:function e(t,n){var r=TS.help.getIssueById(t);if(!r){n&&n(false,r,"unknown issue");return}var i=function e(t,i){var a;if(TS.help.fake_api_rsps){t=true;a=_.cloneDeep(r);a.comments=[{ts:112211111,from:"eeric",text:"comment 1"},{ts:112214444,from:"whoop",text:"comment 2"}]}else t&&(a=i.issue);TS.help.onIssueChange(a);n&&n(t,r,TS.help.makeErrStr(i))};TS.interop.api.call("help.issues.info",{id:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},markIssueRead:function e(t,n){var r=TS.help.getIssueById(t);if(!r){n&&n(false,"unknown issue");return}if("unread"!==r.state){n&&n(true);return}var i=function e(t,i){if(!t&&TS.help.fake_api_rsps){var a=_.cloneDeep(r);a.state="read";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},2e3)}n&&n(t,TS.help.makeErrStr(i))};TS.interop.api.call("help.issues.markRead",{id:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},replyToIssue:function e(t,n,r){var i=function e(t,n){r&&r(t,TS.help.makeErrStr(n),n&&n.error?n.error:"")};TS.interop.api.call("help.issues.replyTo",{id:t,text:n}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},markIssueResolved:function e(t,n){var r=TS.help.getIssueById(t);if(!r){n&&n(false,"unknown issue");return}var i=function e(t,i){if(TS.help.fake_api_rsps||!t&&i&&"ticket_closed"===i.error){t=true;var a=_.cloneDeep(r);a.state="resolved";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},1e3)}n&&n(t,TS.help.makeErrStr(i))};TS.interop.api.call("help.issues.markResolved",{id:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},onIssueChange:function e(t){var n=TS.help.getIssueById(t.id);n?TS.help.updateIssue(t,n):TS.help.issues.push(t);TS.help.sortIssues();TS.help.updateIcon()},updateIssue:function e(t,n){_.forOwn(t,function(e,t){n[t]=e});n.comments&&n.comments.sort(function e(t,n){if(t.ts<n.ts)return 1;if(t.ts>n.ts)return-1;return 0})},makeErrStr:function e(t){if(!t)return"missing data";if(t.ok)return null;if(t.error&&t.info&&TS.boot_data.feature_tinyspeck)try{return'api error: "'+t.error+'"<br><br><div class="admin-section" style="word-wrap: break-word; word-break: break-word;">api rsp: '+JSON.stringify(t).replace(/,/g,", ")+"</div>"}catch(e){}if(t.error)return'api error: "'+t.error+'"'}})})()},2932:function(e,t){(function(){TS.registerModule("ui.share_dialog",{div:null,showing:false,delegate:void 0,onStart:function e(){TS.files.team_file_changed_sig.add(i);TS.files.team_file_comment_added_sig.add(a);TS.files.team_file_comment_deleted_sig.add(a)},onKeydown:function e(t){if(!TS.ui.share_dialog.showing)return;if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){TS.ui.share_dialog.go();t.preventDefault()}}else t.which==TS.utility.keymap.esc&&"BODY"===TS.utility.getActiveElementProp("NODENAME")&&TS.ui.share_dialog.cancel()},start:function e(i,a,s,o,l,u){if(TS.client&&TS.client.ui.checkForEditing())return;if(TS.boot_data.feature_file_threads){TS.redux.dispatch(TS.interop.redux.actions.openShareDialog({fileId:i,initialChannelId:r()}));return}n=false;t=i;var d=TS.files.getFileById(i);var c="file";"post"===d.mode?c="file_post":"space"===d.mode?c="file_space":"snippet"===d.mode?c="file_snippet":"docs"===d.mode&&(c="file_arugula");var _=TS.templates.builders.buildFileSharingControls(d,true,null,s);var m=a?"":TS.templates.builders.fileHTML(d,{for_share_dialog:true});var f={type:c,item:d,item_owner:TS.interop.members.getMemberById(d.user),sharing_html:new Handlebars.SafeString(_),file_html:new Handlebars.SafeString(m),show_copy_link:d.permalink&&TS.clipboard.canWriteText()};f.icon_class=TS.utility.getImageIconClass(d,"thumb_80");TS.ui.share_dialog.div||TS.ui.share_dialog.build();var p=TS.templates.share_dialog(f);p=TS.format.replaceHighlightMarkers(p);var h=TS.ui.share_dialog.div;h.html(p);var g=$("#file_comment_textarea");TS.ui.comments.bindInput(g,TS.ui.share_dialog.go);l&&TS.utility.contenteditable.value(g,l);g=null;h.modal("show");h.find(".dialog_cancel").click(TS.ui.share_dialog.cancel);h.find(".dialog_go").click(TS.ui.share_dialog.go);TS.ui.file_share.bindFileShareDropdowns(TS.utility.members.getEntityFromFile(d),{id:o},void 0,u);TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField()},go:function e(){if(n){TS.info("TS.ui.share_dialog stopping because already sharing");return}if(!TS.ui.share_dialog.showing){TS.error("not showing?");return}var r=$("#select_share_channels").lazyFilterSelect("value")[0];var i=_.trim(TS.utility.contenteditable.value($("#file_comment_textarea")));i=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(i,{enableBroadcastKeywords:false});var a=r&&r.model_ob||{};TS.interop.utility.looksLikeMemberId(a.id)&&(a=TS.redux.channels.getImByMemberId(a.id)||a);TS.interop.utility.isModelObjectExternal(a)&&(i="");var s=function e(){TS.shared.legacyGetShareModelObId(u,function(e){var n=false;TS.files.shareFile(t,e,i,n).then(function(){t=null;if(!TS.client)return;var n=TS.redux.channels.getEntityById(e);if(!n)return;var r=TS.shared.legacyGetActiveModelOb();var i=r&&r.id===n.id;if(!i)return TS.client.displayModelOb(n)})})};if(r&&r.model_ob&&r.model_ob.create_channel){var o=t;TS.ui.new_channel_modal.start(r.model_ob.name).then(function(e){t=o;u=e.id;s();return null}).catch(function(){TS.ui.share_dialog.start(o,false,false,false,i);return null});TS.ui.share_dialog.cancel();return false}if(!TS.interop.utility.isModelObjectExternal(a)&&TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var l=$("#share_dialog");var u=l.find("#share_model_ob_id").val();u||r&&(u=r.model_ob.id);if(!u){TS.warn("model_ob_id is not set! "+$("#select_share_channels").val());return}TS.ui.share_dialog.delegate&&"function"===typeof TS.ui.share_dialog.delegate.submit?TS.ui.share_dialog.delegate.submit(l,s):s();n=true;TS.ui.share_dialog.div.modal("hide")},cancel:function e(){t=null;TS.ui.share_dialog.div.modal("hide")},end:function t(){e&&e.detachEvents&&e.detachEvents();e=null;TS.model.dialog_is_showing=false;TS.ui.share_dialog.showing=false;TS.ui.share_dialog.div.empty();$(window.document).unbind("keydown",TS.ui.share_dialog.onKeydown)},build:function t(){$("body").append('<div id="share_dialog" tabindex="-1" class="modal hide fade"></div>');TS.ui.share_dialog.div=$("#share_dialog");var n=TS.ui.share_dialog.div;n.on("hidden",function(e){if(e.target!=this)return;TS.ui.share_dialog.end()});n.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.share_dialog.showing=true});n.on("shown",function(t){if(t.target!=this)return;var n=$("#select_share_channels").lazyFilterSelect("value");n.length<1?$("#select_share_channels").lazyFilterSelect("getInstance").$input.focus():TS.utility.contenteditable.focus($("#file_comment_textarea"));$(window.document).bind("keydown",TS.ui.share_dialog.onKeydown);e=TS.ui.share_dialog.div.find("img.lazy").lazyload()})}});var e=null;var t;var n=false;var r=function e(){if(!TS.boot_data.feature_file_threads)return null;if(!TS.web||!TS.web.space)return null;var t=TS.web.space.getOriginChannel();if(!t)return null;return t};var i=function e(n){if(TS.ui.share_dialog.showing&&t===n.id){var r=!TS.interop.files.isObjectFresh(n.id);if(r){TS.files.getFileById(n.id);return}s(n);o(n)}};var a=function e(n){TS.ui.share_dialog.showing&&t===n.id&&o(n)};var s=function e(t){TS.templates.builders.updateFileShareLabels(t);$("#select_share_at_channel_list").html(TS.templates.builders.makeFileCommentHelpHTML(t))};var o=function e(t){var n=TS.templates.makeFileDomId(t);$("#"+n).replaceWith(TS.templates.builders.fileHTML(t,{for_share_dialog:true}));var r=$("#"+n).find("img.lazy");r.removeClass("lazy").attr("src",r.attr("data-original"))}})()},2933:function(e,t){(function(){TS.registerModule("pins",{pins_fetched_sig:new signals.Signal,pinned_status_changed_sig:new signals.Signal,pinned_message_changed_sig:new signals.Signal,pinned_message_deleted_sig:new signals.Signal,onStart:function e(){TS.files.team_file_comment_deleted_sig.add(p);TS.files.team_file_deleted_sig.add(h);TS.redux.socket.connectedSig.add(g);TS.channels.left_sig.add(S)},fetchPins:function e(n){if(!n)return;t[n.id]=true;if(TS.isPartiallyBooted())return new Promise(function(e){TS.boot_data.feature_degraded_send?TS.ensureFullyBooted().then(function(){return TS.pins.fetchPins(n)}):TS.redux.socket.connectedSig.addOnce(function(){e(TS.pins.fetchPins(n))})});return TS.interop.api.call("pins.list",{channel:n.id}).then(function(e){TS.pins.onFetchPins(e,n)}).catch(function(e){TS.logError("Failed to fetch pins for model ob: "+n.id,e)}).finally(function(){delete t[n.id]})},onFetchPins:function t(n,r){var i=n.data.items;TS.pins.upsertPinnedItems(i);r.pinned_items=i;r.pinned_items_count=i.length;r.has_pins=!!r.pinned_items_count;r.is_channel&&!r.is_member||(e[r.id]=true);TS.pins.pins_fetched_sig.dispatch(r,i)},arePinsCurrentlyBeingFetched:function e(n){return!!t[n.id]},havePinsBeenFetched:function t(n){return!!e[n.id]},clearHavePinsBeenFetched:function n(r){if(r&&r.id){r.pinned_items=[];delete e[r.id];delete t[r.id]}},startPinFile:function e(t,n){var r=TS.files.getFileById(t);if(!r)return;u("file",n,{file:r,type:"file"})},unPinFile:function e(t,n){var r=i(t,n);if(!r)return;var a={file:r,type:"file"};f(a,n,function(){c(n,a)})},startPinFileComment:function e(t,n,r){var i=TS.files.getFileById(n);if(!i)return;var a=TS.files.getFileCommentById(i,t);if(!a)return;u("comment",r,{file:i,comment:a,type:"file_comment"})},unPinFileComment:function e(t,n,r){var i=a(t,n,r);var s=TS.files.getFileById(n);if(!i||!s)return;var o={file:s,comment:i,type:"file_comment"};f(o,r,function(){c(r,o)})},startPinMessage:function e(t,n){t=t.toString();var r=TS.utility.msgs.findMsg(t,n.id);r&&("file_comment"===r.subtype?TS.pins.startPinFileComment(r.comment.id,r.file.id||r.file,n):r.file?TS.pins.startPinFile(r.file.id||r.file,n):u("message",n,{message:r,type:"message"}))},unPinMessage:function e(t,n){t=t.toString();var r=s(t,n);if(r)if("file_comment"===r.subtype)TS.pins.unPinFileComment(r.comment.id,r.file.id||r.file,n);else if(r.file)TS.pins.unPinFile(r.file.id||r.file,n);else{var i={message:r,type:"message"};f(i,n,function(){c(n,i)})}},isMessagePinned:function e(t,n){if("file_comment"===t.subtype){if(!t.comment)return false;return!!a(t.comment.id,t.file.id||t.file,n)}if(t.file)return!!i(t.file.id||t.file,n);return!!s(t.ts,n)},pinStatusHasChanged:function e(t,n,i,a,s,u){var d;var c;var _;var m;var f;var p;t&&u&&(p={pinnedBy:u.pinned_by,pinnedTs:u.pinned_ts});var h=n.file;h&&1===Object.keys(h).length&&(h=TS.files.getFileById(n.file.id));if("message"===i&&a){d=TS.utility.msgs.findMsg(n.message.ts,a.id);if(d){n.message=d;_=o(t,d,a)}}else if(h&&"file_comment"===i){f=TS.files.upsertFile(h,"pinStatusHasChangedComment");r(h.id,n);c=TS.files.getFileCommentById(h,n.comment.id);if(c){n.comment=c;_=o(t,c,a)}else{c=TS.files.addCommentToFile(n.comment,h);n.comment=c}_=_||"CHANGED"===f.status}else if(h&&"file"===i){h=TS.interop.rules.files.extendFileWithPinnedInfo(h,a.id,p);f=TS.files.upsertFile(h,"pinStatusHasChangedFile");r(h.id,n);_=o(t,h,a);_=_||"CHANGED"===f.status}m=l(t,n,i,a,s);(_||m)&&TS.pins.pinned_status_changed_sig.dispatch(a,n,t);if(_&&"message"===i){d=TS.interop.rules.messages.extendMessageWithPinnedInfo(d,p);TS.redux.messages.replaceMessage(d)}},upsertPinnedItems:function e(t){if(_.isEmpty(t))return;t.forEach(function(e){if("message"===e.type&&e.message&&TS.interop.messages.shouldRenderFileThread(e.message)){var t=e.message;t.files&&t.files.forEach(function(e){TS.files.upsertFile(e,"upsertPinnedItems")})}if("file"===e.type||"file_comment"===e.type){var n=e.file&&e.file.id;TS.files.upsertFile(e.file,"upsertPinnedItems");r(n,e)}if("file_comment"===e.type){var i=TS.files.getFileCommentById(e.file,e.comment.id);i||(i=TS.files.addCommentToFile(e.comment,e.file));e.comment=i}})},replaceMsg:function e(t,n){if(!n.pinned_items)return;n.pinned_items.forEach(function(e){if("message"===e.type&&e.message.ts===t.ts){e.message=t;TS.pins.pinned_message_changed_sig.dispatch(n,e)}})},legacyRemoveMsg:function e(t,n){if(!n.pinned_items)return;l(false,{message:{ts:t}},"message",n);TS.pins.pinned_message_deleted_sig.dispatch(n)},canUserPinHere:function e(t){if(!TS.client||!t)return false;if(!TS.permissions.members.canPostInChannel(t))return false;if(t.is_channel&&!t.is_member)return false;return true},updateCount:function e(t,n){if(!t)return;var r=t.pinned_items_count;t.pinned_items_count=TS.pins.havePinsBeenFetched(t)?_.get(t,"pinned_items.length"):n;if(r===t.pinned_items_count)return;t.has_pins=!!t.pinned_items_count;TS.pins.pinned_status_changed_sig.dispatch(t)},getUnreadPins:function e(t){var n;var r=[];if(!t)return r;var i=t._marked_reason;if("0000000000.000000"===t.last_read&&"back"!==i)return r;if(TS.model.ui.is_window_focused)if("back"===i){var a=TS.utility.msgs.getDisplayedMsgAfterTS(t.last_read,t.msgs);n=a?parseFloat(a.ts)-1:t.last_read}else n=!t._prev_last_read||i&&"viewed"!==i?t.last_read:t._prev_last_read;else n=t.last_read;var s=t.pinned_items;if(_.isEmpty(s))return r;_.forEach(s,function(e){var t=TS.interop.members.getMemberById(e.created_by);if(!t)return;e.created>Math.ceil(n)&&(t.is_self&&"back"===i?r.push(e):t.is_self||r.push(e))});return r},test:function t(){return{fileDeleted:h,fileCommentDeleted:p,have_pins_been_fetched:e}}});var e={};var t={};var n=false;var r=function e(t,n){if(!n||!t||!TS.files.getFileById(t))return;Object.defineProperty(n,"file",{enumerable:true,configurable:true,get:function e(){return TS.files.getFileById(t)},set:function e(){return false}})};var i=function e(t,n){var r=TS.files.getFileById(t);if(!r||!r.pinned_to)return null;var i=-1!==r.pinned_to.indexOf(n.id);return i?r:null};var a=function e(t,n,r){var i=TS.files.getFileById(n);if(!i)return null;var a=TS.files.getFileCommentById(i,t);if(!a||!a.pinned_to)return null;var s=-1!==a.pinned_to.indexOf(r.id);return s?a:null};var s=function e(t,n){if(n.pinned_items){var r;for(var s=0;s<n.pinned_items.length;s+=1){r=n.pinned_items[s];if("message"===r.type&&r.message.ts===t)return r.message}}var o=TS.utility.msgs.findMsg(t,n.id);if(!o)return null;if("file_comment"===o.subtype){if(a(o.comment.id,o.file.id||o.file,n))return o}else if(o.file){if(i(o.file.id||o.file,n))return o}else if(o.pinned_to&&-1!==o.pinned_to.indexOf(n.id))return o;return null};var o=function e(t,n,r){var i=false;n.pinned_to||(n.pinned_to=[]);if(t){if(-1===n.pinned_to.indexOf(r.id)){n.pinned_to.push(r.id);i=true}}else{var a=n.pinned_to.indexOf(r.id);if(-1!==a){n.pinned_to.splice(a,1);i=true}}return i};var l=function e(t,n,r,i,a){var s=false;i.pinned_items||(i.pinned_items=[]);var o=-1;i.pinned_items.some(function(e,t){var i=false;"message"===r&&"message"===e.type?e.message.ts===n.message.ts&&(i=true):"file"===r&&"file"===e.type?e.file.id===n.file.id&&(i=true):"file_comment"===r&&"file_comment"===e.type&&e.comment.id===n.comment.id&&(i=true);i&&(o=t);return i});if(TS.pins.havePinsBeenFetched(i))if(t||-1===o){if(t&&-1===o){i.pinned_items.unshift(n);i.pinned_items_count=i.pinned_items.length;s=true}}else{i.pinned_items.splice(o,1);i.pinned_items_count=i.pinned_items.length;s=true}else{i.pinned_items_count=i.pinned_items_count||0;var l=_.parseInt(a,10);_.isNaN(l)?t?i.pinned_items_count+=1:t||(i.pinned_items_count=Math.max(i.pinned_items_count-1,0)):i.pinned_items_count=l;s=true}i.has_pins=!!i.pinned_items_count;return s};var u=function e(t,n,r){var i="";var a="";var s="";switch(t){case"file":i=TS.interop.i18n.t("Are you sure you want to pin this file to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.interop.i18n.t("Pin file","pins")();s=TS.interop.i18n.t("Yes, pin this file","pins")();break;case"comment":i=TS.interop.i18n.t("Are you sure you want to pin this comment to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.interop.i18n.t("Pin comment","pins")();s=TS.interop.i18n.t("Yes, pin this comment","pins")();break;case"message":i=TS.interop.i18n.t("Are you sure you want to pin this message to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.interop.i18n.t("Pin message","pins")();s=TS.interop.i18n.t("Yes, pin this message","pins")();break;default:break}var o="<p>"+i+"</p>"+TS.client.channel_page.pinnedItemHtml(r,n);TS.generic_dialog.start({title:a,body:o,go_button_text:s,onGo:function e(){d(n,r)}})};var d=function e(t,n){var r=m(t,n);var i=TS.interop.datetime.makeTsStamp(null,{padder:"0"});var a=function e(r,a){if(!r){if("too_many_pins"===a.error){var s="message";"file"===n.type&&(s="file");"file_comment"===n.type&&(s="comment");TS.generic_dialog.start({title:TS.interop.i18n.t("Couldn\u2019t pin {type}","pins")({type:s}),body:"<p>"+TS.interop.i18n.t("Sorry! You\u2019ve hit the limit on how many pins you can have in this channel.","pins")()+"</p>",show_cancel_button:false})}else TS.info("pins.add got a not ok rsp: "+a.error);if("already_pinned"!==a.error)return}TS.boot_data.feature_degraded_send&&!TS.interop.redux.features.socket.isConnected(TS.redux.getState())&&TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:t.id}));if(!TS.pins.havePinsBeenFetched(t))return;n.created=i;n.created_by=TS.boot_data.user_id;TS.pins.pinStatusHasChanged(true,n,n.type,t)};TS.interop.api.call("pins.add",r).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}})};var c=function e(t,n){var r=m(t,n);var i=function e(r,i){if(!r&&"not_pinned"!==i.error)return;TS.boot_data.feature_degraded_send&&!TS.interop.redux.features.socket.isConnected(TS.redux.getState())&&TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:t.id}));if(!TS.pins.havePinsBeenFetched(t))return;TS.pins.pinStatusHasChanged(false,n,n.type,t)};TS.interop.api.call("pins.remove",r).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})};var m=function e(t,n){var r={channel:t.id};"message"===n.type?r.timestamp=n.message.ts:"file"===n.type?r.file=n.file.id:"file_comment"===n.type&&(r.file_comment=n.comment.id);return r};var f=function e(t,n,r){TS.client.channel_page.highlightPinnedItemForRemoval(t);var i=TS.client.channel_page.pinnedItemHtml(t,n);TS.generic_dialog.start({title:TS.interop.i18n.t("Remove Pinned Item","pins")(),body:"<p>"+TS.interop.i18n.t("Are you sure you want to remove this pinned item?","pins")()+"</p>"+i,go_button_text:TS.interop.i18n.t("Yes, remove this pinned item","pins")(),onGo:r,onCancel:function e(){TS.client.channel_page.unHighlightPinnedItemForRemoval(t)}})};var p=function e(t,n,r){if(!r||!r.pinned_to)return;r.pinned_to.forEach(function(e){var t=TS.redux.channels.getEntityById(e);if(!t)return;var n=l(false,{comment:r},"file_comment",t);n&&TS.pins.pinned_status_changed_sig.dispatch(t)})};var h=function e(t){if(!t)return;t.pinned_to&&t.pinned_to.forEach(function(e){var n=TS.redux.channels.getEntityById(e);if(!n)return;var r=l(false,{file:t},"file",n);r&&TS.pins.pinned_status_changed_sig.dispatch(n)});t.comments&&t.comments.forEach(function(e){p(t,e.id,e)})};var g=function r(){if(n){e={};t={}}else n=true};var S=function n(r){var i=r||TS.shared.legacyGetActiveModelOb();if(i&&i.id){delete e[i.id];delete t[i.id]}}})()},2934:function(e,t){(function(){TS.registerModule("inline_file_previews",{expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){_();this.collapse_sig.add(a);this.expand_sig.add(s);$("#messages_container").on("keydown",".preview_show_more .preview_show_btn",i);$("#messages_container").on("keydown",".preview_show_less .preview_show_btn",i)},checkForInlineFilePreviewClick:function e(t){var n=$(t.target);var i;var a=n.closest(".message");if(0===a.length)return;if(n.hasClass("service_link")||n.closest(".service_link")>0)return;var s=a.attr("id");var u=n.closest(".msg_inline_file_preview_toggler");var c=n.closest(".msg_inline_media_toggler");var _=TS.boot_data.feature_file_threads?c.length>0:u.length>0;if(_){t.preventDefault();i=u.data("file-id");var m=a.attr("data-ts");u.hasClass("collapsed")?r(s,m,i):o(s,m,i);return true}var f=n.closest(".inline_file_preview_container, .file_container");if(0===f.length)return;var p=n.closest("ts-message");var h=""+p.data("ts");var g=p.data("model-ob-id");var S={message_timestamp:h,channel_id:g,channel_type:g?g.charAt(0):"",member_id:p.data("member-id"),app_id:p.data("app-id"),bot_id:p.data("bot-id")};if(n.closest(".preview_show.preview_show_more").length>0){t.preventDefault();l(t,a,f);TS.interop.clog.track("PREVIEW_EXPAND",S);return true}if(n.closest(".preview_show.preview_show_less .preview_show_btn, .preview_show_less_header").length>0){t.preventDefault();d(t,a,f);TS.interop.clog.track("PREVIEW_COLLAPSE",S);return true}if(n.closest("a").length)return false;i=f.data("file-id");var T=TS.files.getFileById(i);if(!T)return false;if(("space"===T.mode||"post"===T.mode||"docs"===T.mode||"email"===T.mode||"snippet"===T.mode)&&f.hasClass("inline_collapsed")){t.preventDefault();l(t,a,f);return true}return false},shouldTruncate:function e(t){if(!t)return false;if("snippet"===t.mode){if(t.lines_more>0||t.preview_is_truncated)return true}else if("post"===t.mode||"space"===t.mode){if(!t.preview)return false;if(t.preview.length>=400)return true;if(t.preview.split(" ").length>=50)return true;if(t.preview.split("\n").length>=4)return true;var n=t.preview.match(/<\/(?:h\d|p|li|pre|blockquote)>/g)||[];var r=t.preview.match(/<hr>/g)||[];var i=n.concat(r);if(i.length>=4)return true}else if("email"===t.mode)return true;return false},isTruncated:function t(n,r){if(!r)return false;return!e[n+"_"+r.id]},expandableState:function e(t,n){if(TS.model.expandable_state["inline_file_"+t+n])return true;if(false===TS.model.expandable_state["inline_file_"+t+n])return false},shouldExpand:function e(t,n){var r=TS.inline_file_previews.expandableState(t,n);if("boolean"===typeof r)return r;return true},expandAllInCurrent:function e(){t=true;$(".msg_inline_file_preview_toggler").each(function(e,t){var n=$(t);var i=n.data("file-id");var a=n.closest(".message").attr("id");var s=n.closest(".message").attr("data-ts");r(a,s,i)});t=false},collapseAllInCurrent:function e(){$(".msg_inline_file_preview_toggler").each(function(e,t){var n=$(t);var r=n.data("file-id");var i=n.closest(".message").attr("id");var a=n.closest(".message").attr("data-ts");o(i,a,r)})},test:function e(){return{actuallyExpandContent:u}}});var e={};var t=false;var n=false;var r=function e(n,r,i){var a="inline_file_msg_"+r.replace(".","_")+i;TS.model.expandable_state[a]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var s="#"+TS.utility.makeSafeForDomId(n);var o=$(s);if(!o.length)return;var l=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var u=function e(){if(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+i+'"]').length>0)return true;return $(this).data("file-id")==i};var d=o.find(".inline_file_preview_container, .file_container").filter(u);o.find(".msg_inline_file_title_hider").filter(u).addClass("hidden");o.find('.msg_inline_file_preview_toggler[data-file-id="'+i+'"]').removeClass("collapsed").addClass("expanded");d.removeClass("hidden");TS.client&&TS.client.ui.checkInlineImgsAndIframesEverywhere();d.css("opacity",0).stop().animate({opacity:1},300);t||(TS.client&&l?d.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"}):d.scrollintoview({duration:200,offset:"bottom",px_offset:0,direction:"y"}));TS.inline_file_previews.expand_sig.dispatch(n);TS.client&&TS.ui.utility.updateClosestMonkeyScroller(o)};var i=function e(t){13!=t.which&&32!=t.which||(n=true)};var a=function e(){n&&$(".preview_show_more .preview_show_btn").focus().addClass("focus-ring");n=false};var s=function e(){n&&$(".preview_show_less .preview_show_btn").focus().addClass("focus-ring");n=false};var o=function e(t,n,r){var i="inline_file_msg_"+n.replace(".","_")+r;TS.model.expandable_state[i]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var a="#"+TS.utility.makeSafeForDomId(t);var s=$(a);if(!s.length)return;var o=function e(){if(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+r+'"]').length>0)return true;return $(this).data("file-id")==r};var l=s.find(".inline_file_preview_container, .file_container").filter(o);s.find(".msg_inline_file_title_hider").filter(o).removeClass("hidden");s.find('.msg_inline_file_preview_toggler[data-file-id="'+r+'"]').removeClass("expanded").addClass("collapsed");l.addClass("hidden");TS.inline_file_previews.collapse_sig.dispatch(t);setTimeout(function(){TS.client&&TS.ui.utility.updateClosestMonkeyScroller(s)},0)};var l=function e(t,n,r){var i=r.data("file-id");var a=TS.files.getFileById(i);if(!a)return;if("post"===a.mode||"space"===a.mode||"snippet"===a.mode){var s=r.find(".preview_show_more .preview_show_btn");s.data("stashed_text",s.html()).empty();var o=new Spinner({lines:9,length:0,width:4,radius:5,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:25,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"-8px",left:"-4px",opacity:.1});o.spin(s.get(0));r.addClass("loading");TS.files.fetchFileInfo(i,function(e,t){o.stop();s.html(s.data("stashed_text"));r.removeClass("loading");(t.content_html||t.content_highlight_html)&&u(n,t);TS.utility.welcome_post.clogWelcomePostExpand(t)})}else if("email"===a.mode)if(a.simplified_html){TS.view.rebuildMsgFile(n.data(),a);u(n,a)}else{n.find(".email_content").addClass("loading");var l=setTimeout(function(){n.find(".inline_file_preview_container, .file_container").addClass("expanded")},1e3);TS.files.fetchFileInfo(i,function(e,t){clearTimeout(l);TS.view.rebuildMsgFile(n.data(),t);u(n,t);n.find(".email_content").removeClass("loading")})}};var u=function t(n,r){var i=n.attr("id");var a=i+"_"+r.id;e[a]=true;if(!n.parent("body").length){var s=$("#"+i);s.length&&(n=s)}n.find(".inline_file_preview_container, .file_container").removeClass("inline_collapsed").addClass("inline_expanded");TS.inline_file_previews.expand_sig.dispatch(n);TS.client&&TS.ui.utility.updateClosestMonkeyScroller(n)};var d=function n(r,i,a){var s=i.attr("id");var o=a.data("file-id");var l=TS.files.getFileById(o);if(!l)return;var u=s+"_"+o;delete e[u];i.find(".inline_file_preview_container, .file_container").removeClass("inline_expanded").addClass("inline_collapsed");if(!t){var d=i[0].getBoundingClientRect();d.top<0&&i.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}TS.inline_file_previews.collapse_sig.dispatch(i);TS.client&&TS.ui.utility.updateClosestMonkeyScroller(i)};var c;var _=function e(){c&&clearInterval(c);var t=function e(){var t=$("#msgs_div .file_time_ago");var n=[];t.each(function(){var e=$(this).data("file-id");var t=TS.files.getFileById(e);if(!t){n.push($(this).text());return}n.push(TS.interop.datetime.toTimeAgo(t.updated));t=null});t.each(function(e,t){$(t).text(n[e]);t=null});t=null};t=TS.utility.throttleFunc(t,5e3);c=setInterval(t,6e4)}})()},2935:function(e,t){(function(){TS.registerModule("rxns",{rxn_records_changed_sig:new signals.Signal,member_rxns_fetched_sig:new signals.Signal,member_rxns_being_fetched_sig:new signals.Signal,need_alerts:{},onStart:function e(){if(!TS.client)return;TS.prefs.preferred_skin_tone_changed_sig.add(T);TS.prefs.emoji_mode_changed_sig.add(T);h=function e(){};var t=function e(){};TS.client.login_sig.add(function(){h=TS.utility.throttleFunc(p,100);t=TS.utility.throttleFunc(a,1e3)});s=function e(n,r){t(n,void 0,void 0,r)}},upsertRxnsFromDataAndUpdateUI:function e(t,n){var r=l(t,n);"NOOP"!==r.status&&s(t);return r},getRxnKey:function e(t,n,r){"message"!==t||r||TS.error("getRxnKey: no c_id provided for message rxn_key");"message"!==t&&r&&TS.error("getRxnKey: c_id provided for but this is not a message rxn_key");return t+"-"+n+"-"+(r||"")},getRxnKeyByMsgType:function e(t){var n;if("file_upload"===t.subtype||"file_share"===t.subtype||"file_mention"===t.subtype||"file_reaction"===t.subtype){if(t.file){var r=t.file;_.isString(r)&&(r=TS.files.getFileById(r));n=r&&r._rxn_key}}else"file_comment"===t.subtype?t.comment&&(n=t.comment._rxn_key):n=t._rxn_key;return n},getRxnKeyFromData:function e(t){var n;if("message"===t.type)n=t.ts||t.message.ts;else if("file"===t.type)n=t.file.id||t.file;else{if("file_comment"!==t.type)throw new Error("item.type not handled");n=t.file_comment||t.comment.id}return TS.rxns.getRxnKey(t.type,n,t.channel)},getExistingRxnsByKey:function e(t){var n=TS.redux.reactions.getReactionsForKey(t);return n&&n.length?n:null},getRxnRecordByKey:function e(t){if(r[t])return r[t];for(var i=n.length-1;i>-1;i-=1)if(n[i].rxn_key===t){r[t]=n[i];return r[t]}return null},getNextRxnRecordThatNeedsAlert:function e(){var t;for(var r=n.length-1;r>-1;r-=1){if(!TS.rxns.need_alerts[n[r].rxn_key])break;t=n[r]}return t},getRxnsFromData:function e(t){if("message"===t.type)return t.message&&t.message.reactions;if("file"===t.type)return t.file&&t.file.reactions;if("file_comment"===t.type)return t.comment&&t.comment.reactions;return null},doesRxnsHaveRxnFromMember:function e(t,n,r){var i=TS.emoji.nameToCanonicalName(n);if(!t)return false;var a=TS.rxns.getRxnFromRxns(t,n)||TS.rxns.getRxnFromRxns(t,i);if(!a)return false;if(!a.count)return false;if(!a.users)return false;return-1!==a.users.indexOf(r)},doesRxnsHaveRxnFromUser:function e(t,n){return TS.rxns.doesRxnsHaveRxnFromMember(t,n,TS.model.user.id)},doesRxnsHaveRxn:function e(t,n){if(!t)return false;return!!TS.rxns.getRxnFromRxns(t,n)},doesRxnsHaveSkinlessRxn:function e(t,n){if(!t)return false;var r=[n.replace(/(::skin-tone-[2-6])/,"")];TS.emoji.spliceSkinToneVariationsIntoAnArrayOfEmojiNames(r);for(var i=0;i<r.length;i+=1)if(TS.rxns.getRxnFromRxns(t,r[i]))return true;return false},countAllRxns:function e(t){if(!t)return 0;var n=0;t.forEach(function(e){n+=e.count||0});return n},countAllEmoji:function e(t){if(!t)return 0;return t.length},countAllUsersRxns:function e(t,n){if(!t)return 0;var r=0;t.forEach(function(e){e.users.indexOf(n)>-1&&(r+=1)});return r},getAllUniqueRxners:function e(t,n){if(!t)return[];var r=[];t.forEach(function(e){if(!e)return;if(!e.count)return;if(!e.users)return;e.users.forEach(function(e){if(n==e)return;if(-1!=r.indexOf(e))return;r.push(e)})});return r},getRxnFromRxns:function e(t,n){if(!t)return null;return t.filter(function(e){return e.name==n})[0]||null},changeRxnsFromUserAction:function e(t,n,r){return TS.redux.reactions.changeReactionFromUserAction(t,n,r).catch(function(e){[b,v].indexOf(e.message)>-1?S(e.message):e.message===y&&TS.warn("Attempted to add/remove invalid emoji and the API complained: "+n)})},checkForRxnClick:function e(t){if(!t||!t.target)return;var n=$(t.target);var r=n.closest(".rxn");if(!r.length)return;var i=String(r.data("emoji"));var a=n.closest(".rxn_panel");var s=a.data("rxn-key");var o=r.hasClass("is_handy");var l;if(r.hasClass("menu_rxn"))TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else{l=!r.hasClass("user_reacted");if(!l&&t.shiftKey)w(s);else{var u=o&&TS.emoji.isNameSkinToneModifiable(i)?":"+TS.emoji.getChosenSkinToneModifier():"";TS.rxns.changeRxnsFromUserAction(s,i+u,l)}}},getRxnRecords:function e(){return n},getRxnKeyParts:function e(t){var n=t.split("-");return{type:n[0],id:n[1],c_id:n[2]}},test:function e(){return{updateUI:a,addOrRemoveRxnFromRxns:o,upsertRxnsFromData:l,incrementPendingCnt:u,decrementPendingCnt:d,fetchAndUpdateRxns:c,displayTooManyError:S,TOO_MANY_REACTIONS:v,TOO_MANY_EMOJI:b}},clearHandyRxnsDisplayDataCache:function e(){t=void 0},getMemberRxnsFromMessage:function e(t,n){if(!t||!n)return;var r=TS.rxns.getRxnKeyByMsgType(t);if(!r)return;var i=TS.rxns.getExistingRxnsByKey(r);if(!i)return;var a=i.filter(function(e){return _.includes(e.users,n)});return a},getHandyRxnsDisplayDataByRxnKey:function n(){if(!t){t={items:{}};var r=e;r.forEach(function(e){var n=TS.emoji.isNameSkinToneModifiable(e)?TS.emoji.getChosenSkinToneModifier():"";var r=":"+e+":"+n;t.items[e]={html:new Handlebars.SafeString(TS.emoji.graphicReplace(r,{no_skin_tone_squares:true})),name:r,names:r}})}return t},legacyUpdateReactionRecords:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.adding,r=t.name,i=t.key,a=t.userId,s=t.eventTs,o=t.shouldAlert,l=t.channelId,u=t.url;if(!TS.client)return;n?f(r,i,a,s,o,l,u):g(r,i,a)},legacyUpdateUI:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.key,r=t.name,i=t.userId,o=t.type,l=t.shouldThrottle;l?s(n,o):a(n,r,i,o)}});var e=["slightly_smiling_face","+1","heavy_check_mark","heart","eyes"];var t;var n=[];var r={};var i={};var a=function e(t,n,r,i){TS.templates.builders.updateRxnPanels(t,n,r);if("file"===i){TS.log("(Temporary) Rebuilding mentions due to file reaction.");TS.view.rebuildMentions()}};var s=function e(t,n){a(t,void 0,void 0,n)};var o=function e(t,n,r,i,a){var s=TS.rxns.getRxnFromRxns(n,r);if(t)s?TS.utility.ensureInArray(s.users,i)&&(s.count+=1):n.push({users:[i],count:1,name:r,url:a});else if(s){var o=s.users.indexOf(i)>=0;if(o){_.pull(s.users,i);s.count-=1;(s.count<1||0===s.users.length)&&_.pull(n,s);n.length||(n=null)}}return n};var l=function e(t,n){var r=false;return TS.redux.reactions.upsertReactions(t,n,r)};var u=function e(t){if(!t)return;i[t]=i[t]||0;i[t]+=1;TS.has_pri[k]&&TS.log(k,"_incrementPendingCnt "+t+": "+i[t])};var d=function e(t){if(!i[t]){TS.has_pri[k]&&TS.log(k,"_decrementPendingCnt "+t+": "+i[t]);return}i[t]-=1;0===i[t]&&delete i[t];TS.has_pri[k]&&TS.log(k,"_decrementPendingCnt "+t+": "+i[t])};var c=function e(t){u(t);TS.redux.dispatch(TS.interop.reactions.fetchReactions({reactionKey:t})).then(function(e){d(t);var n=TS.rxns.getRxnsFromData(e);var r=l(t,n);TS.has_pri[k]&&TS.dir(k,r,"_fetchAndUpdateRxns upsert status:"+r.status);if("NOOP"===r.status)return;a(t)}).catch(function(){d(t);TS.error("_fetchAndUpdateRxns got an err")})};var m=function e(t,n,r){if(!t)return null;if(!t.emoji)return null;if(!t.emoji.hasOwnProperty(n))return null;for(var i=0;i<t.emoji[n].length;i+=1)if(t.emoji[n][i].id===r)return t.emoji[n][i];return null};var f=function e(t,i,a,s,o,l,u){s=s||TS.interop.datetime.makeTsStamp();o=!!o;var d=false;var c=r[i];if(!c){d=true;n[n.length]={rxn_key:i};r[i]=n[n.length-1];c=r[i]}c.last_update=s;o&&(TS.rxns.need_alerts[i]=TS.rxns.need_alerts[i]||s);c.emoji=c.emoji||{};c.source=l||"";c.url=u;c.emoji[t]=c.emoji.hasOwnProperty(t)&&c.emoji[t]||[];var _=c.emoji[t];var f=m(c,t,a);if(!f){_[_.length]={id:a};f=_[_.length-1]}f.when=s;TS.dir(877,n,t+" "+i+" "+a);var p=n.length;d&&p>1&&n[p-1].last_update<n[p-2].last_update&&n.sort(function e(t,n){if(t.last_update<n.last_update)return-1;if(t.last_update>n.last_update)return 1;return 0});h(o)};var p=function e(t){TS.rxns.rxn_records_changed_sig.dispatch(t)};var h=function e(){p()};var g=function e(t,i,a){var s=TS.rxns.getRxnRecordByKey(i);var o=m(s,t,a);if(o&&s){_.pull(s.emoji[t],o);s.emoji[t].length||delete s.emoji[t];if(!Object.keys(s.emoji).length){delete r[i];_.pull(n,s)}}TS.rxns.rxn_records_changed_sig.dispatch()};var S=function e(t){var n=TS.interop.i18n.t("You\u2019ve reached the reaction limit","rxns")();var r=[TS.interop.i18n.t("For reasons of performance and productivity and brevity being the soul of wit, you can add up to 23 emoji to a message, but no more.","rxns")(),TS.interop.i18n.t("Well done! You\u2019ve added the maximum amount of emoji one person can add to one message. For reasons of performance, productivity and sharpened creative thinking, we cap the number of individual reacji to 23.","rxns")(),TS.interop.i18n.t("Emotions! We all have them \u2014 but on Slack, you\u2019re limited to 23 reactions per message.","rxns")()];var i=[TS.interop.i18n.t("The human heart is a powerful thing; its capacity to feel is limitless! A message\u2019s capacity is 50.","rxns")(),TS.interop.i18n.t("Alas! Slack only allows each message a grand total of 50 emoji reactions.","rxns")(),TS.interop.i18n.t("A single message can\u2019t have more than 50 unique reactions. When we asked the engineers why they said, \u201cwe have to set limits somewhere,\u201d and then we tried to frown but this error popped up. So that\u2019s where we\u2019re at.","rxns")()];if(t==v){var a=_.sample(r);TS.generic_dialog.alert('<p class="no_bottom_margin">'+a+"</p>",n)}else if(t==b){var s=_.sample(i);TS.generic_dialog.alert('<p class="no_bottom_margin">'+s+"</p>",n)}};var T=function e(){$(".msgs_holder").find("ts-message").each(function(){var e=$(this);TS.ui.messages.maybeUpdateMessageHoverContainer(e)})};var v="too_many_reactions";var b="too_many_emoji";var y="invalid_name";var w=function e(t){var n=TS.rxns.getExistingRxnsByKey(t);if(!n)return;n.forEach(function(e){if(!TS.rxns.doesRxnsHaveRxnFromUser(n,e.name))return;TS.rxns.changeRxnsFromUserAction(t,e.name,false)})};var k="888"})()},2936:function(e,t){(function(){TS.registerModule("ui.new_channel_modal",{channel_prefixes:null,start:function t(n,r,i){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;var a=TS.boot_data.feature_accessible_fs_dialogs?TS.interop.i18n.t("Create a channel","new_channel")():"";TS.ui.fs_modal.start({title:a,body_template_html:'<div id="new_channel_modal_container"></div>',onEnd:v});e=$("#new_channel_modal_container");TS.prefs.getPref("lessons_enabled")&&TS.lessons&&TS.lessons.inOnboarding()&&TS.lessons.new_channel_modal_opened_sig.dispatch(true);"sli_channel_creation"===TS.interop.experiments.getGroupForUser("sli_channel_creation")&&TS.interop.api.call("conversations.getChannelPrefixes",{}).then(function(e){TS.ui.new_channel_modal.channel_prefixes=e.data.prefixes});return TS.ui.new_channel_modal.startInContainer(e,n,r,i)},startInContainer:function i(a,s,o,l){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;e=a;n=false!==o;TS.permissions.members.canCreateChannels()||(n=false);TS.permissions.members.canCreateGroups()||(n=true);var u=TS.permissions.members.canCreateChannels()&&TS.permissions.members.canCreateGroups();s=TS.utility.cleanChannelName(s||"");l=l||[];var d;d=TS.prefs.getPref("lessons_enabled")&&TS.lessons&&TS.lessons.inOnboarding()?TS.templates.channel_new_simplified_for_onboarding_modal:TS.templates.channel_new_modal;e.html(d({title:s,is_public:n,can_toggle_private:u,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start"),is_ra:TS.model.user.is_restricted,can_create_shared_channel:TS.permissions.members.canRequestSharedChannel()}));t=Ladda.create(e.find(".new_channel_go")[0]);c(l);setTimeout(function(){S()},500);return new Promise(function(e,t){r={resolve:e,reject:t}})},go:function r(){var i=e.find(".title_input").val();var a=$("#invite_members_container").lazyFilterSelect("value");var s=[];var o=[];a&&a.forEach(function(e){e.member?s.push(e.member.id):o.push(e)});var l=_.trim(TS.utility.contenteditable.value(e.find("#channel_purpose_input")));t&&t.start();n?f(i,l,s,o):p(i,l,s,o)},end:function e(){b()},test:function e(){return{createPublicChannel:f,createPrivateChannel:p}}});var e;var t;var n;var r;var i=function t(){var n=e.find("#invite_members_container").find("input")[0];var r=e.find("#channel_purpose_input");e.on("keydown",function(e){if(e.which!==TS.utility.keymap.enter||document.activeElement==n||TS.utility.contenteditable.hasFocus(r)){if(e.which===TS.utility.keymap.esc){TS.ui.fs_modal.close();TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled")&&TS.lessons&&TS.lessons.inOnboarding()&&TS.lessons.new_channel_modal_closed_sig.dispatch(true);e.preventDefault()}}else{TS.ui.new_channel_modal.go();e.preventDefault()}})};var a=function t(){var r=$("#channel_public_private_toggle");r.togglify();r.bind("change",function(){n=r.is(":checked");if(r.is(":checked")){e.find(".private_channel_item").addClass("hidden");e.find(".public_channel_item").removeClass("hidden")}else{e.find(".public_channel_item").addClass("hidden");e.find(".private_channel_item").removeClass("hidden")}})};var s=function e(){return new Promise(function(e){TS.model.user.is_admin?TS.interop.api.call("users.admin.invited").then(function(t){var n=TS.pending_users.filterOutURAs(t.data.pending);if(n.length){n.forEach(function(e){TS.pending_users.sanitizeNameFields(e)});e(n)}else e([])}):e([])})};var o=function e(t){var n=true;var r=s();return function(e,i){"@"===e.charAt(0)&&(e=e.substring(1));var a;var s=false;if(n){n=false;_.get(t,"length")&&(s=true)}if(s){var o=_.compact(t.map(function(e){return TS.interop.members.getMemberById(e)}));var u=o.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve({items:u})}if(i>0)return Promise.resolve({items:[]});a=l(e);return Promise.all([a,r]).then(function(t){var n=t[0];var r=t[1];if(_.isUndefined(r)||0===r.length)return n;var i=new RegExp("^"+TS.utility.regexpEscape(e),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(e),"i");r=r.filter(function(e){return TS.pending_users.checkUserMatch(e,i)||TS.pending_users.checkUserMatch(e,a)});n=n.concat(r).sort(function(e,t){return TS.pending_users.usersSorterByName(e,t)});return n})}};var l=function e(t){var n={query:t,filter:TS.boot_data.feature_bots_not_members?"people":"everyone"};return TS.members.fetchAndUpsertMembersWithQuery(n).then(function(e){var n=[];var r=TS.boot_data.feature_bots_not_members?TS.members.getMembersWithOptions({include_bots:false}):TS.members.getMembersForUser();var i=r.map(function(e){return e.id});n=""===t?r:e.objects;n=_.filter(n,function(e){if(e.is_self)return false;if(TS.interop.rules.members.isSlackbotOrTeambot(e,TS.boot_data.feature_teambot))return false;if(-1===_.indexOf(i,e.id))return false;return true});n=_.filter(n,function(e){return!(e.is_ultra_restricted||e.deleted||!e._is_local||e.is_app_user)}).map(function(e){return{member:e,lfs_id:String(e.id)}});if(TS.boot_data.feature_invite_user_groups){var a={usergroups:TS.interop.userGroups.getActiveUserGroups()};var s={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};var o=TS.sorter.search(t,a,s);o=_.map(o,function(e){return{usergroup:e,lfs_id:String(e.id)}});n=_.concat(n,o)}return n})};var u=function e(t){var n;var r;var i;var a={append:true,per_page:50,max_selected_items:1e3,approx_item_height:36,placeholder_text:TS.interop.i18n.t("Search by name","new_channel")(),template:function e(t){var n;n=TS.boot_data.feature_invite_user_groups&&t.usergroup?TS.templates.channel_invite_user_group_small({user_group:t}):t.member?TS.templates.channel_invite_member_small({member:t.member}):TS.templates.channel_invite_pending_user_small({invitee:t});return new Handlebars.SafeString(n)},tokenTemplate:function e(t){var n;n=TS.boot_data.feature_invite_user_groups&&t.usergroup?TS.templates.channel_invite_user_group_token({user_group:t.usergroup}):t.member?TS.templates.channel_invite_member_token({member:t.member}):TS.templates.channel_invite_pending_user_token({invitee:t});return new Handlebars.SafeString(n)},tokenClass:function e(t){if(t.member)return TS.templates.builders.getMemberTypeClass(t.member);if(TS.boot_data.feature_invite_user_groups&&t.usergroup)return"";return"lfs_token_pending_user"},filter:function e(t,a){var s=t.member;if(n!==a){r=new RegExp("^"+TS.utility.regexpEscape(a),"i");i=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(a),"i");n=a}var o=true;if(s)return TS.utility.members.checkMemberMatch(s,r,o)||TS.utility.members.checkMemberMatch(s,i,o);return TS.pending_users.checkUserMatch(t,r)||TS.pending_users.checkUserMatch(t,i)},noResultsTemplate:function e(t){if(!t)return TS.interop.i18n.t("No one found","new_channel")();return TS.interop.i18n.t("No one found matching <strong>{query}</strong>","new_channel")({query:TS.interop.i18n.safeString(TS.utility.truncateAndEscape(t,50))})}};if("sli_channel_creation"===TS.interop.experiments.getGroupForUser("sli_channel_creation")){a.onItemAdded=d;a.onItemRemoved=d}a.data_promise=o(t);$("#invite_members_container").lazyFilterSelect(a)};var d=function e(){var t=$("#invite_members_container").lazyFilterSelect("value");var n=[];t&&t.forEach(function(e){e.member&&n.push(e.member.id)});TS.interop.api.call("conversations.suggestInvites",{users:n.join(",")}).then(function(e){var t=e.data.users.filter(function(e){return e.score>=.9}).slice(0,3);var n=t.map(function(e){return e.id});TS.interop.members.fetchAndUpsertMembersById({ids:n}).then(function(e){var t=e.members.map(function(e){return e.name});$("label[for='invite_members_input']").html('Send invites to: <span class="greigh normal">(optional)</span> Recommended: '+t.join(", "))})})};var c=function t(n){u(n);e.find(".lfs_input").attr("id","invite_members_input");e.find(".new_channel_go").click(TS.ui.new_channel_modal.go);e.find(".create_share_channel").click(function(){TS.ui.new_channel_modal.end();TS.ui.share_channel_dialog.start({channel_name:$("#channel_create_title").val(),is_private:$("#channel_public_private_toggle").length&&!$("#channel_public_private_toggle").is(":checked"),element:"shared_channels_new_channel_modal_share_btn"})});i();a();e.find(".title_input").keydown(function(){e&&e.find(".modal_input_note.mustard_yellow").each(function(){$(this).addClass("hidden")})});$("#channel_create_title").focus();e.find(".new_channel_cancel_btn").on("click",function(){var e=r&&r.reject;e&&e();TS.ui.fs_modal.close();TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding()&&TS.lessons.new_channel_modal_closed_sig.dispatch(true)});var s=$("#save_channel");var o=$("#channel_create_title");function l(){var e=o.val();e&&e.length?TS.utility.disableElement(s,false):TS.utility.disableElement(s,true);if("sli_channel_creation"===TS.interop.experiments.getGroupForUser("sli_channel_creation")&&TS.ui.new_channel_modal.channel_prefixes){var t=null;if(e&&e.length){var n=Object.keys(TS.ui.new_channel_modal.channel_prefixes);var r=null;var i=null;n.forEach(function(t){if(!r&&(0===t.indexOf(e)||0===e.indexOf(t))){r=t;if(e.length>t.length){var n=Object.values(TS.ui.new_channel_modal.channel_prefixes[r]);n.forEach(function(n){i||0!==(t+n).indexOf(e)||(i=n)})}}});r&&(i?t=r+i:r.length>e.length&&(t=r))}t?$("label[for='channel_create_title']").html('Name&nbsp; <span class="normal" style="color:#008952"> A few channels in your workspace start with: <b>'+t+"</b>, maybe use that.</span>"):$("label[for='channel_create_title']").html("Name");if(e&&e.length){var a=TS.searcher.search(e.replace(/(-)|(_)/g,""),{channels:true});a.then(function(t){t.forEach(function(n){n.model_ob.name!==e&&e.replace(/(-)|(_)/g).length===n.model_ob.name.replace(/(-)|(_)/g).length&&$("label[for='channel_create_title']").html('Name&nbsp; <span class="normal" style="color:#ff9000"> Hey! Did you know a channel named <b>'+t[0].model_ob.name+"</b> already exists?</span>")})})}}}if(s.length&&o.length){o.on("input",l);l()}var d=e.find("#channel_purpose_input");TS.utility.contenteditable.create(d,{ariaLabel:TS.interop.i18n.t("Channel purpose","new_channel")(),singleLineInput:true,modules:{tabcomplete:{positionMenu:function e(t){t.style.width=d.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,d)},completers:["channels","emoji","members"]}},enableBroadcastKeywords:false,onTab:function e(){return true},onEnter:function e(){return false},onEscape:function e(){TS.ui.fs_modal.close()}});TS.utility.contenteditable.enable(d)};var m=function e(t){var n=r&&r.resolve;n&&n(t)};var f=function n(r,i,a,s){TS.redux.dispatch(TS.interop.channels.submitCreate({name:r})).then(function(e){TS.client&&TS.channels.legacyDisplayChannel({id:e.id});h(e.id,a);i&&TS.redux.dispatch(TS.interop.channels.submitChannelPurpose({channelId:e.id,purpose:i})).catch(TS.channels.legacyAlertSetPurposeError);g(e.id,s);m(e);TS.ui.fs_modal.close()}).catch(function(n){t&&t.stop();var i=TS.ui.validation.getErrorMessage(_.get(n,"data.error")||n.message,{name:r});TS.ui.validation.showWarning(e.find(".title_input"),i,{custom_for:"channel_create_title"})})};var p=function n(r,i,a,s){TS.redux.dispatch(TS.interop.channels.submitCreate({name:r,isPrivate:true})).then(function(e){TS.client&&TS.groups.legacyDisplayGroup({id:e.id});h(e.id,a);i&&TS.redux.dispatch(TS.interop.channels.submitChannelPurpose({channelId:e.id,purpose:i})).catch(TS.channels.legacyAlertSetPurposeError);g(e.id,s);m(e);TS.ui.fs_modal.close()}).catch(function(n){t&&t.stop();var i=TS.ui.validation.getErrorMessage(_.get(n,"data.error")||n.message,{name:r});TS.ui.validation.showWarning(e.find(".title_input"),i,{custom_for:"channel_create_title"})})};var h=function e(t,n){if(!t||!n||!n.length)return;_.pull(n,TS.model.user.id);n.length&&TS.interop.api.call("conversations.invite",{channel:t,users:n.join(","),just_created:true,force:true})};var g=function e(t,n){t&&n&&n.length&&TS.pending_users.invitePendingUsersToChannel(n,t)};var S=function e(){var t=new Date("March 17, 2017 10:00:00");var n=Math.floor(t.getTime()/1e3);if(TS.prefs.getPref("seen_intl_channel_names_coachmark"))return;if("en-US"===TS.boot_data.browser_lang||"en-us"===TS.boot_data.browser_lang)return;if(TS.model.user.created>n)return;TS.prefs.setPrefLocal("seen_intl_channel_names_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_intl_channel_names_coachmark",value:true},function(){TS.coachmark.start(TS.coachmarks.coachmarks.intl_channel_names)})};var T=function t(){if(e){e.find(".new_channel_go").off("click");e.find("#channel_public_private_toggle").off("change");e.off("keydown")}};var v=function e(){b()};var b=function n(){T();e=null;t=null;r=null}})()},2937:function(e,t){(function(){TS.registerModule("ui.lazy_filter_select",{STYLES:{default:"default",filter_in_list:"filter_in_list",normal:"normal",small:"small"},onStart:function e(){$("select[data-lazy-filter-select], label[data-lazy-filter-select] select").addClass("hidden").lazyFilterSelect({use_data_attributes:true})},create:function t(n,r){if(r.use_data_attributes){var a=Object.keys(n.data());a.forEach(function(e){if(e.indexOf("lazyFilterSelect")>-1&&"TS-lazyFilterSelect"!==e&&""!==n.data(e)){var t=n.data(e);"true"!==t&&"false"!==t||(t="true"===t);r[e.replace("lazyFilterSelect","").toLowerCase()]=t}})}"SELECT"===n.prop("tagName")&&"undefined"===typeof r.single&&(r.single=!n.prop("multiple"));var s=$.extend({},e,r);void 0===r.approx_divider_height&&(s.approx_divider_height*=1);void 0===r.approx_item_height&&(s.approx_item_height*=1);var o=$('<div class="lazy_filter_select">');s.classes&&o.addClass(s.classes);n.prop("disabled")&&(s.disabled=true);s.disabled&&o.addClass("disabled");s.style=_.get(TS.ui.lazy_filter_select.STYLES,s.style,TS.ui.lazy_filter_select.STYLES.default);if(ne(s)&&!s.single){TS.warn("Multi-select lazyFilterSelect instances can't use the 'filter_in_list' style. Using 'default' style instead.");s.style=TS.ui.lazy_filter_select.default}var l=TS.templates.lazy_filter_select_container({instance:s,aria_labelledby:n.attr("aria-labelledby"),STYLES:TS.ui.lazy_filter_select.STYLES});o.html(l);s.append?o.appendTo(n):o.insertAfter(n);o.addClass(s.style+"_style");s.single&&o.addClass("single");s.width&&o.css("width",s.width);s.css&&o.css(s.css);s.$container=o;s.$select=n;s.$input_container=o.find(".lfs_input_container");s.$lfs_value=o.find(".lfs_value");s.$input=o.find(".lfs_input");s.$list_container=o.find(".lfs_list_container");s.$list=o.find(".lfs_list");s.$status=o.find(".lfs_status");s.$status_loading_indicator=s.$status.find(".lfs_status_loading_indicator");s.$status_content=s.$status.find(".lfs_status_content");ne(s)?s.$filter_input=o.find(".lfs_filter_input"):s.$filter_input=s.$input;s._page_number=1;s._slug_id_counter=1;s.run=O;if(s.data_promise){j(s)&&s._running_promise.cancel("Uhhh...");s._running_promise=H(s,"").then(function(e){s.data=e;s.run();i(s)},function(e){i(s);TS.console.logError(e,"LFS error");ie(s,e,"Something failed while trying to return the initial data for lazyFilterSelect.")})}else{s.data&&(s.data=s.data.slice());_.forEach(s.data,function(e,t,n){e&&e._is_interop_channel_object&&(n[t]=_.assign({},e))});s.run();i(s)}s.current_items_in_view_signal=new signals.Signal;return s},convertHTMLDataToRLFSData:x,is_list_open:false});var e={allow_item_unselect:false,allow_list_position_above:false,always_visible:false,append:false,approx_divider_height:28,approx_item_height:30,data_promise:null,data_qa:"lfs",disabled:false,filter:function e(t,n){var r=t.toString();n=n.toLowerCase();if(t instanceof jQuery||t instanceof HTMLElement){r=$(t).text();var i=$(t).attr("data-additional-search-field");if(i&&i.toLowerCase().indexOf(n)>-1)return true}return r.toLowerCase().indexOf(n)>-1},input_debounce_wait_time:void 0,listItemClass:null,max_selected_items:Infinity,min_query_length:0,monkey_scroll:true,no_default_selection:false,noResultsTemplate:function e(t){if(re(this)&&t.length<this.min_query_length)return TS.interop.i18n.t("{query_length, plural, =0 {Start typing to see results\u2026} other {Keep typing to see results\u2026}}","lazy_filter_select")({query_length:t.length});return TS.interop.i18n.t("No items matched {query}","lazy_filter_select")({query:TS.interop.i18n.safeString("<strong>"+_.escape(t)+"</strong>")})},errorTemplate:function e(t){return t||TS.interop.i18n.t("Couldn't load results.","lazy_filter_select")()},onInputBlur:_.noop,onInputFocus:_.noop,onReady:function e(){},onItemAdded:function e(){},onItemRemoved:function e(){},onKeyDown:function e(){},onMaxItemsSelected:function e(){},onListShown:_.noop,onListHidden:_.noop,adjustAvailableSpaceAbove:_.identity,adjustAvailableSpaceBelow:_.identity,placeholder_text:TS.interop.i18n.t("Choose an option\u2026","lazy_filter_select")(),filter_placeholder_text:TS.interop.i18n.t("Search","lazy_filter_select")(),renderDividerFunc:null,render_item_func:null,restrict_input_container_height:false,restrict_preselected_item_removal:false,scroll_threshold:1e3,set_height:true,should_graphic_replace_emoji:false,single:false,sluggify:{enabled:false,delimiter:null,key_name:null,validator:null},style:TS.ui.lazy_filter_select.STYLES.default,template:function e(t){var n=t.toString();var r;var i;if(t instanceof jQuery||t instanceof HTMLElement){n=$(t).text();r=Z($(t).attr("data-additional-search-field"),this);i=Z($(t).attr("data-ts-icon"),this)}n=Z(n,this);r&&(n+=' <span class="addl_text">'+r+"</span>");i&&(n+=' <ts-icon class="addl_icon '+i+'"></ts-icon>');return new Handlebars.SafeString(n)},tokenClass:null,tokenTemplate:null,tokenTemplateSingle:null,use_data_attributes:false,_$active:null,_all_done_fetching:false,_list_built:false,_list_visible:false,_mouse:{},_page_number:1,_prevent_blur:false,_previous_val:"",_running_promise:null,_scroll_callback_was_called:false,_selected:[],_showing_status:false};$.widget("TS.lazyFilterSelect",{_create:function e(){this.instance=TS.ui.lazy_filter_select.create(this.element,this.options)},_destroy:function e(){this.instance.$container.remove();delete this.instance},blur:function e(){this.instance.$filter_input.blur()},clearValue:function e(){if(this.instance.single){if(this.instance._selected.length){var t=this.instance.$input_container.find(".lfs_item");P(this.instance,t)}}else A(this.instance)},container:function e(){return this.instance.$container},disable:function e(){c(this.instance)},disabled:function e(){return this.instance.disabled},enable:function e(){f(this.instance)},focus:function e(){this.instance.$filter_input.focus()},getInstance:function e(){return this.instance},hideList:function e(){T(this.instance,{force:true});le(this.instance)},recomputeHeight:function e(){Q(this.instance)},setValue:function e(t){var n=this.element[0].selectedIndex;this.element.val(t);this.element[0].selectedIndex<0&&(this.element[0].selectedIndex=0);var r=this.element[0].options[this.element[0].selectedIndex];if(this.instance.single){if(this.element[0].selectedIndex==n)return}else A(this.instance);var i=g(this.instance,$(r));N(this.instance,i)},forceSelectItem:function e(t){this.instance.$lfs_value.html(a(this.instance,t,{force_selected:true}));this.instance.$container.addClass("value")},showList:function e(){W(this.instance)},update:function e(t){J(this.instance,t)},updatePlaceholder:function e(t){this.instance.placeholder_text=t;this.instance.$input.prop("placeholder",t)},updateFilterPlaceholder:function e(t){if(!ne(this.instance))return;this.instance.filter_placeholder_text=t;this.instance.$filter_input.prop("placeholder",t)},value:function e(){return this.instance._selected}});var t=function e(t,r){if(!v(t))return;if(!r.trim())return;if(!d(t))return;var i={};i[t.sluggify.key_name]=r.trim();i.lfs_id=null;i.lfs_slug_id=t._slug_id_counter;t._slug_id_counter+=1;t._selected.push(i);var a=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(i),applied_classes:"lfs_token",slug_id:i.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");var s=$(a);s.insertBefore(t.$input);t.sluggify.validator&&t.sluggify.validator(s);C(t,t.data);W(t);t.$filter_input.val("");t._previous_val="";n(t);t.onItemAdded(i);d(t)||t.onMaxItemsSelected()};var n=function e(t){if(!t.single){t.$input.prop("size",t.$filter_input.val().length+1);if(t.$filter_input.val().length+t._selected.length===0)q(t);else{t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var r=function e(t){t.data_promise&&t.$list.on("scroll",function(){var e=$(this).scrollTop();var n=t.$list.height();var r=t.$list.find(".list_items").height();var i=r-e-n;if(i<=t.scroll_threshold&&!t._scroll_callback_was_called&&!t._all_done_fetching){u(t,t._previous_val,t._page_number+1);t._scroll_callback_was_called=true}else if(i>t.scroll_threshold&&t._scroll_callback_was_called){j(t)&&t._running_promise.cancel("User scrolled back and we do not need to add more data");t._scroll_callback_was_called=false}})};var i=function e(t){t.$container.on("mouseleave",ue.bind(null,t));t.$container.on("click",de.bind(null,t));t.$container.parents("label").on("click",ce.bind(null,t));t.$input_container.on("focus",_e.bind(null,t));t.$input.on("focus",me.bind(null,t));var n;n=_.isUndefined(t.input_debounce_wait_time)?fe:_.debounce(fe,t.input_debounce_wait_time);t.$filter_input.on("input",n.bind(null,t));t.$filter_input.on("keydown",pe.bind(null,t));t.$filter_input.on("blur",he.bind(null,t));t.$lfs_value.on("click",be.bind(null,t));t.$lfs_value.on("mousedown",ye.bind(null,t));t.$input_container.on("click",".lfs_token",we.bind(null,t));t.$input_container.on("mousedown",".lfs_token",ke.bind(null,t));t.$list_container.on("mousedown",xe.bind(null,t));t.$list_container.on("mouseup",Ce.bind(null,t));t.$list_container.on("mousemove",".lfs_item",Ie.bind(null,t));t.$list_container.on("mouseleave",".lfs_item.active",Me.bind(null,t));var r=null===_.get(TSSSB,"env.desktop_app_version")?"click":"mousedown";t.$list_container.on(r,".lfs_item",Ae.bind(null,t));t.onReady()};var a=function e(t,n,r){var i=$(n);r=r||{};var a=r.force_selected||b(t,n);var s=n.disabled||n.lfs_disabled;t.restrict_preselected_item_removal&&n.preselected&&(s=true);var o;o=r.should_tokenize&&_.isFunction(t.tokenTemplate)?t.tokenTemplate(n):t.single&&_.isFunction(t.tokenTemplateSingle)?t.tokenTemplateSingle(n):t.template(n);var l=Z(i.data("lfs-item-desc"),t);var u={active:""!==t._previous_val&&!a&&!s,disabled:s,lfs_token:r.should_tokenize,selected:a,single:t.single,group_item:i.hasClass("group_item")};_.isFunction(t.tokenClass)&&(u[t.tokenClass(n)]=true);return TS.templates.lazy_filter_select_item({content:o,icon:i.data("lfs-item-icon"),desc:new Handlebars.SafeString(l),applied_classes:TS.utility.getAppliedClasses(u),lfs_id:n.lfs_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"")};var s="position_above";var o="show_status";var l=function e(t){if(!t._list_built&&!t._showing_status)return;t.$list_container.removeClass(s);var n=t.$list.css("max-height");t.$list.css({"max-height":0});var r=t.$list[0].scrollHeight;var i=parseInt(t.$list_container.css("padding-top"),10)+parseInt(t.$list_container.css("padding-bottom"),10)+parseInt(t.$list_container.css("border-top-width"),10)+parseInt(t.$list_container.css("border-bottom-width"),10)+parseInt(t.$list_container.css("margin-top"),10)+parseInt(t.$list_container.css("margin-bottom"),10);ne(t)&&(i+=t.$filter_input.outerHeight()+parseInt(t.$filter_input.css("margin-bottom"),10));var a=parseInt(t.$list_container.css("max-height"),10);var o=2*t.approx_item_height+i;var l=Math.min(r+i,a);var u=$(window).height();var d=t.$input_container[0].getBoundingClientRect().bottom+parseInt(t.$input_container.css("margin-bottom"),10);var c=t.adjustAvailableSpaceBelow(u-d);if(t.allow_list_position_above){var _=t.$input_container[0].getBoundingClientRect().top+parseInt(t.$input_container.css("margin-top"),10);var m=t.adjustAvailableSpaceAbove(_);var f=m>=l;var p=c>=l&&c>o;if(f&&!p){c=m;t.$list_container.addClass(s)}}var h=Math.floor(Math.min(c,l)-i);t.$list.css({"max-height":h||n})};var u=function e(t,n,r){j(t)&&t._running_promise.cancel("Scrolling happened");if(t._all_done_fetching)return;t._running_promise=t.data_promise(n,r).then(function(e){var n=e;n.items&&(n=n.items);if(n&&n.length){t._page_number+=1;t._current_data||(t._current_data=t.data.slice());"undefined"!==typeof e.all_items_fetched&&(t._all_done_fetching=!!e.all_items_fetched);"undefined"!==typeof e.num_remaining&&0===e.num_remaining&&(t._all_done_fetching=true);var r;var i=parseInt(e.num_new,10)||0;r=n.slice(-i);if(r.length){e._replace_all_items||e.replace_all_items?t._current_data=r:t._current_data=t._current_data.concat(r);m(t,t._current_data)}else t._all_done_fetching=true}else t._all_done_fetching=true},function(e){TS.console.logError(e,"LFS error");ie(t,e,"Something failed while trying to return the next batch of data for lazyFilterSelect.")})};var d=function e(t){return t._selected.length<t.max_selected_items};var c=function e(t){if(t.disabled)return;t.disabled=true;t.$container.addClass("disabled");t.$input.prop("disabled",true);t.$filter_input.prop("disabled",true)};var m=function e(t,r){M(t,r);C(t,r);var i=t._list_built&&(!t.data||0===t.data.length||t.always_visible);i&&W(t,true);n(t)};var f=function e(t){if(!t.disabled)return;t.disabled=false;t.$container.removeClass("disabled");t.$input.prop("disabled",false);t.$filter_input.prop("disabled",false)};var p=function e(t,n){var r=t.data;var i=[];for(var a=0;a<r.length;a+=1){var s=r[a];if(s.lfs_group||s.is_divider){var o=[];for(var l=0;l<s.children.length;l+=1){var u=s.children[l];t.filter(u,n)&&o.push(u)}o.length>0&&i.push({is_divider:true,lfs_group:true,label:s.label,children:o})}else t.filter(s,n)&&i.push(s)}return i};var h=function e(t){return t.attr("data-lfs-id")||t.prop("lfs_id")||null};var g=function e(t,n,r){var i=h(n);var a;if(r)a=t._selected;else{a=t.data_promise&&t._current_data?t._current_data:t.data;if(-1!==i.indexOf(".")){var s=parseInt(i.split(".")[0],10);a=a[s]?a[s].children:a[0].children}}var o=a.filter(function(e){return e.lfs_id===i});if(o.length)return o[0];return null};var S=function e(t,n){var r=parseInt(n.attr("data-lfs-slug-id"),10);var i=t._selected;var a=i.filter(function(e){return e.lfs_slug_id===r});if(a.length)return a[0];return null};var T=function e(t,n){n=n||{};var r=!t._list_visible||t.always_visible||t.disabled;if(r&&!n.force)return;t._list_visible=false;t.$list_container.removeClass("visible");t.$container.removeClass("list_visible");t.$input_container.removeClass("active");t._list_built&&t.$list.longListView("setHidden",true);t._$active=null;t.onListHidden()};var v=function e(t){if(!t.sluggify.enabled)return false;if(!t.sluggify.delimiter){TS.error("You must pass a delimiter regular expression to use sluggify with lazyFilterSelect.");return false}if(!t.sluggify.key_name){TS.error("You must pass a key name to use sluggify with lazyFilterSelect.");return false}if(t.single){TS.error("Sluggify only works in multi-select versions of lazyFilterSelect.");return false}return true};var b=function e(t,n){if(!t._selected.length)return false;var r=t._selected.filter(function(e){return e.lfs_id===n.lfs_id});return!!r.length};var y=function e(t){if(t instanceof jQuery)return!!t.attr("data-lfs-slug-id");return void 0!==t.lfs_slug_id};var w=function e(t,r,i){if(!v(t))return;if(!y(r))return;var a=$(r);var s=Z(a.data("lfs-item-desc"),t);t._slug_id_counter=Math.max(r.lfs_slug_id,t._slug_id_counter)+1;t._selected.push(r);var o;var l=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(r),icon:a.data("lfs-item-icon"),desc:new Handlebars.SafeString(s),applied_classes:"lfs_token",slug_id:r.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");o=$(l);o.insertBefore(t.$input);n(t);t.sluggify.validator&&t.sluggify.validator(o);t.data=i.filter(function(e){return e.lfs_slug_id!==r.lfs_slug_id});return t.data};var k=function e(t){var n=t.children("option, optgroup");var r=n.length>0?[]:void 0;n.each(function(){if("OPTGROUP"===$(this).prop("tagName")){var e=$(this).children("option").toArray();$(this).prop("disabled")&&(e=e.map(function(e){e.lfs_disabled=true;return e}));r.push({is_divider:true,lfs_group:true,label:$(this).prop("label"),children:e})}else r.push(this)});return r};function x(e){var t=k(e);t=t.map(function(e,t){e instanceof HTMLOptionElement&&(e={id:String(e.lfs_id||t),original_item:e,label:$(e).text(),value:e.value,preselected:e.selected});return e});return t}var C=function e(t,n){n||(n=t.data);if(!n){ie(t);return}if(0===n.length){ae(t);return}le(t,{keep_input_active:true});if(t._list_built){var r=I(n);t.$list.longListView("setItems",r,true);t._current_data=n;Q(t)}else{t.data&&0!==t.data.length||(t.data=n);z(t)}l(t)};var I=function e(t){var n=[];t.forEach(function(e){n.push(e);if(e.children&&e.children.length)for(var t=0;t<e.children.length;t+=1)n.push(e.children[t])});return n};var M=function e(t,n){n||(n=t.data);if(!n)return;var r="";var i=!t.single;var s=0;while(s<n.length){var o=n[s];if(y(o)){n=w(t,o,n);continue}o.children&&o.children.length&&(o.lfs_group=true);if(o.lfs_group||o.is_divider){o.is_divider=true;var l=s;for(var u=0;u<o.children.length;u+=1){var d=o.children[u];d.lfs_id=d.lfs_id||l+"."+u;if((d.selected||d.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,d))continue;t._selected.push(d);r+=a(t,d,{should_tokenize:i})}}}else{o.lfs_id=o.lfs_id||String(s);if((o.selected||o.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,o)){s+=1;continue}t._selected.push(o);r+=a(t,o,{should_tokenize:i})}}s+=1}if(r.length>0){t.$container.addClass("value");if(t.single)t.$lfs_value.html(r);else{$(r).insertBefore(t.$input);t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var A=function e(t){while(t.$input_container.find(".lfs_token").length>0)E(t)};var E=function e(t){var n=t.$input_container.find(".lfs_token").last();n.length&&P(t,n)};var P=function e(t,n){if(t.disabled)return;if(y(n)){F(t,n);return}var r=g(t,n,true);if(r.disabled||t.restrict_preselected_item_removal&&r.preselected)return;t._selected=t._selected.filter(function(e){return e!==r});var i=t.$list.find('[data-lfs-id="'+r.lfs_id+'"]');i.removeClass("selected");n.remove();X(t);t.$filter_input.val().length+t._selected.length===0&&q(t);0===t._selected.length&&t.$container.removeClass("value");t.onItemRemoved(r)};var F=function e(t,n){if(!v(t))return;var r=S(t,n);t._selected=t._selected.filter(function(e){return e!==r});n.remove();X(t);t.$filter_input.val().length+t._selected.length===0&&q(t);t.onItemRemoved(r)};var O=function e(){this.data&&0===this.data.length&&TS.warn("Data passed to lazyFilterSelect is empty.");J(this,this.data);this.always_visible&&W(this);if(this.restrict_input_container_height){this.$container.addClass("has_restricted_input_container_height");TS.environment.supports_custom_scrollbar||this.$input_container.monkeyScroll()}};var D=function e(t,r,i){if(t.disabled)return;if(r===t._previous_val)return;t._all_done_fetching=false;t._previous_val=r;t._$active=null;n(t);t._page_number=1;t._list_built&&t.$list.longListView("scrollToTop",true);if(t.data_promise){j(t)&&t._running_promise.cancel("User entered more text");t._running_promise=H(t,r).then(function(e){m(t,e);W(t,i)},function(e){TS.console.logError(e,"LFS error");ie(t,e,"Something failed while trying to return the filtered data for lazyFilterSelect.")})}else{W(t,i);var a=p(t,r);C(t,a);n(t)}};var H=function e(t,n){return new Promise(function(e,r){if(n.length<t.min_query_length){t._all_done_fetching=true;e([])}else{_.delay(function(){j(t)&&se(t)},650);t.data_promise(n).then(function(n){n=n||{};_.isUndefined(n.all_items_fetched)||(t._all_done_fetching=!!n.all_items_fetched);0===n.num_remaining&&(t._all_done_fetching=true);var r=(n.items||n).slice();e(r);le(t,{keep_input_active:true})},function(e){r(e);le(t)})}})};var j=function e(t){return t._running_promise&&t._running_promise.isPending()};var B=function e(t,n){if(t.disabled)return;if(!t._list_visible){W(t);return}var r;r=t._$active?t._$active[n](".lfs_item:not(.disabled, .hidden)").first():t.$list.find(".lfs_item:not(.disabled, .hidden)").first();if(r.length){r.scrollintoview({duration:0});t._$active&&t._$active.removeClass("active");r.addClass("active");t._$active=r}};var L=function e(t){return!(t.hasClass("selected")||t.hasClass("disabled"))};var N=function e(t,n){if(!d(t))return;if(t.single&&t._selected.length){var r=t.$list.find('[data-lfs-id="'+t._selected[0].lfs_id+'"]');r.removeClass("selected");t._selected.length=0;t.$lfs_value.empty()}t._selected.push(n);X(t);var i=$(a(t,n,{should_tokenize:!t.single}));_.isFunction(t.tokenClass)&&i.addClass(t.tokenClass(n));if(t.single)t.$lfs_value.html(i);else{i.addClass("lfs_token");i.insertBefore(t.$input)}if(!t.single){t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}t.$container.addClass("value");t.onItemAdded(n);d(t)||t.onMaxItemsSelected();t.single||t.$filter_input.focus()};var R=function e(t){return B(t,"nextAll")};var U=function e(t){if(t.disabled)return;var n=t._$active;if(!n.length)return;if(!L(n))return;if(!d(t))return;n.addClass("selected");n.removeClass("active");t._$active=null;var r=g(t,n);N(t,r)};var G=function e(t){return B(t,"prevAll")};var q=function e(t){t.$input_container.addClass("empty");te(t)};var W=function e(t,n){if(t.disabled)return;TS.utility.rAF(function(){t.$filter_input.focus()});if(t._list_visible)return;if(t._showing_status&&t.always_visible)return;t._list_built||z(t);if(t._list_built||t._showing_status){t._list_visible=true;t.$list_container.addClass("visible");t.$container.addClass("list_visible");ne(t)||t.$input_container.addClass("active");t._list_built&&t.$list.longListView("setHidden",false)}if(t.single&&!n){t.$filter_input.val("");t._previous_val="";t.$filter_input.focus();re(t)&&(t.data=[]);C(t)}if(t.set_height){l(t);t.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&t.$list.monkeyScroll()}t.onListShown()};var z=function e(t){if(!t.data||0===t.data.length)return;var n=I(t.data);t._list_built=true;var i={items:n,approx_item_height:t.approx_item_height,approx_divider_height:t.approx_divider_height,preserve_dom_order:true,calcDividerHeight:function e(t){return t.outerHeight()},makeDivider:function e(){return $('<div class="lfs_group"></div>')},makeElement:function e(){return $(TS.templates.lazy_filter_select_item().replace(/(\r\n|\n|\r)/gm,""))},renderDivider:function e(n,r,i){if(t.renderDividerFunc)return t.renderDividerFunc(n,r,i);n.html(Z(r.label,t))},renderItem:function e(n,r,i){if(t.render_item_func)return t.render_item_func(n,r,i);var a=$(r);var s="active selected disabled single group_item lfs_token";var o={disabled:r.disabled||r.lfs_disabled,selected:b(t,r),single:t.single,group_item:a.hasClass("group_item")};_.isFunction(t.listItemClass)&&(o[t.listItemClass(r)]=true);var l=TS.utility.getAppliedClasses(o);var u={"data-qa":t.data_qa+"-item-"+r.lfs_id,"data-lfs-id":r.lfs_id,title:r.title};n.attr(u).removeClass(s).addClass(l).html(t.template(r).string);if(a.data("lfs-item-icon")){var d="url("+a.data("lfs-item-icon")+")";var c=$('<span class="lfs_item_icon">').css("background-image",d);n.prepend(c)}if(a.data("lfs-item-desc")){var m=Z(a.data("lfs-item-desc"),t);var f=$('<span class="lfs_item_desc">').html(m);n.append(f)}}};t.$list.longListView(i);r(t);t.$list_items=t.$container.find(".list_items");TS.utility.rAF(function(){t.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&t.$list.monkeyScroll();t.$list.longListView("resizeImmediately");TS.utility.rAF(function(){t.current_items_in_view_signal.dispatch(t.$list.longListView("getCurrentItemsInView")||[])})});t.$list.longListView("getCurrentItemsInViewSignal")&&t.$list.longListView("getCurrentItemsInViewSignal").add(function(e){t.current_items_in_view_signal.dispatch(e)})};var K=function e(t){t.stopPropagation();t.preventDefault()};var V=function e(t,n){if(t.single||!t.allow_item_unselect)return;var r=g(t,n,true);n.removeClass("selected");t._selected=t._selected.filter(function(e){return e!==r});t.$input_container.find('.lfs_item[data-lfs-id="'+r.lfs_id+'"]').remove();X(t);t.$filter_input.val().length+t._selected.length===0&&q(t);0===t._selected.length&&t.$container.removeClass("value");t.onItemRemoved(r)};var Y=function e(t,r){if(!v(t)||!y(r))return;var i=r.text().trim();r.length&&F(t,r);t.$filter_input.val(i);n(t);t.$filter_input.select()};var J=function e(t,n){t.data=n||k(t.$select);if(t.data){t._selected=[];M(t);if(t.$filter_input.val().length){var r=t.$filter_input.val();t._previous_val="";D(t,r)}}};var Q=function e(t){t.restrict_input_container_height&&TS.ui.utility.updateClosestMonkeyScroller(t.$input_container,true);if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar){l(t);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(t.$list,true)})}};var X=function e(t){if(t.append)return;var n=t._selected.filter(function(e){return e instanceof HTMLOptionElement}).map(function(e){return $(e).val()});t.$select.val(n).trigger("change")};var Z=function e(t,n){t=_.escape(t);_.get(n,"should_graphic_replace_emoji")&&(t=TS.emoji.graphicReplace(t));return t};var ee=function e(t){t.$input.attr("placeholder","");ne(t)&&t.$filter_input.attr("placeholder","")};var te=function e(t){t.$input.attr("placeholder",t.placeholder_text);ne(t)&&t.$filter_input.attr("placeholder",t.filter_placeholder_text)};var ne=function e(t){return t.style===TS.ui.lazy_filter_select.STYLES.filter_in_list};var re=function e(t){return _.isFunction(t.data_promise)&&t.min_query_length};var ie=function e(t,n,r){oe(t,t.errorTemplate(n),{internal_error_message:r,clear_active_items:true})};var ae=function e(t){var n=t.noResultsTemplate(t.$filter_input.val());oe(t,n,{clear_active_items:true})};var se=function e(t){var n=TS.interop.i18n.t("Loading results\u2026","lazy_filter_select")();oe(t,n,{show_loading_indicator:true})};var oe=function e(t,n,r){r=r||{};t._showing_status=true;r.internal_error_message&&TS.error(r.internal_error_message);ne(t)||t.$input_container.addClass("active");r.show_loading_indicator&&t.$status_loading_indicator.removeClass("hidden");r.clear_active_items&&(t._$active=null);t.$status_content.html(n);t.$list_container.addClass(o)};var le=function e(t,n){n=n||{};t._showing_status=false;n.keep_input_active||t.$input_container.removeClass("active");t.$status_loading_indicator.addClass("hidden");t.$list_container.removeClass(o)};var ue=function e(t){t._prevent_blur=false};var de=function e(t){if(t.disabled)return;W(t)};var ce=function e(t,n){if(t.disabled)return;n.preventDefault();W(t)};var _e=function e(t){t.$input_container.click();t.$input.focus()};var me=function e(t){if(!t._input_is_focused){t._input_is_focused=true;t.$input_container.click();t.onInputFocus()}t.single||t.$input_container.addClass("active")};var fe=function e(n){var r=n.$filter_input.val();if(v(n)&&r.match(n.sluggify.delimiter)){var i=r.split(n.sluggify.delimiter);i.forEach(function(e){e.length&&t(n,e)})}else D(n,r,true)};var pe=function e(t,n){if(t.disabled)return;switch(n.keyCode){case TS.utility.keymap.down:K(n);R(t);break;case TS.utility.keymap.up:K(n);G(t);break;case TS.utility.keymap.enter:ge(t,n);break;case TS.utility.keymap.del:Se(t,n);break;case TS.utility.keymap.tab:Te(t,n);break;case TS.utility.keymap.esc:ve(t,n);break;default:break}t.onKeyDown(n,n.isDefaultPrevented())};var he=function e(t){if(!t._prevent_blur){T(t);le(t)}t._input_is_focused=false;t.onInputBlur()};var ge=function e(t,n){if(t._$active&&t._$active.length&&t._list_visible){K(n);var r=t._$active;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,r));if(i)V(t,r);else{if(!d(t))return;U(t);var a=$(n.currentTarget);if(""!==a.val()){a.val("");t._previous_val="";C(t)}if(t.single){T(t);le(t)}}}};var Se=function e(t,n){if(""===t.$filter_input.val()){K(n);var r=t.$input_container.find(".lfs_token").last();v(t)&&y(r)?Y(t,r):E(t)}};var Te=function e(n,r){if(n.$filter_input.val().trim()&&v(n)){K(r);t(n,n.$filter_input.val())}else if(n.tab_to_nav){K(r);r.shiftKey?G(n):R(n)}};var ve=function e(t,n){K(n);T(t);le(t);t.$filter_input.blur()};var be=function e(t,n){if(t.disabled)return;n.stopPropagation();W(t);t._prevent_blur=false};var ye=function e(t,n){1===n.which&&(t._prevent_blur=true)};var we=function e(t,n){if(t.disabled)return;P(t,$(n.currentTarget));t._prevent_blur=false};var ke=function e(t,n){1===n.which&&(t._prevent_blur=true)};var xe=function e(t,n){1===n.which&&(t._prevent_blur=true)};var Ce=function e(t){t._prevent_blur&&t.$filter_input.focus()};var Ie=function e(t,n){if(t.disabled)return;if(n.clientX==t._mouse.lastX&&n.clientY==t._mouse.lastY)return;var r=$(n.currentTarget);t._$active&&t._$active.removeClass("active");if(!r.hasClass("active")&&L(r)){r.addClass("active");t._$active=r}t._mouse.lastX=n.clientX;t._mouse.lastY=n.clientY};var Me=function e(t,n){$(n.currentTarget).removeClass("active");t._$active=null};var Ae=function e(t,n){if(t.disabled)return;n.preventDefault();var r=$(n.currentTarget);t._$active=r;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,r));if(i)V(t,r);else{var a=L(r);if(!a&&!t.single)return;if(!d(t))return;if(!a&&t.single){T(t);n.stopPropagation();return}U(t);if(""!==t.$filter_input.val()){t.$filter_input.val("");t._previous_val="";C(t)}if(t.single){T(t);n.stopPropagation()}}t._prevent_blur=false}})()},2938:function(e,t){(function(){TS.registerModule("ui.people_picker",{STYLES:{normal:"normal",small:"small"},onStart:function e(){},preload:function e(n){t(n)("");return n},make:function e(n,r){r=r||{};r.append||n.addClass("hidden");r.style=_.get(TS.ui.people_picker.STYLES,r.style,TS.ui.people_picker.STYLES.normal);n.lazyFilterSelect({append:!!r.append,always_visible:!!r.always_visible,approx_item_height:r.approx_item_height||50,data_promise:t(r),placeholder_text:r.placeholder_text||TS.interop.i18n.t("Search by name","people_picker")(),classes:"people_picker",scroll_threshold:2500,single:!!r.single,style:r.style,sluggify:r.sluggify,disabled:r.disabled,template:r.template||function(e){var t=TS.templates.member_small({member:e.member});return new Handlebars.SafeString(t)},tokenTemplate:r.tokenTemplate||function(e){var t=TS.templates.member_token({member:e.member});return new Handlebars.SafeString(t)},tokenClass:function e(t){return TS.templates.builders.getMemberTypeClass(t.member)},noResultsTemplate:r.noResultsTemplate||function(e){if(!e)return TS.interop.i18n.t("No one found","people_picker")();return TS.interop.i18n.t("No one found matching <strong>{query}</strong>","people_picker")({query:TS.interop.i18n.safeString(_.escape(e))})},onItemAdded:r.onItemAdded,onItemRemoved:r.onItemRemoved})},value:function e(t){return t.lazyFilterSelect("value")},clearValue:function e(t){return t.lazyFilterSelect("clearValue")},recomputeHeight:function e(t){return t.lazyFilterSelect("recomputeHeight")}});var e=["include_slackbot","include_self","include_bots","only_local_team","only_admins"];var t=function e(t){var r={};var i={};t.preselected_ids&&t.preselected_ids.length&&_.forEach(t.preselected_ids,function(e){e&&(i[e]=true)});var a={};t.omitted_ids&&t.omitted_ids.length&&_.forEach(t.omitted_ids,function(e){e&&(a[e]=true)});var s=function e(s,o){"@"===s.charAt(0)&&(s=s.substring(1));if(""===s&&t.empty_query_result){if(o>0)return Promise.resolve([]);return Promise.resolve(t.empty_query_result.map(function(e){return{member:e,lfs_id:String(e.id),preselected:!!i[e.id]}}))}if(""===s&&t.initial_load_promise){if(_.isUndefined(o))return t.initial_load_promise;t.initial_load_promise=n(t.initial_load_promise,i,a);return t.initial_load_promise}if(r.query!==s){r.query=s;r.include_org=TS.boot_data.page_needs_enterprise;r.include_slackbot=!!t.include_slackbot;r.include_self=t.include_self;r.full_profile_filter=false;r.include_bots=!!t.include_bots;r.only_local_team=!!t.only_local_team;r.only_admins=!!t.only_admins}var l=TS.interop.members.ensureMembersArePresent(_.keys(i)).then(function(){return n(r,i,a)});""!==s||t.initial_load_promise||(t.initial_load_promise=l);return l};return s};var n=function t(n,r,i){return Promise.resolve().then(function(){var e=[];var t=_.keys(r);t.forEach(function(t){var n=TS.interop.members.getMemberById(t);n||e.push(t)});if(e.length)return TS.interop.members.ensureMembersArePresent(e).catch(_.noop);return Promise.resolve()}).then(function(){return TS.members.promiseToSearchMembers(n).then(function(t){var a=[];if(""===t.query){var s=_.pick(n,e);a=TS.members.getMembersWithOptions(s)}else a=t.items;t.items=a.filter(function(e){return!i[e.id]}).map(function(e){if(e.member&&"undefined"!==typeof e.preselected)return e;return{member:e,lfs_id:String(e.id),preselected:!!r[e.id]}});return t})})}})()},2939:function(e,t){(function(){TS.registerModule("dnd",{dnd_statuses_changed_sig:new signals.Signal,current_user_dnd_status_changed_sig:new signals.Signal,onStart:function e(){if(!TS.client)return;if(TS.boot_data.feature_sonic_dnd_manager)return;TS.redux.socket.connectedSig.add(h);TS.redux.socket.disconnectedSig.add(g);var t=_.random(i,r);var n=Math.round(t*a);TS.dnd.setApiDelays(t,n);TS.dnd.debouncedCheckForChanges=TS.utility.throttleFunc(TS.dnd.checkForChanges,500,true);m=!!TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1);TS.presence_manager.sub_list_changed.add(S)},memberDndStatus:function e(){var t=TS.dnd.calculateMemberDndFromTimestamp(TS.model.user);var n=t&&TS.dnd.getSnoozeEnabled();var r=M(TS.model.user);var i;if(r&&n)i=P(r);else if(r){i=TS.interop.datetime.toTime(r,{do24hrTime:TS.utility.date.do24hrTime()});TS.utility.date.do24hrTime()||(i=i.split(":00").join(""))}return{in_dnd:t,snoozed:n,ends:r,readable_end_time:i}},setSnooze:function e(t){var n=function e(n,r){if(!n){TS.warn("dnd.setSnooze failed");return}TS.has_pri[$]&&D("dnd.setSnooze to "+t+" minutes. New end time is "+H(r.snooze_endtime))};return TS.interop.api.call("dnd.setSnooze",{num_minutes:t}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},endSnooze:function e(){var t=function e(t){if(!t){TS.warn("dnd.endSnooze failed");return}TS.has_pri[$]&&D("dnd.endSnooze succeeded")};return TS.interop.api.call("dnd.endSnooze",{}).then(function(e){var n=e.data,r=e.args,i=e.request_id;var a=true;t(a,n,r,i);return{data:n,args:r,request_id:i}}).catch(function(e){var n=e.data,r=e.args,i=e.request_id;var a=false;t(a,n,r,i);return{data:n,args:r,request_id:i}})},endDnd:function e(){var t=function e(t){if(!t){TS.warn("dnd.endDnd failed");return}TS.has_pri[$]&&D("dnd.endDnd succeeded")};return TS.interop.api.call("dnd.endDnd",{}).then(function(e){var n=e.data,r=e.args,i=e.request_id;var a=true;t(a,n,r,i);return{data:n,args:r,request_id:i}}).catch(function(e){var n=e.data,r=e.args,i=e.request_id;var a=false;t(a,n,r,i);return{data:n,args:r,request_id:i}})},calculateMemberDndFromTimestamp:function e(t,n){var r;n||(n=E());var i=I(t);var a=M(t);if(t.is_self&&TS.dnd.getSnoozeEnabled()&&a&&a>n)return true;if(null==i||null==a)return false;r=a>n&&(i<=n||i>a);return r},isMemberInDnd:function e(t){return!!TS.redux.dnd.isMemberInDndById(t.id)},checkForChanges:function e(){if(TS.boot_data.feature_sonic_dnd_manager)return;if(!TS.redux.socket.isConnected())return;m&&TS.metrics.mark("dnd_check_for_changes");var t=false;var n=E();if(TS.dnd.getSnoozeEnabled()&&n>=TS.dnd.getSnoozeEndtime()){var r=false;var i=null;TS.redux.dnd.updateSnoozeScheduleForCurrentMember(r,i);t=true}if(_.size(TS.redux.dnd.getAllDndSchedules())>s){TS.has_pri[$]&&D("checkForChanges over limit, purging non-relevant dnd data");v()}var a=[];var o=[];var l=function e(r){if(!r||r.deleted)return;var i=TS.dnd.isMemberInDnd(r)||false;var s=TS.dnd.calculateMemberDndFromTimestamp(r,n);if(i!=s){f(r.id,s);r.is_self&&(t=true);o.push(r)}F(r,n)&&a.push(r)};var u=TS.redux.dnd.getAllDndSchedules();_.forOwn(u,function(e,t){var n=TS.interop.members.getMemberById(t);l(n)});t&&!_.includes(o,TS.model.user)&&o.push(TS.model.user);o.length>0&&TS.has_pri[$]&&D("Processing DND status changes for "+o.length+" members");p(o);if(t){TS.dnd.current_user_dnd_status_changed_sig.dispatch();TS.has_pri[$]&&D("Current user DND status changed")}var d=0;var c=[];a=_.filter(a,function(e){var t=TS.presence_manager.isSubscribedToMember(e.id);if(!t){c.push(e.id);d+=1}return t});TS.redux.dnd.removeDndScheduleForMember(c);d&&TS.has_pri[$]&&D("checkForChanges discarded "+d+" stale members");TS.dnd.kickOffNextEventTimer();m&&TS.metrics.measureAndClear("dnd_check_for_changes_lazy","dnd_check_for_changes");return a},debouncedCheckForChanges:function e(){},kickOffNextEventTimer:function e(){if(TS.boot_data.feature_sonic_dnd_manager)return;clearTimeout(u);var t=E();var n=b(t);TS.has_pri[$]&&D("next DND tick scheduled for "+H(n));var r=1e3*(n-t);d=n;u=setTimeout(function(){var e=TS.dnd.checkForChanges();if(!e)return;if(e.length>1){TS.dnd.fetchMultipleMembers(e);TS.has_pri[$]&&D("DND refreshing "+e+" members")}else if(1===e.length){TS.dnd.refreshMember(e[0]);TS.has_pri[$]&&D("DND refreshing one member")}},r)},fetchMultipleMembers:function e(t){var n=k(t);if(n)return n.finally(TS.dnd.checkForChanges)},refreshMember:function e(t){var n=C(t);if(n)return n.finally(TS.dnd.checkForChanges)},updateUserPropsAndSignal:function e(t,n){if(!TS.redux.dnd.getDndScheduleByMemberId(t)){TS.has_pri[$]&&D("Ignoring new DND props for "+t);return}y(t,n);t===TS.model.user.id?TS.dnd.checkForChanges():TS.dnd.debouncedCheckForChanges()},getSnoozeEnabled:function e(){var t=TS.redux.dnd.getSnoozeScheduleForCurrentUser();if(!t)return false;return t.snoozeEnabled},getSnoozeEndtime:function e(){var t=TS.redux.dnd.getSnoozeScheduleForCurrentUser();if(!t)return null;return t.snoozeEndTs},getNextDndStartTs:function e(t){var n=TS.redux.dnd.getDndScheduleByMemberId(t);if(!n)return null;return n.nextDndStartTs},getNextDndEndTs:function e(t){var n=TS.redux.dnd.getDndScheduleByMemberId(t);if(!n)return null;return n.nextDndEndTs},debugInfo:function e(){var t=["DND debug info:"];t.push("next timer fires at "+H(d));t.push("_team_info_delay: "+o);t.push("_single_user_info_delay: "+l);t.push("_calcNextCheckTime: "+H(b()));var n="\n"+t.join("\n");TS.info(n)},debugMember:function e(t){var n=["DND member debugging:"];n.push("is in DND: "+!!TS.dnd.isMemberInDnd(t)+" ("+TS.dnd.calculateMemberDndFromTimestamp(t)+")");n.push("start: "+H(I(t),true));n.push("end  : "+H(M(t),true));n.push("next : "+H(A(t),true));n.push("stale? "+F(t));var r=M(t);r&&O(r)?n.push("Probably a snooze"):r&&n.push("Probably a scheduled DND");var i="\n"+n.join("\n");TS.info(i)},setApiDelays:function e(t,n){o=t;l=n},test:function e(){return{fetchUsersInfo:k,calcNextCheckTime:b,snoozeReadableCountdown:P,updateUserDndProps:y,timeWasProbablyASnooze:O,memberHasStaleTimes:F,ensureDndTimesForMemberIds:T,purgeNonRelevantData:v,requested_member_ids:c}}});var e=15;var t=300;var n=100;var r=1500;var i=10;var a=.01;var s=1500;var o=r;var l=i;var u;var d;var c={};var m=false;var f=function e(t,n){TS.redux.dnd.updateDndForMember(t,n)};var p=function e(t){t=_.filter(t,function(e){if(e.is_self)return true;return TS.presence_manager.isSubscribedToMember(e.id)});t.length&&TS.dnd.dnd_statuses_changed_sig.dispatch(t)};var h=function e(t){if(TS.boot_data.feature_sonic_dnd_manager)return;if(TS.ensureFullyBooted().isPending()){TS.ensureFullyBooted().then(e);return}if(!t){v();var n=TS.presence_manager.getSubList();_.includes(n,TS.model.user.id)||n.push(TS.model.user.id);var r=true;T(n,r)}TS.dnd.checkForChanges()};var g=function e(){if(TS.boot_data.feature_sonic_dnd_manager)return;clearTimeout(u)};var S=function e(){T(TS.presence_manager.getSubList())};var T=function e(t,n){if(TS.boot_data.feature_sonic_dnd_manager)return;if(!t||!t.length)return Promise.resolve();var r=_.map(t,function(e){return TS.interop.members.getMemberById(e)});r=_.filter(r,function(e){return e&&!e.is_bot&&!e.deleted&&e._is_local});n||(r=_.filter(r,function(e){return!c[e.id]&&!TS.redux.dnd.getDndScheduleByMemberId(e.id)}));if(!r.length)return Promise.resolve();t=_.map(r,"id");var i=_.groupBy(t);_.forEach(t,function(e){c[e]=true});TS.has_pri[$]&&D("_ensureDndTimesForMemberIds requesting "+t.length);m&&TS.metrics.count("dnd_lookup_lazy",t.length);return TS.interop.api.call("dnd.teamInfo",{users:t.join(",")}).then(function(e){var n=e.data;var r=[];if(n.users){var a=[];var s=true;_.forOwn(n.users,function(e,t){r.push(t);i[t]&&a.push(y(t,e,s))});TS.redux.dnd.updateDndScheduleForMembers(a)}if(TS.boot_data.feature_tinyspeck){var o=[];_.forEach(t,function(e){if(!TS.redux.dnd.getDndScheduleByMemberId(e)){TS.has_pri[$]&&D("dnd lookup failed for "+e);o.push(e)}});if(o.length){TS.metrics.count("dnd_lookup_failed",o.length);var l={requested:t,received:r,missing:o};TS.console.logError(l,"dnd_lookup_failed_members",null,true)}}TS.dnd.checkForChanges()}).catch(function(e){TS.boot_data.feature_tinyspeck&&TS.console.logError(e,"dnd_lookup_request_failed")}).finally(function(){_.forEach(t,function(e){delete c[e]})})};var v=function e(){var t=_.groupBy(TS.presence_manager.getSubList());var n=[];var r=TS.redux.dnd.getAllDndSchedules();_.forOwn(r,function(e,r){if(t[r])return;if(r===TS.model.user.id)return;n.push(r);f(r,false)});var i=_.map(n,function(e){return TS.interop.members.getMemberById(e)});i=_.compact(i);p(i);TS.redux.dnd.removeDndScheduleForMember(n);TS.has_pri[$]&&D("_purgeNonRelevantData dropped "+n.length)};var b=function n(r){var i;r||(r=E());var a=A(TS.model.user,r);a&&(i=a);var s=function e(t){if(t.id==TS.model.user.id)return;var n=A(t,r);if(!n)return;(!i||n<i)&&(i=n)};var o=TS.redux.dnd.getAllDndSchedules();_.forOwn(o,function(e,t){var n=TS.interop.members.getMemberById(t);n&&s(n)});var l=t+r;(!i||i>l)&&(i=l);var u=e+r;i<u&&(i=u);return i};var y=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t===TS.model.user.id&&("snooze_enabled"in n||"snooze_endtime"in n)&&TS.redux.dnd.updateSnoozeScheduleForCurrentMember(n.snooze_enabled,n.snooze_endtime);if(r){if(n.dnd_enabled)return{memberId:t,nextDndStartTs:n.next_dnd_start_ts,nextDndEndTs:n.next_dnd_end_ts};return{memberId:t,nextDndStartTs:null,nextDndEndTs:null}}n.dnd_enabled?TS.redux.dnd.updateDndScheduleForMember(t,n.next_dnd_start_ts,n.next_dnd_end_ts):TS.redux.dnd.updateDndScheduleForMember(t,null,null)};var w=false;var k=function e(t){if(w)return;w=true;m&&TS.metrics.count("dnd_lookup_lazy",t.length);var n=_.map(t,"id").join(",");var r=function e(t,n){w=false;if(!t){TS.warn("dnd.teamInfo failed for a multi-user request");return}if(n.users){var r=true;var i=_.map(n.users,function(e,t){return y(t,e,r)});TS.redux.dnd.updateDndScheduleForMembers(i)}};return TS.interop.api.call("dnd.teamInfo",{users:n},null,true).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})};var x=[];var C=function e(t){if(-1!==x.indexOf(t.id))return;x.push(t.id);if(x.length>1)return;return new Promise(function(e,t){setTimeout(function(){var r=x;x=[];var i="dnd.info";var a={user:r[0]};if(r.length>1){i="dnd.teamInfo";a=r.length>n?{}:{users:r.join(",")}}m&&TS.metrics.count("dnd_lookup_lazy",r.length);var s=function n(i,a){if(!i){if(r.length>1)TS.warn("dnd.teamInfo failed for a multi-user request (bundled single-user fetches)");else{TS.warn("dnd.info failed for "+r[0]);t(new Error("dnd.info failed for "+r[0]))}return}if(a.users){var s=true;var o=_.map(a.users,function(e,t){return y(t,e,s)});TS.redux.dnd.updateDndScheduleForMembers(o)}else y(r[0],a);e()};TS.interop.api.call(i,a,null,true).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})},1e3*l)})};var I=function e(t){return TS.dnd.getNextDndStartTs(t.id)};var M=function e(t){if(t.is_self&&TS.dnd.getSnoozeEnabled())return TS.dnd.getSnoozeEndtime();return TS.dnd.getNextDndEndTs(t.id)};var A=function e(t,n){n||(n=E());var r=I(t);var i=M(t);if(r&&i&&r>n&&r<i)return r;if(i){if(i>n)return i;var a=i+o;if(a>=n)return a}return null};var E=function e(){return Math.floor(Date.now()/1e3)};var P=function e(t){var n=t-E();if(n<0)return TS.interop.i18n.t("0s","dnd")();var r;var i;r=n/3600;if(r>=1){r=Math.floor(r);i=(n-3600*r)/60;i=Math.round(i);if(60===i){r+=1;return TS.interop.i18n.t("{dnd_hours}h","dnd")({dnd_hours:r})}if(0===i)return TS.interop.i18n.t("{dnd_hours}h","dnd")({dnd_hours:r});return TS.interop.i18n.t("{dnd_hours}h {dnd_minutes}m","dnd")({dnd_hours:r,dnd_minutes:i})}i=n/60;if(i>=1){i=Math.round(i);if(60===i)return TS.interop.i18n.t("1h","dnd")();return TS.interop.i18n.t("{dnd_minutes}m","dnd")({dnd_minutes:i})}return TS.interop.i18n.t("{dnd_remaining}s","dnd")({dnd_remaining:n})};var F=function e(t,n){n||(n=E());var r=M(t);if(!r||r>n)return false;var i=n-r;if(O(r))return true;return i>=o};var O=function e(t){var n=new Date(1e3*t);var r=n.getSeconds();var i=n.getMinutes();var a=0===r&&(0===i||30===i);return!a};var D=function e(t){TS.log($,t)};var H=function e(t,n){if(!t)return"<null>";var r=new Date(1e3*t);if(n)return r.toTimeString()+" ("+r.toDateString()+")";return r.toTimeString()};var $=2002})()},294:function(e,t,n){n(157)("asyncIterator")},2940:function(e,t){(function(){TS.registerModule("ui.messages",{onStart:function t(){var n=$("body");n.on("click.msg_action","ts-message",function(t){if(TS.client&&TS.client.ui.checkForEditing(t))return;e(t)});n.delegate("ts-message.dirty_hover_container","mouseenter",function(e){TS.ui.messages.updateMessageHoverContainer($(e.currentTarget))})},maybeUpdateMessageHoverContainer:function e(t){if(!t.length)return;t.is(":visible")?TS.ui.messages.updateMessageHoverContainer(t):t.addClass("dirty_hover_container")},updateMessageHoverContainer:function e(t){t.removeClass("dirty_hover_container");var n=t.data("model-ob-id");var r=n?TS.redux.channels.getEntityById(n):TS.shared.legacyGetActiveModelOb();if(!r)return;var i=t.attr("data-ts");var a=TS.utility.msgs.getMsg(i,r.msgs);!a&&r._archive_msgs&&(a=TS.utility.msgs.getMsg(i,r._archive_msgs));!a&&TS.model.unread_view_is_showing&&(a=TS.client.unread.getMessage(r,i));a||(a=TS.ui.replies.getActiveMessage(r,i));a||(a=TS.client.threads.getMessage(r,i));if(!a){TS.error(i+" not found in "+n);return}var s=t.find("[data-js=action_hover_container]");var o=t.closest("ts-conversation").length>0;var l=t.closest("#threads_msgs").length>0;var u=t.closest("#sli_briefing").length>0;var d=o||l;var c=!a.thread_ts||a.thread_ts===a.ts;var m="tombstone"===a.subtype&&r.is_channel&&!r.is_member;var f=false;if(!a.is_ephemeral&&"tombstone"!==a.subtype){var p="message";a.file&&(p="file_comment"===a.subtype?"file_comment":"file");var h;a.file&&(h=_.isString(a.file)?TS.files.getFileById(a.file):a.file);var g={message:a,file:h,file_comment:a.comment}[p];var S="file_comment"===p?h:r;var T=TS.templates.builders.buildStarComponents(p,g,S,true);var v=T.is_starred?"starred ts_icon_star":"ts_icon_star_o";f={text:T.is_starred?T.unstar_str:T.star_str,classes:"star_link star_"+p+" "+("file_comment"===p?"star_comment":"")+" "+v,attributes:T.html_attrs,starred:T.is_starred}}s.html(TS.templates.action_hover_items({msg:a,actions:TS.utility.msgs.getMsgActions(a,r),ts_tip_delay_class:"ts_tip_delay_60",is_in_threads_view:l,is_in_thread:d,is_root_msg:c,is_briefing_msg:u,hide_actions_menu:m,show_rxn_action:!!s.data("show_rxn_action"),show_reply_action:!!s.data("show_reply_action"),show_comment_action:!!s.data("show_comment_action"),abs_permalink:s.data("abs_permalink"),star:f}));s.toggleClass("narrow_buttons",s.children().length>3)}});var e=function e(n){if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();n.preventDefault();return}var r=$(n.target);var i=r.closest("[data-action]");if(i.length){var a=r.closest("ts-message");var s=a.data("model-ob-id");var o=s?TS.redux.channels.getEntityById(s):TS.shared.legacyGetActiveModelOb();var l=a.attr("data-ts");var u=TS.utility.msgs.getMsg(l,o.msgs);var d=i.data("action");var c=false;if(!u){u=TS.utility.msgs.getMsg(l,o._archive_msgs);u&&(c=true)}u||(u=TS.ui.replies.getActiveMessage(o,l));!u&&TS.model.threads_view_is_showing&&(u=TS.client.threads.getMessage(o,l));if(!u&&TS.model.unread_view_is_showing){u=TS.client.unread.getMessage({id:s},l);if(u){var _=TS.client.unread.getGroup(s);if(_)o=_.model_ob;else if(TS.highlights_briefing){var m=TS.highlights_briefing.getMessageFromCache(s,l);m&&(o=TS.redux.channels.getEntityById(m.channel_id))}}}if(!u){TS.error("WTF no message to click?");return}var f=TS.rxns.getRxnKeyByMsgType(u);var p;switch(d){case"actions_menu":c?TS.menu.startWithMessageActions(n,a.data("ts"),o._archive_msgs,o):TS.menu.startWithMessageActions(n,a.data("ts"),o.msgs,o);t("more_actions_button");break;case"reaction":TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics()&&TS.metrics.count("unread_view_emoji_reaction");TS.ui.react_emoji_menu.start({e:n,rxn_key:f});t("add_reaction_button");break;case"pin":TS.pins.startPinMessage(l,o);t("pin_to_this_conversation_button");break;case"unpin":TS.pins.unPinMessage(l,o);t("unpin_from_this_conversation_button");break;case"edit":TS.msg_edit.startEdit(l,o);t("edit_message_button");break;case"delete":TS.msg_edit.startDelete(l,o);t("delete_message_button");break;case"mark_unread":TS.info("_msgActionHandler: setting unread point on "+o.id+", ts = "+l+" (mark_unread)");TS.client.msg_pane.setUnreadPoint(l);t("mark_unread_button");break;case"reply":if(a.length){TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics()&&TS.metrics.count("unread_view_reply");p=u.thread_ts||u.ts;TS.ui.replies.openConversationFromMessagePane(a,o,p)}t("reply_to_thread_button");break;case"open_in_channel":if(TS.web){var h=TS.utility.msgs.constructMsgPermalink(o,l);window.location=h}else if(TS.client){TS.model.threads_view_is_showing&&TS.client.ui.threads.trackThreadsViewClosed("OPEN_IN_CHANNEL");p=u.thread_ts||u.ts;TS.client.ui.tryToJump(o.id,p)}t("open_in_channel_button");break;case"open_in_channel_from_briefing":TS.highlights_briefing&&TS.highlights_briefing.jumpToMessageInChannel(o.id,u.thread_ts||u.ts);t("open_in_channel_button");break;case"open_conversation":break;case"copy_link":var g=TS.interop.i18n.t("Copied!","messages_action_items")();TS.tips.updateFloater({title:g,classes_to_add:["success"]});TS.clipboard.writeText(i.data("permalink"));t("copy_link_button");break;case"comment":if(TS.client){n.preventDefault();var S="";var T=null;TS.client.ui.files.previewFile(u.file.id,S,false,true,T)}var v=a.attr("data-thread-ts")?"reply_to_thread_button":"start_a_thread_button";t(v);break;case"share_message":TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics()&&TS.metrics.count("unread_view_share_message");TS.ui.share_message_dialog.start(u.ts,o);t("share_message_button");break;case"add_handy_rxn":var b=i.data("name");var y=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(f),b);y&&a.addClass("just_added_handy_rxn_from_actions");TS.rxns.changeRxnsFromUserAction(f,b,y);break;case"share_file":var w=u.file;if(!w)return;TS.client?TS.view.files.shareInCurrentChannelOrIM(w.id,s):TS.ui.share_dialog.start(w.id);break;case"star":TS.stars.checkForStarClick(n,function(e){t(e?"star_message_button":"unstar_message_button")});break;default:TS.error("WTF no action?");break}}};var t=function e(t){var n={action:"click",ui_element:t};TS.interop.clog.track("MSG_ACTION",{contexts:{ui_context:n}})}})()},2941:function(e,t){(function(){TS.registerModule("click",{onStart:function e(){n();t()},addHandler:function t(n,r,i){if(_.isFunction(n)){i=r;r=n;n=null}e.push({selector:n,fn:r,prevent_on_drag:i||false})},addClientHandler:function e(){if(!TS.client)return;return TS.click.addHandler.apply(this,arguments)},addWebHandler:function e(){if(!TS.web)return;return TS.click.addHandler.apply(this,arguments)},test:function r(){return{addAll:t,setupBinding:n,handlers:function t(){return e},resetHandlers:function t(){e=[]},unbind:function e(){$("body").off("click.ts_dot_click");$("body").off("mousedown.ts_dot_click_mousedown")}}}});var e=[];var t=function e(){TS.click.addClientHandler("#archive_msg_lim_btn, #msg_lim_header_btn",function(e,t){TS.interop.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"click",ui_element:t.data("data-clog-ui-element")}}})});TS.click.addWebHandler("#msgs_div",function(e){TS.utility.isSpaceClickEventSafe(e)||e.preventDefault()});var t=["[data-ts]","[data-member-id]","[data-channel-id]","[data-group-id]","[data-mpim-id]","[data-im-id]","[data-user-group-id]","[data-file-id]"].join(", ");TS.click.addClientHandler(t,function(e){if(!e.altKey||!e.shiftKey)return;var n=$(e.target).closest(t);if(!n.length)return;var r=n.attr("data-ts");if(r){var i=n.attr("data-model-ob-id");var a=TS.utility.msgs.findMsg(r,i);if(a){e.preventDefault();TS.dir(0,a);return}}var s=n.attr("data-member-id");if(s){var o=TS.interop.members.getMemberById(s);if(o){e.preventDefault();TS.dir(0,o);return}}var l=n.attr("data-channel-id")||n.attr("data-group-id")||n.attr("data-mpim-id")||n.attr("data-im-id");if(l){var u=TS.interop.channels.getEntityById(l);if(u){e.preventDefault();TS.dir(0,u);return}}var d=n.attr("data-user-group-id");if(d){var c=TS.interop.userGroups.getUserGroupById(d);if(c&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(c)){e.preventDefault();TS.dir(0,c);return}}var _=n.attr("data-file-id");if(_){var m=TS.files.getFileById(_);if(m){e.preventDefault();TS.dir(0,m)}}});TS.click.addClientHandler("#msgs_div .message[data-ts]",function(e){var t=$(e.target);var n=t.closest(".message").data("ts");n&&(n=n.toString());var r=TS.shared.legacyGetActiveModelOb();if(!n)return;if(e.altKey){e.preventDefault();TS.info("setting unread point on "+r.id+" due to alt+click on message with ts = "+n);TS.client.msg_pane.setUnreadPoint(n)}});TS.click.addClientHandler("ts-message .resend_temp_msg, ts-message .remove_temp_msg",function(e,t){var n=t.closest("ts-message");var r=n.attr("data-ts");if(!r)return;var i=n.attr("data-model-ob-id");var a=TS.redux.channels.getEntityById(i);if(!a)return;e.preventDefault();var s=t.hasClass("resend_temp_msg");TS.utility.msgs.handleFailedMsgSend(r,a,s)});var n=["ts-message .message_body a","ts-message .message_body .btn_attachment_link","ts-message .file_container a"].join(", ");TS.click.addClientHandler(n,function(e,t){var n;var r;var i;var a;var s;var o;var l;var u;var d;var c;var m;var f=$(e.target);n=t.closest("ts-message");r=""+n.data("ts");i=n.data("model-ob-id");var p=r&&i?TS.utility.msgs.findMsg(r,i):null;a=n.data("member-id");s=n.data("app-id");o=n.data("bot-id");l=t.data("referer-original-href")||t.attr("href")||t.data("url");u={message_timestamp:r,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:l||""};if(_.has(TS,"interop.redux.features.messagePane")){var h=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==h&&(u.channel_session_id=h)}var g=TS.utility.msgs.extractMsgDisplayContext(n);if(g){u.link_origin=g;var S=null;"briefing"==g&&TS.highlights_briefing?S=TS.highlights_briefing.last_request_id:"all_unreads"==g&&TS.client.unread&&(S=TS.client.unread.last_request_id);S&&(u.request_id=S)}var T=TS.utility.msgs.isRawLink(f,l);T&&(u.link_is_raw=true);var v=TS.utility.msgs.extractLinkType(t,f,l);u.link_type=v;var b=TS.utility.msgs.extractLinkAction(t,f);b&&(u.link_action=b);var y=TS.utility.msgs.extractLinkItemId(t,f,v);if(y){u.item_id=y;u.item_type=y.charAt(0);if("channel"===v){var w=TS.interop.channels.getPublicChannelById(y);w&&null!==w.is_member&&(u.is_member=w.is_member)}}var k=p&&p.attachments;if(k){var x=t.closest(".attachment_group").length>0;if(x){u.link_is_attachment=true;var C=TS.utility.msgs.extractLinkAttachmentField(t);C&&(u.link_attachment_field=C)}}if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(r));TS.client.ui.unread.incrementTrackingSeqId()}d=t.closest(".msg_inline_img_holder").length>0;c=t.attr("data-file-id");c||(c=t.closest("[data-file-id]").attr("data-file-id"));m=c?TS.files.getFileById(c):null;if("gdrive"===_.get(m,"external_type")){u.contexts||(u.contexts={});u.contexts.platform||(u.contexts.platform={});u.contexts.platform.service_type="GSUITE";u.contexts.platform.app_id=9;u.contexts.platform.has_rich_preview=TS.files.fileHasRichPreview(m)}(d||m&&TS.files.fileIsImage(m))&&TS.interop.clog.track("MSG_PHOTO_EXPAND",u);TS.interop.clog.track("MSG_LINK_CLICKED",u);var I=TS.interop.url.urlQueryStringParse(l).state;I=I?I.match(/(\{.*\})/g):null;I=I?I[0]:null;I=I?JSON.parse(I):null;if(I&&I.is_external_auth_url){var M="auto"===I.ask?"PLATFORM_APPS_TARGETED_SUGGESTIONS_SELECTED":"PLATFORM_APPS_TARGETED_SUGGESTIONS_JUST_THIS_ONCE_SELECTED";TS.interop.clog.track(M,{app_id:I.service_type_id})}});TS.click.addClientHandler("ts-message .msg_inline_video_buttons_div .msg_inline_video_play_button",function(e,t){var n=t.closest("ts-message");var r=""+n.data("ts");var i=n.data("model-ob-id");var a=n.data("member-id");var s=n.data("app-id");var o=n.data("bot-id");var l=n.find(".msg_inline_video_new_window_button");var u=l.data("referer-original-href");var d=u||l.attr("href");var c={message_timestamp:r,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:d||""};TS.interop.clog.track("MSG_VIDEO_PLAY",c)});TS.click.addClientHandler(".member_preview_link, .member_preview_image",function(e,t,n){e.preventDefault();var r=t.closest("#member_preview_scroller");var i=t.data("member-id");if(i){if(e.shiftKey){e.preventDefault();var a=TS.interop.members.getMemberById(i);TS.dir(0,a)}if(r.length&&i==TS.model.previewed_member_id)TS.menu.member.startWithMember(e,i);else if(r.length)TS.menu.member.startWithMember(e,i,true);else if("mentions"===n||"conversation"===n||"threads"===n)TS.menu.member.startWithMember(e,i);else{var s=t.closest("#msgs_div, #archives_msgs_div, #unread_msgs_div, #sli_briefing");var o=t.closest("#all_members_container").length>0;TS.ui.share_dialog.showing&&TS.ui.share_dialog.div.modal("hide");s.length||o?TS.menu.member.startWithMember(e,i):TS.client.ui.previewMember(i,n||"team_list")}var l=t.closest("ts-message");var u=""+l.data("ts");var d=l.data("model-ob-id");i=l.data("member-id");var c=l.data("app-id");var _=l.data("bot-id");var m={message_timestamp:u,channel_id:d,channel_type:d?d.charAt(0):"",member_id:i,app_id:c,bot_id:_};TS.interop.clog.track("USERNAME_CLICK",m)}else TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".app_profile a, .app_profile_slash_command",function(e,t){var n=t.closest(".app_profile");TS.interop.clog.track("USER_PROFILE_CLICK",{app_id:n.data("app_id"),bot_id:n.data("bot_id")})});TS.click.addClientHandler(".member_details a",function(e,t){t.hasClass("member_preview_menu_target")||TS.interop.clog.track("USER_PROFILE_CLICK")});TS.click.addClientHandler(".member",function(e,t){e.preventDefault();var n=t.data("member-id");n?TS.menu.member.startWithMember(e,n):TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".theme_installer_btn",function(e,t){e.preventDefault();var n=t.data("theme");var r=false;if(n){n=n.replace(/ /g,"");n=n.replace(/,$/g,"");var i=n.split(",");n=TS.interop.utility.formatThemeColorsArray(i);TS.sidebar_themes.setLastThemeSelectedInUI("custom_theme");TS.prefs.setMultiPrefsByAPI({sidebar_theme:TS.prefs.last_theme_selected_in_UI,sidebar_theme_custom_values:JSON.stringify(n)});TS.prefs.setPrefLocal("sidebar_theme",TS.prefs.last_theme_selected_in_UI);TS.prefs.setSidebarThemeCustomValues(n);TS.view.prefs.sidebarThemePrefChanged(r)}});TS.click.addClientHandler(".internal_im_link",function(e,t){e.preventDefault();TS.ims.legacyStartImByMemberId(t.data("member-id"))});TS.click.addClientHandler(".group_link, .internal_group_link",function(e,t){e.preventDefault();TS.view.onGroupReferenceClick(e,t.data("group-id"))});TS.click.addClientHandler(".internal_im_call_link",function(e,t){if(!TS.utility.calls.isEnabled())return;e.preventDefault();TS.utility.calls.startCallInModelOb(TS.interop.members.getMemberById(t.data("member-id")))});TS.click.addClientHandler(".file_viewer_link",function(e,t,n){e.preventDefault();if(t.hasClass("file_viewer_channel_link"))if(TS.boot_data.feature_file_threads){var r=t.data("file-id");var i=function e(){var i=TS.files.getFileById(r);if(!i)return false;TS.interop.files.isTombstone(i)?TS.client.ui.files.previewFile(r,n):TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:r,show_control_btns:false});return true};i()||TS.files.fetchFileInfo(r,i)}else TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),show_control_btns:!t.closest("#file_preview_container").length})});TS.click.addClientHandler(".file_viewer_external_link",function(e,t){e.preventDefault();TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),current_external_link:t[0]})});TS.click.addHandler(".inline_attachment.clickable, .inline_attachment.clickable + .reply_broadcast_rule",function(e,t){var n=["a",".media_caret",".delete_attachment_link",".msg_inline_video_buttons_div"].join(",");if($(e.target).closest(n).length)return;var r;r=t.is(".reply_broadcast")||t.closest(".reply_broadcast_rule").length?t.closest(".message_body").find('[data-action="open_conversation"]'):t.find(".attachment_from_url_link");r[0]&&r[0].click()},true);TS.click.addClientHandler(".internal_file_list_filter",function(e,t){e.preventDefault();TS.client.ui.files.showFileList();TS.client.ui.files.toggleFileList(t.data("file-list-filter"))});TS.click.addClientHandler(".channel_link, .internal_channel_link",function(e,t){e.preventDefault();TS.view.onChannelReferenceClick(e,t.data("channel-id"))});TS.click.addClientHandler(".channel_link_unfurl_footer",function(e,t){var n=t.data("channel-id");var r=TS.interop.channels.getPublicChannelById(n);if(!r||TS.interop.rules.channels.isFromAnotherTeam(r))return;e.preventDefault();TS.channels.legacyDisplayChannel({id:r.id})});TS.click.addClientHandler(".internal_member_link:not(.plastic_contenteditable_element)",function(e,t){e.preventDefault();t.data("member-id")&&TS.view.onMemberReferenceClick(e,t.data("member-id"))});TS.click.addClientHandler(".internal_user_group_link",function(e,t){e.preventDefault();TS.view.onUserGroupReferenceClick(e,t.data("user-group-id"))});TS.click.addClientHandler(".file_preview_link, .file_details_container .file_comment_btn, .back_from_file_comments",function(e,t,n){e.preventDefault();TS.ui.share_dialog.showing&&TS.ui.share_dialog.div.modal("hide");var r=t.closest("[data-model-ob-id]").attr("data-model-ob-id");if(TS.boot_data.feature_file_threads&&t.hasClass("msg_inline_file_preview_title")){var i=t.closest("[data-ts]").attr("data-ts");var a=TS.utility.msgs.findMsg(i,r);var s=TS.redux.channels.getEntityById(r);var o=true;if(a&&TS.replies.canReplyToMsg(s,a,o)){TS.ui.replies.openConversation(r,i,null,n);return}}var l=t.attr("data-file-id");l||(l=t.closest("[data-file-id]").attr("data-file-id"));var u=TS.files.getFileById(l);if(u&&u.is_deleted){TS.generic_dialog.alert("<p>"+TS.interop.i18n.t("This file has been deleted.","clicks")()+"</p>");return}var d=t.hasClass("file_comment_link");var c=t.hasClass("file_force_flexpane");if(!c){var _=d?"?comments=1":"";if(TS.client.windows.openFileWindow(l,_))return}TS.client.ui.files.previewFile(l,n||"file_list",false,d,r)});TS.click.addClientHandler('#share_dialog [data-action="copy_link"]',function(e,t){var n=t.data("link");if(!n||!TS.clipboard.canWriteText())return;TS.tips.updateFloater({title:TS.interop.i18n.t("Copied!","share_dialog")(),classes_to_add:["success"]});TS.clipboard.writeText(n)});TS.click.addClientHandler(".msg_actions",function(e,t){var n=t.data("msg-ts");if(t.is(t)||t.closest(".msg_cog").length){e.preventDefault();if(TS.model.archive_view_is_showing){var r=TS.client.archives.getCurrentModelOb()||{};TS.menu.startWithMessageActions(e,n,r._archive_msgs)}else TS.menu.startWithMessageActions(e,n,TS.shared.legacyGetActiveModelOb().msgs)}});TS.click.addClientHandler(".comment_actions",function(e,t){var n=$(e.target);if(n.hasClass("comment_cog")){e.preventDefault();TS.menu.startWithCommentActions(e,t.data("file-id"),t.data("comment-id"))}});TS.click.addHandler(".file_actions",function(e,t){e.preventDefault();TS.menu.file.startWithFileActions(e,t.data("file-id"))});TS.click.addClientHandler(".file_ssb_download_link",function(e,t){var n=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);var r=TS.files.getFileById(t.data("file-id"));var i={is_successful:false};if(r){i.is_successful=true;var a=TS.interop.members.getMemberById(r.user);if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.interop.bots.getBotById(s);i.app_id=o?o.app_id:"";i.bot_id=s}}TS.interop.clog.track("FILE_DOWNLOAD",i);r&&TS.client.downloads.startDownload(r,n)&&e.preventDefault()});TS.click.addClientHandler(".msg_jump, .star_jump",function(e,t,n){e.preventDefault();var r=""+t.closest("[data-ts]").data("ts");if(!r){TS.error("error no msg_id to jump to?");return}var i=t.data("cid");var a=TS.redux.channels.getEntityById(i);var s=t.closest("[data-thread-ts]").attr("data-thread-ts");if(s&&s!=r){TS.ui.replies.openConversation(a,s,r,n);return}TS.client.ui.tryToJump(i,r)});TS.click.addClientHandler(".broadcast_indicator_holder_content, .broadcast_indicator_icon",function(e,t){e.preventDefault();var n=t.closest("ts-message");if(!n||!n.length)return;var r=""+n.data("ts");if(!r)return;var i=n.data("model-ob-id");if(!i)return;var a=TS.redux.channels.getEntityById(i);if(!a)return;TS.view.displayMsgInModelOb(a,r)});TS.click.addWebHandler("#msgs_div.selecting_messages ts-message",function(e){var t=$(e.target);if(t.attr("href")||t.hasClass("star"))return;var n=t.closest("ts-message");var r=n.find(".msg_select_cb");t.is("input")||r.prop("checked",!r.prop("checked"));TS.msg_edit.batchDeleteSelectionChanged(r,e.shiftKey)});TS.click.addHandler(TS.rxns.checkForRxnClick);TS.click.addHandler(TS.stars.checkForStarClick);TS.click.addHandler(function(e){TS.inline_imgs.checkForInlineImgClick(e)});TS.click.addHandler(function(e){TS.inline_videos.checkForInlineVideoClick(e)});TS.click.addHandler(function(e){TS.inline_audios.checkForInlineAudioClick(e)});TS.click.addHandler(function(e){TS.inline_others.checkForInlineOtherClick(e)});TS.click.addHandler(function(e){TS.inline_attachments.checkForInlineAttachmentClick(e)});TS.click.addHandler(TS.inline_file_previews.checkForInlineFilePreviewClick);TS.click.addHandler(TS.inline_room_previews.checkForInlineRoomPreviewClick);TS.click.addClientHandler(".file_list_item",function(e,t,n){var r;var i=$(e.target);var a=t.data("file-id");r=!TS.menu.file.file_list_menu_up&&!i.is(".star")&&!i.closest("a").length&&!i.closest("button").length;if(r){e.preventDefault();if(!TS.boot_data.feature_file_threads&&TS.files.fileIsImage(a)){TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:a,show_control_btns:false});return}TS.ui.share_dialog.showing&&TS.ui.share_dialog.div.modal("hide");TS.client.ui.files.previewFile(t.data("file-id"),n||"file_list",false)}});TS.click.addClientHandler("a.file_share, button.file_share",function(e,t){e.preventDefault();TS.view.files.shareInCurrentChannelOrIM(t.data("file-id"))});TS.click.addClientHandler(".snippet_edit_dialog_link",function(e,t){var n=TS.files.getFileById(t.data("file-id"));if(!n.is_truncated){e.preventDefault();TS.ui.snippet_dialog.startEdit(n.id)}});TS.click.addClientHandler(".file_new_window_link",function(e,t){TS.client.windows.openFileWindow(t.data("file-id"),"")?e.preventDefault():TS.utility.welcome_post.clogWelcomePostOpen(t)});TS.click.addClientHandler("a.show_parent_replies, a.show_replies, .reply_bar",function(e,t,n){e.preventDefault();var r=t.closest("ts-message");var i=r.attr("data-thread-ts");if(!i)return;var a=r.attr("data-model-ob-id");var s=TS.redux.channels.getEntityById(a);if(!s)return;TS.ui.replies.openConversationFromMessagePane(r,s,i,null,n)});TS.click.addWebHandler(".reply_bar",function(e,t){var n=$(e.target);if(!n.is("a")){var r=t.closest("ts-message");var i=r.attr("data-thread-ts");if(!i)return;var a=r.attr("data-model-ob-id");var s=TS.redux.channels.getEntityById(a);if(!s)return;var o=TS.utility.msgs.constructConversationPermalink(s,i);window.open(o)}});TS.click.addClientHandler('[data-action="open_conversation"]',function(e,t,n){e.preventDefault();var r=t.attr("data-model-ob-id");var i=TS.redux.channels.getEntityById(r);if(!i)return;var a=t.attr("data-thread-ts");if(!a)return;var s=t.attr("data-ts");TS.ui.replies.openConversation(i,a,s,n)});TS.click.addClientHandler("#mentions_clear_notifications",function(e){e.preventDefault();TS.replies.markAllThreads()});TS.click.addClientHandler("#reply_container .reply_send, #file_reply_container .reply_send",function(e,t){e.preventDefault();TS.ui.replies.submitReply(e,t)});TS.click.addClientHandler("#threads_msgs .reply_send",function(e,t){e.preventDefault();TS.ui.thread.submitReply(e,t)});TS.click.addClientHandler("#reply_container .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.replies.joinChannelFromThread(e,t)});TS.click.addClientHandler("#threads_msgs .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.thread.joinChannelFromThread(e,t)});TS.click.addClientHandler(".thread_error_state_refresh_button",function(e){e.preventDefault();TS.client.threads.maybeReloadThreadsView()});TS.click.addClientHandler(".thread_flexpane_retry_button",function(e){e.preventDefault();TS.ui.replies.reloadConversation()});TS.click.addClientHandler("#thread_notification_banner .banner_buttons .btn",function(e,t){e.preventDefault();var n=t.data("turn-on-pref");var r=$("#thread_notification_banner");var i=r.height();r.height(i);r.addClass("show_confirmation");r.height(92);TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true});var a=TS.prefs.getPref("threads_everything")!==n;if(a){TS.prefs.setPrefByAPI({name:"threads_everything",value:n});TS.interop.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{threads_everything:n.toString()}})}});TS.click.addClientHandler("#thread_notification_banner .close",function(e){e.preventDefault();var t=$("#thread_notification_banner");var n=t.height();t.height(n);t.height(0);TS.prefs.getPref("seen_threads_notification_banner")||TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true})});TS.click.addClientHandler("#thread_notification_banner_pref_link",function(e){e.preventDefault();TS.ui.prefs_dialog.start("notifications","#prefs_threads_everything","prefs_notifications")});TS.click.addClientHandler("a.see_all_pins",function(e){if(TS.client&&TS.client.channel_page){e.preventDefault();TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showPinsSection();$("#channel_page_scroller .channel_page_pinned_items").highlight(null,"channel_page_pinned_items_highlighter")}});TS.click.addClientHandler("ts-thread .new_reply_indicator",function(e,t){var n=t.closest("ts-thread");if(!n.length)return;e.preventDefault();var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");TS.client.threads.showNewRepliesAndMarkThread(r,i)});TS.click.addClientHandler("ts-thread .view_all_replies_container",function(e,t){var n=t.closest("ts-thread");if(!n.length)return;e.preventDefault();if(t.hasClass("active"))return;t.addClass("active");var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");TS.client.threads.showPreviousReplies(r,i).finally(function(){t.removeClass("active")})});TS.click.addClientHandler("#msgs_div ts-thread .expand_inline_thread",function(e,t){e.preventDefault();var n=t.closest("ts-thread");if(!n.length)return;TS.ui.thread.expandInlineThread(n)});TS.click.addClientHandler("#msgs_div ts-thread .collapse_inline_thread",function(e,t){e.preventDefault();var n=t.closest("ts-thread");if(!n.length)return;TS.ui.thread.collapseInlineThread(n)});TS.click.addClientHandler(".thread_comments_toggle_container",function(e,t){e.preventDefault();t.closest(".thread_comments_holder").toggleClass("expanded")});TS.click.addClientHandler("a[href]",function(e,t,n){var r;var i;var a=t.attr("href");TS.utility.isSlackUrl(a)&&(a=a.toLowerCase());var s=a.indexOf("?")>-1;if(s){r=a.indexOf("?");i=a.slice(0,r)}var o={"/account/settings":true,"/admin":true,"/admin/billing":true,"/admin/settings":true,"/apps":true,"/apps/manage":true,"/apps/new":true,"/customize":true,"/files":true,"/pricing":true,"/pricing/standard":true,"/pricing/plus":true,"/pricing/enterprise-grid":true,"/stats":true,"/help":true};if(o[a]||o[i]){e.preventDefault();TS.utility.openAuthenticatedInBrowser(a);return}if(TS.client.archives.maybeHandleArchiveLink(t,n)){TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing&&TS.ui.fs_modal.close();e.preventDefault();return}if(TS.utility.calls.maybeHandleCallLink(t)){e.preventDefault();return}if(TS.utility.calls.maybeEnterMasToDdlFlow(a)){e.preventDefault();return}if(!t.attr("target")&&0!==a.indexOf("skype:")){e.preventDefault();TS.utility.openInNewTab(a,TS.templates.builders.newWindowName());return}var l=TS.utility.getFileIDFromURL(a);if(l&&TS.client.windows.openFileWindow(l,"")){e.preventDefault();return}TS.ui.replies.maybeOpenConversationLink(t,n)&&e.preventDefault()});TS.click.addClientHandler(".attachment_show_more",function(e,t){var n=t.closest("ts-message");if(!n||!n.length)return;var r=n.data("ts").toString();var a=n.data("model-ob-id");var s=TS.redux.channels.getEntityById(a);var o=TS.utility.msgs.findMsg(r,a);if(!o){TS.log(i,"cannot show more attachments, msg not found");return}var l=o._shown_attachments;Number.isInteger(l)&&l+20<=o.attachments.length?o._shown_attachments+=20:o._shown_attachments=o.attachments.length;TS.utility.msgs.legacyReplaceMsg(s,o)});TS.click.addClientHandler(".attachment_actions_interactions .btn",function(e){e.preventDefault();var t=TS.attachment_actions.handleActionEventAndGetContext($(e.target));if(t){var n=TS.attachment_actions.client_buttons.fetchClientButtonData(t.message);if(n){TS.attachment_actions.client_buttons.handleClick(n,t);return}t.action.confirm?TS.attachment_actions.confirmAction(t.action,function(){TS.attachment_actions.action_triggered_sig.dispatch(t)}):TS.attachment_actions.action_triggered_sig.dispatch(t);var r=["Create a channel","Edit messages","Upload files"];var i=_.startsWith(t.action.name,"slackbot_help");(_.includes(r,t.action.name)||i)&&TS.interop.clog.track("GROWTH_HELP_SLACKBOT_V2",{action:"click",click_target:t.action.name,button_position:t.action.id,button_text:t.action.text,locale:TS.interop.i18n.locale})}});TS.click.addClientHandler("#threads_view_banner .clear_unread_messages",function(e){e.preventDefault();TS.client.threads.markAllNewThreads()});TS.click.addClientHandler("#threads_view_banner",function(e){e.preventDefault();if(TS.client.ui.threads.isAlternativeThreadsViewShowing()){TS.client.threads.maybeReloadThreadsView();return}TS.client.ui.threads.jumpToTop()});TS.click.addClientHandler(".app_preview_link",function(e,t){e.preventDefault();var n=t.closest("[data-bot-id]");var r=n.data("bot-id");var i=n.data("team-id");var a=""+n.data("ts");var s=n.data("model-ob-id");var o=n.data("member-id");var l=n.data("app-id");if(r&&!i)if(o)i=_.get(TS.interop.members.getMemberById(o),"team_id",null);else{var u=TS.shared.legacyGetActiveModelOb();var d=TS.utility.msgs.getMsg(a,u.msgs);i=_.get(d,"bot_profile.team_id",null)}var c={message_timestamp:a,channel_id:s,channel_type:s?s.charAt(0):"",member_id:o,app_id:l,bot_id:r};TS.interop.clog.track("USERNAME_CLICK",c);if(r)if(t.closest(".dm_badge").length>0&&t.hasClass("member_image")){var m=o||_.get(TS.interop.apps.getAppById(l),"bot_user.id");TS.ims.legacyStartImByMemberId(m).then(function(){TS.client.ui.app_space.toggleView("about")})}else TS.menu.app.startWithApp(e,r,i,true);else TS.warn("hmm, no data-bot-id?")});TS.click.addClientHandler(".attachment_attribution a",function(e,t){var n=t.data("attribution-bot-id");var r=t.data("attribution-team-id");if(n){e.preventDefault();r?TS.menu.app.startWithApp(e,n,r):TS.menu.app.startWithApp(e,n)}else TS.warn("hmm, no data-bot-id?")});TS.click.addHandler("[data-slash-command-autofill]",function(e,t){var n=TS.client.msg_input.$input;var r=TS.utility.contenteditable.value(n);var i=t.data("slash-command-autofill");var a;var s;var o;if(t.data("app_space_profile_slash_command")){a="APP_SPACE_ABOUT_SLASH_COMMAND_CLICK";s=_.get(TS.client.ui.app_space,"active_app.id");o=TS.client.ui.app_space.app_bot_id}else{a="APP_PROFILE_SLASH_COMMAND_CLICK";s=_.get(TS.client.ui.app_profile,"active_app.id");o=null}TS.interop.clog.track(a,{app_id:s,bot_id:o,contexts:{core:{app_id:s,bot_id:TS.client.ui.app_space.app_bot_id}}});TS.interop.apps.isAppSpaceEnabled()&&"messages"!==TS.client.ui.app_space.active_view&&TS.client.ui.app_space.toggleView("messages");if(!r){TS.utility.contenteditable.clear(n);TS.utility.contenteditable.insertTextAtCursor(n,i)}TS.utility.contenteditable.value(n,i+" "+r);TS.utility.contenteditable.cursorPosition(n,i.length+1,r.length);TS.utility.contenteditable.focus(n)});if(TS.boot_data.feature_tinyspeck){TS.click.addClientHandler(".p-channel_insights__top-contributors-debug",function(){var e=TS.client.ui.channel_insights.last_details_response;var t=_.get(e,"response.data.top_contributors.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)});TS.click.addClientHandler(".p-channel_insights__similar-channels-debug",function(){var e=TS.client.ui.channel_insights.last_details_response;var t=_.get(e,"response.data.similar_channels.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)});TS.click.addClientHandler(".p-channel_insights__top-messages-debug",function(){var e=TS.client.ui.channel_insights.last_highlights_response;var t=_.get(e,"response.data.top_messages.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)})}TS.boot_data.feature_tinyspeck&&TS.click.addClientHandler(".recap_highlight_debug",function(e){if("sli_debug_info"===TS.client.highlights.sli_recaps_debug_group){var t;if(TS.model.unread_view_is_showing){var n=$(e.target).parents("ts-message").data("model-ob-id");t=TS.redux.channels.getEntityById(n)}else t=TS.shared.legacyGetActiveModelOb();var r=$(e.target).parents("ts-message").data("ts");var i=TS.client.highlights.getHighlight(t.id,r);TS.client.ui.debugger_flexpane.printJSON(i)}});TS.click.addClientHandler("[data-highlight-feedback]",function(e){var t=$(e.target).data("highlight-feedback");var n=$(e.target).closest("ts-message");var r=n.data("model-ob-id");var i=n.data("ts");TS.client.highlights.setDefaultFeedbackForHighlight(r,i,{feedback:t},TS.model.unread_view_is_showing?"all-unreads":"in-channel");$("#ts_tip_float_floater .ts_tip_tip").text(TS.interop.i18n.t("Thank you!","highlights")())});TS.click.addClientHandler('[data-js="highlights_feedback_dropdown"]',function(e){var t=$(e.target).closest("ts-message");var n=t.data("model-ob-id");var r=t.data("ts");var i=TS.model.unread_view_is_showing?"all-unreads":"in-channel";TS.client.ui.highlights.openNegativeFeedbackMenu(e,n,r,i)});TS.click.addClientHandler('[data-js="sli_briefing_back_button"]',function(){TS.client.unread.showUnreadView();TS.highlights_briefing.clogBackButton()});TS.click.addClientHandler(".channel_page_highlights ts-message",function(e){var t=$(e.target).closest("ts-message");var n=t.data("ts");var r=t.data("model-ob-id");TS.client.ui.tryToJump(r,n);var i={channel_id:r,channel_type:r[0]||"",message_timestamp:n,request_id:TS.client.ui.channel_insights.last_highlights_response.response.request_id};TS.interop.clog.track("CHANNEL_INSIGHTS_JUMP_TO_MESSAGE",i)});TS.click.addClientHandler("[data-js=mount-connected-workspaces]",function(){TS.interop.mountConnectedWorkspaces(TS.boot_data.team_id,{referringUiElement:"WHATS_NEW_PRIV_ESC_ANNOUNCEMENT_MANAGE_SHARED_CHANNELS_LINK"})});TS.click.addClientHandler(".remove_file_from_msg_button",function(e){var t=$(e.target).closest("[data-file-id]").attr("data-file-id");var n=$(e.target).closest("ts-message");var r=n.attr("data-ts");var i=n.attr("data-model-ob-id");t&&r&&i&&TS.interop.api.call("chat.removeFile",{channel:i,ts:r,file:t})})};var n=function t(){var n={};$("body").on("mousedown.ts_dot_click_mousedown",function(e){n.x=e.clientX;n.y=e.clientY});$("body").on("click.ts_dot_click",function(t){if(t.isDefaultPrevented())return;if(TS.view&&TS.view.maybeFollowLink(t))return;if(TS.isPartiallyBooted()){t.preventDefault();return}var a=$(t.target);if(a.parents("[data-reactroot]").length||a.parents(".ReactModalPortal").length)return;var s=r(t);var o;var l;for(var u=0;u<e.length;u+=1){o=e[u];l=null;if(o.prevent_on_drag&&(t.clientX!=n.x||t.clientY!=n.y))continue;if(o.selector){l=a.closest(o.selector);if(!l.length)continue;o.fn(t,l,s);t.isDefaultPrevented()&&TS.has_pri[i]&&TS.log(i,"click on "+o.selector)}else o.fn(t,s);if(t.isDefaultPrevented())return}})};var r=function e(t){var n=$(t.target);if(n.closest("#member_stars_list").length)return"starred_items";if(n.closest("#member_mentions").length)return"mentions";if(n.closest("#file_list").length)return"file_list";if(n.closest("#file_preview_scroller").length)return"file_preview";if(n.closest("#member_preview_scroller").length)return"member_preview";if(n.closest("#convo_scroller").length)return"conversation";if(n.closest("#groups_tab").length)return"groups";if(n.closest("#threads_msgs_scroller_div").length)return"threads";if(n.closest("#channel_page_scroller").length){var r=TS.shared.legacyGetActiveModelOb();var i="channel_page";r.is_group&&!r.is_mpim?i="group_page":(r.is_im||r.is_mpim)&&(i="im_page");return i}return null};var i=2003})()},2942:function(e,t){(function(){TS.registerModule("sorter",{onStart:function e(){},search:function e(t,n,r){return c(t,n,r)},printTest:function e(t,n){var r=TS.members.getActiveMembersWithSelfAndSlackbot();var i=_.partition(TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()),"is_group");var a=i[0];var s=i[1];var o=TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim);var l=_.values(TS.boot_data.other_accounts);var u=TS.interop.userGroups.getActiveUserGroups();var d=TS.model.emoji_map;var c=TS.utility.members.getBroadcastKeywordsForUser();var m=TS.model.NAMED_VIEWS;var f={members:r,channels:s,groups:a,mpims:o,teams:l,usergroups:u,emoji:d,broadcast_keywords:c,views:m};TS.sorter.search(t,f,_.extend({print:true},n))},scoreEmoji:function e(t,n){return s(t,n)},test:function t(){var r={sortFuzzy:g,frecencyBonusPoints:T,getFilteredMatchesForFrecency:m,scoreMember:l,_scoreUserGroup:u,getSubQueryMatchers:o,_scoreEmoji:s,_makeFuzzySearcher:e,_getMetaFieldForId:i,search:c,getNameForComparison:h};Object.defineProperty(r,"_meta_fields",{get:function e(){return n},set:function e(t){n=t}});return r}});var e=function e(t,n){n=n||{};var i=null!=n.fuzzy_limit?n.fuzzy_limit:10;t=TS.interop.i18n.deburr(t.toLocaleLowerCase());var a=t;var c="@"===t.charAt(0);var m="#"===t.charAt(0);var f=":"===t.charAt(0);var p=false;TS.interop.apps.isGlobalActionsEnabled()&&(p="/"===t.charAt(0));(c||m||f||p)&&(t=t.substring(1));var h={fuzzy_limit:i};var g={fuzzy_limit:i,search_forward_only:true};var S=TS.fuzzy.makeFuzzyMatcher(t,h);var T=TS.fuzzy.makeFuzzyMatcher(a,h);var v=TS.fuzzy.makeFuzzyMatcher(t,g);var b=o(t,g);return{query:t,full_query:a,only_channels:m,only_members:c,only_emoji:f,only_app_actions:p,matchesChannel:function e(a){if(TS.interop.rules.channels.isUnknownOrNonExistent(a))return false;if(c||f||p)return false;if((n.allow_empty_query||m)&&!t){r(a.id,"jumper_score",0);return true}var s=S.score(a.name_normalized||a.name);r(a.id,"jumper_score",s);if(s>i&&n.search_previous_channel_names&&a.previous_names&&a.previous_names.length){var o=_.map(a.previous_names,function(e){return{score:S.score(e),name:e}});r(a.id,"jumper_previous_name_scores",o);var l=_.some(o,function(e){return e.score<=i});var u=l&&s>i;if(u){var d=_.minBy(o,"score");a._jumper_previous_name_match=d&&d.name}else a._jumper_previous_name_match=null;return s<=i||l}a._jumper_previous_name_match&&(a._jumper_previous_name_match=null);return s<=i},matchesGroup:function e(a){if(m||c||f||p)return false;if(n.allow_empty_query&&!t){r(a.id,"jumper_score",0);return true}var s=S.score(a.name_normalized||a.name);r(a.id,"jumper_score",s);return s<=i},matchesMember:function e(a){if(a.is_non_existent||a.isNonExistent||a.is_unknown||a.isUnknown)return false;if(m||f||p)return false;if((n.allow_empty_query||c)&&!t){r(a.id,"jumper_score",0);return true}var s=l(a,v,t);r(a.id,"jumper_score",s);return s<=i},matchesMpim:function e(a){if(m||c||f||p)return false;if(n.allow_empty_query&&!t){r(a.id,"jumper_score",0);return true}var s=TS.mpims.legacyGetMembersInDisplayOrder(a);s=_.chain(s).reject(function(e){return!e||e.is_non_existent||e.isNonExistent||e.is_unknown||e.isUnknown}).value();var o=b.map(function(e){var t=s.map(function(t){return l(t,e)});return _.min(t)});var u=_.sum(o);r(a.id,"jumper_score",u);return u<=i},matchesTeam:function e(t){if(TS.interop.rules.teams.isUnknownOrNonExistent(t))return false;var n=t.team_name||t.name||"";var a=T.score(n.toLocaleLowerCase());r(t.id,"jumper_score",a);return a<=i},matchesUserGroup:function e(a){if(m||f||p)return false;if((n.allow_empty_query||c)&&!t){r(a.id,"jumper_score",0);return true}var s=u(a,S);r(a.id,"jumper_score",s);return s<=i},matchesEmoji:function e(i){if(m||c||p)return false;if(n.allow_empty_query&&!t){r(i.id,"emoji_score",0);return true}var a=TS.interop.i18n.deburr(i.display_name||i.name);var o;var l;o=s(a,t);if(i.display_name&&i.display_name!==i.name){l=s(i.name,t);if(Infinity!==l&&l<o){o=l;a=i.name}}if(Infinity!==o){r(i.id,"emoji_score",o);return true}return false},matchesBroadcastKeyword:function e(a){if(m||f||p)return false;if((n.allow_empty_query||c)&&!t){r(a.id,"jumper_score",0);return true}var s=d(a,S);r(a.id,"jumper_score",s);return s<=i},matchesView:function e(t){if(m||f||p)return false;var n=S.score(t.name.toLocaleLowerCase());Infinity===n&&t.alt_names&&(n=_.reduce(t.alt_names,function(e,t){return Math.min(e,S.score(t.toLocaleLowerCase()))},n));r(t.id,"jumper_score",n);return n<=i},matchesAppAction:function e(a){if(!TS.interop.apps.isGlobalActionsEnabled())return false;if(m||f||c)return false;if((n.allow_empty_query||p)&&!t){r(a.id,"jumper_score",0);return true}var s=S.score(a.name.toLocaleLowerCase());r(a.id,"jumper_score",s);return s<=i}}};var t=/\s+/g;var a=/[-]+/g;var s=function e(n,r){var i=2;var s=6;if(r.length<3){i=0;s=0}else if(3===r.length){i=1;s=1}else if(4===r.length){i=1;s=5}else s=5;if("ok_hand"===n&&"ok"===r)return 0;var o=TS.interop.searcher.emojiSkiplist;if(o[r]&&-1!==o[r].indexOf(n))return Infinity;var l=Infinity;var u=n.indexOf(r);-1===u&&(u=n.indexOf(r[0]));if(-1!==u){r=r.replace(t,"").replace(a,"_");n=n.replace(a,"_");var d=r.split("");var c=0;var _=0;var m=0;var f=true;for(var p=u;p<n.length;p++){if(n[p]===d[0]){f=true;d.shift();m>_&&(_=m);m=0;if(0===d.length)break}else{f&&(c+=1);f=false;m+=1}if(c>i)return l;if(m>s)return l}if(d.length>0)return l;l=1-r.length/n.length;c>0&&(l+=c)}return l};var o=function e(t,n){var r=t.split(/[,| ]/).filter(function(e){return!!e});return r.map(function(e){e="@"===e.charAt("0")?e.substring(1):e;return TS.fuzzy.makeFuzzyMatcher(e,n)})};var l=function e(t,n,r){var i;if(TS.utility.queryIsMaybeSelf(r)&&t.is_self)return 0;var a=Infinity;var s=Infinity;var o=Infinity;var l=Infinity;a=n.score(t._real_name_lc);t._real_name_lc!==t._real_name_normalized_lc&&(s=n.score(t._real_name_normalized_lc));if(t._display_name_lc){o=n.score(t._display_name_lc);t._display_name_lc!==t._display_name_normalized_lc&&(l=n.score(t._display_name_normalized_lc))}i=Math.min(a,s,o,l);return i};var u=function e(t,n){var r=Infinity;var i=Infinity;r=n.score(t.name);i=n.score(t.handle);var a=Math.min(r,i);return a};var d=function e(t,n){var r=Infinity;var i=Infinity;r=n.score(t.name);t.ms_name!==t.name&&(i=n.score(t.ms_name));if(!t.alias)return Math.min(r,i);var a=Infinity;a=n.score(t.alias);var s=Math.min(r,i,a);return s};var c=function t(n,a,o){var l=e(n,o||{});var u=[];var d=[];var c=[];var f=[];var p=[];var h=[];var v=[];var b=[];var y=[];var w=[];var k=[];var x=[];var C=[];var I=o.match_emoji_keywords?TS.emoji.findByKeyword(n):[];var M=[];a.members=a.members||[];a.channels=a.channels||[];a.groups=a.groups||[];a.mpims=a.mpims||[];a.teams=a.teams||[];a.usergroups=a.usergroups||[];a.emoji=a.emoji||[];a.broadcast_keywords=a.broadcast_keywords||[];a.views=a.views||[];a.enterprise_channels=a.enterprise_channels||[];a.enterprise_groups=a.enterprise_groups||[];a.app_actions=a.app_actions||[];TS.metrics.mark("ts-sorter-matching-mark");if(!l.only_channels&&!l.only_emoji&&!l.only_app_actions){d=a.members.filter(function(e){if(e.is_non_existent||e.isNonExistent||e.is_unknown||e.isUnknown)return false;_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))||TS.console.logError(e.id+": memberProfileFieldDisplayName is not a string.");_.isString(TS.interop.members.getMemberRealName(e))||TS.console.logError(e.id+": memberRealName is not a string");if(o.prefer_exact_match&&l.query&&(TS.interop.members.getMemberProfileFieldDisplayName(e)&&_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))&&TS.interop.members.getMemberProfileFieldDisplayName(e).toLocaleLowerCase()===l.query||TS.interop.members.getMemberRealName(e)&&_.isString(TS.interop.members.getMemberRealName(e))&&TS.interop.members.getMemberRealName(e).toLocaleLowerCase()===l.query)){r(e.id,"jumper_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);return l.matchesMember(e)});w=a.usergroups.filter(function(e){if(o.prefer_exact_match&&e.handle===l.query||e.name_lc===l.query){u.push(e);return false}return l.matchesUserGroup(e)});x=a.broadcast_keywords.filter(function(e){if(o.prefer_exact_match&&e.name===l.query){u.push(e);return false}return l.matchesBroadcastKeyword(e)})}if(!l.only_members&&!l.only_emoji&&!l.only_app_actions){var A=function e(t){if(TS.interop.rules.channels.isUnknownOrNonExistent(t))return;if(o.prefer_exact_match&&t.name===l.query){r(t.id,"jumper_exact_match",true);u.push(t);return}r(t.id,"jumper_exact_match",false);var n=l.matchesChannel(t);if(!n)return;t.is_member?c.push(t):t.is_archived?p.push(t):f.push(t)};a.channels.forEach(A);a.enterprise_channels.forEach(A)}if(!l.only_channels&&!l.only_members&&!l.only_emoji&&!l.only_app_actions){var E=function e(t){if(o.prefer_exact_match&&t.name===l.query){r(t.id,"jumper_exact_match",true);u.push(t);return}r(t.id,"jumper_exact_match",false);var n=l.matchesGroup(t);if(!n)return;t.is_archived?v.push(t):h.push(t)};a.groups.forEach(E);a.enterprise_groups.forEach(E);b=a.mpims.filter(function(e){return l.matchesMpim(e)})}y=a.teams.filter(function(e){if(TS.interop.rules.teams.isUnknownOrNonExistent(e))return false;if(!_.isObject(e))return false;var t=e.team_name||e.name||"";if(o.prefer_exact_match&&t.toLocaleLowerCase()===l.full_query){r(e.id,"jumper_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);var n=l.matchesTeam(e);return n});l.only_channels||l.only_members||l.only_app_actions||(k=a.emoji.filter(function(e){if(o.prefer_exact_match&&((e.display_name||e.name)===l.query||"ok_hand"===e.name&&"ok"===l.query)){r(e.id,"jumper_exact_match",true);r(e.id,"emoji_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);if(o.match_emoji_keywords&&I.length){var t=TS.emoji.nameToBaseName(e.display_name||e.name);if(-1!==I.indexOf(t)){r(e.id,"emoji_score",s(t,n));return true}}return l.matchesEmoji(e)}));TS.client&&a.views&&(l.only_channels||l.only_members||(C=a.views.filter(function(e){if(o.prefer_exact_match&&e.name===l.query){u.push(e);return false}return l.matchesView(e)})));l.only_channels||l.only_emoji||l.only_members||(M=a.app_actions.filter(function(e){if(!_.isObject(e))return false;var t=e.name;if(o.prefer_exact_match&&t.toLocaleLowerCase()===l.full_query){r(e.id,"jumper_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);var n=l.matchesAppAction(e);return n}));TS.metrics.measureAndClear("ts-sorter-matching","ts-sorter-matching-mark");TS.metrics.mark("ts-sorter-sorting-mark");var P;var F;var O;P=d.concat(c,h,b,k,w,x,C,M);o.flat||P.sort(_.partial(g,true));F=f.concat(y);o.flat||F.sort(_.partial(g,true));O=v.concat(p);o.flat||O.sort(_.partial(g,true));var D=P.concat(F,O);o.flat&&D.sort(_.partial(g,true));var H=D;if(o.prefer_exact_match&&u.length>0)if("updated_sort"===TS.interop.experiments.getGroupForUser("sli_searcher_member_sort")){var $;u.sort(_.partial(S,true));($=H).unshift.apply($,u)}else for(var j=0;j<u.length;j+=1)H.unshift(u[j]);if(o.frecency){o.normalize=true;TS.metrics.mark("ts-sorter-frecency-sort-mark");H=TS.ui.frecency.query(H,n,T,o)}o.limit&&(H=_.take(H,o.limit));if(o.frecency){H=m(H);TS.metrics.measureAndClear("ts-sorter-frecency-sort","ts-sorter-frecency-sort-mark")}if(o.print){var B="\n";_.forEach(H,function(e){var t=o.frecency?e.model_ob:e;o.frecency&&(B+="["+e.score+"] ");null!=i(t.id,"jumper_score")&&(B+="["+i(t.id,"jumper_score")+"] ");t.is_mpim?B+=TS.mpims.legacyGetDisplayName(t):t.is_channel?B+="#"+t.name:t.is_group?B+=t.name:t.team_name?B+=t.team_name:t.is_usergroup?B+="@"+t.name:t.presence?B+="@"+t.name:B+=e.model_ob?e.model_ob.name:e.name;B+="\n"});TS.info(B)}TS.metrics.measureAndClear("ts-sorter-sorting","ts-sorter-sorting-mark");return H};var m=function e(t){var n=[];TS.boot_data.page_needs_enterprise&&(t=_.uniqBy(t,function(e){return e.id}));_.forEach(t,function(e){var t;if(TS.interop.utility.looksLikeMemberId(e.id)){var r=TS.interop.members.getMemberById(e.id);r&&n.push({model_ob:r,score:e.score});return}var i=0===e.id.indexOf("BK");var a=0===e.id.indexOf("V");var s=false;TS.interop.apps.isGlobalActionsEnabled()&&(s=TS.interop.utility.looksLikeGlobalActionFrecencyId(e.id));t=i?TS.model.getBroadcastKeywordById(e.id):a?TS.model.getViewById(e.id):s?p(e.id):f(e.id);t&&n.push({model_ob:t,score:e.score})});return n};var f=function e(t){if("E"===t[0])return TS.emoji.getEmojiById(t);if("S"===t[0])return TS.interop.userGroups.getUserGroupById(t);if("T"===t[0])return TS.redux.teams.getTeamById(t);return TS.boot_data.page_needs_enterprise?TS.enterprise.getModelObById(t):TS.redux.channels.getEntityById(t)};var p=function e(t){var n=TS.interop.utility.decodeGlobalActionFrecencyId(t);if(!n)return null;var r=TS.interop.redux.models.appActions.selectGlobalActionsCache(TS.redux.getState());var i=r[n];return i?TS.interop.utility.getGlobalActionForFrecency(i):null};var h=function e(t){var n;n=t.is_mpim?_.toLower(TS.mpims.legacyGetDisplayName(t)):t.is_usergroup?t.handle||t.name:"updated_sort"===TS.interop.experiments.getGroupForUser("sli_searcher_member_sort")&&TS.interop.members.isMember(t)?TS.interop.members.getPrefCompliantMemberName(t):t._name_lc?t._name_lc:t.team_name?t.team_name.toLocaleLowerCase():t.name;return n};var g=function e(t,n,r){if(n.is_mpim&&!r.is_mpim)return 1;if(r.is_mpim&&!n.is_mpim)return-1;if(!n.is_mpim&&!r.is_mpim){var a=i(n.id,"jumper_score")-i(r.id,"jumper_score");if(0!==a)return a}if(n.is_mpim&&r.is_mpim){var s=i(n.id,"jumper_score")-i(r.id,"jumper_score");if(0!==s)return s;var o=TS.mpims.getMemberCount(n)-TS.mpims.getMemberCount(r);if(0!==o)return o}return S(t,n,r)};var S=function e(t,n,r){var i=h(n);var a=h(r);if(t)return TS.interop.i18n.sorter(i,a);if(i>a)return 1;if(a>i)return-1;return 0};var T=function e(t,n){if(t.is_mpim)return 0;var r=0;if(i(t.id,"jumper_exact_match")){r+=TS.ui.frecency.bonus_points.exact_match;i(t.id,"emoji_exact_match")&&(r+=TS.ui.frecency.bonus_points.exact_match)}else i(t.id,"emoji_score")?r+=v(t,"emoji_score",TS.ui.frecency.bonus_points.emoji_match):r+=v(t,"jumper_score",TS.ui.frecency.bonus_points.fuzzy_match);i(t.id,"jumper_previous_name_scores")&&(r+=TS.ui.frecency.bonus_points.matches_previous_name);n.prefer_channel_members&&t.presence&&n.model_ob&&b(t.id,n.model_ob)&&(r+=TS.ui.frecency.bonus_points.member_of_this_channel);t.is_starred&&(r+=TS.ui.frecency.bonus_points.starred_channel);if(TS.interop.members.isMember(t)){var a=TS.redux.channels.getImByMemberId(t.id);a&&a.is_starred&&(r+=TS.ui.frecency.bonus_points.starred_channel)}t.is_emoji&&("thumbsup"!==t.name&&"point_up"!==t.name||(r+=1));n.self_first&&t.is_self&&(r=Infinity);if(t.is_channel||t.is_group){t.is_archived&&(r+=TS.ui.frecency.bonus_points.archived_channel_or_group);t.is_channel&&n.prefer_channels_user_belongs_to&&(t.is_archived||b(TS.model.user.id,f(t.id))||(r+=TS.ui.frecency.bonus_points.not_in_channel));(t.is_channel&&TS.enterprise.getChannelById(t.id)||t.is_group&&TS.enterprise.getGroupById(t.id)||TS.interop.rules.channels.isFromAnotherTeam(t))&&(r+=TS.ui.frecency.bonus_points.foreign_channel_or_group)}(t.is_usergroup||t.is_broadcast_keyword)&&(r+=TS.ui.frecency.bonus_points.usergroup_or_keyword);return r};var v=function e(t,n,r){var a=i(t.id,n);if(!_.isFinite(a))return 0;var s=Math.pow(.5,a);return Math.round(r*s)};var b=function e(t,n){if(n.is_channel&&t===TS.model.user.id)return n.is_member;var r=TS.interop.membership.getCachedChannelMembershipInfoForUser(n.id,t);return r.is_known&&r.is_member}})();var n={};var r=function e(t,r,i){if(!t||!r)return;n[t]||(n[t]={});n[t][r]=i};var i=function e(t,r){if(!t||!r)return;if(!t||!n[t])return;return n[t][r]}},2943:function(e,t){(function(){TS.registerModule("ui.enterprise_shared_channels_invites",{onStart:function e(){TS.ui.validation.register("valid_invite",$e)},start:function e(){TS.boot_data.page_needs_enterprise&&we()}});var e;var t;var n;var r=[];var i;var a=false;var s;var o=false;var l=[];var u=[];var d=[];var c=[];var m;var f;var p=false;var h=function e(n){if(!n)return;var r=H(n,W(n));if(!r)return;t.find('.sci_send_email_container [data-action="replace_sent_emails"]').replaceWith(TS.templates.shared_channels_invites_sent_emails(r))};var g=1e3;var S;var T;var v=1e3;var b;var y=function e(n,r){n||(n=false);r||(r=false);t.find("#sci_channels_create .input_wrapper .spinner").toggleClass("hidden",n);r&&w(!n)};var w=function e(n){if(T){clearTimeout(T);T=null}n||(n=false);var r=t.find("#sci_channels_create .input_wrapper .available");r.toggleClass("hidden",n);n||(T=setTimeout(function(){r.addClass("hidden")},v))};var k=function r(){TS.kb_nav.start(i.find(".list_items"),".channel_browser_row",i,{use_data_ordering:true,px_offset:35,scrollToStartImmediately:function e(){i.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){i.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){p&&ee($(this),e)});i.find(".list_items").on("click",".channel_browser_row",function(e){ee($(this),e)});t.on("click",'[data-action="sci_to_create"]',xe);t.on("click",'[data-action="sci_channels_create"]',A);t.on("click",'[data-action="sci_cancel"]',Ce);t.on("change",'[type="radio"][name="share_with"]',Fe);t.on("click",'[data-action="sci_show_action"]',Se);var s='#sci_channels_create input[name="channel_name"]';var o=_.debounce(function(e){if(b&&b.isPending()){if(S){clearTimeout(S);S=null}S=setTimeout(function(e){o(e)},g,e);return}$(".validation_message").remove();$('label[for="channel_name"]').removeClass("validation_warning");e.removeClass("validation_warning");var t=false;var n=true;var r=true;var i=false;var a=$('#sci_channels_create [data-action="sci_channels_create"]');y();Me(null,a,t,n);var s=TS.ui.validation.validate(e);if(s){var l=e.val().trim();var u=function s(o,u){if(o){if(u.name_taken){r=true;i=false;y(r,i);n=true;Me(null,a,t,n);TS.ui.validation.showWarning(e,'"'+_.escape(l)+'" is already taken by a channel, username, or user group.',{});return}b=null;r=true;i=true;y(r,i);n=false;t=true;Me(null,a,t,n)}else{r=true;i=false;y(r,i);TS.generic_dialog.alert("Something failed! "+u.error)}return null};b=TS.interop.api.callExpedited("enterprise.nameTaken",{name:l,ignore_local_team:false}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;u(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;u(i,t,n,r);return{data:t,args:n,request_id:r}})}else{r=true;y(r)}},g,{leading:false,trailing:true});t.on("input",s,function(e){e.preventDefault();e.stopPropagation();o($(this))});t.on("input",'#sci_channels_create [data-validation]:not([name="channel_name"])',function(){var e=t.find("#sci_channels_create");Me(e.find(F()),e.find('[data-action="sci_channels_create"]'),true)});n.on("textchange",function(){if(!a)return;E()}).on("keydown",function(e){e.which===TS.utility.keymap.esc&&TS.ui.fs_modal.close()});var l={classes:"channel_browser_sort",onItemAdded:function e(t){if(!a)return;var n=$(t);var r=n.val();if(TS.model.ui_state){TS.model.ui_state.sort_shared_channel_browser_by=r;TS.storage.storeUIState(TS.model.ui_state)}be(r);E()},styling:"normal",template:function e(t){var n=$(t);return new Handlebars.SafeString(n.text())},tokenTemplateSingle:function e(t){var n=$(t);var r;r=TS.boot_data.feature_channel_browser_dropdown?TS.interop.i18n.t('<span class="bold">Sort:</span> {value}',"channel_browser")({value:n.text()}):TS.interop.i18n.t('<span class="greigh">Sort:</span> {value}',"channel_browser")({value:n.text()});return new Handlebars.SafeString(r)}};m.hide().lazyFilterSelect(l);f=$(".channel_browser_sort");if(TS.boot_data.feature_channel_browser_dropdown){f.find(".lfs_input").attr("size","auto");je();m.on("change",function(){je()})}t.on("click",".clear_filter_icon",function(){n.val("").trigger("textchange").focus()});e.on("keyup.sci",X);t.on("click",'[data-action="sci_toggle_contents"]',Ae);t.on("click",'[data-action="sci_toggle_send_email"]',Pe);t.on("click",'[data-action="sci_toggle_copy_link"]',Ee);t.on("click",'[data-action="sci_send"]',me);t.on("click",'[data-action="sci_copy"]',K);t.on("click",'[data-action="sci_revoke"]',_e);t.on("input","input[data-invite-id]",function(e){var t=$(e.target).parent();var n=true;Me(t,t.find('[data-action="sci_send"]'),n)})};var x=function e(){t.find(".showing_sci_action").removeClass("showing_sci_action")};var C=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container").addClass("hidden")};var I=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container").addClass("hidden")};var M=function e(t,n){var r=[];if(t.length>0){r.push({is_divider:true,name:TS.interop.i18n.t("Channels you can join","shared")()});r=r.concat(t)}if(n.length>0){r.push({is_divider:true,name:TS.interop.i18n.t("Channels you belong to","shared")()});r=r.concat(n)}return r};var A=function e(){var n=t.find("#sci_channels_create");var r=n.find(F());if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);Ladda.stopAll();n.find('[data-action="sci_channels_create"]').addClass("disabled");return}var i={};var a=!n.find('[name="access"]').prop("checked");if(q())switch(n.find('[name^="share_with"]:checked').val()){case"specific":i.target_domains=n.find('[name="domains"]').val();break;case"external":i.target_domain=n.find('[name="domain"]').val();break;case"all":i.all_teams=true;break;default:break}else i.target_domain=n.find('[name="domain"]').val();var s=n.find('[name="channel_name"]').val();s&&(i.channel_name=s);var o=n.find('[name="purpose"]').val();o&&(i.purpose=o.trim());if(i.target_domain){i.is_private=a;ne(i).then(function(e){var t=e.data.invite_id;Ie(e.data);return ie().then(function(e){pe(e.data.invites,a);ue(t)})}).catch(N).finally(Ladda.stopAll)}else te(i,a).then(function(e){var t;if(e.data.group){t=e.data.group.id;TS.groups.legacyDisplayGroup({id:t})}else{t=e.data.channel.id;TS.channels.legacyDisplayChannel({id:t})}TS.ui.fs_modal.close()}).catch(N).finally(Ladda.stopAll)};var E=function e(){var t=$.trim(n.val());if(""!==t&&-1!==t.indexOf("#")){t=t.replace("#","","g");t=$.trim(t)}if(t){n.closest(".channel_browser_filter_container").addClass("active");r=O(t)}else{n.closest(".channel_browser_filter_container").removeClass("active");r=O()}if(0===r.length){De(t);U("#sci_no_shared_channels")}else U("#sci_channels_container");i.longListView("scrollToTop",true);i.longListView("setItems",r);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i);i.longListView("resizeImmediately")});t?TS.kb_nav.highlightFirstItem():TS.kb_nav.clearHighlightedItem()};var P=function e(t,n){return _.find(j(),function(e){return e.team.domain===t&&e.channel_name===n})||_.find(j(true),function(e){return e.team.domain===t&&e.channel_name===n})};var F=function e(){var n=['[name="channel_name"]','[name="purpose"]'];if(q())switch(t.find('[name^="share_with"]:checked').val()){case"specific":n.push('[name="domains"]');break;case"external":n.push('[name="domain"]');break;default:break}else n.push('[name="domain"]');return n.join(", ")};var O=function e(t){var n=D();var r=D(true);var i=!(n.length||r.length);if(i)return;var a=Y(n,r);var s=[];var o=[];var l={};var u;var d;if(t){t=TS.utility.regexpEscape(t);d=new RegExp(t,"i")}a.forEach(function(e){var n=l.hasOwnProperty(e.id);if(n)return;if(!e.hasOwnProperty("name"))return;n||(l[e.id]=true);if(t){if(e.name.toLowerCase()===t.toLowerCase()){u=e;return}if(!e.name.match(d))return}e.is_member?o.push(e):s.push(e)});u&&(u.is_member?o.unshift(u):s.unshift(u));return M(s,o)};var D=function e(t){return t?l:d};var H=function e(t,n){return _.find(j(n),function(e){return e.invite_id==t})};var j=function e(t){return t?u:c};var B=function e(){var n=TS.interop.i18n.t("Anyone in your workspace can join","shared")();if(q()){var r=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));switch(t.find('[name^="share_with"]:checked').val()){case"specific":n=TS.interop.i18n.t("Specific workspaces at {name} can join","shared")({name:r});break;case"all":n=TS.interop.i18n.t("Anyone at {name} can join","shared")({name:r});break;default:break}}return n};var L=function e(){var n=TS.interop.i18n.t("Restricted to invited members","shared")();if(q()){var r=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));switch(t.find('[name^="share_with"]:checked').val()){case"specific":n=TS.interop.i18n.t("Restricted to invited members on specific {name} workspaces","shared")({name:r});break;case"all":n=TS.interop.i18n.t("Restricted to invited members at {name}","shared")({name:r});break;default:break}}return n};var N=function e(t){var n;switch(t.data.error){case"invalid_target_domain":n=TS.interop.i18n.t("Darn&mdash;we couldn\u2019t find a workspace with that domain. Try again?","shared")();break;case"name_taken":n=TS.interop.i18n.t("Darn&mdash;that channel name is already taken. Try another?","shared")();break;case"invite_exists":n=TS.interop.i18n.t("An invitation already exists for that workspace and channel.","shared")();break;case"shared_channel_exists":n=TS.interop.i18n.t("Good news! That workspace has already joined the shared channel.","shared")();break;case"not_paid":n=TS.interop.i18n.t("Darn&mdash;that workspace has to upgrade to a paid Slack plan to join a shared channel.","shared")();break;default:return R(t)}return TS.generic_dialog.alert(n)};var R=function e(t){var n=t.message||"";t.data&&t.data.error&&(n+=": "+t.data.error);TS.error(n);var r=TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","shared")();return TS.generic_dialog.alert(r)};var U=function e(n){var r=["#sci_loading","#sci_no_shared_channels","#sci_channels_container","#sci_channels_create","#sci_send","#sci_invites_container"].filter(function(e){return e!==n}).join(", ");t.find(r).addClass("hidden");t.find(n).removeClass("hidden")};var G=function e(){o=false;a&&i.longListView("setHidden",true)};var q=function e(){return TS.boot_data.page_needs_enterprise};var W=function e(t){return!!H(t,true)};var z=function e(){var n=t.find("#sci_channels_create");if(TS.useReactLFS()){var r=document.getElementById("sci_teams_picker");var i=true;TS.ui.team_picker.make(r,{omitted_ids:[TS.model.team.id],onValueChange:function e(t){var r=t.map(function(e){return e.team.domain}).join(",");n.find('[name="domains"]').val(r);var i=true;Me(n.find(F()),n.find('[data-action="sci_channels_create"]'),i)}},i)}else n.find('[name="domains"]').each(function(e,t){var r=$(t);TS.ui.team_picker.make(r,{omitted_ids:[TS.model.team.id]});r.on("change",function(){var e=TS.ui.team_picker.value(r).map(function(e){return e.team.domain}).join(",");r.val(e);var t=true;Me(n.find(F()),n.find('[data-action="sci_channels_create"]'),t)})})};var K=function e(t){var n=$(t.target);var r=n.parent();var i=r.find("input");var a=r.find("label > span");var s=i.get(0);var o=i.val();TS.clipboard.canWriteText()?TS.clipboard.writeText(o):Te(a);s&&s.setSelectionRange(0,o.length)};var V=function e(){j().length||D().length||j(true).length||D(true).length||Ce()};var Y=function e(t,n){return t.concat(n)};var J=function e(t){if("num_members"in t)return t.num_members||0;return t.active_members?t.active_members.length:0};var Q=function n(){Oe(true);t=null;e.off("keyup.sci");e=null;TS.kb_nav.end();o=false;a=false;fe([]);fe([],true)};var X=function e(t){if(t.which!==TS.utility.keymap.enter)return;var n=$(t.target);if(n.is("input[data-invite-id]"))me(t);else if(n.is('input[name="domain"], input[name="channel_name"]')){TS.ui.startButtonSpinner($('#sci_channels_create [data-action="sci_channels_create"]').get(0));A(t)}};var Z=function r(){t=$("#sci_container");e=$("body");s=t.find(".list_container");i=s.find(".list");n=t.find("#channel_browser_filter");m=t.find("#channel_browser_sort");TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by&&m.find('option[value="'+TS.model.ui_state.sort_shared_channel_browser_by+'"]').attr("selected",true);oe().then(Ce).catch(N)};var ee=function e(t,n){if(t.hasClass("channel_link")){var r=t.data("channel-id");TS.view.onChannelReferenceClick(n,r)}else{var i=t.data("group-id");TS.view.onGroupReferenceClick(n,i)}TS.ui.fs_modal.close()};var te=function e(t,n){return TS.interop.api.call(n?"enterprise.groups.createShared":"enterprise.channels.createShared",t)};var ne=function e(t){return TS.interop.api.call("conversations.inviteShared",t)};var re=function e(t){return TS.interop.api.call(t?"groups.listShared":"channels.listShared")};var ie=function e(){return TS.interop.api.call("channels.listSharedInvites")};var ae=function e(t){return TS.interop.api.call("channels.revokeSharedInvite",t)};var se=function e(t){return TS.interop.api.call("channels.sendSharedInvite",t)};var oe=function e(){var t=[re().reflect(),re(true).reflect()];return Promise.all(t).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("Some shared channels start APIs failed:\n"+t.join("\n")));fe(e[0].value().data.channels);fe(e[1].value().data.channels,true)})};var le=function e(n){if(!n)return;var r=H(n,W(n));if(!r)return;t.find("#sci_invite_container_"+n+' [data-action="replace_emailed_invites"]').replaceWith(TS.templates.shared_channels_invites_emailed_invitations(r))};var ue=function e(n){if(!n)return;var r=H(n,W(n));if(!r)return;var i=t.find("#sci_invite_container_"+n);i.length?i.replaceWith(TS.templates.shared_channels_invites_invite(r)):t.find("#sci_invites_container .sci_list_header").after(TS.templates.shared_channels_invites_invite(r));t.find("#sci_invites_container").removeClass("hidden")};var de=function e(n){if(!n)return;t.find("#sci_invite_container_"+n).remove();var r=t.find("#sci_invites_container");1===r.children().length&&r.addClass("hidden")};var ce=function e(t,n){_.remove(j(n),function(e){return e.invite_id==t})};var _e=function e(t){var n=$(t.target);var r=n.data("invite-id");var i=W(r);ae({invite_id:r}).then(function(){ce(r,i);de(r);V()}).catch(N)};var me=function e(t){var n=$(t.target);var r=n.parent();if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);r.find('[data-action="sci_send"]').addClass("disabled");return}var i=n.data("invite-id");var a=r.find("input");var s=a.val();if(!s)return;var o=W(i);var l={invite_id:i,email:s};se(l).then(function(){a.val("");return ie().then(function(e){pe(e.data.invites,o);le(i);h(i)})}).catch(N)};var fe=function e(t,n){t.length&&(t=t.map(function(e){var t=false;var n=TS.redux.channels.getEntityById(e.channel,t);return $.extend({},e,n)}));n?l=t:d=t};var pe=function e(t,n){n?u=t:c=t};var he=function e(){var n=t.find("#sci_channels_create .placeholder_overlay");t.find('#sci_channels_create input[name="domain"]').on("input",function(e){n.toggleClass("hidden",!!$(e.target).val())})};var ge=function e(){t.find('#sci_channels_create [name="access"]').togglify({on_text:TS.interop.i18n.t("Public","shared")(),off_text:TS.interop.i18n.t("Private","shared")(),label:B(),off_label:L(),off_class:"ts_toggle_orange",initial_state:true})};var Se=function e(t){x();var n=$(t.currentTarget).addClass("showing_sci_action");n.is(".sci_send_email_container")&&n.find("input").focus()};var Te=function e(t){var n=t.data("timeout");clearTimeout(n);t.removeClass("hidden").data("timeout",setTimeout(function(){t.addClass("hidden")},3e3))};var ve=function e(){if(o)return;if(!a){ke();o=true;return}if(a){o=true;i.longListView("setHidden",false);i.longListView("setItems",O(),true);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i)})}};var be=function e(t){var n=["name","creator","created","members_high","members_low"];var r="name";-1!==n.indexOf(t)&&(r=t);ye(D(),r);ye(D(true),r)};var ye=function e(t,n){"name"===n?t.sort(function(e,t){if(e._name_lc>t._name_lc)return 1;if(t._name_lc>e._name_lc)return-1;return 0}):"creator"===n?t.sort(function(e,t){var n;var r;n=TS.interop.members.getMemberById(e.creator);r=TS.interop.members.getMemberById(t.creator);if(n&&r){if(n._name_lc>r._name_lc)return 1;if(r._name_lc>n._name_lc)return-1;return 0}if(n&&!r)return-1;if(!n&&r)return 1;return 0}):"created"===n?t.sort(function(e,t){if(e.created<t.created)return 1;if(t.created<e.created)return-1;return 0}):"members_high"===n?t.sort(function(e,t){var n=J(e);var r=J(t);if(n<r)return 1;if(r<n)return-1;return 0}):"members_low"===n&&t.sort(function(e,t){var n=J(e);var r=J(t);if(n>r)return 1;if(r>n)return-1;return 0})};var we=function e(){var t=TS.permissions.members.canCreateConvertOrgSharedChannels();var n={body_template_html:TS.templates.shared_channels_invites_modal({show_create_shared_channel_btn:t}),onShow:Z,onCancel:Q,modal_class:"fs_modal_internal_scroll convert_to_shared_dialog"};TS.ui.fs_modal.start(n)};var ke=function e(){a=true;var t=O();var n={items:t,approx_item_height:60,preserve_dom_order:true,approx_divider_height:35,pin_dividers:true,makeElement:function e(t){var n=$(TS.templates.channel_browser_row({is_shared:true}));t.$icon=n.find(".channel_browser_type_icon");t.$created_info=n.find(".channel_browser_channel_created_info");t.$name=n.find(".channel_browser_channel_name");t.$purpose=n.find(".channel_browser_channel_purpose");t.$member_count_container=n.find(".channel_browser_member_count_container");t.$member_count=n.find(".channel_browser_member_count");t.$open=n.find(".channel_browser_open");t.$preview=n.find(".channel_browser_preview");t.$joined=n.find(".channel_browser_joined");t.$shared_channel_icon=n.find(".shared_channel_icon");return n},makeDivider:function e(){return $("<div>").addClass("channel_browser_divider")},renderItem:function e(t,n,r){TS.interop.rules.channels.isOrgShared(n)?r.$shared_channel_icon.removeClass("hidden"):r.$shared_channel_icon.addClass("hidden");n.is_channel?r.$icon.removeClass("ts_icon_lock").addClass("ts_icon_channel_pane_hash"):r.$icon.removeClass("ts_icon_channel_pane_hash").addClass("ts_icon_lock");r.$name.text(n.name?n.name:"");var i=TS.interop.members.getMemberById(n.creator);i?r.$created_info.html(TS.interop.i18n.t("Created by {user} on {date}","channel_browser")({user:TS.interop.i18n.safeString("<strong>"+_.escape(TS.interop.members.getPrefCompliantMemberName(i))+"</strong>"),date:TS.interop.datetime.toCalendarDate(n.created)})):r.$created_info.html(TS.interop.i18n.t("Created on {date}","channel_browser")({date:TS.interop.datetime.toCalendarDate(n.created)}));var a=J(n);r.$member_count.text(a);if(n.purpose&&n.purpose.value){var s=TS.utility.formatTopicOrPurpose(n.purpose.value);s=s.replace(/<a .*?>(.*?)<\/a>/g,"$1");r.$purpose.removeClass("hidden").html(s)}else r.$purpose.text("").addClass("hidden");var o=n.is_member||n.is_group;if(o){r.$open.removeClass("hidden");r.$preview.addClass("hidden");r.$joined.removeClass("hidden")}else{r.$open.addClass("hidden");r.$preview.removeClass("hidden");r.$joined.addClass("hidden")}if(n.is_group){t.removeClass("channel_link").removeAttr("data-channel-id");t.addClass("group_link").attr("data-group-id",n.id)}else{t.removeClass("group_link").removeAttr("data-group-id");t.addClass("channel_link").attr("data-channel-id",n.id)}},renderDivider:function e(t,n){t.text(n.name)},calcItemHeight:function e(t){return t.outerHeight()}};i.longListView(n);k();TS.utility.rAF(function(){i.monkeyScroll()})};var xe=function e(){p=false;var n=q();var r={reserved_domain:TS.model.team.domain};n&&(r.enterprise_info=TS.redux.enterprise.getEnterprise());var i=TS.templates.shared_channels_invites_create(r);var a=t.find("#sci_channels_create");a.html(i).find("textarea").autogrow();U("#sci_channels_create");G();$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",false);t.find("#sci_header_wrapper").addClass("hidden");he();ge();n&&z();t.find('#sci_channels_create [name="domain"]').focus();Ladda.bind('#sci_channels_create [data-action="sci_channels_create"]');Oe()};var Ce=function e(){p=true;t.find("#sci_header_wrapper").removeClass("hidden");var n=D();var r=D(true);var i=!(n.length||r.length);if(i){De();U("#sci_no_shared_channels");G();k();return null}U("#sci_channels_container");$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",true);TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by?be(TS.model.ui_state.sort_shared_channel_browser_by):be(m.val());ve();Oe(true)};var Ie=function e(n){p=false;var r=TS.templates.shared_channels_invites_send(n);t.find("#sci_send").html(r);U("#sci_send");G();Oe()};var Me=function e(t,n,r,i){if(r&&t){var a=$(_.find(t,["nodeName","TEXTAREA"]));var s=a.val();s&&s.length?a.attr("data-validation","maxlength=250"):a.removeAttr("data-validation");i=!TS.ui.validation.validate(t,{quiet:true,fast:true})}n.toggleClass("disabled",i)};var Ae=function e(t){if($(t.target).is("a, input, .btn"))return;var n=$(t.currentTarget);var r=n.hasClass("showing_contents");n.toggleClass("showing_contents",!r);n.find(".sci_toggle_icon").toggleClass("ts_icon_caret_right",r).toggleClass("ts_icon_caret_down",!r)};var Ee=function e(t){var n=$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container");n.toggleClass("hidden",!n.hasClass("hidden"));I(t)};var Pe=function e(t){var n=$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container");n.toggleClass("hidden",!n.hasClass("hidden")).find("input").focus();C(t)};var Fe=function e(n){var r=$(n.target);var i=t.find("#sci_channels_create");var a=r.val();var s="specific"===a;var o="external"===a;$("#sci_specific_team").toggleClass("hidden",!s);$("#sci_external_team").toggleClass("hidden",!o);i.find('[for="share_with_specific"]').toggleClass("hidden",!s);i.find('[for="share_with_external"]').toggleClass("hidden",!o);"specific"===a&&i.find('[name="team_list"]').focus();"external"===a&&i.find('[name="domain"]').focus();var l=true;Me(i.find(F()),i.find('[data-action="sci_channels_create"]'),l);He()};var Oe=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(Ce);TS.ui.fs_modal.showBackButton()}};var De=function e(n){var r=t.find("#sci_no_shared_channels");var i=r.find(".sci_no_shared_note");var a=TS.interop.i18n.t("You don\u2019t have any shared channels yet.","shared")();if(n){var s=TS.interop.i18n.t("No matches found for <strong> {escaped_query_string} </strong>","shared")({escaped_query_string:TS.utility.truncateAndEscape(n,50)});i.html(s)}else i.text(a)};var He=function e(){t.find(".ts_toggle_on_label").text(B());t.find(".ts_toggle_off_label").text(L())};var $e=function e(n,r){if(!t)return true;if(!n.is("input"))return true;var i=$("#sci_channels_create");var a=n.is('[name="domain"]')?n:i.find("[name=domain]");var s=n.is("[name=channel_name]")?n:i.find("[name=channel_name]");var o=a.val();var l=s.val();if(!o)return true;o=o.trim();l=l.trim();if(P(o,l)){r.quiet||n.addClass("invalid_invite");var u=TS.interop.i18n.t("This invite already exists. Try a different workspace or channel!","shared")();TS.ui.validation.showWarning(n,u,r);return}if(a===n){if(l&&!r.quiet&&s.hasClass("invalid_invite")){s.removeClass("invalid_invite");TS.ui.validation.validate(s)}}else if(o&&!r.quiet&&a.hasClass("invalid_invite")){a.removeClass("invalid_invite");TS.ui.validation.validate(a)}r.quiet||n.removeClass("invalid_invite");return true};var je=function e(){if(TS.boot_data.feature_channel_browser_dropdown){var t=TS.interop.i18n.t("Sort:","channel_browser")();$("#temp_option_width").text(t+" "+$("#channel_browser_sort option:selected").text());var n=Math.min($("#temp_select_width").outerWidth(),300);f.css("width",n)}}})()},2944:function(e,t){(function(){TS.registerModule("user_groups",{updated_sig:new signals.Signal,updated_info_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,unknown_resolution_rebuild_sig:new signals.Signal,is_in_bulk_upsert_mode:false,legacyPromiseToGetUserGroupMembers:function e(t){if(TS.boot_data.feature_sonic_user_groups)return TS.interop.userGroups.promiseToGetUserGroupMembers(t);return TS.interop.api.call("subteams.users.list",{subteam:t,include_disabled:1}).then(function(e){var n=e.data;var r=s(t,n);return r})},legacyGetUserGroupMembers:function e(t,n){if(TS.boot_data.feature_sonic_user_groups){TS.interop.userGroups.getUserGroupMembers(t,n);return}var r=function e(r,i){if(r&&i){var a=s(t,i);a&&n&&n(a)}};TS.interop.api.call("subteams.users.list",{subteam:t,include_disabled:1}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},legacyNeedsToFetchMembership:function e(t){return void 0===t.users||_.size(t.users)!==t.user_count},getUserGroupMembersNotInModelObCount:function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);var i=_.get(r,"users.length");var a=TS.interop.channels.getPublicChannelById(n)||TS.interop.channels.getGroupById(n);if(!r||TS.interop.rules.user_groups.isUnknownOrNonExistent(r)||!a)return 0;if(_.isUndefined(r.users))return 0;var s=r.users.some(function(e){return!TS.interop.redux.models.membership.isMembershipKnownForUser(TS.redux.getState(),a.id,e)});if(s)return 0;var o=r.users.filter(function(e){var t=TS.interop.membership.getCachedChannelMembershipInfoForUser(a.id,e);return t.is_known&&t.is_member});return i-o.length},legacyUpsertUserGroup:function e(t){if(TS.model.user&&TS.model.user.is_restricted)return false;var n=TS.interop.userGroups.getUserGroupById(t.id);t._name_lc=t.name.toLowerCase();if(n&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(n)){TS.has_pri[a]&&TS.log(a,'updating existing User Group "'+t.id+'"');n=_.assign({},n);var i=TS.model.your_user_group_regex[t.id];i&&TS.interop.userGroups.removeSelfUserGroup(n.id);for(var s in t)n[s]!=t[s]&&(n[s]=t[s]);if(!t.date_delete&&t.users&&-1!==t.users.indexOf(TS.model.user.id)){TS.interop.userGroups.upsertSelfUserGroup(n.id);r(t);TS.user_groups.legacy_is_in_bulk_upsert_mode?TS.redux.user_groups.addToBulkUpsertPayload(n):TS.redux.user_groups.addUserGroup(n)}}else if(!t.date_delete){TS.has_pri[a]&&TS.log(a,'Adding user group "'+t.id+'"');r(t);TS.user_groups.legacy_is_in_bulk_upsert_mode?TS.redux.user_groups.addToBulkUpsertPayload(t):TS.redux.user_groups.addUserGroup(t)}TS.user_groups.legacy_is_in_bulk_upsert_mode||TS.user_groups.updated_sig.dispatch()},legacyStartBatchUpsert:function e(){if(TS.user_groups.legacy_is_in_bulk_upsert_mode)return false;TS.user_groups.legacy_is_in_bulk_upsert_mode=true;return true},legacyFinishBatchUpsert:function e(){if(!TS.user_groups.legacy_is_in_bulk_upsert_mode)return false;TS.user_groups.legacy_is_in_bulk_upsert_mode=false;TS.user_groups.batch_upserted_sig.dispatch();TS.user_groups.updated_sig.dispatch();return true},upsertUserGroupAndSignal:function e(t){TS.interop.userGroups.upsertUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},legacyUserGroupMembersChanged:function e(t){TS.info("TS.user_groups.legacyUserGroupMembersChanged");var n=TS.interop.userGroups.getUserGroupById(t.subteam_id);if(!n||TS.interop.rules.user_groups.isUnknownOrNonExistent(n))return;if(n.users){t.added_users&&(n.users=_.union(n.users,t.added_users));t.removed_users&&(n.users=_.difference(n.removed_users,t.removed_users))}n.user_count=parseInt(n.user_count,10)||0;n.user_count+=parseInt(t.added_users_count,10)||0;n.user_count=Math.max(0,n.user_count-(t.removed_users_count||0));n.date_previous_update=_.assign(n,_.pick(t,["date_update","date_previous_update"]))},removeUserGroup:function e(t){var n=TS.interop.userGroups.getUserGroupById(t.id);if(n&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(n)){TS.interop.userGroups.removeSelfUserGroup(n.id);i(n);n.date_delete=-1}},removeUserGroupAndSignal:function e(t){TS.user_groups.removeUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},legacyUpsertSelfUserGroup:function e(t){var n=TS.model.your_user_group_regex[t];n&&TS.interop.userGroups.removeSelfUserGroup(t);var r=TS.interop.userGroups.getUserGroupById(t);if(r&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(r)&&!r.date_delete){var i=new RegExp("<!subteam\\^("+r.id+(r.handle?"|"+r.handle:"")+")\\b");TS.model.your_user_group_regex[r.id]=i;TS.redux.dispatch(TS.interop.redux.models.userGroups.addMemberToGroup({groupId:r.id,memberId:TS.model.user.id}))}},legacyRemoveSelfUserGroup:function e(t){TS.model.your_user_group_regex[t]=null;delete TS.model.your_user_group_regex[t];var n=TS.interop.userGroups.getUserGroupById(t);if(n&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(n)){i(n);TS.user_groups.updated_sig.dispatch(n.id);TS.redux.dispatch(TS.interop.redux.models.userGroups.removeMemberFromGroup({groupId:n.id,memberId:TS.model.user.id}))}},legacyDeleteUserGroupRegex:function e(t){TS.model.your_user_group_regex[t]=null;delete TS.model.your_user_group_regex[t]},legacyGetUserGroupRegexById:function e(t){return TS.model.your_user_group_regex[t]},legacyAddUserGroupRegex:function e(t){if(_.isEmpty(t))return;var n=new RegExp("<!subteam\\^("+t.id+(t.handle?"|"+t.handle:"")+")\\b");TS.model.your_user_group_regex[t.id]=n},test:function e(){return{clearUseGroupMaps:n}}});var e={};var t={};var n=function n(){e={};t={}};var r=function n(r){if(!r)return;if(r.handle){e[r.handle]=r;e["@"+r.handle]=r}t[r.id]=r};var i=function n(r){if(!r)return;if(r.handle){delete e[r.handle];delete e["@"+r.handle]}delete t[r.id]};var a=4;var s=function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);if(!r||TS.interop.rules.user_groups.isUnknownOrNonExistent(r))return;r.users=n.users;r.user_count=n.users.length;TS.user_groups.upsertUserGroupAndSignal(r);return TS.interop.userGroups.getUserGroupById(t)}})()},2945:function(e,t){(function(){TS.registerModule("ui.admin_user_groups",{user_groups_fetched:new signals.Signal,onStart:function e(){$("body").on("click",'[data-action="admin_user_groups_modal"]',function(){u()});$("body").on("click",'[data-action="admin_user_groups_modal_new"]',function(){TS.ui.admin_user_groups.add()})},start:function e(){u()},add:function e(){u();s=true;w()},editInfo:function e(t){u();s=true;w(t)},editMembers:function e(t){u();s=true;A(t,false)},disable:function e(t){u();s=true;b(t,"disable_user_group")},enable:function e(t){u();s=true;b(t,"enable_user_group")},remove:function e(t){u();s=true;b(t,"delete_user_group")},interopFunctions:function e(t){var n=t.action,r=t.userGroup;switch(n){case"add":w();break;case"delete":b(r,"delete_user_group");break;case"enable":b(r,"enable_user_group");break;case"disable":b(r,"disable_user_group");break;case"editInfo":w(r);break;case"editMembers":A(r,false);break;default:}},test:function e(){var t={_isFullLocalMember:j};Object.defineProperty(t,"_isFullLocalMember",{get:function e(){return j},set:function e(t){j=t}});return t}});var e;var t;var n;var r;var i=true;var a=[];var s=false;var o=[];var l=false;var u=function e(){var t=TS.templates.user_group_modal({show_info_pane:!TS.prefs.getPref("hide_user_group_info_pane"),show_user_groups_add:TS.permissions.members.canCreateAndDeleteUserGroups()});var n={body_template_html:t,onShow:d,onCancel:c};if(TS.boot_data.feature_lazy_user_groups){n.full_height_contents=true;n.modal_contents_container_class="overflow_hidden";U="";TS.interop.userGroups.setSearchQuery(U)}TS.ui.fs_modal.start(n)};var d=function i(){e=$("#user_groups_container");t=$("#all_user_groups");n=$("#user_groups_form_div");r=$("#user_groups_toggle_div");T();TS.boot_data.feature_lazy_user_groups?$("#user_groups_create_btn").on("click",function(){w()}):e.find('[data-action="open_form"]').on("click",function(e){e.preventDefault();var t=$(this).closest(".user_group_item").data("user-group-id");var n=B(t);w(n)})};var c=function l(){i=true;e=null;t=null;n=null;r=null;s=false;G=null;q=null;$(window).off("resize",S);TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);L(TS.model.user_groups);N(o,TS.model.user_groups);R();TS.boot_data.feature_lazy_user_groups&&TS.client.ui.user_groups.setUserGroupQuery()};var m=function e(t){t&&t.preventDefault();if(s){TS.ui.fs_modal.close();G=null}else T();L(TS.model.user_groups);N(o,TS.model.user_groups)};var f=function e(){if(s){TS.ui.fs_modal.close();G=null}else{i=true;T()}TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);L(TS.model.user_groups);N(o,TS.model.user_groups)};var p=function e(){if(!s){TS.ui.fs_modal.bindBackButton(T);TS.ui.fs_modal.showBackButton()}};var h=function e(t){if(!a||!t)return false;for(var n=0,r=a.length;n<r;n+=1)if(a[n].auto_type===t)return a[n];return false};var g=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t){var r=$("#user_group_name_input").val()||"";var i=$("#user_group_handle_input").val()||"";n.group_name=r;n.group_handle=i;if(n.error&&("forbidden_handle"===n.error||"forbidden_name"===n.error)){var a=r+i;if(a){var s=h("owner");var o=h("admin");var l=!!a.match(/admins/i);var u=!!a.match(/owners/i);n.suggest_auto_group=true;n.can_create_auto_owners=u&&TS.model.user.is_admin&&!s;n.can_enable_auto_owners=u&&s&&s.date_delete;n.can_create_auto_admins=l&&TS.model.user.is_admin&&!o;n.can_enable_auto_admins=l&&o&&o.date_delete}}$("#user_group_alerts").html(TS.templates.user_group_alerts(n));return true}return false};var S=function e(){var t=$("#user_groups_header");if(!t.length)return;var n=TS.boot_data.feature_lazy_user_groups?$("#user_groups_list_scroller"):$("#user_groups_list_div");if(!n.length)return;var r=t[0].offsetHeight;var i=$(window).height();var a=250;var s=.15*i;var o=Math.max(a,i-r-s);n.css("height",o)};var T=function e(s){var u=$("#user_groups_list_div");if(TS.boot_data.feature_lazy_user_groups){if(u&&!l){TS.interop.mountUserGroupsList(TS.boot_data.team_id,u[0],{isLegacy:true,isUserGroupBrowser:true,includeDeactivated:true});u.addClass("ug_modern_list");l=true}}else if(i){u.html(Handlebars.helpers.loadingHTML());var d=function e(t,n){if(g(t,n))return;a=n.subteams;for(var r=0,i=a.length;r<i;r+=1)a[r]._name_lc=a[r].name.toLowerCase();a.sort(TS.interop.i18n.mappedSorter("_name_lc"));TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);H();v();if(s){$('#fs_modal [data-user-group-id="'+s+'"]').addClass("highlight_yellow");$("#fs_modal").animate({scrollTop:$(".highlight_yellow").offset().top},500)}o=n.subteams;TS.redux.dispatch(TS.interop.redux.models.userGroups.bulkAddGroups(n.subteams))};TS.interop.api.call("subteams.list",{include_disabled:1,include_users:1}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d(i,t,n,r);return{data:t,args:n,request_id:r}});i=false}t.removeClass("hidden");n.addClass("hidden");r.addClass("hidden");TS.boot_data.feature_lazy_user_groups&&v();TS.ui.fs_modal.hideBackButton()};var v=function r(){$(window).on("resize",S);S();if(!TS.boot_data.feature_lazy_user_groups){$("#user_groups_list_div").monkeyScroll();G=$("#user_groups_list_div").data("monkeyScroll")}$("#user_group_modal_search").on("keydown keyup change",O);q=$("#user_groups_header .user_groups_search .icon_close");q.off("click").on("click",D);t.off("click");if(!TS.boot_data.feature_lazy_user_groups){t.on("click",'[data-action="open_form"]',function(e){e.preventDefault();var t=$(e.target);var n=t.closest(".user_group_item").data("user-group-id");var r=B(n);w(r)});t.on("click",'[data-action="edit_members"]',function(e){e.preventDefault();var t=$(e.target);var n=t.closest(".user_group_item").data("user-group-id");var r=B(n);A(r)});t.on("click",'[data-action="hide_info_pane"]',function(t){t.preventDefault();TS.prefs.setPrefByAPI({hide_user_group_info_pane:true},function(t,n){if(g(t,n))return;e.find(".info_panel").addClass("hidden")})});t.on("click",".user_group_toggle_btn",function(e){e.preventDefault();var t=$(e.target).closest("button, a");var n=t.closest(".user_group_item").data("user-group-id");var r=t.data("action");var i=B(n);b(i,r)});t.on("click",".clear_members_filter",D)}var a=function e(t,n){if(t){i=true;s=false;T(n.subteam&&n.subteam.id?n.subteam.id:null)}};var o={owners:{create:function e(){TS.interop.api.call("subteams.createAuto",{type:"owner"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a&&a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a&&a(i,t,n,r);return{data:t,args:n,request_id:r}})},enable:function e(){var t=h("owner");if(!t)return;TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:t.id})).then(function(e){a(true,e)})}},admins:{create:function e(){TS.interop.api.call("subteams.createAuto",{type:"admin"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a&&a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a&&a(i,t,n,r);return{data:t,args:n,request_id:r}})},enable:function e(){var t=h("admin");if(!t)return;TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:t.id})).then(function(e){a(true,e)})}}};n.off("click").on("click","a.user_group_auto_action",function(e){var t=$(e.target);var n=t.data("auto-type");var r=t.data("auto-action");if(o[n]&&o[n][r]){o[n][r]();e.preventDefault();return false}})};var b=function e(n,i){if(!n){TS.warn("Cannot switch toggle view to undefined User Group");return}R();r.html(TS.templates.user_group_toggle({action:i,user_group:n}));r.find('[data-action="cancel"]').on("click",m);r.find(".user_group_toggle_btn").on("click",function(){var e=$(this).data("action");if(!_.includes(["enableUserGroup","disableUserGroup","deleteUserGroup"],e))return;TS.redux.dispatch(TS.interop.userGroups[e]({subteam:n.id})).then(function(){"enableUserGroup"===e&&y(n);f()}).catch(function(e){var t=e.data;return g(false,t)})});r.find('[data-action="switch_delete_user_group"]').on("click",function(t){t.preventDefault();e(n,"delete_user_group")});t.addClass("hidden");r.removeClass("hidden");p()};var y=function e(t){var n=TS.interop.userGroups.getUserGroupById(t.id);n&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(n)||TS.interop.userGroups.upsertUserGroup(t);TS.interop.userGroups.searchLocalUserGroups()};var w=function e(r){R();n.html(TS.templates.user_group_settings_form(r));$("#user_group_default_channels").lazyFilterSelect(I(r));M(r);t.addClass("hidden");n.removeClass("hidden");p()};var k=function e(t,n){if(!t||!n)return false;var r=t&&t.id;var i=n.prefs.channels.concat(n.prefs.groups);return _.includes(i,r)};var x=function e(t,n){var r=_.get(n,"prefs.channels",[]);var i=r.length?TS.shared.ensureModelObsArePresent(r):Promise.resolve();var a={prefer_exact_match:false,frecency:false,allow_empty_query:true,prefer_channels_user_belongs_to:false,flat:true};var s={channels:{include_archived:false},groups:{include_archived:false},sort:!!t&&a};return i.then(function(){return TS.searcher.search(t,s)}).then(function(e){return t?e:TS.sorter.search(t,e,a)})};var C=function e(t){return function(e){return x(e,t).then(function(e){var n=_.map(e,function(e){var n=e.id;var r=k(e,t);return{model_ob:e,lfs_id:n,preselected:r}});return{replace_all_items:true,all_items_fetched:true,items:n}})}};var I=function e(t){return{data_promise:C(t),template:function e(t){var n=t.model_ob;var e="";e+=TS.interop.rules.channels.isPublicChannel(n)?"#":'<ts-icon class="ts_icon_lock ts_icon_inherit"></ts-icon>';e+=_.escape(n.name);TS.interop.rules.channels.isOrgShared(n)?e+=' <ts-icon class="ts_icon_shared_channel ts_icon_inherit"></ts-icon>':TS.interop.utility.isModelObjectExternal(n)&&(e+=TS.templates.shared_channels_icon({model_ob:n,tooltip:true,shared_team_ids:TS.interop.rules.channels.isPendingExternallySharedChannel(n)?t.pending_shared:t.shared_team_ids,inherit:true}));return new Handlebars.SafeString(e)},placeholder_text:""}};var M=function e(t){var r;var i;var a;if(t){r=TS.interop.userGroups.updateUserGroup;i=false;a=t.id}else{r=TS.interop.userGroups.createUserGroup;i=true}var s=$("#user_group_handle_input");s.on("input",function(){$(this).closest(".handle_input").toggleClass("empty",!this.value.length)});n.find(".user_group_settings_form").on("submit",function(e){e.preventDefault();var t=$('input[name="name"]').val();var n=$('input[name="handle"]').val();var s=$('input[name="description"]').val();var o=$("#user_group_default_channels").lazyFilterSelect("value");o=_.map(o,"model_ob.id");var l={name:t,handle:n,description:s,channels:o};a&&(l.subteam=a);TS.redux.dispatch(r(l)).then(function(e){y(e.subteam);i?A(e.subteam,i):f();TS.user_groups.updated_info_sig.dispatch(e.subteam.id)}).catch(function(e){var t=e.data;return g(false,t)})});n.find(".user_group_settings_form").on("reset",m);var o=$("#save_user_group");var l=$("#user_group_name_input");function u(){var e=l.val();var t=s.val();_.isEmpty(e)||_.isEmpty(t)?o.attr("disabled",true):o.removeAttr("disabled")}if(o.length&&l.length&&s.length){l.on("change",u);l.on("keyup",u);s.on("change",u);s.on("keyup",u);u()}};var A=function e(r,i){var a=!!r.is_external||!!r.auto_type;var s=function e(){n.html(TS.templates.user_group_members_form({is_new:i,is_locked:a,user_group:r}))};var o=function e(){var a=$("#member_count");var s=r.user_count||0;var o=function e(){var t=$(i?"#create_group":"#save_group");t.length&&(s<1?t.prop("disabled",true):t.prop("disabled",false))};var l={approx_item_height:36,template:function e(t){var n=TS.templates.user_group_invite_member_small(t);return new Handlebars.SafeString(n)},onItemAdded:function e(){s+=1;a.html(s);o()},onItemRemoved:function e(){s-=1;a.html(s);o()},filter:function e(t,n){var r=t.member;"@"===n.charAt(0)&&(n=n.substr(1));var i=new RegExp("^"+TS.utility.regexpEscape(n),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(n),"i");return TS.utility.members.checkMemberMatch(r,i)||TS.utility.members.checkMemberMatch(r,a)},disabled:!!r.is_external||!!r.auto_type,data_promise:E(r)};$("#user_group_members_select").lazyFilterSelect(l);F(r);t.addClass("hidden");n.removeClass("hidden");R();o()};if(i){s();TS.ui.fs_modal.hideBackButton();o()}else{var l=function e(){s();p();o()};if(!TS.user_groups.legacyNeedsToFetchMembership(r)){if(TS.boot_data.feature_lazy_user_groups){var u=_.get(r,"users",[]);return TS.interop.members.ensureMembersArePresent(u).then(l)}return l()}TS.interop.userGroups.getUserGroupMembers(r.id,function(e){if(e&&e.users){r=e;if(TS.boot_data.feature_lazy_user_groups){var t=_.get(r,"users",[]);return TS.interop.members.ensureMembersArePresent(t).then(l)}return l()}})}};var E=function e(t){var n=true;return function(e,r){"@"===e.charAt(0)&&(e=e.substring(1));var i=false;if(n){n=false;_.get(t,"users.length")&&(i=true)}if(i){var a=t.users.map(function(e){return TS.interop.members.getMemberById(e)});a.sort(TS.interop.members.memberSorterByName);var s=a.map(function(e){if(!e)return{};return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve(s)}if(r>0)return Promise.resolve([]);var o={query:e,include_org:false,include_slackbot:false,include_teambot:false,include_self:true,full_profile_filter:false,include_bots:true};var l=P(o);return l}};var P=function e(t){return Promise.resolve().then(function(){return TS.members.promiseToSearchMembers(t).then(function(e){var t=[];t=""===e.query?TS.utility.teams.getMembersForTeam(TS.model.team):e.items;e.items=t.filter(j).map(function(e){return{member:e,lfs_id:String(e.id)}});return e})})};var F=function e(t){n.find(".user_group_members_form").on("submit",function(e){e.preventDefault();var n=$("#user_group_members_select").lazyFilterSelect("value");n=n.map(function(e){return e.member.id});TS.redux.dispatch(TS.interop.userGroups.updateMembersOfUserGroup({subteam:t.id,users:n})).then(function(e){f();TS.user_groups.updated_info_sig.dispatch(e.subteam.id)}).catch(function(e){var t=e.data;g(false,t)})});n.find(".user_group_members_form").on("reset",function(e){e.preventDefault();i=true;m(e)})};var O=function e(t){var n=$(t.target);var r=n.val();if(r!==U){U=r;q.toggleClass("hidden",""===r);H()}};var D=function e(){var t=$("#user_group_modal_search");U="";t.val("");setTimeout(function(){t.focus()},0);q.addClass("hidden");H()};var H=function e(){if(TS.boot_data.feature_lazy_user_groups){TS.interop.userGroups.setSearchQuery(U);return}var t=$("#user_groups_list_div");var n=U;var r;$("#user_groups_header .user_groups_search").toggleClass("hidden",!a.length);if("string"===typeof n&&n.length){var i=a.filter(function(e){return-1!==e.handle.indexOf(n)||-1!==e._name_lc.indexOf(n)||e.description&&-1!==e.description.toLowerCase().indexOf(n)});if(i.length){t.html(TS.templates.builders.buildUserGroupListHTML(i));G&&G.updateFunc();return}var s={query:n,tab:{label:TS.interop.i18n.t("User Groups","pages_admin")()}};r='<div class="no_results top_margin">'+TS.templates.team_list_no_results(s)+"</div>"}else r=TS.templates.builders.buildUserGroupListHTML(a);t.html(r);G&&G.updateFunc()};var j=function e(t){if(!t)return false;if(t._is_local&&!t.deleted&&!t.is_ultra_restricted&&!t.is_restricted&&!(t.is_bot||TS.interop.rules.members.isSlackbotOrTeambot(t,TS.boot_data.feature_teambot)))return true;return false};var B=function e(t){if(t)for(var n=0;n<a.length;n+=1)if(a[n].id==t)return a[n]};var L=function e(t){var n=$("#user_groups_tab .count");n.html(t.length)};var N=function e(t,n){if(TS.boot_data.feature_lazy_user_groups)return;0===t.length&&n.length>0&&TS.reload()};var R=function e(){if(TS.boot_data.feature_lazy_user_groups){l=false;var t=$("#user_groups_list_div");TS.interop.unmountUserGroupsList(t[0])}};var U;var G;var q})()},2946:function(e,t){(function(){TS.registerModule("utility.search",{test:function e(){return{_fetchMembersFromFlannel:r}},makeClause:function t(n,r,i){if(e(n,r,i))return;var a={type:n.toLowerCase(),value:r};i&&(a.field_id=i);return a},makeConjunction:function e(n,r){if(t(n,r))return;return{type:n.toLowerCase(),clauses:r}},promiseToSearch:function e(t){if(!t)return Promise.reject(new Error("Cannot search without arguments."));if(t.all_of_org&&!TS.boot_data.page_needs_enterprise)return Promise.reject(new Error("cannot search an org when not an enterprise team"));if(!t.solr&&TS.interop.Flannel.useSocket()){if(!t.hasOwnProperty("raw_query"))return Promise.reject(new Error("Flannel searches require a `raw_query` to be provided"));var a=t.raw_query;var s=t.count||Infinity;var o;if(_.isEmpty(t.raw_query)&&!t.only_admins)o=Promise.resolve([]);else{var l={};t.only_admins?l.filter="admins":t.only_local_team&&(l.filter="team");o=r(t.raw_query,s,t.determine_membership_for_channel,l)}return o.then(function(e){var n=e.objects;if(!t.include_bots){var r=_.remove(n,{is_bot:true});r.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these bots from results:",r)}if(t.exclude_slackbot&&t.include_bots){var o=_.remove(n,{is_slackbot:true});o.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed slackbot from results:",o)}if(TS.boot_data.page_needs_enterprise&&!t.all_of_org){var l=_.remove(n,function(e){var t=_.get(e,"enterprise_user.teams",[]);var n=_.includes(t,TS.model.team.id);return!n});l.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these org members from results:",l)}if(!t.include_deleted){var u=_.remove(n,{deleted:true});u.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these deleted members from results:",u)}n=_.intersectionBy(TS.members.getMembersForUser(),n,"id");return{ok:true,data:{items:n.slice(0,s),next_cursor_mark:null,num_found:n.length,teams:[TS.model.team]},args:{query:a}}})}if(!t.query)return Promise.reject(new Error("Cannot search without a query."));var u={query:JSON.stringify(t.query)};["sort","sort_direction","count","cursor_mark","include_bots","include_deleted","exclude_slackbot","ignore_guest_accounts"].forEach(function(e){t.hasOwnProperty(e)&&(u[e]=t[e])});var d=t.endpoint;d||(d=t.all_of_org?"search.enterprise":"search.team");return TS.interop.api.call(d,u).catch(n)}});var e=function e(t,n,r){if(!t){TS.error("cannot make a clause without a type");return}if(!n){TS.error("cannot make a clause without a value");return}"custom"!==t||r||TS.error("cannot make a custom type clause without a field id")};var t=function e(t,n){if(!t){TS.error("cannot make a conjunction without an 'and' or 'or' type");return}(!n||n.length<2)&&TS.error("cannot make a conjunction without at least two clauses")};var n=function e(t){TS.error(t.data.error+" error occured while searching");TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","utility_search")());throw t};var r=function e(t,n,r,i){i=i||{};var a={query:t,count:n};i.filter&&(a.filter=i.filter);var s=TS.members.fetchAndUpsertMembersWithQuery(a);if(!r)return s;var o=_.assign({channels:[r]},a);var l=TS.members.fetchAndUpsertMembersWithQuery(o);return Promise.join(s,l).then(function(e){var t=e[0];var n=e[1];var i=_.map(t.objects,"id");var a=_.map(n.objects,"id");var s={};a.forEach(function(e){s[e]=true});_.difference(i,a).forEach(function(e){s[e]=false});TS.redux.dispatch(TS.interop.redux.models.membership.setChannelMembershipInfoForUsers({channelId:r,membershipInfo:s}));return t})};var i=1989})()},2947:function(e,t){(function(){TS.registerModule("utility.calls",{share_url_prefix:document.location.origin+"/call/",calls_window_changed_sig:new signals.Signal,room_id_sig:new signals.Signal,started_platform_call_sig:new signals.Signal,window_types:{call_window:"call_window",mini_panel:"mini_panel",incoming_call:"incoming_call"},messages_to_call_window_types:{invite_response:"invite_response",invite_cancel:"invite_cancel",start_call:"start_call",caller_id:"caller_id",mini_panel_action:"mini_panel_action",did_close_window:"did_close_window",ping:"ping",ms_msg:"ms_msg",reachability:"reachability",calls_status:"calls_status",regions:"regions",got_server:"got_server",got_server_error:"got_server_error"},messages_to_mini_panel_types:{update_state:"update_state"},messages_from_call_window_types:{update_mini_panel:"update_mini_panel",set_call_window_loaded:"set_call_window_loaded",set_call_window_busy:"set_call_window_busy",show_growl_notification:"show_growl_notification",set_is_publisher_screensharing:"set_is_publisher_screensharing",pong:"pong",close:"close",restart_cursors_window_if_open:"restart_cursors_window_if_open",hide_call_window:"hideCallWindow",get_calls_status:"get_calls_status",force_janus_disconnect:"force_janus_disconnect",get_regions:"get_regions",get_server:"get_server",get_member_data:"get_member_data",play_sound:"play_sound",launch_dev_tools_mini_panel:"launch_dev_tools_mini_panel",launch_dev_tools_cursors:"launch_dev_tools_cursors",send_interactive_mas_migration_slackbot_message_after_call:"send_interactive_mas_migration_slackbot_message_after_call",update_injection_urls:"update_injection_urls",dm_call_is_usable:"dm_call_is_usable"},messages_from_incoming_call_types:{user_clicked_accept_or_reject:"user_clicked_accept_or_reject"},messages_from_mini_panel_types:{user_clicked_action:"user_clicked_action"},invite_response_types:{accept:"accept",reject:"reject",on_call:"on_call",dnd:"dnd",hangup:"hangup"},invite_cancel_types:{cleanup:"cleanup",timeout:"timeout",inviter_cancel:"inviter_cancel",accepted_timeout:"accepted_timeout",caller_hangup:"caller_hangup"},invite_unsupported_types:{platform:"platform",client_version:"client_version",offline:"offline",max_teams:"max_teams"},openMasMigrationDialog:function e(){"enabled"===TS.interop.experiments.getGroupForUser("calls_interactive_ss")&&TS.generic_dialog.start({title:TS.interop.i18n.t("Close Slack to download the app?","calls")(),body:TS.interop.i18n.t("We'll close Slack for you, and open the downloads page on our website. The app will download automatically \u2014 just follow the three quick installation steps listed at the end!","calls")(),show_cancel_button:true,go_button_text:TS.interop.i18n.t("Start Download Now","calls")(),onGo:function e(){TS.utility.openInNewTab("https://slack.com/downloads/instructions/osx?ddl=1","_blank");_.delay(function(){return _.invoke(desktop.app,"quit")},2e3)}})},onStart:function t(){e=TS.calls&&TS.calls.api?TS.calls.api:TS.interop.api;l.in_slack_app=!!TS.client;l.in_call_window=!!TS.calls;l.calls_url_prefix=document.location.origin+"/call/";l.send_interactive_mas_migration_slackbot_message_after_call=false;if(l.in_slack_app){TS.redux.socket.connectedSig.add(m);TS.redux.socket.disconnectedSig.add(f);TS.redux.socket.socketMessageReceivedSig.add(c);TS.interop.desktop.setCallWindowBusy(false);window.addEventListener("online",p);window.addEventListener("offline",p);window.addEventListener("message",se);TS.model.is_our_app&&TS.client.login_sig.add(h);if(TS.client.windows){TS.client.windows.win_finished_loading_sig.add(g);TS.client.windows.win_will_close_sig.add(S);TS.client.windows.win_crashed_sig.add(T);TS.client.windows.win_became_key_sig.add(v);TS.client.windows.win_resigned_key_sig.add(b)}TS.ui&&TS.ui.window_unloaded_sig.add(y);TS.model.is_our_app?l.call_window_loaded=false:l.call_window_loaded=true;l.is_ms_connected=false;l.is_reachability_online=true;l.screen_sharing_enabled=TS.model.supports_screen_sharing;"enabled"===TS.interop.experiments.getGroupForUser("calls_better_regions")&&(l.calls_better_regions_expt=true)}u="enabled"===TS.interop.experiments.getGroupForUser("calls_modern_from_legacy");if(TS.client&&!window.desktop&&u){var n=document.getElementById("incoming_call_mount_point");TS.interop.mountBrowserIncomingCall(TS.boot_data.team_id,n)}},startCallInModelOb:function e(t,n,r){var i;var a=!n&&"Slack"!==TS.prefs.getTeamPref("calling_app_name");if(TS.interop.utility.looksLikeMemberId(t.id)){var s=t.id;t=TS.redux.channels.getImByMemberId(s);if(!t){TS.ims.promiseToStartImByMemberId(s,true,false).then(function(){t=TS.redux.channels.getImByMemberId(s);i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:r};a?TS.utility.calls.launchPlatformCalls(i):TS.utility.calls.launchVideoCall(i)});return}}i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:r};a?TS.utility.calls.launchPlatformCalls(i):TS.utility.calls.launchVideoCall(i)},getCallsUrlPrefix:function e(){return l.calls_url_prefix},isEnabled:function e(){if(!TS.model||!TS.model.team)return false;return TS.prefs.getTeamPref("allow_calls")},isCallWindowReady:function e(){return l.is_reachability_online&&l.is_ms_connected},isMultiPartyEnabled:function e(){return TS.utility.calls.isEnabled()&&TS.utility.calls.isPaidTeam()},isPaidTeam:function e(){return""!==TS.model.team.plan},isCurrentContextMultiParty:function e(){if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id)return true;return false},launchPlatformCalls:function t(n){if(!n)return;if(!n.id)return;var r=null!=TS.interop.environment.desktop_app_version;TS.utility.calls.started_platform_call_sig.dispatch({is_loading:true});e.call("calls.request",{channel:n.id,app:TS.prefs.getTeamPref("calling_app_id")}).then(function(e){if(!e.data.ok){d(e);return}var t=window.open(encodeURI(e.data.url),TS.prefs.getTeamPref("calling_app_name"));try{t.focus()}catch(e){if(!r){var n=bowser.name;var i;i=n?TS.interop.i18n.t("Please allow pop-ups in {browser} to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")({browser:n}):TS.interop.i18n.t("Please allow pop-ups in your browser to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")();var a={text:i,ephemeral_type:"enable_popups",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(a)}}}).catch(function(e){d(e)}).finally(function(){TS.utility.calls.started_platform_call_sig.dispatch({is_loading:false})})},isInteractiveScreenShareHostingSupported:function e(){return TS.model.supports_screen_sharing&&!TS.model.is_lin&&!TS.utility.calls.isInteractiveDisabledByMas()&&!TS.utility.isAppVersionBefore("2.8.0")},isInteractiveDisabledByMas:function e(){return TS.model.is_our_app&&TS.model.is_mac&&TS.interop.desktop.isAppStoreBuild()},launchVideoCall:function e(t){if(!TS.model.supports_voice_calls){w();return}if(!t)return;if(!t.id)return;if(!TS.utility.calls.isCallWindowReady())return;if(l.incoming_caller_info){var n=TS.redux.channels.getImByMemberId(l.incoming_caller_info.user_id);n&&n.id===t.id&&j().then(function(e){if(e){TS.utility.calls.closeIncomingCallWindow();TS.utility.calls.sendInvitationResponseToCaller({user_id:l.incoming_caller_info.user_id,room_id:l.incoming_caller_info.room_id,response:TS.utility.calls.invite_response_types.accept,did_choose_video:false})}})}G().then(function(e){if(e){K();return}TS.utility.calls_log.logEvent({event:o.log_events.start_call,value:t});re("call_initiated_by_user",t.id);q(l.calls_url_prefix+t.id,t.id,{start_with_video:t.is_video_call})})},sendInvitationResponseToCaller:function t(n){if(!n||!n.user_id||!n.room_id||!n.response||!TS.utility.calls.invite_response_types[n.response]){TS.utility.calls_log.logError("sendInvitationResponseToCaller: invalid args: ",n);return}TS.utility.calls.room_id_sig.dispatch({room_id:n.room_id});if(n.response){var r=function e(t,n){t||TS.utility.calls_log.logError("inviteResponse API failed with: ",n)};e.callImmediately("screenhero.rooms.inviteResponse",{caller:n.user_id,room:n.room_id,response:n.response}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}});if(n.response===TS.utility.calls.invite_response_types.accept){l.accepted_caller_id=n.user_id;n.currently_calling_caller||W(n.room_id,n.did_choose_video)}else ae()}Promise.join(G(),j(),function(e,t){TS.utility.calls_log.logEvent({event:o.log_events.invite_response_send,value:{response_type:n.response,user_id:n.user_id,room_id:n.room_id,is_call_window_busy:e,is_in_incoming_call:t}});return null})},closeIncomingCallWindow:function e(t){TS.utility.calls_log.logEvent({event:o.log_events.close_incoming_call});if(TS.model.is_our_app){if(window.desktop&&l.incoming_call_token){TS.interop.desktop.closeWindow(l.incoming_call_token);delete l.incoming_call_token}}else j().then(function(e){e&&TS.incoming_call.timeout()});delete l.incoming_caller_info;t?TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true}):H()},maybeEnterMasToDdlFlow:function e(t){if(!TS.utility.calls.isInteractiveDisabledByMas())return false;t=TS.utility.normalizeDevHost(t);if(-1===t.indexOf("slack.com/downloads")||-1===t.indexOf("?ddl=1"))return false;if("enabled"===TS.interop.experiments.getGroupForUser("calls_interactive_ss")){TS.utility.calls.openMasMigrationDialog();return true}return false},maybeHandleCallLink:function e(t){if(!l.in_slack_app)return false;t=$(t);if(!t||!t.length)return false;if(!t.is("a"))return false;var n=t.attr("href");if(!n)return false;n=TS.utility.normalizeDevHost(n);n=n.replace("https://","").replace("http://","");var r=TS.utility.normalizeDevHost(l.calls_url_prefix);r=r.replace("https://","").replace("http://","");0===n.indexOf(r)&&(n=n.replace(r,"call/"));while(0===n.indexOf("/"))n=n.substr(1);if(0!==n.indexOf("call/"))return false;var i=n.split("/");if(i.length<2)return false;var a=i[1];if(!a)return false;if(!TS.utility.calls.isCallWindowReady())return true;j().then(function(e){if(e){TS.utility.calls_log.logEvent({event:o.log_events.call_object_click_in_incoming_call});return}TS.utility.calls.room_id_sig.dispatch({room_id:a});W(a)});return true},getParentWindow:function e(){if(window.desktop&&!(window.parentInfo||window.parentBrowserWindowId))TS.utility.calls_log.logWarn("WinSSB: Trying to get parent window before browser window ID is initialized");else if(window.opener)return window.opener},promiseToGetRegions:function e(r){if(t)return t;var i=void 0;var s="https://universal.slack-core.com/region.json";t=new Promise(function(e){r&&"R"===r.charAt(0)?e(""):$.ajax({type:"GET",url:s,async:true,cache:false,timeout:2e3,success:function t(n){TS.utility.calls_log.logEvent({event:"Regions",value:n.region_text});i=n.region_text;TS.interop.environment.isDev&&(i="dev");e(i)},error:function t(n,r,a){TS.utility.calls_state_logging.error("CALLS_REGION_REQUEST_ERROR",{error:r,error_msg:a});i="";TS.interop.environment.isDev&&(i="dev");e(i)}})});clearTimeout(n);n=_.delay(function(){t=void 0},a);return t},promiseToGetServer:function t(n,s){if(r[s])return r[s];var o;var l={regions:n,protocol:"1.0"};if("R"===s.charAt(0)){o="screenhero.rooms.join";l.room=s}else{o="screenhero.rooms.create";l.channel=s;var u=TS.storage.fetchCallsState();if(u.call_server_override){l.call_server=u.call_server_override;u.call_server_override=null;TS.storage.storeCallsState(u)}}r[s]=e.callImmediately(o,l).then(function(e){return _.omit(e,"data.args")});clearTimeout(i[s]);i[s]=_.delay(function(){TS.utility.calls.clearServerPromise(s)},a);return r[s]},clearServerPromise:function e(t){delete r[t]},dummyMediaServerRequest:function e(t,n){$.ajax({type:"HEAD",url:"https://"+t+":"+n+"/janus",async:true,timeout:1e3,success:function e(){},error:function e(t,n,r){}})},getCallActive:function e(){return G()},isScreenSharing:function e(){return l.is_publisher_screensharing},isSupportedMessage:function e(t){var n=["user_change","pref_change","team_join","channel_created","channel_deleted","channel_archive","channel_unarchive","channel_rename","channel_joined","channel_left","group_deleted","group_archive","group_unarchive","group_rename","group_joined","group_left","im_open","mpim_joined","mpim_open","mpim_close"];return-1!==n.indexOf(t)},getPlatformErrorMessageForModal:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("Unfortunately, this version of Slack is out of date. Update your Slack app for access to calls &mdash; as well as bug fixes and an all-around smoother experience.","utility")();return TS.utility.calls.getPlatformErrorMessageForCallWindow()},getPlatformErrorMessageForCallWindow:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("To join or start calls, you'll need to use the latest version of the Slack app.","utility")();return TS.interop.i18n.t("Unfortunately, Slack calls aren't available in this browser. We recommend downloading the Slack desktop app, or you can switch to Chrome.","utility")()},getPlatformErrorModalTitle:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("To join calls, you\u2019ll need to update Slack","utility")();return TS.interop.i18n.t("Please download the app to use calls","utility")()},getPlatformErrorButtonText:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("Update Slack","utility")();return TS.interop.i18n.t("Download Slack","utility")()},verifyOriginUrl:function e(t){return TS.interop.url.getHostName(t)==window.location.hostname&&_.startsWith(t,"https:")},getUrlForRoom:function e(t){return TS.utility.calls.getUrlForRoomId(t.id)},getUrlForRoomId:function e(t){return TS.utility.calls.share_url_prefix+t},dbg:{getState:function e(){return{config:o,state:l}},isCallWindowBusy:function e(){G().then(function(e){TS.info("_isCallWindowBusy: "+e)})},isIncomingCallWindowBusy:function e(){j().then(function(e){TS.info("_isInIncomingCall: "+e)})}}});var e;var t;var n;var r={};var i={};var a=6e4;var s=[];var o={call_window_dims:{width:1070,height:600,min_width:600,min_height:500},mini_panel_dims:{width:280,height:64,min_width:280,min_height:44,x_offset:50,y_offset:50},incoming_call_window_dims:{width:240,height:373},log_events:{previous_crash:"PreviousCrash",incoming_call:"IncomingCall",invite_response_from_callee:"InviteResponseFromCallee",ms_connected:"MSConnected",ms_disconnected:"MSDisconnected",reachability_changed:"ReachabilityChanged",window_closed:"WindowClosed",window_crashed:"WindowCrashed",call_window_load_timeout:"CallWindowLoadTimeout",call_window_load_start:"CallWindowLoadStart",incoming_call_timeout:"IncomingCallTimeout",send_msg_no_call_window:"SendMsgNoCallWindow",send_msg_no_mini_panel:"SendMsgNoMiniPanel",call_window_loaded:"CallWindowLoaded",call_window_busy:"CallWindowBusy",invalid_msg_from_child_window:"InvalidMsgFromChildWindow",call_window_pong:"CallWindowPong",unknown_msg_from_call_window:"UnknownMsgFromCallWindow",incoming_call_click:"IncomingCallClick",unknown_msg_from_incoming_call_window:"UnknownMsgFromIncomingCallWindow",mini_panel_click:"MiniPanelClick",unknown_msg_from_mini_panel:"UnknownMsgFromMiniPanel",call_object_click_in_incoming_call:"CallObjectClickInIncomingCall",invite_response_send:"InviteResponseSend",close_incoming_call:"CloseIncomingCall",no_mini_panel_in_update:"NoMiniPanelInUpdate",start_call:"StartCall",join_call:"JoinCall"},CALL_WINDOW_LOAD_TIMEOUT_MSECS:3e4,INCOMING_RING_TIMEOUT_MSECS:27e3};var l={};var u=false;var d=function e(t){var n={text:t.data.response||TS.interop.i18n.t("Darn, that didn\u2019t work. Try your call again or <http://my.slack.com/help.requests/new|contact us> if it\u2019s still not working.","utility")(),ephemeral_type:t.data.error||"uncaught_third_party_call_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(n)};var c=function t(n){if(!l.in_slack_app)return;switch(n.type){case"screenhero_invite":TS.utility.calls_log.logEvent({event:o.log_events.incoming_call,value:n});if(u){TS.redux.dispatch(TS.interop.calls.handleCallInvite(n));break}Promise.join(G(),j(),function(e,t){O(e,t,n);return null});break;case"screenhero_invite_cancel":TS.utility.calls.closeIncomingCallWindow();l.accepted_caller_id||ae();G().then(function(e){e?B({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:n.cancel_type,user_id:n.responder,room_id:n.room}):l.cached_invite_cancel={cancel_type:n.cancel_type,user_id:n.responder,room_id:n.room}});break;case"screenhero_invite_response":TS.utility.calls_log.logEvent({event:o.log_events.invite_response_from_callee,value:n});B({message_type:TS.utility.calls.messages_to_call_window_types.invite_response,response_type:n.response,user_id:n.responder,room_id:n.room});e.callImmediately("screenhero.rooms.inviteCancel",{responder:n.responder,room:n.room,cancel_type:TS.utility.calls.invite_cancel_types.cleanup});break;case"sh_room_join":TS.utility.calls_log.logInfo("sh_room_join msg: ",n);break;default:TS.utility.calls.isSupportedMessage(n.type)&&(TS.model.is_our_app||B({message_type:TS.utility.calls.messages_to_call_window_types.ms_msg,msg:n}));break}};var m=function e(){TS.utility.calls_log.logEvent({event:o.log_events.ms_connected});l.is_ms_connected=true;V()};var f=function e(){TS.utility.calls_log.logEvent({event:o.log_events.ms_disconnected});l.is_ms_connected=false;V()};var p=function e(){l.is_reachability_online=window.navigator.onLine;V();N()};var h=function e(){l.did_login=true};var g=function e(t){switch(t){case l.incoming_call_token:TS.interop.desktop.centerWindow(t);TS.interop.desktop.showWindowInactive(t);D();break;case l.mini_panel_token:if(window.desktop&&desktop.window&&desktop.window.browserWindows&&desktop.window.browserWindows[t]&&desktop.window.browserWindows[t].setMinimumSize){desktop.window.browserWindows[t].setMinimumSize(o.mini_panel_dims.min_width,o.mini_panel_dims.min_height);desktop.window.browserWindows[t].setSize(o.mini_panel_dims.width,o.mini_panel_dims.height)}break;default:break}};var S=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.window_closed,value:{token:t,cw_token:l.call_window_token,mp_token:l.mini_panel_token,ic_token:l.incoming_call_token}});switch(t){case l.call_window_token:l.last_call_window_token=l.call_window_token;Q();l.call_window_token&&delete l.call_window_token;A();E();break;case l.mini_panel_token:l.mini_panel_token&&delete l.mini_panel_token;break;default:break}};var T=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.window_crashed,value:{token:t,cw_token:l.call_window_token,mp_token:l.mini_panel_token,ic_token:l.incoming_call_token}});if(t!==l.last_call_window_token&&t!==l.call_window_token)return;F();Q();delete l.call_window_token;TS.utility.calls_log.logEvent({event:o.log_events.previous_crash});A();E()};var v=function e(t){if(t!==l.call_window_token)return;if(l.is_publisher_screensharing)return;TS.interop.desktop.hideWindow(l.mini_panel_token)};var b=function e(t){if(t!==l.call_window_token)return;G().then(function(e){e&&TS.interop.desktop.showWindowInactive(l.mini_panel_token)})};var y=function e(){TS.utility.calls_log.logInfo("client window unloaded!");P()};var w=function e(){TS.generic_dialog.start({title:TS.utility.calls.getPlatformErrorModalTitle(),body:TS.utility.calls.getPlatformErrorMessageForModal(),show_cancel_button:true,go_button_text:TS.utility.calls.getPlatformErrorButtonText(),onGo:function e(){var t="_"+Math.random();TS.utility.openInNewTab("https://slack.com/downloads",t)}})};var k=function e(){return _.get(window,"desktop.app.areTransparentWindowsSupported",true)};var x=function e(t){var n;if(u&&window.desktop&&TS.utility.compareSemanticVersions(window.process.versions.electron,"3.0.0")<0){window.confirm("[TS-only] You're opted in to the Friends of Calls alpha release, but you need to download a SlackPilot Desktop build to use modern Calls.");return}if(!TS.utility.calls.isEnabled())return;if(l.call_window_token&&!u){B({message_type:TS.utility.calls.messages_to_call_window_types.start_call,args:{url:t}});TS.interop.desktop.focusWindow(l.call_window_token)}else{TS.metrics.mark("start_loading_call_window");n={url:t||l.calls_url_prefix,title:"",background:true,backgroundColor:"#2c2d30",width:o.call_window_dims.width,height:o.call_window_dims.height,minWidth:o.call_window_dims.min_width,minHeight:o.call_window_dims.min_height,hideMenuBar:true,windowType:"calls",show:true,no_spinner:true,hides_on_close:false};if(window.desktop){var r=TS.interop.desktop.getAppDisplay();n.x=r.bounds.x+(r.bounds.width-o.call_window_dims.width)/2;n.y=r.bounds.y+(r.bounds.height-o.call_window_dims.height)/2}l.call_window_token=TS.client.windows.openWindow(n);TS.utility.calls_log.logInfo("_startCallWindow: returned token: ",l.call_window_token);l.injection_url_promise=new Promise(function(e){l.injection_url_resolver=e})}l.injection_url_promise.then(function(){I();M()})};var C=function e(){if(!l.call_window_token)return;F();var t=l.call_window_token;delete l.call_window_token;TS.interop.desktop.closeWindow(t);TS.info("Call window closed after Janus disconnect",t)};var I=function e(){if(!window.desktop||l.mini_panel_token)return;var t=TS.interop.desktop.getDisplayForWindow(l.call_window_token);var n={x:t.bounds.x+(t.bounds.width-o.mini_panel_dims.x_offset-o.mini_panel_dims.width),y:t.bounds.y+o.mini_panel_dims.y_offset,width:o.mini_panel_dims.width,height:o.mini_panel_dims.height,minWidth:o.mini_panel_dims.min_width,minHeight:o.mini_panel_dims.min_height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_mini_panel",show:false,useContentSize:true,skip_css:true,skipTaskbar:true,fullscreenable:false};TS.model.is_mac&&k()&&(n.transparent=true);n.content_html=TS.templates.calls_minipanel({is_linux:TS.model.is_lin,is_screenhero_disabled_by_admin:!TS.prefs.getTeamPref("allow_calls_interactive_screen_sharing"),locale:TS.interop.i18n.locale,no_border:!TS.model.is_mac,js_urls:l.injection_urls?l.injection_urls.calls_mini_panel.js:[],css_urls:l.injection_urls?l.injection_urls.calls_mini_panel.css:[]});l.mini_panel_token=TS.client.windows.openWindow(n);TS.interop.desktop.showWindowInactive(l.mini_panel_token);TS.interop.desktop.hideWindow(l.mini_panel_token)};var M=function e(){if(!l.screen_sharing_enabled||TS.model.is_lin)return;if(l.injection_urls)var t=l.injection_urls.calls_cursors.js;var n=TS.templates.calls_cursors({locale:TS.interop.i18n.locale,js_urls:t,css_urls:l.injection_urls?l.injection_urls.calls_cursors.css:[]});var r={width:0,height:0,windowType:"calls_cursors",transparent:true,alwaysOnTop:true,hideMenuBar:true,resizable:false,frame:false,useContentSize:true,skip_css:true,content_html:n,fullscreenable:false,enableLargerThanScreen:true,hasShadow:false,focusable:false,show:false,skipTaskbar:true};l.cursors_window_token=TS.client.windows.openWindow(r)};var A=function e(){if(!l.mini_panel_token)return;var t=l.mini_panel_token;delete l.mini_panel_token;TS.interop.desktop.closeWindow(t);TS.info("Mini panel window closed after call",t)};var E=function e(){if(!l.screen_sharing_enabled)return;if(!l.cursors_window_token)return;var t=l.cursors_window_token;delete l.cursors_window_token;TS.interop.desktop.closeWindow(t);TS.info("Cursors window closed after call",t)};var P=function e(){if(l.mini_panel_token){TS.interop.desktop.closeWindow(l.mini_panel_token);delete l.mini_panel_token}if(l.call_window_token){B({message_type:TS.utility.calls.messages_to_call_window_types.did_close_window});F();TS.interop.desktop.closeWindow(l.call_window_token);Q();delete l.call_window_token}if(l.window_handle){l.window_handle.close();delete l.window_handle}};var F=function e(){R(false);U(false);if(l.send_interactive_mas_migration_slackbot_message_after_call&&"enabled"===TS.interop.experiments.getGroupForUser("calls_interactive_ss")){var t="TS.utility.calls.openMasMigrationDialog()";TS.client.msg_pane.addMaybeClick(t,TS.utility.calls.openMasMigrationDialog.bind(Object.create(null)));var n=TS.interop.i18n.t("To share control of your screen, you'll need to <javascript:{open_dialog_fn}|download the Slack app> directly from our website.","calls")({open_dialog_fn:t});TS.client.ui.addEphemeralBotMsg({text:n,type:"interactive_mas_migration"});l.send_interactive_mas_migration_slackbot_message_after_call=false}};var O=function t(n,r,i){if(!TS.utility.calls.isEnabled())return;var a=TS.shared.isRelevantTeam();if(!a)return;var s=false;var u=TS.redux.channels.getImByMemberId(i.caller);u&&u.id===l.call_channel&&(s=true);if(n||r||s){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:s?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.on_call,currently_calling_caller:s});return}if(TS.dnd.isMemberInDnd(TS.model.user)){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:TS.utility.calls.invite_response_types.dnd});return}var d=TS.interop.members.getMemberById(i.caller);var c=Promise.resolve(d);d||(c=e.call("users.info",{user:i.caller,_x_reason:"incoming_calls"}).then(function(e){TS.members.legacyUpsertMember(e.data.user);d=TS.interop.members.getMemberById(i.caller)}));c.then(function(){var e=TS.interop.members.getPrefCompliantMemberName(d);re("incoming_call_window_shown",i.room);if(TS.model.is_our_app){if(window.desktop){var t={width:o.incoming_call_window_dims.width,height:o.incoming_call_window_dims.height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_incoming_call",show:false,skip_css:true,fullscreenable:false};TS.model.is_mac&&k()&&(t.transparent=true);var n=TS.templates.calls_incoming_call({caller:d,name:e,is_video_call:TS.model.supports_video_calls&&i.cameras_on>0,team:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)});t.content_html=TS.templates.calls_incoming_call_window({locale:TS.interop.i18n.locale,incoming_call_div:n,room_id:i.room,user_id:i.caller,no_border:!TS.model.is_mac,css_urls:TS.boot_data.electron_window_injection_urls?TS.boot_data.electron_window_injection_urls.calls_incoming_call.css:[]});l.incoming_call_token=TS.client.windows.openWindow(t)}}else TS.incoming_call.start({caller:d,name:e,is_video_call:TS.model.supports_video_calls&&i.cameras_on>0,onAccept:function e(t){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:TS.utility.calls.invite_response_types.accept,did_choose_video:t})},onReject:function e(){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:TS.utility.calls.invite_response_types.reject})},onTimeout:function e(){},onShow:function e(){D()},onEnd:function e(){H()}});l.incoming_caller_info={user_id:i.caller,room_id:i.room}})};var D=function e(){TS.sounds.play("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{should_loop:true,ignore_mute:true});l.incoming_ring_timer=setTimeout(function(){TS.utility.calls_log.logEvent({event:o.log_events.incoming_call_timeout});TS.utility.calls.closeIncomingCallWindow();ae()},o.INCOMING_RING_TIMEOUT_MSECS);l.in_incoming_call=true;X()};var H=function e(){TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true});if(l.incoming_ring_timer){clearTimeout(l.incoming_ring_timer);delete l.incoming_ring_timer}delete l.in_incoming_call;delete l.incoming_caller_info;Z()};var j=function e(){if(!TS.model.is_our_app||!TS.interop.desktop.supportsCallWindowStatus())return Promise.resolve(!!l.in_incoming_call);return TS.interop.desktop.isIncomingCallWindowBusy()};var B=function e(t){if(TS.model.is_our_app){var n=l.call_window_token;if(!n){TS.utility.calls_log.logEventWarn({event:o.log_events.send_msg_no_call_window,value:t});return}window.desktop&&window.desktop.window&&window.desktop.window.postMessage(t,n)}else if(l.window_handle)try{l.window_handle.postMessage(t,"*")}catch(e){"DataCloneError"==e.name?l.window_handle.postMessage(_.cloneDeep(t),"*"):TS.error("Unexpected failure in sending a post message:",e.name)}};var L=function e(t){if(!l.mini_panel_token){TS.utility.calls_log.logEventWarn({event:o.log_events.send_msg_no_mini_panel,value:t});return}window.desktop&&window.desktop.window&&window.desktop.window.postMessage(t,l.mini_panel_token)};var N=function e(){if(!l.call_window_loaded)return;B({message_type:TS.utility.calls.messages_to_call_window_types.reachability,online:l.is_reachability_online})};var R=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.call_window_loaded,value:{is_loaded:t}});l.call_window_loaded=t;V();t&&TS.metrics.getLatestMark("start_loading_call_window")&&TS.metrics.measureAndClear("calls_desktop_window_loading_time","start_loading_call_window");N()};var U=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.call_window_busy,value:{is_busy:t}});l.is_call_window_busy=t;if(t){J();l.accepted_caller_id&&B({message_type:TS.utility.calls.messages_to_call_window_types.caller_id,args:{caller_id:l.accepted_caller_id}});l.cached_invite_cancel&&B({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:l.cached_invite_cancel.cancel_type,user_id:l.cached_invite_cancel.user_id,room_id:l.cached_invite_cancel.room_id})}else{ae();Q();l.call_channel=void 0;l.is_publisher_screensharing=false;l.is_publisher_screenhero=false}l.accepted_caller_id&&delete l.accepted_caller_id;l.cached_invite_cancel&&delete l.cached_invite_cancel};var G=function e(){if(u)return Promise.resolve(false);if(!TS.model.is_our_app||!TS.interop.desktop.supportsCallWindowStatus())return Promise.resolve(!!l.is_call_window_busy);return TS.interop.desktop.isCallWindowBusy()};var q=function e(t,n,r){r=r||{};if(u){TS.redux.dispatch(TS.interop.calls.startOrJoinCall(n));return}t+="?_fast_members=1&_end_call_sound=1"+(r.start_with_video?"&_start_with_video=1":"");TS.pri&&(t+="&pri="+TS.pri);TS.qs_args._calls_halt_at_loading_screen&&(t+="&_calls_halt_at_loading_screen=1");TS.qs_args.locale&&(t+="&locale="+TS.qs_args.locale);TS.qs_args.js_path&&(t+="&js_path="+encodeURIComponent(TS.qs_args.js_path));TS.utility.calls.promiseToGetRegions(n).then(function(e){TS.utility.calls.promiseToGetServer(e,n).then(function(e){TS.utility.calls.dummyMediaServerRequest(e.data.hostname,e.data.port)})});TS.interop.clog.track("CALLS_USER_JOIN_INTENT");TS.model.is_our_app?x(t):l.window_handle=window.open(t,n);l.call_channel=n};var W=function e(t,n){if(!TS.model.supports_voice_calls){w();return}if(!TS.utility.calls.isCallWindowReady())return;G().then(function(e){if(e){K();return}TS.utility.calls_log.logEvent({event:o.log_events.join_call,value:{room_id:t,start_with_video:n}});re("call_accepted_by_user",t);ie("incoming_call_window_shown_to_accepted_time","incoming_call_window_shown",t);q(l.calls_url_prefix+t,t,{start_with_video:n})})};var z=function e(t){var n;n=t?TS.interop.i18n.t("You\u2019re already in a call on another workspace ({team_name})","utility")({team_name:t}):TS.interop.i18n.t("You\u2019re already in a call on another workspace","utility")();TS.generic_dialog.start({title:n,body:'<p class="no_bottom_margin">'+TS.interop.i18n.t("You can only be in one call at a time. Please end that call and try again.","utility")()+"</p>",go_button_text:TS.interop.i18n.t("OK","utility")(),show_cancel_button:false})};var K=function e(){TS.utility.calls_log.logInfo("_handleAlreadyInCall");if(!TS.model.is_our_app){l.window_handle.focus();return}if(!TS.interop.desktop.supportsCallWindowStatus()){TS.interop.desktop.focusWindow(l.call_window_token);return}TS.interop.desktop.getCallWindowTeamId().then(function(e){e===TS.model.team.id?TS.interop.desktop.focusWindow(l.call_window_token):TS.interop.desktop.getCallWindowTeamName().then(function(e){z(e)})})};var V=function e(){TS.client.msg_pane.setCallButtonState(TS.utility.calls.isCallWindowReady())};var Y=function e(t){if(!l.mini_panel_token){TS.utility.calls_log.logEventWarn({event:o.log_events.no_mini_panel_in_update});return}L({message_type:TS.utility.calls.messages_to_mini_panel_types.update_state,mini_panel_state:t})};var J=function e(){if(!TS.model.is_our_app)return;TS.interop.desktop.setCallWindowBusy(true);TS.interop.desktop.setCallWindowToken(l.call_window_token);TS.interop.desktop.setCallWindowTeamId(TS.model.team.id);TS.interop.desktop.setCallWindowTeamName(TS.interop.rules.teams.getTeamDisplayName(TS.model.team))};var Q=function e(){if(!TS.model.is_our_app)return;if(!TS.interop.desktop.supportsCallWindowStatus())return;var t=String(l.call_window_token);TS.interop.desktop.getCallWindowToken().then(function(e){if(e!==t)return;TS.interop.desktop.setCallWindowBusy(false);TS.interop.desktop.clearCallWindowToken();TS.interop.desktop.clearCallWindowTeamId();TS.interop.desktop.clearCallWindowTeamName()})};var X=function e(){if(!TS.model.is_our_app)return;if(!TS.interop.desktop.supportsCallWindowStatus())return;TS.interop.desktop.setIncomingCallWindowBusy(true);l.incoming_call_token&&TS.interop.desktop.setIncomingCallWindowToken(l.incoming_call_token);TS.interop.desktop.setIncomingCallWindowTeamId(TS.model.team.id);TS.interop.desktop.setIncomingCallWindowTeamName(TS.interop.rules.teams.getTeamDisplayName(TS.model.team))};var Z=function e(){var t=function e(){TS.interop.desktop.setIncomingCallWindowBusy(false);TS.interop.desktop.clearIncomingCallWindowToken();TS.interop.desktop.clearIncomingCallWindowTeamId();TS.interop.desktop.clearIncomingCallWindowTeamName()};if(!TS.model.is_our_app)return;if(!l.incoming_call_token){t();return}var n=String(l.incoming_call_token);TS.interop.desktop.getIncomingCallWindowToken().then(function(e){if(e!==n)return;t()})};var ee=function e(t,n,r,i){$.ajax({timeout:2e3,type:"POST",url:t+"/"+n,async:true,cache:false,contentType:"application/json",headers:{Authorization:"Basic "+btoa(":"+r)},data:JSON.stringify({janus:"destroy",transaction:i}),dataType:"json"})};var te=function e(t){_(window.desktop.window.state.windows).filter({subType:t}).map("id").each(function(e){return desktop.window.toggleDevTools({window_token:e})})};var ne=function e(t){ie("dm_call_initiated_to_usable_time","call_initiated_by_user",t);ie("dm_call_accepted_to_usable_time","call_accepted_by_user",t)};var re=function e(t,n){TS.metrics.mark(t);s[t]=n};var ie=function e(t,n,r){if(s[n]==r){TS.metrics.measureAndClear(t,n);s[n]=void 0}};var ae=function e(){TS.metrics.clearMarks("call_initiated_by_user");TS.metrics.clearMarks("call_accepted_by_user");TS.metrics.clearMarks("incoming_call_window_shown");TS.metrics.clearMarks("start_loading_call_window")};var se=function e(t){if(!t||!t.data||!t.data.message_type){TS.utility.calls_log.logEvent({event:o.log_events.invalid_msg_from_child_window,value:t});return}if(!TS.model.is_our_app&&!TS.utility.calls.verifyOriginUrl(t.origin))return;if(t.data.origin_window_type===TS.utility.calls.window_types.call_window)switch(t.data.message_type){case TS.utility.calls.messages_from_call_window_types.update_mini_panel:Y(t.data.mini_panel_state);t.data.mini_panel_state.hidden&&TS.interop.desktop.hideWindow(l.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.set_call_window_loaded:R(t.data.is_loaded);N();break;case TS.utility.calls.messages_from_call_window_types.set_call_window_busy:U(t.data.is_busy);break;case TS.utility.calls.messages_from_call_window_types.show_growl_notification:"nothing"!==TS.notifs.getGlobalNotificationSetting()&&TS.ui.growls.show(t.data.title,t.data.txt,null,{subtitle:t.data.subtitle,sound_name:"none",channelId:t.data.channel,is_call_notification:true});break;case TS.utility.calls.messages_from_call_window_types.set_is_publisher_screensharing:l.is_publisher_screensharing=t.data.is_enabled;l.is_publisher_screenhero=t.data.is_screenhero;l.is_publisher_screensharing&&TS.interop.desktop.showWindowInactive(l.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.close:C();A();E();break;case TS.utility.calls.messages_from_call_window_types.restart_cursors_window_if_open:if(l.cursors_window_token){E();M()}break;case TS.utility.calls.messages_from_call_window_types.hide_call_window:TS.interop.desktop.hideWindow(l.call_window_token);break;case TS.utility.calls.messages_from_call_window_types.get_calls_status:G().then(function(e){TS.interop.desktop.getCallWindowTeamName().then(function(t){B({message_type:TS.utility.calls.messages_to_call_window_types.calls_status,is_busy:e,team_name:t})})});break;case TS.utility.calls.messages_from_call_window_types.force_janus_disconnect:ee(t.data.server,t.data.session_id,t.data.token,t.data.transaction_id);break;case TS.utility.calls.messages_from_call_window_types.get_regions:TS.utility.calls.promiseToGetRegions(t.data.id).then(function(e){B({message_type:TS.utility.calls.messages_to_call_window_types.regions,regions:e})});break;case TS.utility.calls.messages_from_call_window_types.get_server:var n=t.data.id;var r=t.data.regions;TS.utility.calls.promiseToGetServer(r,n).then(function(e){B({message_type:TS.utility.calls.messages_to_call_window_types.got_server,data:e.data});TS.utility.calls.clearServerPromise(n)}).catch(function(e){TS.utility.calls.clearServerPromise(n);B({message_type:TS.utility.calls.messages_to_call_window_types.got_server_error,error:e.data?e.data.error:null})});break;case TS.utility.calls.messages_from_call_window_types.get_member_data:TS.interop.members.ensureMembersArePresent([t.data.user_id]).then(function(){B({reply_to:t.data.message_id,message_type:t.data.message_type,message:{user_id:t.data.user_id,member:TS.interop.members.getMemberById(t.data.user_id)}})});break;case TS.utility.calls.messages_from_call_window_types.play_sound:TS.sounds.play("call/"+t.data.sound+"_"+TS.boot_data.call_sounds_version+".mp3");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_mini_panel:TS.model.is_our_app&&te("calls_mini_panel");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_cursors:TS.model.is_our_app&&te("calls_cursors");break;case TS.utility.calls.messages_from_call_window_types.send_interactive_mas_migration_slackbot_message_after_call:l.send_interactive_mas_migration_slackbot_message_after_call=true;break;case TS.utility.calls.messages_from_call_window_types.update_injection_urls:l.injection_urls=t.data.urls;l.injection_url_resolver();break;case TS.utility.calls.messages_from_call_window_types.dm_call_is_usable:ne(t.data.id);break;default:TS.utility.calls_log.logEvent({event:o.log_events.unknown_msg_from_call_window,value:t});break}else if(t.data.origin_window_type===TS.utility.calls.window_types.incoming_call)switch(t.data.message_type){case TS.utility.calls.messages_from_incoming_call_types.user_clicked_accept_or_reject:TS.utility.calls_log.logEvent({event:o.log_events.incoming_call_click,value:t.data});TS.utility.calls.sendInvitationResponseToCaller({user_id:t.data.user_id,room_id:t.data.room_id,response:t.data.did_accept?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.reject,did_choose_video:t.data.did_choose_video});var i=true;TS.utility.calls.closeIncomingCallWindow(i);break;default:TS.utility.calls_log.logEvent({event:o.log_events.unknown_msg_from_incoming_call_window,value:t});break}else if(t.data.origin_window_type===TS.utility.calls.window_types.mini_panel)switch(t.data.message_type){case TS.utility.calls.messages_from_mini_panel_types.user_clicked_action:TS.utility.calls_log.logEvent({event:o.log_events.mini_panel_click,value:t.data});"mute"===t.data.action||"leave"===t.data.action||"screenhero"===t.data.action||"stop_screenshare"===t.data.action||"doodle"===t.data.action?B({message_type:TS.utility.calls.messages_to_call_window_types.mini_panel_action,action:t.data.action}):"activate"===t.data.action&&TS.interop.desktop.showWindow(l.call_window_token);break;default:TS.utility.calls_log.logEvent({event:o.log_events.unknown_msg_from_mini_panel,value:t});break}}})()},2948:function(e,t){(function(){TS.registerModule("ui.inline_msg_input",{onStart:_.noop,make:function i(a,s){var o=!!(TS.client&&!s.no_emo);var l=TS.templates.inline_message_input({input_id:_.uniqueId("inline_message_input_"),include_emo:o,include_plus_button:s.include_plus_button});var u=$(l);u.appendTo(a);var d=u.find(".message_input");s.placeholder&&TS.utility.contenteditable.placeholder(d,s.placeholder);e(u,d,s);t(u,d);s.include_plus_button&&n(u,s);s.scrollIntoView&&r(u,d);return u}});var e=function e(t,n,r){var i=r.onSubmit||_.noop;var a=r.onCancel||_.noop;TS.utility.contenteditable.create(n,{modules:{msginput:{onUpArrow:function e(){if(!TS.prefs.getPref("arrow_history"))return o(n,false,r)},onUpArrowCmd:function e(){o(n,true,r)}},tabcomplete:{searchOptions:{model_ob:r.model_ob,in_thread:!!r.in_thread},completers:r.completers,positionMenu:function e(t){var i=n.offset();var a=$(window).width()-i.left-2;t.style.width=Math.min(n.outerWidth(),a)+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,n,r.autocomplete_below_input)}}},placeholder:r.placeholder,ariaLabel:r.aria_label,isJumbomojiEnabled:!!r.jumbomoji&&TS.utility.contenteditable.isJumbomojiEnabled,enableBroadcastKeywords:r.enableBroadcastKeywords,onEnter:function e(){TS.client.ui.cal_key_checker.prevent_enter||s(n,t,i);r.onEnter&&r.onEnter();return false},onEscape:function e(){r.onEscape&&r.onEscape()},onTab:function e(){r.onTab&&r.onTab();return true},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(n);r.onTextChange&&r.onTextChange(n)}});TS.utility.contenteditable.enable(n);t.bind("destroyed",function(){a(t)});t.bind("submit",function(e){e.preventDefault();s(n,t,i)})};var t=function e(t,n){var r=t.find(".emo_menu");r.removeClass("hidden");r.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:n})})};var n=function e(t,n){var r=n.model_ob,i=n.thread_ts;t.find(".inline_file_upload").click(function(e){e.preventDefault();TS.menu.file.startWithNewFileOptions(e,$(this),{model_ob_id:r.id,thread_ts:i})})};var r=function e(t,n){t.scrollintoview({duration:500,px_offset:100,complete:function e(){TS.utility.contenteditable.focus(n);TS.utility.contenteditable.setCursorAtEnd(n)}})};var i=function e(t,n){var r=t.closest("ts-message");if(n&&r.length){var i=r.data("ts");var a=TS.utility.msgs.getMsg(i,n.msgs);if(a&&TS.interop.messages.canEditMessage(TS.model.user.id,a,n,TS.prefs.getTeamPref("msg_edit_window_mins")))return a}return null};var a=function e(t,n){var r=TS.msg_edit.isMessageTooLong(t);if(r)return false;if(!$.trim(n))return false;return true};var s=function e(t,n,r){var i={enableBroadcastKeywords:false};var s=TS.utility.contenteditable.value(t);s=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(s,i);a(t,s)&&r(n,s)};var o=function e(t,n,r){var i=jQuery.Event("keydown",{altKey:false,shiftKey:false,which:TS.utility.keymap.up});n&&(TS.model.is_mac?i.metaKey=true:i.ctrlKey=true);if(!TS.client.ui.shouldEventTriggerMaybeEditLast(i,t))return true;l(t,r)};var l=function e(t,n){var r=n.getMsgDivForEditing||i;var a=n.model_ob;var s=r(t,a);if(s&&s.length){var o=s.data("ts");var l=s.data("model-ob-id");a=TS.redux.channels.getEntityById(l);var u=s.closest("#convo_container").length>0;var d=u?"convo":null;TS.msg_edit.startEdit(o,a,d)}}})()},2949:function(e,t){(function(){TS.registerModule("attachment_actions",{action_triggered_sig:new signals.Signal,action_completed_sig:new signals.Signal,onStart:function e(){TS.attachment_actions.action_triggered_sig.add(t);TS.attachment_actions.action_completed_sig.add(n)},getActionContext:function e(t){var n=a(t);var r=TS.utility.msgs.findMsg(n.message_ts,n.channel_id);if(!r)return;var i=_.find(r.attachments,{id:n.attachment_id});if(!i)return;var s=TS.attachment_actions.client_buttons.fetchClientButtonData(r);if(s)return TS.attachment_actions.client_buttons.getActionContext(s,r,i,n);var o=_.find(i.actions,{id:n.action_id});if(!o)return;return{action:o,attachment:i,channel_id:n.channel_id,message:r}},handleActionEventAndGetContext:function e(t){var n=t.data("url");if(n){var r=n.match(/<(.*?)\|/);var i=r?r[1]:n;if(!i)return;if(0===i.indexOf(TS.utility.msgs.new_api_url_prefix))TS.utility.msgs.doNewApiUrl(i);else{var a=TS.model.isSSB()&&parseFloat(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor)>=2.6;var s=TS.interop.url.parseUrl(n);TS.interop.url.isValidSlackHostName(s.hostname)&&"/oauth/authorize"===s.pathname&&a?TS.utility.openAuthenticatedInBrowser(s.pathname+s.search):TS.utility.openInNewTab(n,"_blank",{dontEncodeHash:true})}return}var o=TS.attachment_actions.getActionContext(t);(TS.client.activeChannelIsHidden()||o.channel_id!=TS.shared.legacyGetActiveModelOb().id)&&TS.client.ui.tryToJump(o.channel_id,o.message.ts);return o},confirmAction:function e(t,n,r){var i="danger"===t.style?"btn_danger":"btn_primary";var a=_.defaults(t.confirm,{dismiss_text:TS.interop.i18n.t("Cancel","attachment_actions")(),ok_text:TS.interop.i18n.t("OK","attachment_actions")(),text:"",title:""});a.text?a.text=TS.emoji.graphicReplace(a.text):a.title||(a.text=TS.interop.i18n.t("Are you sure?","attachment_actions")());a.title&&(a.title=TS.emoji.graphicReplace(a.title));TS.generic_dialog.start({title:a.title,body:a.text,show_go_button:true,show_cancel_button:true,go_button_text:a.ok_text,go_button_class:i,cancel_button_text:a.dismiss_text,onGo:n,onCancel:r})},render:function e(t,n,r){if(!t||!n)return;var a=i(t,n);if(!a.length)return;if(!r||a.find(".attachment_actions_interactions").hasClass("attachment_pending")){var s=TS.templates.attachment_actions({attachment:t,message_ts:n});a.html(s);TS.attachment_actions.select.decorateNewElements(a)}},test:function t(){var n={};Object.defineProperty(n,"_getActionContextDataFromDOM",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(n,"_getPendingAttachment",{get:function t(){return e},set:function t(n){e=n}});return n}});function e(e,t){if(!e||!t||!t.length)return;var n=_.map(t,"id");var r=_.cloneDeep(e);r.actions.forEach(function(e){e._disabled=true;e._loading=_.includes(n,e.id)});r._pending=true;return r}function t(t){if(!t||!t.message||!t.attachment||!t.action||!t.channel_id){TS.warn("_onActionTriggered: missing message, attachment, action, or channel_id");return}var n=e(t.attachment,[t.action]);n&&TS.attachment_actions.render(n,t.message.ts);var r=_.clone(t.action);delete r.options;var i={actions:[r],attachment_id:t.attachment.id,callback_id:t.attachment.callback_id,channel_id:t.channel_id,is_ephemeral:t.message.is_ephemeral,message_ts:t.message.ts};var a=_.get(t.message,"bot_profile.team_id",false);a&&(i.team_id=a);var s={payload:JSON.stringify(i),client_token:TS.interop.client_action_token.generateAndEnqueue()};t.message.bot_id&&(s.service_id=t.message.bot_id);t.message.user&&(s.bot_user_id=t.message.user);TS.interop.api.call("chat.attachmentAction",s).then(function(e){TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,is_expecting_ms_update:!!(_.get(e,"data.replaced")||_.get(e,"data.deleted"))})}).catch(function(e){TS.error(e);TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,err:e})})}function n(e){if(!e)return;if(e.err){var t=TS.interop.i18n.t("Oh no, something went wrong. Please try that again.","attachment_actions")();var n={text:_.get(e,"err.data.response")||t,ephemeral_type:_.get(e,"err.data.error")||"attachment_action_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(n)}e.attachment&&e.message_ts&&e.channel_id&&!e.is_expecting_ms_update&&r(e)}function r(e){TS.utility.rAF(function(){var t=TS.utility.attachments.findAttachment({attachment_id:e.attachment.id,message_ts:e.message_ts,channel_id:e.channel_id});t&&TS.attachment_actions.render(t,e.message_ts,true)})}function i(e,t){var n=TS.templates.makeMsgDomId(t);var r="#"+n+", #"+n+"_conversation";return $(r).find("[data-attachment-id="+e.id+"] .attachment_actions")}function a(e){var t=e.parents("[data-attachment-id]");var n=t.parents("ts-message");var r={action_id:String(e.data("action-id")||""),attachment_id:String(t.data("attachment-id")||""),channel_id:String(n.data("model-ob-id")||""),message_ts:String(n.data("ts")||"")};Object.keys(r).forEach(function(e){if(!r[e])throw new Error('Attachment is missing "'+e+'"')});return r}})()},295:function(e,t,n){n(157)("observable")},2950:function(e,t){(function(){TS.registerModule("attachment_actions.select",{onStart:_.noop,decorateNewElements:function e(t){t=t||TS.client.ui.$msgs_div;var n=t.find(".attachment_actions_interactions select:not(.hidden)");n.each(function(){var e=$(this);var t=TS.client?TS.attachment_actions.getActionContext(e):{};var n={adjustAvailableSpaceAbove:d,adjustAvailableSpaceBelow:u,allow_list_position_above:true,classes:"select_attachment",data_promise:m(t),disabled:e.attr("disabled"),errorTemplate:a,filter:o,input_debounce_wait_time:g(t),min_query_length:_.get(t,"action.min_query_length",0),no_default_selection:true,onItemAdded:s,onListShown:l(t),placeholder_text:T(t),filter_placeholder_text:v(t),should_graphic_replace_emoji:true,style:TS.ui.lazy_filter_select.STYLES.filter_in_list,template:S(t)};e.lazyFilterSelect(n).addClass("hidden");y(t,e)})},getActionModel:function e(t,r){var i=n[t.data_source]||n.default;return _.merge({},t,{_disabled:t._disabled||!!r,data_source:i,options:C(t.options),option_groups:x(t.option_groups),text:t.text||b(i)})}});var e={channels:TS.interop.i18n.t("Choose a channel\u2026","attachment_actions")(),conversations:TS.interop.i18n.t("Choose a conversation\u2026","attachment_actions")(),default:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),external:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),users:TS.interop.i18n.t("Choose a person\u2026","attachment_actions")()};var t={channels:TS.interop.i18n.t("Search channels","attachment_actions")(),conversations:TS.interop.i18n.t("Search conversations","attachment_actions")(),default:TS.interop.i18n.t("Filter options","attachment_actions")(),external:TS.interop.i18n.t("Search options","attachment_actions")(),users:TS.interop.i18n.t("Search people","attachment_actions")()};var n={channels:"channels",conversations:"conversations",default:"default",external:"external",users:"users"};var r=250;function i(e,t){var n=_.find(t.attachment.actions,{id:e});n&&(n.selected_options=[])}function a(e){if(!e)return TS.interop.i18n.t("No results.","lazy_filter_select")();return TS.interop.i18n.t("Couldn\u2019t load results.","lazy_filter_select")()}function s(e){if(!TS.client)return;var t=this.$select;var n=TS.attachment_actions.handleActionEventAndGetContext(t);var r=_.get(e,"model_ob.id",e.value);var a=function t(){n.action.selected_options=[{text:e.text,value:r}];var a=i.bind(null,n.action.id);TS.attachment_actions.action_completed_sig.addOnce(a);_.defer(TS.attachment_actions.action_triggered_sig.dispatch,n)};var s=function e(){t.lazyFilterSelect("clearValue")};n.action.confirm?TS.attachment_actions.confirmAction(n.action,a,s):a()}function o(e,t){return _.isEmpty(t)||TS.fuzzy.score(e.text.toLowerCase(),t.toLowerCase())<Infinity}function l(e){var t=_.get(e,"action.data_source");var n=E(e);return function e(){A(t,n)}}function u(e){var t=$("#footer").height()||0;return e-t}function d(e){var t=$("#client_header").height()||0;return e-t}function c(e){var t=_.get(e,"action.data_source");return n[t]||n.default}function m(e){switch(c(e)){case n.channels:return f({channels:{include_archived:false}},{default_query:"#"});case n.conversations:return p();case n.external:return h(e);case n.users:return f({members:{include_self:true}},{default_query:"@"});default:break}}function f(e,t){e=_.defaults(e,{limit:100,sort:{frecency:true}});t=_.defaults(t,{default_query:""});return function(n){n=n||t.default_query;return new Promise(function(t,r){TS.searcher.search(n,e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},r)})}}function p(){return function(e){return new Promise(function(t,n){TS.ui.file_share.promiseToGetFileShareSelectOptions(e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},n)})}}function h(e){return function(t){return new Promise(function(n,r){var i=_.get(e.message,"bot_profile.team_id",false);var a={name:e.action.name,value:t,attachment_id:e.attachment.id,callback_id:e.attachment.callback_id,channel_id:e.channel_id,is_ephemeral:true,message_ts:e.message.ts};i&&(a.team_id=i);TS.interop.api.call("chat.attachmentSuggestion",{service_id:E(e),payload:JSON.stringify(a)}).then(function(e){n({all_items_fetched:true,items:I(e),replace_all_items:true})}).catch(function(e){r(e)})})}}function g(e){if(c(e)!==n.default)return r}function S(e){var t=c(e);if("users"===t)return k;if(_.includes([n.channels,n.conversations],t))return w}function T(e){return _.get(e,"action.text")||b(e)}function v(e){return _.get(t,c(e),t.default)}function b(t){return _.get(e,c(t),e.default)}function y(e,t){if(!$.contains(document,t[0]))return;var r=c(e);var i=_.get(e,"action.selected_options[0]");if(i){var a=_.includes([n.channels,n.conversations,n.users],r);if(a){var s;s=r===n.users?TS.interop.members.getMemberById(i.value):TS.redux.channels.getEntityById(i.value);if(!s)return;i={model_ob:s}}else{i.text=_.unescape(i.text);i.description=_.unescape(i.description);i=M(i)}t.lazyFilterSelect("forceSelectItem",i)}}function w(e){var t=TS.templates.attachment_actions_select_channel_or_conversation_option(e.model_ob);return new Handlebars.SafeString(t)}function k(e){var t=TS.templates.attachment_actions_select_user_option(e.model_ob);return new Handlebars.SafeString(t)}function x(e){if(!e)return;return e.map(function(e){return _.merge({},e,{options:C(e.options),text:e.text&&new Handlebars.SafeString(e.text)})})}function C(e){if(!e)return;return e.map(function(e){return _.merge({},e,{description:e.description&&new Handlebars.SafeString(e.description),text:e.text&&new Handlebars.SafeString(e.text)})})}function I(e){var t=_.get(e,"data.option_groups");if(_.isArray(t))return t.map(function(e){var t=_.get(e,"options",[]).map(function(e){return M(e,{is_group_item:true})});return{lfs_group:true,label:e.text,children:t}});return _.get(e,"data.options",[]).map(M)}function M(e,t){e=_.merge({},e,{is_group_item:_.get(t,"is_group_item")});var n=TS.templates.attachment_actions_select_option(e);var r=$("<div>").html(n);return r.children()[0]}function A(e,t){TS.interop.clog.track("MSG_MENU_OPEN",{data_source:e,service_id:t})}function E(e){if(_.get(e,"attachment.is_app_unfurl"))return e.attachment.bot_id;return _.get(e,"message.bot_id")}})()},2951:function(e,t){(function(){TS.registerModule("attachment_actions.client_buttons",{isClientButtonAttachment:function e(t){if(!t.callback_id)return false;var n=t.callback_id.split("_")[0];return _.includes(c,n)},fetchClientButtonData:function e(t){if(!t||t.bot_id!==u||!t.attachments)return false;return _.find(d,function(e){return e.match(t)})},handleClick:function e(t,n){t.onClick(n)},generateActions:function e(t,n){return t.generate(n)},getActionContext:function e(t,n,r,i){r=TS.attachment_actions.client_buttons.generateActions(t,r);var a={action:_.find(r.actions,{id:i.action_id}),attachment:r,channel_id:i.channel_id,message:n};return a},test:function e(){return{_CLIENT_BUTTON_OPTIONS:d,_generateSharedChannelInvitationActions:t,_generateSharedChannelFindAnAdminAction:i,_generateSharedChannelBetaOptInActions:o}}});var e=function e(t){var n=_.get(t,"attachments[1].callback_id");return!!n&&_.includes(n,this.callback_id_prefix)};var t=function e(t){var n={id:"1",name:"approve",style:"primary",text:TS.interop.i18n.t("View Invitation","shared_channels")(),type:"button",value:"approve"};var r={id:"2",name:"decline",style:"danger",text:TS.interop.i18n.t("Decline","shared_channels")(),type:"button",value:"decline"};return _.assign({},t,{actions:[n,r]})};var n=function e(t){var n=_.get(t,"message.attachments[1].callback_id");if(!_.isString(n)||!_.includes(n,this.callback_id_prefix))return;var r=n.split("_")[1];if(!r)return;if("approve"===t.action.value){TS.interop.clog.trackClickWithContext({event:"SHARED_CHANNELS_SLACKBOT_ADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_VIEW_BTN",contexts:{core:{shared_channels_invite_id:r}}});TS.ui.share_channel_dialog.showApproveRequestDialog(r);TS.model.plan||TS.boot_data.page_needs_enterprise||TS.interop.clog.track("UPGRDEXP_FREE_TRIAL_FOR_SC",{contexts:{ui_context:{step:"slackbot_invitation",action:"click",ui_element:"shared_channels_slackbot_invite_view_btn"}}})}else if("decline"===t.action.value){TS.interop.clog.trackClickWithContext({event:"SHARED_CHANNELS_SLACKBOT_ADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_DECLINE_BTN",contexts:{core:{shared_channels_invite_id:r}}});TS.interop.api.call("conversations.declineSharedInvite",{invite_id:r});TS.model.plan||TS.boot_data.page_needs_enterprise||TS.interop.clog.track("UPGRDEXP_FREE_TRIAL_FOR_SC",{contexts:{ui_context:{step:"slackbot_invitation",action:"decline",ui_element:"shared_channels_slackbot_invite_decline_btn"}}})}};var r=function e(t){var n=_.get(t,"attachments[0].callback_id");return!!n&&_.includes(n,this.callback_id_prefix)};var i=function e(t){var n={id:"1",name:"find_an_admin",style:"primary",text:TS.interop.i18n.t("Who are my admins?","shared_channels")(),type:"button",value:"find_an_admin"};return _.assign({},t,{actions:[n]})};var a=function e(t){var n=_.get(t,"message.attachments[0].callback_id");if(!_.isString(n)||!_.includes(n,this.callback_id_prefix))return;var r=n.split("_")[1];TS.interop.clog.trackClickWithContext({event:"SHARED_CHANNELS_NONADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_FIND_ADMIN_BTN",contexts:{core:{shared_channels_invite_id:r}}});TS.ui.share_channel_dialog.showFindAnAdminDialog()};var s=function e(t){var n=_.get(t,"attachments[0].callback_id");return!!n&&_.includes(n,this.callback_id_prefix)};var o=function e(t){var n={id:"1",name:"opt_in",style:"primary",text:TS.interop.i18n.t("Join the Beta","shared_channels")(),type:"button",value:"opt_in"};var r={id:"2",name:"not_now",style:"default",text:TS.interop.i18n.t("Not Now","web_admin")(),type:"button",value:"not_now"};if(0===TS.prefs.getTeamPref("enable_shared_channels")){t.text=TS.interop.i18n.t(":no_entry_sign: To join later, click on *Shared channels (beta)* in the top-left menu.","shared_channels")();return t}if(1===TS.prefs.getTeamPref("enable_shared_channels")){t.text=TS.interop.i18n.t(":white_check_mark: Your team has joined the Shared Channels beta. To learn more, click on *Shared channels (beta)* in the top-left menu.","shared_channels")();return t}return _.assign({},t,{actions:[n,r]})};var l=function e(t){var n=_.get(t,"message.attachments[0].callback_id");if(!_.isString(n)||!_.includes(n,this.callback_id_prefix))return;"opt_in"===_.get(t,"action.value")?TS.ui.shared_channels_open_beta_modal.showModal():"not_now"===t.action.value&&TS.prefs.setTeamPrefByAPI({enable_shared_channels:0})};var u="B01";var d={shared_channel_invitation:{callback_id_prefix:"sharedchannelsinvite",match:e,generate:t,onClick:n},shared_channel_find_an_admin:{callback_id_prefix:"sharedchannelsfindanadmin",match:r,generate:i,onClick:a},shared_channel_beta_opt_in:{callback_id_prefix:"sharedchannelsbetaoptin",match:s,generate:o,onClick:l}};var c=_.map(d,"callback_id_prefix")})()},2952:function(e,t){(function(){TS.registerModule("utility.enterprise",{getSelf:function e(){return _.get(TS.enterprise.model.get(),"org.user")},splitQueryIntoTerms:function e(t,n,r){var i=n;var a;t=t.trim();if(t.length>=2){i=_.isArray(n)?_.slice(n):[];a=t.split(/\s+/);_.each(a,function(e){i.push({type:r||"fuzzy_with_email",value:e})})}return i},doFormatSearchQuery:function e(t,n,r){n=n||"";var i=[];switch(t){case"members":i.push({type:"is",value:"user"});r&&!_.isEqual(r,"all")&&i.push(TS.utility.enterprise.doFormatMemberFilterClauses(r));break;case"groups":i.push({type:"is",value:"group"});break;case"teams":i.push({type:"is",value:"team"});break;default:}return{query:TS.utility.enterprise.splitQueryIntoTerms(n,i)}},doFormatMemberFilterClauses:function e(t){switch(t){case"admins":return{type:"or",clauses:[{type:"level",value:"admin"},{type:"level",value:"owner"}]};case"guests":return{type:"or",clauses:[{type:"level",value:"restricted"},{type:"level",value:"ultra_restricted"}]};case"members":default:return{type:"level",value:"regular"}}},getSSOProviderLabel:function e(t,n){if(!t)return n;var r=_.get(t,"type","");var i=_.get(t,"name","");var a=""===r;var s="saml"===r;if(a||s)return n;return i||n},getProviderLabel:function e(t,n){var r=n||"IDP";if(!t)return r;n=_.get(t,"saml_provider")||r;"saml"===n.toLowerCase()&&(n=r);return TS.utility.enterprise.getSSOProviderLabel(_.get(t,"sso_provider"),n)},getWorkspaceVisibilityLabel:function e(t){switch(t){case"open":return TS.interop.i18n.t("Open","enterprise_dashboard")();case"unlisted":return TS.interop.i18n.t("Hidden","enterprise_dashboard")();case"closed":return TS.interop.i18n.t("By Request","enterprise_dashboard")();case"invite_only":return TS.interop.i18n.t("Invite Only","enterprise_dashboard")();default:return t}},getGroupsTitle:function e(t){var n=TS.utility.enterprise.getProviderLabel(t);if("IDP"===n)return TS.interop.i18n.t("IDP Groups","enterprise_dashboard")();return TS.interop.i18n.t("{provider_label} Groups","enterprise_dashboard")({provider_label:n})},wrapWithStrongTags:_.wrap(_.escape,function(e,t){return"<strong>"+e(t)+"</strong>"}),buildTeamUrl:function e(t){return"https://"+(t||"my")+"."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},buildOrgUrl:function e(t){return"https://"+t+".enterprise."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},getSanitizedIdpLabel:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.locale,i=void 0===r?TS.interop.i18n.locale:r;return{simple:"IDP"!==t&&t?t:"",your:"IDP"!==t&&t?t:TS.interop.i18n.t("your IdP","enterprise_utility")(),possessive:"IDP"!==t&&t?TS.interop.i18n.fullPossessiveString(t,{locale:i}):TS.interop.i18n.t("your IdP\u2019s","enterprise_utility")()}},formatChannelsData:function e(t){var n=[];if(t.private_channels){t.private_channels=_.isArray(t.private_channels)?t.private_channels:[t.private_channels];n=_.map(t.private_channels,function(e){var t=TS.interop.members.getMemberById(e.creator)||{};var n={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:e.member_count,purpose:e.purpose.value,topic:e.topic.value,private:true};return _({}).assign(e,n).omit("members").value()})}t.channels&&(n=n.concat(_.map(t.channels,function(e){var t=TS.interop.members.getMemberById(e.creator)||{};var n={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:_.get(e,"members.length",0),purpose:_.get(e,"purpose.value",""),topic:_.get(e,"topic.value",""),private:false};return _({}).assign(e,n).omit("members").value()})));return n},pollUntilCondition:function e(t){return new Promise(function(e,n){var r={api_method:null,api_params:{},condition_method:null,interval:5e3,interval_backoff:1e3,attempts_max:10,call_immediately:true};t=_.merge(r,t||{});var i={attempts:0,last_api_response:null,interval:parseInt(t.interval,10)||1e3,interval_backoff:parseInt(t.interval_backoff,10)||0};function a(){if(i.attempts>=t.attempts_max)return n(new Error("Giving up on "+t.api_method+", reached max attempts of "+t.attempts_max));i.attempts+=1;i.interval+=i.interval_backoff;TS.interop.api.call(t.api_method,t.api_params).then(function(n){i.last_api_response=n;if(t.condition_method(n))return e(n);return s()}).catch(function(e){i.last_api_response=e;return s()})}function s(){window.setTimeout(a,i.interval)}if(!t.api_method)return n(new Error("missing required api_method in params"));if(!t.condition_method)return n(new Error("missing required condition_method in params"));t.call_immediately?a():s()})},getUserRoleLabel:function e(t,n){var r;var i;r=n?{primary_owner:TS.interop.i18n.t("Primary Org Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Org Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Org Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()}:{primary_owner:TS.interop.i18n.t("Primary Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()};i=t.is_ultra_restricted?r.single_channel_guest:t.is_restricted?r.multi_channel_guest:t.is_primary_owner?r.primary_owner:t.is_owner?r.owner:t.is_admin?r.admin:r.member;return i},buildAnalyticsApiOptionsFor:function e(t){var n=function e(t){return _.reduce(t,function(e,t,n){var r=TS.enterprise.model.get(["analytics",t]);r&&(e[n]=r);return e},{})};switch(t){case"teams":return n({query:"teams_search_term",sort_prefix:"teams_sort_prefix",sort_dir:"teams_sort_dir",cursor_mark:"teams_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"team_overview":return n({date_range:"current_date_range",start_date:"start_date",end_date:"end_date",team_id:"team_overview_id"});case"members":return n({query:"members_search_term",sort_prefix:"members_sort_prefix",sort_dir:"members_sort_dir",cursor_mark:"members_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"channels":return n({query:"channels_search_term",sort_prefix:"channels_sort_prefix",sort_dir:"channels_sort_dir",cursor_mark:"channels_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});default:return n({date_range:"current_date_range",start_date:"start_date",end_date:"end_date"})}},maybeGetUpdatedAtTime:function e(t){return t?TS.interop.datetime.toTimeAgo(t):null},getObjectsForIds:function e(t,n){if(_.isEmpty(t)||_.isEmpty(n))return[];return _.intersectionWith(t,n,function(e,t){return e.id===t})},getQueryForIds:function e(t){if(_.isEmpty(t))return;if(1===t.length)return{query:{type:"id",value:_.head(t)}};return{query:{type:"or",clauses:_.map(t,function(e){return{type:"id",value:e}})}}},buildApiOptionsForAnalyticsCSVExport:function e(t){var n={};t.type&&(n.type=t.type);t.date_range&&(n.date_range=t.date_range);_.get(t.selected_columns,"length")&&(n.cols=t.selected_columns.join(","));t.team_id&&(n.team_id=t.team_id);if(t.sort_prefix){n.sort_prefix=t.sort_prefix;t.sort_dir&&(n.sort_dir=t.sort_dir)}if(t.search_term){var r=TS.utility.enterprise.splitQueryIntoTerms(t.search_term,[],"fuzzy_with_email");if(r.length){var i=1===r.length?_.head(r):{type:"and",clauses:r};n.query=JSON.stringify(i)}}return n},recordAnalyticsPricingEvents:function e(t,n,r){r=r||{};var i={};switch(n){case"overview_impression":i.action="impression";i.step="team_stats_overview";break;case"coachmark_impression":i.action="impression";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";break;case"coachmark_resolve":i.action="click";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";i.ui_element="learn_more_btn";break;case"coachmark_reject":i.action="dismiss";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";i.ui_element="skip_this";break;case"msg_files_pricing_btn_click":i.action="click";i.step="team_stats_overview";i.ui_element="msg_files_chart_link_btn";break;case"single_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element=_.get(r,"callout_module")+"_upgrade_link";break;case"multi_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element="multi_lim_upgrade_link";break;case"data_table_upsell_banner_impression":i.action="impression";i.step="team_stats_"+_.get(r,"report_name");break;case"data_table_upsell_banner_click":i.action="click";i.step="team_stats_"+_.get(r,"report_name");i.ui_element="see_pricing_plans_btn";break;default:}TS.interop.clog.track(t,{contexts:{ui_context:i}})},recordAnalyticsImpression:function e(t,n,r,i,a){var s="ENTERPRISE_ANALYTICS";var o={};var l={};o.action="impression";o.ui_element=n;l.entity_key=r;l.tracking_code=i;l.anchor_page=t;l.target_team_id=a||(TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id"));TS.interop.clog.track(s,_.assign({},l,{contexts:{ui_context:o}}))},recordAnalyticsTooltipHover:function e(t){var n="ENTERPRISE_ANALYTICS";var r={};var i={};r.action="hover";r.ui_element="NOTING_BADGE";i.entity_key=t;var a=TS.enterprise.model.get("org.enterprise.id");var s=TS.enterprise.model.get("analytics.overview_open");if(a&&!s){i.anchor_page="organization_overview";i.target_team_id=a}else if(s){i.anchor_page="workspace_overview";i.target_team_id=TS.enterprise.model.get("analytics.team_overview_id")}else{i.anchor_page="workspace_overview";i.target_team_id=_.get(TS.boot_data,"team_id")}TS.interop.clog.track(n,_.assign({},i,{contexts:{ui_context:r}}))},recordAnalyticsSearchEvent:function e(t,n,r){var i="ENTERPRISE_ANALYTICS";var a={};var s={};a.action="impression";a.action_status=r?2:1;a.ui_element="SEARCH_BAR";s.entity_key=n;s.anchor_page=t;s.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.interop.clog.track(i,_.assign({},s,{contexts:{ui_context:a}}))},convertDateRangeToThriftID:function e(t){switch(t){case"30d":return"FILTER_LAST_30DAYS";case"all":return"FILTER_ALL_TIME";default:}},convertTimeseriesTabToClogKey:function e(t){switch(t){case"active-users_weekly_active_users":return"wau_ts";case"active-users_daily_active_users":return"dau_ts";case"messages-and-files_messages_sent":return"messages_sent_ts";case"messages-and-files_files_uploaded":return"files_uploaded_ts";case"transparency_where_messages_sent":return"transparency_sent_ts";case"transparency_where_messages_read":return"transparency_read_ts";default:}},getNumberAnnotation:function e(t){var n="";if("ja-JP"===TS.interop.i18n.locale)switch(t){case"channels":case"messages":n="\u4ef6";break;case"users":n="\u4eba";break;case"files":case"apps":n="\u500b";break;default:}return n}})})()},2953:function(e,t){(function(){TS.registerModule("replies",{thread_marked_sig:new signals.Signal,thread_subscription_changed_sig:new signals.Signal,sanity_check_failed_sig:new signals.Signal,thread_synced_sig:new signals.Signal,reply_changed_sig:new signals.Signal,reply_deleted_sig:new signals.Signal,DEFAULT_HISTORY_API_LIMIT:100,onStart:function e(){TS.channels.message_received_sig.add(d);TS.groups.message_received_sig.add(d);TS.ims.message_received_sig.add(d);TS.mpims.message_received_sig.add(d);TS.channels.message_removed_sig.add(u);TS.groups.message_removed_sig.add(u);TS.ims.message_removed_sig.add(u);TS.mpims.message_removed_sig.add(u);TS.channels.message_changed_sig.add(l);TS.groups.message_changed_sig.add(l);TS.ims.message_changed_sig.add(l);TS.mpims.message_changed_sig.add(l);TS.redux.socket.connectedSig.add(o)},canReplyToMsg:function e(t,n,r){if(!TS.client)return false;if(!n)return false;if(TS.interop.rules.messages.isAutomatedSubtype(n.subtype))return false;if(TS.interop.rules.messages.isFile(n))return false;if(TS.interop.rules.messages.isTempMsg(n)||n.is_ephemeral)return false;if(TS.interop.messages.isReply(n))return false;if(TS.interop.channels.isImWithDeletedMember(t))return false;if(!r&&t.is_channel&&!t.is_member)return false;return true},getMessage:function e(t,n){var r=TS.utility.msgs.getMsg(n,t.msgs)||TS.utility.msgs.getMsg(n,t._archive_msgs);if(r)return r;if(TS.ui.replies)return TS.ui.replies.getActiveMessage(t,n);return null},getThread:function t(n,r,i){if(!i){var a=c(n,r);if(a){m(n,r)&&f(n,r,a);return Promise.resolve(a)}}var s={channel:n,thread_ts:r};var o={D:"im.replies",C:"channels.replies",G:"groups.replies"};var l=n[0];var u=o[l];if(!u){TS.error("Unable to get thread for message in unsupported model object type with ID"+n);return Promise.reject(new Error("missing api endpoint"))}var d=p(n,r);if(e[d])return e[d];TS.has_pri[T]&&(i?TS.log(T,"Calling "+u+" for "+r+" because always_make_api_call"):TS.log(T,"Calling "+u+" for "+r+" because local history is incomplete"));e[d]=TS.interop.api.call(u,s).then(function(e){var t=e.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,n)});h(n,t);var i=TS.redux.channels.getEntityById(n);if(i&&i.msgs&&i.msgs.length){var a=_.filter(i.msgs,function(e){return e.thread_ts===r&&TS.interop.rules.messages.isTempMsg(e)});a.length&&(t=_.sortBy(t.concat(a),"ts"))}g(i,t);return t}).finally(function(){delete e[d]});return e[d]},getThreadLazy:function n(r,i,s,o){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"getThreadLazy";if(!o){var u=c(r,i);if(u){m(r,i)&&f(r,i,u,s);var d=_.find(u,{ts:i});return Promise.resolve({root_msg:d,messages:u,has_more_beginning:false,has_more_end:false})}}var h=TS.redux.channels.getEntityById(r);var g=a(h);TS.has_pri[T]&&(o?TS.log(T,"Calling "+g+" for "+i+" because always_make_api_call"):TS.log(T,"Calling "+g+" for "+i+" because local history is incomplete"));var S=p(r,i);if(s){if(t[S])return t[S];t[S]=TS.replies.getThreadBefore(r,i,null,false,l).then(function(e){e.has_more_beginning=e.has_more;e.has_more_end=false;return e}).finally(function(){delete t[S]});return t[S]}if(e[S])return e[S];e[S]=TS.replies.getThreadAfter(r,i,null,false,l).then(function(e){e.has_more_beginning=false;e.has_more_end=e.has_more;return e}).finally(function(){delete e[S]});return e[S]},getThreadBefore:function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"getThreadBefore";var l={channel:t,thread_ts:n,count:TS.replies.DEFAULT_HISTORY_API_LIMIT,_x_reason:o};if(r){l.latest=r;i&&(l.inclusive=i)}var u=TS.redux.channels.getEntityById(t);var d=a(u);return TS.interop.api.call(d,l).then(function(e){var t=s(u,n,e);t.has_more||t.messages.unshift(t.root_msg);return t})},getThreadAfter:function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"getThreadAfter";var l={channel:t,thread_ts:n,count:TS.replies.DEFAULT_HISTORY_API_LIMIT,_x_reason:o};var u=false;if(r){l.oldest=r;i&&(l.inclusive=i)}else{u=true;l.oldest=n;l.inclusive=true}var d=TS.redux.channels.getEntityById(t);var c=a(d);return TS.interop.api.call(c,l).then(function(e){var t=s(d,n,e);u&&t.messages.unshift(t.root_msg);return t})},getThreadAround:function e(t,n,r){var i=c(t,n);if(i){var a=false;m(t,n)&&f(t,n,i,a);var s=_.find(i,{ts:n});return Promise.resolve({root_msg:s,messages:i,has_more_beginning:false,has_more_end:false})}var o=TS.replies.getThreadBefore(t,n,r);var l=TS.replies.getThreadAfter(t,n,r,true);return Promise.join(o,l,function(e,t){var n=e.has_more;var r=t.has_more;var i=e.messages.concat(t.messages);n||i.unshift(e.root_msg);return{has_more_beginning:n,has_more_end:r,messages:i,root_msg:e.root_msg}})},requestOfflineThread:function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"requestOfflineThread";if(!TS.boot_data.feature_degraded_send)return Promise.resolve();var i=TS.redux.channels.getEntityById(t);if(!i)return Promise.reject(new Error("Unknown model_ob in requestOfflineThread: "+t));var a=true;var s=true;return TS.replies.getThreadLazy(t,n,a,s,r).then(function(e){if(!e||!e.messages)return;if(TS.interop.redux.features.socket.isConnected(TS.redux.getState()))return;var t=e.messages,n=e.has_more_beginning,r=e.has_more_end,a=e.root_msg;t.forEach(function(e){TS.interop.sendMessage.resolveMessage(TS.redux.getState,TS.redux.dispatch,e,e)});a&&TS.redux.dispatch(TS.interop.redux.models.messages.addMessages([a]));TS.replies.dispatchThreadSyncedSig(i,a,t,n,r)}).catch(function(e){TS.console.error("Failed to fetch offline history for "+t+"-"+n+": "+e)})},dispatchThreadSyncedSig:function e(t,n,r,i,a){TS.replies.thread_synced_sig.dispatch(t,n,r,i,a)},getSubscriptionState:function e(t,n){var i=p(t,n);var a=r[i];return a},promiseToGetSubscriptionState:function i(a,s){var o=p(a,s);var l=r[o];if(l)return Promise.resolve(l);var u=e[o]||t[o];if(u)return u.then(function(){return TS.replies.getSubscriptionState(a,s)});if(n[o])return n[o];n[o]=TS.interop.api.call("subscriptions.thread.get",{channel:a,thread_ts:s}).then(function(e){var t=e.data.subscriptions;var n=_.includes(t,s);var i={model_ob_id:a,thread_ts:s,subscribed:n};r[o]=i;return i}).finally(function(){delete n[o]});return n[o]},markThread:function e(t,n,a,s){var o=p(t,n);var l=r[o];if(l&&l.last_read===a)return Promise.resolve();if(l){l._pending||(l._pending={});if(l._pending[a])return;l._pending[a]=true}var u=function e(){TS.has_pri[T]&&TS.log(T,"subscriptions.thread.mark "+n+" -> "+a);return TS.interop.api.call("subscriptions.thread.mark",{channel:t,thread_ts:n,ts:a}).finally(function(){l&&l._pending&&delete l._pending[a]})};if(s){TS.has_pri[T]&&TS.log(T,"Queuing thread mark "+n+" -> "+a);i&&i();i=u}else u()},updateThreadStateReceived:function e(){if(i){i();i=null}},markAllThreads:function e(t){var n={};t&&(n.max_ts=t);return TS.interop.api.call("subscriptions.thread.clearAll",n)},threadMarked:function e(t,n,i,a){var s=p(t,n);var o=r[s];if(o){o.last_read=i;o.unread_count=a}TS.replies.thread_marked_sig.dispatch(t,n,o)},threadSubscribed:function e(t,n,r){var i=S(t,n,true,r);TS.replies.thread_subscription_changed_sig.dispatch(t,n,i)},threadUnsubscribed:function e(t,n,r){var i=S(t,n,false,r);TS.replies.thread_subscription_changed_sig.dispatch(t,n,i)},setSubscriptionState:function e(t,n,i,a){var s=TS.redux.channels.getEntityById(t);if(!s)return;var o=p(t,n);var l=r[o];l&&(l.subscribed=i);var u={channel:t,thread_ts:n};a&&(u.last_read=a);if(i)return TS.interop.api.call("subscriptions.thread.add",u);var d=TS.replies.getMessage(s,n);if(d&&!d.thread_ts){u.preemptive_remove=true;TS.replies.thread_subscription_changed_sig.dispatch(t,n,l)}return TS.interop.api.call("subscriptions.thread.remove",u)},maybeSlurpSubscriptionState:function e(t,n){return h(t,n)},updateThreadBroadcastRoots:function e(t,n){var r=t.msgs;if(!r||!r.length)return;_.forEach(r,function(e){if(e.ts===n.ts)return;if(e.thread_ts!==n.ts)return;if("thread_broadcast"!==e.subtype||!e.root)return;e.root=n;t.is_channel?TS.channels.message_changed_sig.dispatch(t,e):t.is_im?TS.ims.message_changed_sig.dispatch(t,e):t.is_group&&t.is_mpim?TS.mpims.message_changed_sig.dispatch(t,e):t.is_group&&!t.is_mpim&&TS.groups.message_changed_sig.dispatch(t,e)})},test:function e(){return{processRepliesHistoryResponse:s}}});var e={};var t={};var n={};var r={};var i=null;var a=function e(t){if(t.is_channel)return"channels.replies";if(t.is_im)return"im.replies";return"groups.replies"};var s=function e(t,n,r){var i=r.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,t.id)});var a=!!r.data.has_more;h(t.id,i);var s={};TS.boot_data.feature_degraded_send&&i.forEach(function(e){e.client_msg_id&&(s[e.client_msg_id]=e)});if(t&&t.msgs&&t.msgs.length){var o=_.filter(t.msgs,function(e){return e.thread_ts===n&&TS.interop.rules.messages.isTempMsg(e)&&!(e.client_msg_id&&s[e.client_msg_id])});o.length&&(i=_.sortBy(i.concat(o),"ts"))}g(t,i);var l=_.find(i,{ts:n});l&&(i=_.without(i,l));return{messages:i,has_more:a,root_msg:l}};var o=function e(t){if(t)return;r&&_(r).values().forEach(function(e){delete e.sanity_check_status})};var l=function e(t,n){var r=TS.replies.getSubscriptionState(t.id,n.ts);var i=false===_.get(r,"sanity_check_status");if(i){TS.has_pri[T]&&TS.log(T,"Clearing previous sanity check failure for "+n.ts);delete r.sanity_check_status}TS.replies.reply_changed_sig.dispatch(t,n)};var u=function e(t,n){TS.replies.reply_deleted_sig.dispatch(t,n)};var d=function e(t,n){l(t,n)};var c=function e(t,n){var r=TS.redux.channels.getEntityById(t);if(!r)return;if(r.is_channel&&!r.is_member)return;var i=TS.replies.getSubscriptionState(t,n);var a=false===_.get(i,"sanity_check_status");if(a){TS.has_pri[T]&&TS.log(T,"Sanity check for "+n+" failed earlier, not using local messages");return}var s;var o;if(!o){s=r.msgs;o=TS.utility.msgs.getMsg(n,s)}if(!o){s=r._archive_msgs;o=TS.utility.msgs.getMsg(n,s)}if(!o)return;var l=s.filter(function(e){return e.ts==n||e.thread_ts==n});var u=l.filter(function(e){return!e.is_ephemeral&&!TS.interop.rules.messages.isTempMsg(e)});var d=o.reply_count||0;if(u.length<d+1)return;return _.sortBy(l,"ts")};var m=function e(t,n){if(TS.boot_data.feature_degraded_send)return true;if(!TS.redux.socket.isConnected()||TS.interop.api.isPaused())return false;var r=TS.replies.getSubscriptionState(t,n);var i=_.get(r,"sanity_check_status",false);if(i){TS.has_pri[T]&&TS.log(T,"Skipping sanity check for "+n+" because it passed previously");return false}return true};var f=function e(t,n,r,i){r=r.filter(function(e){return!e.is_ephemeral&&!TS.interop.rules.messages.isTempMsg(e)});var a=true;TS.replies.getThreadLazy(t,n,i,a).then(function(e){var i=e.messages;e.has_more_beginning?r=_.takeRight(r,i.length):e.has_more_end&&(r=_.take(r,i.length));var a=_.map(r,"ts");var s=_.map(i,"ts");var o=_.map(r,"text");var l;l=TS.boot_data.feature_degraded_send?_.map(i,"text"):_.map(r,"text");var u=TS.replies.getSubscriptionState(t,n);if(_.isEqual(a,s)&&_.isEqual(o,l)){TS.has_pri[T]&&TS.log(T,"Replies sanity check passed for "+n);u&&(u.sanity_check_status=true);return}var d=_.intersection(a,s);var c=_.difference(s,d);var m=_.difference(a,d);if(0==m.length&&c.length>0){var f=_(i).filter(function(e){return"tombstone"===e.subtype}).map("ts").value();var p=_.isEqual(c.sort(),f.sort());if(p){TS.has_pri[T]&&TS.log(T,"Replies sanity check passed (except tombstones) for "+n);TS.metrics.count("replies_sanity_check_passed_except_tombstones");return}}if(m.length>0&&0==c.length){var h=_.max(s);var g=_.every(m,function(e){return e>h});if(g){TS.has_pri[T]&&TS.log(T,"Replies sanity check passed (except newer local msgs) for "+n);TS.metrics.count("replies_sanity_check_passed_except_newer_local_msgs");return}}var S={version_ts:TS.boot_data.version_ts,channel_id:t,thread_ts:n,messages_from_api:s,messages_from_model_ob:a};TS.warn("Replies sanity check failed. Here's the debug info: "+JSON.stringify(S));TS.metrics.count("replies_sanity_check_failed");u&&(u.sanity_check_status=false);var v=TS.redux.channels.getEntityById(t);if(!v)return;var b=TS.replies.getMessage(v,n);if(!b)return;TS.replies.sanity_check_failed_sig.dispatch(v,b,i,e.has_more_beginning,e.has_more_end);return null});return null};var p=function e(t,n){return t+"_"+n};var h=function e(t,n){n.forEach(function(e){if(!e.hasOwnProperty("_subscribed"))return;var n=p(t,e.ts);r[n]&&r[n].last_read?e._last_read&&e._last_read>r[n].last_read&&(r[n].last_read=e._last_read):r[n]={model_ob_id:t,thread_ts:e.ts,subscribed:e._subscribed,last_read:e._last_read,unread_count:e._unread_count}})};var g=function e(t,n){if(!t||!t.msgs||!n||!n.length)return;var r=_.find(n,TS.utility.msgs.msgHasReplies);if(!r||r.ts!==r.thread_ts)return;var i=_.differenceBy(n,t.msgs,"ts");if(!i.length)return;var a=t.msgs.concat(i);TS.utility.msgs.setMsgs(t,a)};var S=function e(t,n,i,a){var s=p(t,n);var o=r[s];if(o)o.subscribed=i;else{o={subscribed:i,model_ob_id:t,thread_ts:n};r[s]=o}a.last_read&&(o.last_read=a.last_read);a.unread_count&&(o.unread_count=a.unread_count);return o};var T=2004})()},2954:function(e,t){(function(){TS.registerModule("ui.thread",{expanded_threads:{},buildThreadHTML:function e(n,r){try{var i=n.model_ob;var a=n.root_msg;var u=n.replies;var d=[];if(n.max_visible_ts){var c=_.takeWhile(u,function(e){return e.ts<=n.max_visible_ts});d=_.drop(u,c.length);u=c}var m="thread_"+i.id+"_"+n.ts.replace(".","_");var f;i.is_im&&(f=TS.interop.members.getMemberById(i.user));var p=TS.replies.getSubscriptionState(i.id,a.thread_ts);var h=p&&p.subscribed;var g=s(n);var S;var T;if(g>=TS.replies.DEFAULT_HISTORY_API_LIMIT){S=o(n);T=l(n)}var v=TS.templates.thread({id:m,ts:n.ts,model_ob:i,thread:n,root_msg:a,conversation_permalink:TS.utility.msgs.constructConversationPermalink(i,a.ts),channel_msg_permalink:TS.utility.msgs.constructMsgPermalink(i,a.ts),replies:u,new_replies:d,new_replies_count:t(d.length),im_user:f,is_subscribed:h,options:r||{},view_previous_count:g,visible_reply_count:S,total_reply_count:T});return v}catch(e){TS.error("Threads view: error rendering thread");TS.console.logError(e,"threads_view_error");return""}},updateThreadWithMessage:function e(t,s,o,l){var u=t.find('ts-message[data-ts="'+o.ts+'"]');var d;var c={};var _=t.attr("data-context");"inline"===_&&(c.inline=true);d=TS.templates.builders.buildThreadMsgHTML(o,s.model_ob,s,c);var m=$(d);if(u.length){u.hasClass("hidden")&&m.addClass("hidden");u.replaceWith(m)}else if(l){var f=t.find(".thread_replies_container");var p=t.find(".new_replies_container ts-message");f.append(p);if(TS.boot_data.feature_degraded_send){var h=false;f.find("ts-message").each(function(){var e=$(this);var t=e.attr("data-ts");if(t>o.ts){m.insertBefore(e);h=true}});h||f.append(m)}else f.append(m);n(t,false)}else{t.find(".new_replies_container").append(m);r(s,t)}if(TS.interop.messages.isReply(o))o.is_ephemeral&&i(s,t,o);else{a(s,t,o);i(s,t,o)}TS.attachment_actions.select.decorateNewElements(t);g(s,t)},removeMessageFromThread:function e(t,n,a){var s=$("#"+TS.templates.makeMsgDomIdInThreadsView(a.ts));if(!s.length)return;a.is_pending?s.remove():s.addClass("delete_mode").slideUp(200,function(){s.remove()});r(n,t);g(n,t);a.is_ephemeral&&i(n,t)},revealNewReplies:function e(t,r){return new Promise(function(e){var s=t.find(".new_reply_indicator");var o=t.find(".thread_replies_container");var l=t.find(".new_replies_container");s.animate({height:0},150,function(){n(t,false);s.css("height","");var r=o.height();o.height(r);o.css("overflow","hidden");var i=l.find("ts-message");i.appendTo(o);o.css("height","auto");var a=o.height();o.height(r).animate({height:a},300,function(){l.css("height","");o.css("height","");o.css("overflow","");e()})});a(r,t,r.root_msg);i(r,t)})},revealPreviousReplies:function e(t,n,r){var o={};var l=t.attr("data-context");"inline"===l&&(o.inline=true);return new Promise(function(e,l){r.then(function(){var r=s(n);var l=t.find(".view_all_replies_container");var u=function s(){if(r){TS.ui.thread.hideThreadLoadingSpinner(t);a(n,t,n.root_msg)}else l.remove();i(n,t);var u=t.find(".thread_replies_container");var d=u.find("ts-message:first");var c=$("<div></div>");d.length?d.before(c):u.append(c);var m=_.takeWhile(n.replies,function(e){return e.ts<n.min_visible_ts});_.forEach(m,function(e){c.append(TS.templates.builders.buildThreadMsgHTML(e,n.model_ob,n,o))});TS.attachment_actions.select.decorateNewElements(t);var f=c.height();c.height(0).animate({height:f},300,function(){var t=c.find("ts-message");d.length?t.insertBefore(d):t.appendTo(u);c.remove();e()})};l.length&&!r?l.animate({height:0},150,u):u()},function(){p(t);l()})})},renderReplyInput:function e(t,n){var r=n.model_ob;var i=n.root_msg.ts;var a=t.find(".reply_input_container");a.empty();var s=TS.permissions.members.canPostInModelOb(r);TS.boot_data.feature_default_shared_channels&&!s&&(s=TS.permissions.members.canThread(r));if(!s||r.is_archived){c(r,a);return}if(!TS.replies.canReplyToMsg(r,n.root_msg)){r.is_channel&&!r.is_member?m(r,a):t.addClass("no_reply_container");return}var o=TS.boot_data.feature_file_threads;o&&a.addClass("upload_in_threads");TS.ui.inline_msg_input.make(a,{placeholder:TS.interop.i18n.t("Reply...","threads")(),aria_label:TS.interop.i18n.t("Reply...","threads")(),enableBroadcastKeywords:false,complete_cmds:true,in_thread:true,model_ob:r,thread_ts:i,jumbomoji:TS.utility.contenteditable.isJumbomojiEnabled,include_plus_button:o,onSubmit:function e(s,o){if(!TS.redux.socket.isConnected()&&!TS.boot_data.feature_degraded_send||!TS.interop.connectivity.isOnline()&&TS.boot_data.feature_degraded_send)return;if(r.is_archived){TS.generic_dialog.alert(TS.interop.i18n.t("This channel has been archived; you cannot send messages to it.","threads")());return}var l=_.last(n.replies);n.max_visible_ts&&(l=_.findLast(n.replies,function(e){return e.ts<=n.max_visible_ts}));var d=TS.client.ui.maybeHandleReactionCmd(l,o,function(){u(a,r,i)});if(d)return;if(TS.interop.slashCommand.looksLikeSlashCommand(o)){u(a,r,i);TS.client.ui.sendSlashCommand(r,o,n.root_msg)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",r.id,i);var c=a.find(".reply_broadcast_toggle").prop("checked");u(a,r,i);var m=TS.ui.thread.getContextForEl(t);var f=c?"THREADS_REPLY_BROADCAST_CLICKED":"THREADS_REPLY";var p=_.get(n,".root_msg.reply_count",0)+1;TS.ui.thread.trackEvent(r.id,n.root_msg.ts,m,f,{num_msg_in_thread:p});c&&TS.log(2004,"Submitting broadcast from threads view for "+r.id+"-"+n.root_msg.ts);TS.client.ui.sendMessage(r,o,n.root_msg,c)}return null},getMsgDivForEditing:function e(){var r=t.closest("ts-thread");var i=n.replies;var a=_.reject(i,function(e){return"tombstone"===e.subtype});"tombstone"!==n.root_msg.subtype&&a.unshift(n.root_msg);_.reverse(a);var s=TS.interop.rules.messages.getLastMessageByMember(a,TS.model.user.id);if(!s)return null;return r.find('ts-message[data-ts="'+s.ts+'"]')},onTextChange:function e(t){var n=TS.utility.contenteditable.value(t);var s=!n.trim();var o=s?"":n;TS.storage.storeReplyInput(r.id,i,o);f(a)}});var l=a.find(".message_input");l.on("focusin",function(){a.addClass("has_focus")}).on("focusout",function(){var e=TS.utility.contenteditable.isEmpty(l,true);var t=document.activeElement===this;e&&!t&&a.removeClass("has_focus")});d(r,i,a);var p=TS.storage.fetchReplyInput(r.id,i);if(p){TS.utility.populateInput(l,p);a.addClass("has_focus")}},joinChannelFromThread:function e(t,n){var r=n.closest("ts-thread");if(!r.length)return;var i=r.data("model-ob-id");var a=TS.redux.channels.getEntityById(i);if(!a)return;TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:a.id,inBackground:true})).catch(_.noop);r.find(".join_channel_from_thread").addClass("disabled")},submitReply:function e(t,n){if(!n||0===n.length)return;var r=n.closest(".reply_input_container").find("form");if(0===r.length)return;r.submit()},findAndPopulateInput:function e(t,n,r){if(!n||!r)return;var i='ts-thread[data-model-ob-id="'+n+'"][data-thread-ts="'+r+'"]';var a=$(i).find(".message_input");TS.utility.populateInput(a,t);TS.storage.storeReplyInput(n,r,t)},showThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_loading_container");n.html(TS.templates.infinite_spinner({size:"small"}))},hideThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_loading_container");n.empty()},startInlineThread:function t(n,r){e(n.id,r.ts,true);TS.view.rebuildMsg(r)},expandInlineThread:function t(n){var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");var a=TS.redux.channels.getEntityById(r);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;var o={model_ob:a,root_msg:s,replies:[],ts:s.ts};TS.ui.utility.preventElementFromScrolling(n.find(".message_content"),function(){n.addClass("expanded")});TS.ui.thread.renderReplyInput(n,o);var l=TS.replies.getThread(r,i).then(function(e){var t=Infinity;o.replies&&o.replies.length&&(t=_.first(o.replies).ts);o.min_visible_ts=t;var n=_.filter(e,function(e){return e.ts!==s.ts});o.replies=n});TS.ui.thread.revealPreviousReplies(n,o,l);e(r,i,true);return null},collapseInlineThread:function t(n){var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");var a=TS.redux.channels.getEntityById(r);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;if(!TS.utility.msgs.msgHasReplies(s)){e(r,i,false);TS.view.rebuildMsg(s);return}var o=n.find(".thread_replies_container");o.animate({height:0},300,function(){o.css("height","");o.find("ts-message").remove();TS.ui.utility.preventElementFromScrolling(n.find(".message_content"),function(){n.removeClass("expanded")})});n.find(".reply_input_container").html(TS.templates.thread_inline_input_placeholder({model_ob:a,root_msg:s,conversation_permalink:TS.utility.msgs.constructConversationPermalink(a,s.ts),num_total_threads:s.reply_count}));e(r,i,false)},isThreadExpanded:function e(t,n){return!!TS.ui.thread.expanded_threads[t+n]},isMessageBeingConvertedToThread:function e(t,n){return!TS.utility.msgs.msgHasReplies(n)&&!TS.interop.messages.isReply(n)&&TS.ui.thread.isThreadExpanded(t,n.ts)},makeInlineThread:function e(t,n){var r=TS.redux.channels.getEntityById(t);if(!r)return null;var i=TS.utility.msgs.getMsg(n,r.msgs);if(!i)return null;var a={model_ob:r,root_msg:i,replies:[],ts:i.ts};if(TS.ui.thread.isThreadExpanded(t,n)){var s=_.filter(r.msgs,function(e){return e.ts!==n&&e.thread_ts===n});a.replies=s}return a},trackEvent:function e(t,n,r,i,a){if(!t||!n||!r){TS.error("error collecting clog data for threads");return}var s=h(t,n,r,a);"threads_view"===r&&TS.client.ui.threads.incrementTrackingSeqId();TS.interop.clog.track(i,s)},getTrackingPayloadForEl:function e(t,n){var r={};var i=TS.ui.thread.getContextForEl(t);if("threads_view"!==i&&"convo"!==i)return r;var a=t.closest("ts-thread, ts-conversation");if(!a.length)return r;var s=a.attr("data-model-ob-id");var o=a.attr("data-thread-ts");if(!s||!o)return r;return h(s,o,i,n)},getContextForEl:function e(t){if(t.closest("#threads_msgs").length>0)return"threads_view";if(t.closest("#convo_tab").length>0)return"convo";if(t.closest("#msgs_scroller_div").length>0)return"message_pane";if(t.closest("#unread_msgs_scroller_div").length>0)return"unreads_view";return"other"}});var e=function e(t,n,r){TS.ui.thread.expanded_threads[t+n]=r};var t=function e(t){return TS.interop.i18n.t("{reply_count,plural,=1{{reply_count} new reply}other{{reply_count} new replies}}","threads")({reply_count:t})};var n=function e(t,n){var r=t.find(".thread_messages");var i="show_new_reply_indicator";n?r.addClass(i):r.removeClass(i)};var r=function e(r,i){if(!r||!i||!i.length)return;var a=_.reduce(r.replies,function(e,t){t.ts>r.max_visible_ts&&(e+=1);return e},0);var s=i.find(".new_reply_indicator");var o=s.find(".reveal_new_replies");if(a<=0){n(i,false);o.empty();return}var l=t(a);o.text(l);n(i,true)};var i=function e(t,n){if(!t||!n||!n.length)return;var r=n.find(".visible_reply_count");if(s(t)>=TS.replies.DEFAULT_HISTORY_API_LIMIT){var i=o(t);var a=l(t);var u=TS.interop.i18n.t("{visible_reply_count} of {total_reply_count}","threads")({visible_reply_count:i,total_reply_count:a});r.text(u)}else r.text("")};var a=function e(t,n,r){if(!n||!n.length||!r)return;if(!r.replies&&!r.reply_count)return;var i=n.find(".view_all_replies_container");if(!i.length)return;var a=i.find(".view_all_replies");var o=s(t);if(!o){i.addClass("hidden");return}var l=TS.interop.i18n.t("Show {reply_count,plural,=1{{reply_count} more reply}other{{reply_count} more replies}}","threads","8f851c7d35df7273168c88882f54d31083402b7e")({reply_count:o});a.text(l)};var s=function e(t){var n=t.root_msg.reply_count;var r=t.replies;if(r&&r.length){var i=_.filter(r,function(e){return!e.is_ephemeral&&!TS.interop.rules.messages.isTempMsg(e)}).length;n=t.root_msg.reply_count-i;n=Math.min(TS.replies.DEFAULT_HISTORY_API_LIMIT,n)}if(n<0){TS.error("Ignoring negative previous reply count for "+t.ts);return 0}return n};var o=function e(t){var n;n=t.max_visible_ts?_.reduce(t.replies,function(e,n){n.ts<=t.max_visible_ts&&(e+=1);return e},0):_.get(t,".replies",[]).length;return n};var l=function e(t){var n=_.filter(t.replies,function(e){return e.is_ephemeral||TS.interop.rules.messages.isTempMsg(e)}).length;var r;r=t&&t.root_msg&&t.root_msg.reply_count?_.get(t,"root_msg.reply_count",0)+n:_.get(t,"root_msg.replies.length",0)+n;return r};var u=function e(t,n,r){var i=t.find(".message_input");TS.utility.populateInput(i,"",0);TS.utility.contenteditable.clearHistory($("#reply_container .message_input"));TS.storage.storeReplyInput(n.id,r,"");t.find(".reply_broadcast_toggle").prop("checked",false)};var d=function e(t,n,r){if(!t||!n||!r||0===r.length)return;var i=TS.permissions.members.canPostInChannel(t);r.append(TS.templates.reply_broadcast_buttons({model_ob:t,label_id:n,view:"threads",can_post_back_to_channel:i}));var a=r.find(".reply_broadcast_label_container, .reply_send");var s=r.find(".message_input");a.mousedown(function(e){e.preventDefault();TS.utility.contenteditable.focus(s)}).click(function(){TS.utility.contenteditable.focus(s)})};var c=function e(t,n){n.html(TS.templates.reply_limited({channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t),is_archived:t.is_archived}))};var m=function e(t,n){n.html(TS.templates.join_channel_from_thread({model_ob_name:t.name,is_threads_view:true}))};var f=function e(t){var n=t.find(".message_input");var r=!!TS.msg_edit.isMessageTooLong(n);t.find(".reply_container_info").toggleClass("hidden",r)};var p=function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_replies_container");var r=n.find(".view_all_loading_container");var i=n.find(".view_all_error_msg");var a=n.find(".view_all_replies");r.empty();i.removeClass("hidden");var s=TS.interop.i18n.t("Try Again","threads")();a.removeClass("active").text(s)};var h=function e(t,n,r,i){if(!t||!n||!r){TS.error("error collecting clog data for threads");return}var a={parent_message_id:n,channel_id:t,is_threads_view:"threads_view"===r?1:0,is_flexpane:"convo"===r?1:0};"threads_view"===r&&_.merge(a,TS.client.ui.threads.getTrackingData());i&&(a=_.merge(a,i));return a};var g=function e(t,n){var r=TS.templates.builders.buildThreadParticipantListHTML(t.root_msg);n.find(".thread_participants").html(r)}})()},2955:function(e,t){(function(){TS.registerModule("ui.react_emoji_menu",{is_showing:false,onStart:function e(){TS.prefs.emoji_mode_changed_sig.add(w)},start:function e(t){c(t)}});var e=15;var t=0;var n=-6;var r="top-left";var i="reactroot_emoji_picker";var a;var s;var o="#msg_input";var l;var u;var d;var c=function e(t){l=t.rxn_key;u=l?function e(n){var r=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t.rxn_key),n);TS.rxns.changeRxnsFromUserAction(t.rxn_key,n,r);t.callback&&t.callback()}:t.callback;o=!l&&(t.input_to_fill||o);if(TS.client&&TS.utility.contenteditable.isDisabled(o))return;var n=t.position;var r=TS.client&&o===TS.client.ui.$msg_input;var i=_.get(TS,"model.ui_state.flex_visible");r&&i&&(n="top-right");s=$(t.e&&t.e.target);p({open:true,is_rxn:!!l});TS.tips.hideAll();TS.boot_data.feature_emoji_picker_frecently_used&&TS.emoji.replaceFrecentlyUsed();d=t.target_bounds||s.dimensions_rect();var a=window.pageYOffset;d.top+=a;d.bottom+=a;TS.ui.react_emoji_menu.is_showing=true;var c={};var m={position:n,offset_x:t.offset_x,offset_y:t.offset_y};f(c,m);TS.model.is_our_app&&TS.interop.desktop.areDragRegionsRequired()&&_.get(window,"desktop.app.updateDragRegion")&&window.desktop.app.updateDragRegion([])};var m=function e(){p({open:false,is_rxn:!!l});s=null;o="#msg_input";l=null;u=null;_handy_rxns=null;TS.tips.unhideAll();TS.ui.react_emoji_menu.is_showing=false;f();TS.model.is_our_app&&TS.interop.desktop.areDragRegionsRequired()&&TS.client.channel_header.calculateNoDragRegions()};var f=function e(t,n){var r=S(t);var i=T(n);TS.metrics.mark("react_emoji_menu_render_mark");a||(a=k());TS.interop.mountEmojiPicker(TS.boot_data.team_id,a,r,i)};var p=function e(t){if(t.is_rxn){s.closest(".menu_rxn").toggleClass("active",t.open);s.closest(".rxn_panel").toggleClass("active",t.open);s.closest("ts-message").toggleClass("active",t.open);s.toggleClass("active",t.open)}else{s.closest(".emo_menu").toggleClass("active",t.open);s.closest(".handy_rxns_row").toggleClass("active",t.open);s.closest(".current_status_emoji_picker").toggleClass("active",t.open)}};var h=function e(t,n){var r=$(o);var i=n.display_name||n.name;var a=!(t&&t.shiftKey);if(TS.interop.utility.isContentEditableElement(r))if(TS.utility.contenteditable.inlineEmojiIsEnabled()){var s=TS.interop.texty.convertContentsStringToContents(n.name,{shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});setTimeout(TS.utility.contenteditable.insertContentsAtCursor,0,r,s,a)}else setTimeout(TS.utility.contenteditable.insertTextAtCursor,0,r,i,a);else{var l=TS.utility.contenteditable.cursorPosition(r).start;var u=l+i.length;var d=TS.utility.contenteditable.value(r);var c=d.substr(0,l)+i+d.substr(l);TS.utility.populateInput(r,c);a&&setTimeout(TS.utility.contenteditable.cursorPosition,0,o,u)}};var g=function e(t,n){if(TS.boot_data.feature_sonic_emoji)return;var r=_.find(TS.model.emoji_map,{name_with_colons:TS.emoji.stripLocalizedSkinTone(t.name)});n&&(n=n.replace(/^:/,""));r&&TS.ui.frecency.record(r,n)};var S=function e(){var t={onSkinToneChanged:y,groups:TS.model.emoji_groups,onSelected:v,onClosed:b,emojiMap:TS.model.emoji_map,showHandyReactions:!!l};return t};var T=function i(a){a=a||{};return{targetBounds:d,allowanceX:e,allowanceY:e,position:a.position||r,offsetX:_.isUndefined(a.offset_x)?t:a.offset_x,offsetY:_.isUndefined(a.offset_y)?n:a.offset_y,isOpen:TS.ui.react_emoji_menu.is_showing,onClose:b,ariaRole:"dialog",ariaLabel:TS.interop.i18n.t("Emoji picker dialog","emoji_picker")()}};var v=function e(t,n,r){g(n,r);if(u){setTimeout(u,0,n.name);return}if(!o)return TS.error("Could not find an _input_to_fill.");h(t,n)};var b=function e(){m()};var y=function e(t){TS.prefs.legacyOnPrefChanged({name:"preferred_skin_tone",value:t});TS.prefs.setPrefByAPI({name:"preferred_skin_tone",value:t});TS.boot_data.feature_emoji_picker_frecently_used&&TS.emoji.replaceFrecentlyUsed();if(TS.ui.react_emoji_menu.is_showing){var n={skin_tone_id:t};f(n)}};var w=function e(){TS.ui.react_emoji_menu.is_showing&&_.defer(f)};var k=function e(){if(!document.getElementById(i)){var t=document.createElement("div");t.setAttribute("id",i);document.body.appendChild(t)}return document.getElementById(i)}})()},2956:function(e,t){(function(){var e="reactroot_menu";var t=15;var n;var r;TS.registerModule("ui.react_menu",{is_showing:false,start:function e(n){TS.ui.react_menu.is_showing&&TS.ui.react_menu.end({skip_unmount:true});TS.ui.react_menu.is_showing=true;TS.tips.hideAll();r=n.on_end;var i=$(n.e&&n.e.target);var s=n.target_bounds||i.dimensions_rect();var o={template:n.template,onMenuItemSelected:TS.ui.react_menu.end,onTriggerClose:TS.ui.react_menu.end};var l={targetBounds:s,position:n.position,allowanceX:n.allowance_x||t,allowanceY:n.allowance_y||t,offsetX:n.offset_x,offsetY:n.offset_y,isOpen:TS.ui.react_menu.is_showing,onClose:TS.ui.react_menu.end};a(o,l)},end:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};TS.tips.unhideAll();TS.ui.react_menu.is_showing=false;_.isFunction(r)&&r();r=void 0;var i=Promise.resolve();t.skip_unmount||i.then(function(){if(n){TS.interop.unmountMenu(n);document.body.removeChild(n);n=void 0}});return i}});var i=function t(){if(!document.getElementById(e)){var n=document.createElement("div");n.setAttribute("id",e);document.body.appendChild(n)}return document.getElementById(e)};var a=function e(t,r){n||(n=i());TS.interop.mountMenu(TS.boot_data.team_id,n,t,r)}})()},2957:function(e,t){(function(){TS.registerModule("ui.react_message_menu",{onStart:function t(){e=document.getElementById(s)},showMessageMenu:function n(r,i){var a=i.channel,s=i.message,l=i.message_container_type;t=$(r&&r.target);var u="";l===TS.interop.constants.MESSAGE_CONTAINERS.THREADS_FLEXPANE&&(u="convo");TS.redux.dispatch(TS.interop.redux.models.messages.addMessages([s]));var d={channelId:a.id,ts:s.ts,messageContainerType:l,onSelectAction:function e(t,n){var r=TS.interop.mountMessageActionsMenu.actionIds;if(n.id===r.editMessage){TS.msg_edit.startEdit(s.ts,a,u);return true}if(n.id===r.markUnread&&TS.model.unread_view_is_showing){TS.client.ui.unread.setUnreadPoint(s.ts);return true}return false},onTriggerClose:TS.ui.react_message_menu.closeMessageMenu,onMenuItemSelected:TS.ui.react_message_menu.closeMessageMenu};var c=o();t.closest("ts-message").addClass("active");TS.interop.mountMessageActionsMenu(TS.redux.getState().teamId,e,d,c)},closeMessageMenu:function n(){if(t){t.closest("ts-message").removeClass("active");t=null}TS.interop.mountMessageActionsMenu(TS.redux.getState().teamId,e,{},{isOpen:false})}});var e=void 0;var t=void 0;var n=15;var r=46;var i="right-bottom";var a={x:4,y:-8};var s="message_actions_menu_mount_point";var o=function e(){return{targetBounds:t?t.dimensions_rect():{},position:i,allowanceX:r,allowanceY:n,offsetX:a.x,offsetY:a.y,isOpen:true,onClose:TS.ui.react_message_menu.closeMessageMenu}}})()},2958:function(e,t){(function(){TS.registerModule("ui.a11y",{focus_stack:[],unread_message_strings:{},$aria_live_div:null,zoom_level_changed_sig:new signals.Signal,zoomPercentToLevel:function t(n){return e[n]},zoomLevelToPercent:function e(n){return t[n]},onStart:function e(){a();f();h();TS.channels.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.ims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.groups.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.mpims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.prefs.a11y_animations_changed_sig.add(TS.ui.a11y.replaceAnimatedImages);$(document).on("focus","input[placeholder],textarea[placeholder]",function(e){i($(e.target))});$(document).on("blur","input[placeholder],textarea[placeholder]",function(e){i($(e.target))})},focusOnNextMessage:function e(){var t=$(document.activeElement);var r;var i=t.is(n);r=i&&t.next().length?t.next():o();TS.ui.a11y.focusAndAddTabindex(r)},focusOnPreviousMessage:function e(){var t=$(document.activeElement);var r;var i=l();var a=t.is(n);r=a&&t.prev().length?t.prev():a&&TS.model.archive_view_is_showing?o():t.is("#end_display_meta")?o():i.children(n).length&&i.children(n).last()?i.children(n).last():o();TS.ui.a11y.focusAndAddTabindex(r)},focusOnOldestUnreadMessage:function e(){TS.ui.a11y.ariaLiveAnnounce(TS.interop.i18n.t("No unread messages.","a11y")(),true)},focusOnMessageInput:function e(){TS.ui.a11y.focusAndAddTabindex(o())},focusAndAddTabindex:function e(t){if(!t)return;t.attr("tabindex")&&t.data("previous-tabindex",t.attr("tabindex"));t.attr("tabindex","0");t.focus()},cleanUpTabindex:function e(t){if(!t)return;t.data("previous-tabindex")?t.attr("tabindex",t.data("previous-tabindex")):t.removeAttr("tabindex")},saveCurrentFocus:function e(){TS.ui.a11y.focus_stack.push(document.activeElement);return document.activeElement},saveCurrentFocusAndFocusOnElement:function e(t){var n=TS.ui.a11y.saveCurrentFocus();TS.ui.a11y.focusAndAddTabindex(t);return n},restorePreviousFocus:function e(){var t=TS.ui.a11y.focus_stack.pop();if(t&&"function"===typeof t.focus){t.focus();return t}},restorePreviousFocusAndCleanUpElement:function e(t){var n=TS.ui.a11y.restorePreviousFocus();TS.ui.a11y.cleanUpTabindex(t);return n},ariaLiveAnnounce:function e(t,n){TS.ui.a11y.$aria_live_div.empty();TS.ui.a11y.$aria_live_div.attr("aria-live",n?"assertive":"polite");TS.ui.a11y.$aria_live_div.text(t)},assembleActiveModelName:function e(){var t=TS.shared.legacyGetActiveModelOb();var n="";TS.model.unread_view_is_showing?n=TS.interop.i18n.t("All unreads","a11y")():TS.model.threads_view_is_showing?n=TS.interop.i18n.t("Threads","a11y")():t.is_channel?n=TS.interop.i18n.t("Channel #{model_name}","a11y")({model_name:t.name}):t.is_im?n=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.interop.members.getPrefCompliantMemberNameById(t.user)}):t.is_mpim?n=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.mpims.legacyGetDisplayName(t)}):t.is_group&&(n=TS.interop.i18n.t("Private Channel {model_name}","a11y")({model_name:t.name}));return n},saveUnreadCountMessage:function e(t,n){if(!t||!t.name||!n)return;TS.ui.a11y.unread_message_strings[t.name]=n},annouceCurrentChannelOrImOrGroup:function e(){var t=TS.ui.a11y.assembleActiveModelName();var n=t;var r=TS.shared.legacyGetActiveModelOb();if(!r)return;if(TS.model.archive_view_is_showing){TS.ui.a11y.focusAndAddTabindex(o());return}if(TS.ui.a11y.unread_message_strings[r.name]){n+=", "+TS.ui.a11y.unread_message_strings[r.name];delete TS.ui.a11y.unread_message_strings[r.name]}TS.ui.a11y.ariaLiveAnnounce(n,true)},resetMessageInput:function e(){TS.client.msg_input.$input.trigger("autosize-resizeIncludeStyle");TS.client.msg_input.resized();TS.view.onResize()},replaceAnimatedImages:function e(){TS.ui.a11y.replaceAnimatedFiles();TS.ui.a11y.replaceEmoji()},replaceAnimatedFiles:function e(){var t=TS.prefs.getPref("a11y_animations");var n;var i;if(r){c();return}var a=TS.utility.msgs.getDisplayedMsgs(TS.shared.legacyGetActiveModelOb().msgs);var s;if(false===t)for(s=0;s<a.length;s+=1)if(a[s].file){n=a[s].file;if("gif"===n.filetype){n.deanimate_gif?i=n.deanimate_gif:n.thumb_160&&(i=n.thumb_160);i&&u(n.id,i)}else"space"===n.filetype&&c(a[s].ts)}else a[s].attachments&&d(a[s].ts,a[s].attachments[0]);else for(s=0;s<a.length;s+=1)if(a[s].file){n=a[s].file;if("gif"===n.filetype){n.thumb_360_gif?i=n.thumb_360_gif:n.thumb_360&&(i=n.thumb_360);i&&u(n.id,i)}else"space"===n.filetype&&c(a[s].ts)}else a[s].attachments&&d(a[s].ts,a[s].attachments[0])},replaceEmoji:function e(){var t=emoji;var n=$(".emoji:not(.stop_animations)");var r;for(var i=0;i<n.length;i+=1){var a=t.replace_colons(n[i].innerText);if(!a){var s=":"+n[i].parentNode.getAttribute("data-emoji")+":";a=t.replace_colons(s)}a&&a.match(/.+background-image:url\((.+)\).*/)&&(r=a.match(/.+background-image:url\((.+)\).*/)[1]);n[i].style.backgroundImage='url("'+r+'")'}TS.emoji.makeMenuLists()},getContrastColor:function e(t){var n=false;t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(t){var r=parseInt(t[1],16);var i=parseInt(t[2],16);var a=parseInt(t[3],16);var s=(299*r+587*i+114*a)/1e3;n=s>=128?"#000000":"#FFFFFF"}return n},test:function e(){return{createAriaLiveElement:a,destroyAriaLiveElement:s,getMessageInputElement:o,getMessageDivElement:l}}});var e={70:"-3",80:"-2",90:"-1",normal:"0",110:"1",125:"2",150:"3"};var t=Object.keys(e).reduce(function(t,n){t[e[n]]=n;return t},{});var n=".message, .day_divider, .unread_divider";var r=TS.web&&TS.web.space;var i=function e(t){var n=t.attr("placeholder");var r=t.attr("aria-label")||"";var i=!!r.length;var a=!!t.val().trim().length;if(a&&!i&&n.length){t.attr("aria-label",n);return}!a&&i&&r==n&&t.removeAttr("aria-label")};var a=function e(){TS.ui.a11y.$aria_live_div=$('<div id="aria_live_announcer" role="status"></div>');$("body").append(TS.ui.a11y.$aria_live_div);return TS.ui.a11y.$aria_live_div};var s=function e(){TS.ui.a11y.$aria_live_div.remove();delete TS.ui.a11y.$aria_live_div};var o=function e(){return TS.model.archive_view_is_showing&&TS.client.archives.not_member?$("#footer_archives"):TS.client.ui.$msg_input};var l=function e(){return TS.model.archive_view_is_showing?TS.client.archives.$archives_msgs_div:TS.client.ui.$msgs_div};var u=function e(t,n){var r=$('.image_gif[data-file-id="'+t+'"]');r.attr("data-src",n);r.find(".image_bg").attr("data-real-background-image",n);r.find(".image_bg").css("backgroundImage","url("+n+")");r.find("img").data("real-src",n);r.find("img").attr("src",n)};var d=function e(t,n){if(!n)return;if(n.is_animated||n.image_url&&n.image_url.match(/\.gifv?$/)){var r=$('.message[data-ts="'+t+'"]');var i=r.find(".msg_inline_img img");var a=false===TS.prefs.getPref("a11y_animations")?TS.utility.getImgProxyURL(n.image_url,n.image_width,n.image_height):n.image_url;_(i,a)}};var c=function e(t){var n=r?$("ts-space .msg_inline_img img"):$('.message[data-ts="'+t+'"] .post_container .msg_inline_img img');$.each(n,function(){var e=$(this);var t=TS.utility.getImgProxyURL(e.attr("src"));_(e,t)})};var _=function e(t,n){t.attr({"data-real-src":n,src:n});var r=t.closest(".msg_inline_img");r.attr("data-real-background-image",n);r.css("backgroundImage","url("+n+")")};var m;var f=function e(){if(!TS.model.is_electron)return;m=TS.interop.desktop.getZoom();$(window).on("resize",p)};var p=function e(){var t=TS.interop.desktop.getZoom();if(m!=t){m=t;TS.ui.a11y.zoom_level_changed_sig.dispatch({zoom_level:t})}};var h=function e(){if(!TS.model.is_electron)return;$("body").append('<div class="zoom_level_indicator hidden"></div>');TS.ui.a11y.zoom_level_changed_sig.add(T)};var g=function e(n){var r=t[n]||"100";var i="normal"===r?"100":r;var a=TS.interop.i18n.t("zoom: <strong>{zoom_percentage}%</strong>","a11y")({zoom_percentage:i});$(".zoom_level_indicator").html(a)};var S;var T=function e(t){if(TS._incremental_boot||$("body").hasClass("loading"))return;var n=$(".prefs_modal.active");if(n.length&&n.find(".a11y_pref_zoom").length)return;if(S){clearTimeout(S);S=null}g(t.zoom_level);var r=$(".zoom_level_indicator");r.insertAfter(document.body.lastElementChild);r.removeClass("hidden").show(0);var i=r.outerWidth()/2;var a="calc(50vw - "+i+"px)";r.css("left",a);S=setTimeout(function(){r.fadeOut(100)},1e3)}})()},2959:function(e,t){(function(){var e=10;var t=10;var n=100;var r=100;var i=33;var a=100;TS.registerComponent("SearchableEnterpriseTeamList",{_constructor:function e(t){this.id=t.id;this.triggered_by_user_action=t.triggered_by_user_action;this.$_container=t.$container;this.$_long_list_view;this.$_search_bar;this.$_search_input;this.$_clear_icon;this._team_searcher={};this._have_all_teams=false;this._model_ob_id=t.model_ob_id;this._omit_my_team=!!t.omit_my_team;this._current_query="";this._approx_item_height=30;this._long_list_view_height=0;this._long_list_view_items_height=0;this._long_list_view_initial_height=null;this._fetch_page_p=null;this._resize_sig_handler=null;this.team_clicked_sig=new signals.Signal},destroy:function e(){this._resize_sig_handler&&TS.view&&TS.view.resize_sig.remove(this._resize_sig_handler);this.$_container.off();this.$_long_list_view&&this.$_long_list_view.off();this.$_search_input&&this.$_search_input.off();this.$_clear_icon&&this.$_clear_icon.off();this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView")&&this.$_long_list_view.longListView("destroy");this.$_search_bar&&this.$_search_bar.remove()},showInitial:function e(){var t=this;this.$_long_list_view=this.$_container.find(".p-searchable_enterprise_team_list__scroller");this._showLoadingState();this._fetchPage().then(function(){t._hideLoadingState()}).then(function(){t._setupLongListView();t._maybeSetupSearchBar();return null})},maybeRerenderLongListView:function e(){this.$_long_list_view&&_.get(this._team_searcher,"items")&&this.$_long_list_view.longListView("setItems",this._team_searcher.items,true,true)},_fetchPage:function e(){if(this._fetch_page_p)return this._fetch_page_p;var t=this;this._setupSearcher();this._fetch_page_p=TS.teams.promiseToSearchTeams(this._team_searcher).then(function(){t._fetch_page_p=null;t._have_all_teams=t._team_searcher.num_remaining<=0});return this._fetch_page_p},_setupSearcher:function e(){this._team_searcher.max_api_results=this._current_query?n:t;var r=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);this._team_searcher.included_ids=TS.interop.utility.looksLikeMemberId(_.get(r,"id"))?_.get(r,"enterprise_user.teams",[]):_.get(r,"shared_team_ids",[]);_.get(TS.model.user,"is_restricted")&&(this._team_searcher.included_ids=_.intersection(_.get(TS.model.user,"enterprise_user.teams"),this._team_searcher.included_ids));this._omit_my_team&&(this._team_searcher.omitted_ids=[TS.model.team.id]);this._current_query&&(this._team_searcher.query=this._current_query)},_fetchProcessAndDisplayPage:function e(){var t=this;return this._fetchPage().then(function(){t._maybeHideNoResultsState();_.get(t._team_searcher,"items.length")?t.$_long_list_view.longListView("setItems",t._team_searcher.items,true,true):t._showNoResultsState();return null}).then(function(){TS.utility.rAF(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._recursivelyFillLongListViewToHeight()});return null})},_maybeSetupSearchBar:function t(){var n=this;if(this.$_search_bar)return;var r=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);var i;i=TS.interop.utility.looksLikeMemberId(_.get(r,"id"))?_.get(r,"enterprise_user.teams.length"):_.get(r,"is_global_shared")?Infinity:_.get(r,"shared_team_ids.length");if(i>=e){n.$_long_list_view.before(TS.templates.teams_search_bar());n.$_search_bar=n.$_container.find(".p-searchable_enterprise_team_list__search_bar");n.$_search_input=n.$_search_bar.find(".p-searchable_enterprise_team_list__input");n._setupSearchInput()}},_setupSearchInput:function e(){var t=this;this.$_search_bar.find(".p-searchable_enterprise_team_list__search.loading").replaceWith(TS.templates.teams_search_bar_input());this.$_search_input=this.$_search_bar.find(".p-searchable_enterprise_team_list__input");this.$_clear_icon=this.$_container.find(".icon_close");this.$_search_input.bind("keyup.searchable_enterprise_team_list",this._handleSearchKeyUp.bind(this));this.$_clear_icon.bind("click",function(){t._reset();Promise.resolve().then(function(){t.$_search_input.focus();return null})});this.triggered_by_user_action&&this.$_search_input.focus()},_setupLongListView:function e(){var t=this;var n=TS.interop.utility.looksLikeMemberId(this._model_ob_id);this.$_long_list_view.longListView({items:this._team_searcher.items||[],approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function e(t){return t.outerHeight()},makeElement:function e(){return $(TS.templates.teams_list_item())},renderItem:function e(r,i){var a=TS.model.team.id!==i.id;var s=n&&a;r.html(TS.templates.teams_team_row({team:i,linked:!!s&&t._buildTeamLink(i),target:s?t._buildTeamLinkTarget(i):""}));TS.utility.makeSureAllLinksHaveTargets(r)}});this.$_long_list_view.on("click","[data-long-list-item]",function(e){t.team_clicked_sig.dispatch(e,TS.teams.getTeamById($(e.target).closest(".p-enterprise_team_item").find("[data-team-id]").data("teamId")))});this._resize_sig_handler=_.throttle(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._long_list_view_initial_height||(t._long_list_view_initial_height=t._long_list_view_height)},i);TS.view&&TS.view.resize_sig.add(this._resize_sig_handler);this.$_long_list_view.on("scroll",_.debounce(function(e){if(t._current_query)return;var n=t._long_list_view_items_height-($(e.target).scrollTop()+t._long_list_view_height);n<r&&t._fetchProcessAndDisplayPage()},a));TS.utility.rAF(function(){TS.view&&TS.view.resizeManually("TS.SearchableEnterpriseTeamList.showInitial");t._recursivelyFillLongListViewToHeight()})},_recursivelyFillLongListViewToHeight:function e(){var t=this;if(this._current_query)return;this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_teams&&this._fetchProcessAndDisplayPage().then(function(){t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height()})},_reset:function e(){this._team_searcher={};this._current_query="";this.$_search_input.val("");this.$_clear_icon.addClass("hidden");this._have_all_teams=false;this._maybeHideNoResultsState();this.$_long_list_view.longListView("setItems",[],true,true);this.$_long_list_view.scrollTop(0);this.$_long_list_view.height(this._long_list_view_initial_height);this._fetchProcessAndDisplayPage()},_showLoadingState:function e(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function e(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function e(){var t=this.$_container.find(".no_results");t.length>0&&t.remove();var n=this;var r={query:this._current_query};var i=TS.templates.teams_searchable_no_results(r);this.$_long_list_view.hide().before(i);this.$_container.on("click",".clear_enterprise_team_filter",function(){n._reset()})},_maybeHideNoResultsState:function e(){var t=this.$_container.find(".no_results");if(0==t.length)return;var n=this.$_container.find(".other_matches");n&&n.remove();t.remove();this.$_long_list_view.show()},_handleSearchKeyUp:function e(t){var n=$(t.target).val();if(n.trim()!==this._current_query){if(this._fetch_page_p){this._fetch_page_p.cancel();this._fetch_page_p=null}this._team_searcher={};this._have_all_teams=false;this._current_query=n.trim();this._fetchProcessAndDisplayPage();this.$_long_list_view.scrollTop(0);this.$_clear_icon.toggleClass("hidden",!this._current_query)}},_buildTeamLink:function e(t){return TS.utility.enterprise.buildTeamUrl(t.domain)+(TS.client?"messages":"home")},_buildTeamLinkTarget:function e(t){return TS.client?"_self":TS.utility.enterprise.buildTeamUrl(t.domain)},test:function r(){var i={};Object.defineProperty(i,"MINIMUM_TEAMS_FOR_SEARCH",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(i,"FETCH_PAGE_SIZE",{get:function e(){return t},set:function e(n){t=n}});Object.defineProperty(i,"FETCH_PAGE_SIZE_SEARCH",{get:function e(){return n},set:function e(t){n=t}});return i}})})()},296:function(e,t,n){e.exports={default:n(330),__esModule:true}},2960:function(e,t){(function(){TS.registerModule("ui.enterprise_teams_dialog",{show:function e(t){a(t)},test:function e(){var t={};Object.defineProperty(t,"_showTeamsDialog",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"_getTeamsDialogChannelTitle",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(t,"_getTeamsDialogMemberTitle",{get:function e(){return o},set:function e(t){o=t}});return t}});var e="p-enterprise_teams_dialog";var t="enterprise_team_dialog";var n=null;function r(e){$(window.document).bind("keydown",i);var n=$(".p-searchable_enterprise_team_list");var r=new TS.SearchableEnterpriseTeamList({$container:n,id:t,model_ob_id:e.id,triggered_by_user_action:true});r.showInitial();n.on("click",".p-enterprise_team_row",TS.generic_dialog.cancel)}var i=function e(t){t.which==TS.utility.keymap.esc&&""===TS.generic_dialog.div.find("input").val()&&TS.generic_dialog.cancel()};var a=function a(l){var u=_.get(l,"id");if(n===u)return;n=u;var d=TS.templates.enterprise_teams_dialog();var c=TS.interop.utility.looksLikeMemberId(_.get(l,"id"));var m;if(c&&!_.get(l,"enterprise_user.teams.length"))return;if(!c&&!l.is_global_shared&&!_.get(l,"shared_team_ids.length"))return;m=c?o(l):s(l);TS.generic_dialog.start({dialog_class:e,title:m,body:d,cancel_button_text:TS.interop.i18n.t("Close","teams")(),hide_footer:true,show_cancel_button:true,show_go_button:false,backdrop_click_to_dismiss:true,onShow:function e(){r(l)},onEnd:function e(){var r=TS.SearchableEnterpriseTeamList.get(t);r&&r.destroy();TS.generic_dialog.div.remove();TS.generic_dialog.div=void 0;$(window.document).unbind("keydown",i);n=null}})};var s=function e(t){return t.is_global_shared?TS.interop.i18n.t("All workspaces in {channel_name}","teams")({channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t)}):TS.interop.i18n.t("{team_count, number} workspaces in {channel_name}","teams")({team_count:_.get(t,"shared_team_ids.length"),channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t)})};var o=function e(t){return TS.interop.i18n.t("Your {enterprise_name} workspaces","teams")({enterprise_name:_.escape(_.get(t,"enterprise_user.enterprise_name"))})}})()},2961:function(e,t){(function(){TS.registerModule("searcher",{search:function t(n,r){r.tiered?TS.metrics.mark("ts-searcher-search-tiered-mark"):TS.metrics.mark("ts-searcher-search-mark");r.limit?r.limit_option={limit:r.limit}:r.limit_option={limit:e};if(r.members){true===r.members&&(r.members=_.cloneDeep(i));var a=r.members,o=a.include_teambot,l=a.include_slackbot;_.isUndefined(o)&&(r.members.include_teambot=l)}var u=g(n,r);if(r.tiered){var d=s(n,r);d.promise=u;return Promise.resolve(d).finally(function(){TS.metrics.measureAndClear("ts-searcher-search-tiered","ts-searcher-search-tiered-mark")})}return u.finally(function(){TS.metrics.measureAndClear("ts-searcher-search","ts-searcher-search-mark")})},test:function e(){return{count:k}}});var e=24;var t={prefer_exact_match:true,frecency:true,prefer_channels_user_belongs_to:true};var n={include_archived:true,only_if_member:false};var r={include_archived:true};var i={include_self:false,include_slackbot:true,include_bots:true,only_local_team:false,only_admins:false};var a={include_deleted:false};var s=function e(n,r){x(r);var i={};r.members&&(i.members=o(r.members));r.channels&&(i.channels=l(r.channels));r.groups&&(i.groups=u(r.groups));r.all_mpims&&(i.all_mpims=TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim));r.mpims&&(i.mpims=TS.redux.channels.dangerouslyGetMpims());r.teams&&(i.teams=d(r.teams));r.usergroups&&(i.usergroups=c(r.usergroups));r.views&&(i.views=m(r.views));if(r.enterprise_channels){i.enterprise_channels=f();i.enterprise_groups=p()}r.app_actions&&TS.interop.apps.isGlobalActionsEnabled()&&(i.app_actions=h());r.filter&&(i=r.filter(i));if(false!==r.sort){var a=w(r.sort,r.limit_option,t);return TS.sorter.search(n,i,a)}return i};var o=function e(t){t=w(t,i);return TS.members.getMembersWithOptions(t)};var l=function e(t){t=w(t,n);var r;r=TS.redux.channels.dangerouslyGetPublicChannels({includeFromAnotherTeam:t.include_from_another_team});t.include_archived||(r=_.reject(r,"is_archived"));t.exclude_required&&(r=_.reject(r,TS.interop.rules.channels.isRequired));t.only_if_member&&(r=_.filter(r,"is_member"));t.can_post&&(r=_.filter(r,TS.permissions.members.canPostInModelOb));TS.boot_data.feature_cross_workspace_quick_switcher_prototype&&(r=_.reject(r,{is_moved:1,is_archived:true}));return r};var u=function e(t){t=w(t,r);var n=TS.redux.channels.dangerouslyGetPrivateChannels({includeFromAnotherTeam:t.include_from_another_team});t.include_archived||(n=_.reject(n,"is_archived"));TS.boot_data.feature_cross_workspace_quick_switcher_prototype&&(n=_.reject(n,{is_moved:1,is_archived:true}));return n};var d=function e(){var t=_.map(TS.boot_data.other_accounts,function(e){return TS.teams.getTeamById(e.team_id)});var n=[];!TS.boot_data.page_needs_enterprise||TS.model.is_our_app&&!TS.interop.environment.isSSBAndAtLeastVersion("2.8")||(n=_.values(TS.teams.getEnterpriseTeams({only_member_of:true,exclude_current_team:true})));return _.uniqBy(n.concat(t),"id")};var c=function e(){return TS.interop.userGroups.getActiveUserGroups().slice()};var m=function e(){var t=[];TS.client.unread.isEnabled()&&t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_unreads"}));t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"}));TS.interop.apps.isAppSpaceEnabled()&&t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vapp_space"}));return t};var f=function e(){return TS.enterprise.getChannels()};var p=function e(){return TS.enterprise.getGroups()};var h=function e(){var t=TS.interop.redux.models.appActions.selectGlobalActions(TS.redux.getState()).actions;return t.map(TS.interop.utility.getGlobalActionForFrecency)};var g=function e(t,n){var r=[];var i=[];if(n.members){var a=S(t,n);(n.members.runaway?i:r).push(a)}if(n.channels||n.groups){var o=T(t,n);var l=n.channels&&n.channels.runaway||n.groups&&n.groups.runaway;(l?i:r).push(o)}if(TS.boot_data.feature_lazy_user_groups&&n.usergroups){var u=v(t,n);(n.usergroups.runaway?i:r).push(u)}if(TS.boot_data.page_needs_enterprise){if(n.enterprise_channels){var d=y(t,n);(n.enterprise_channels.runaway?i:r).push(d)}if(n.teams){var c=b(t,n);(n.teams.runaway?i:r).push(c)}}return Promise.all(r).then(function(){var e=s(t,n);var r=false!==n.sort?!!e.length:_.some(_.values(e),"length");var a=i.length&&!r;if(!a)return e;return new Promise(function(e){Promise.all(i).then(e)}).then(function(){return s(t,n)})})};var S=function e(t,n){var r=t.charAt(0);if("#"===r)return Promise.resolve();"@"===r&&(t=t.slice(1));if(r&&!t)return Promise.resolve();n=w(n.members,n.limit_option,i);n.max_api_results=n.remote_limit||n.limit;n.query=t;return TS.members.promiseToSearchMembers(n).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop)};var T=function e(t,n){var r=t.charAt(0);if("@"===r)return Promise.resolve();"#"===r&&(t=t.slice(1));if(r&&!t)return Promise.resolve();var i=n.channels&&n.channels.include_from_another_team||n.groups&&n.groups.include_from_another_team;n=w(n.channels||n.groups,n.limit_option);var a=n.remote_limit||n.limit;return TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:t,count:a},includeFromAnotherTeam:i}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop)};var v=function e(t,n){if(!TS.boot_data.feature_lazy_user_groups)return Promise.resolve();var r=t.charAt(0);if("#"===r)return Promise.resolve();"@"===r&&(t=t.slice(1));if(r&&!t)return Promise.resolve();n=w(n.usergroups,n.limit_option,a);var i=n.remote_limit||n.limit;return TS.interop.userGroups.fetchAndUpsertUserGroupsWithQuery({query:t,count:i}).catch(_.noop)};var b=function e(t,n){n=w(n.teams,n.limit_option);var r=n.remote_limit||n.limit;return TS.interop.teams.fetchAndUpsertTeamsWithQuery({query:t,count:r}).catch(_.noop)};var y=function e(t,n){var r=t.charAt(0);if("@"===r)return Promise.resolve();"#"===r&&(t=t.slice(1));if(r&&!t)return Promise.resolve();n=w(n.enterprise_channels,n.limit_option);n.query=t;n.count=n.remote_limit||n.limit;return TS.enterprise.promiseToSearchEnterpriseChannels(n).catch(_.noop)};var w=function e(t,n){true===t&&(t={});return _.defaultsDeep.apply(null,arguments)};var k=function e(t){return _.size(_.flatten(_.values(t)))};var x=function e(t){(t.members||t.mpims||t.all_mpims)&&TS.interop.members.pauseRefetch();(t.channels||t.groups||t.mpims||t.all_mpims)&&TS.interop.channels.pauseRefetch();t.teams&&TS.interop.teams.pauseRefetch()}})()},2962:function(e,t,n){"use strict";n.r(t);var r=n(2878);var i=n(2879);var a=n(40);var s=n.n(a);(function(){var e="STORAGE";TS.registerModule("storage",{version:"0.85",msgs_version:window.boot_data&&boot_data.cache_version||"unknown_version",cache_ts_version:window.boot_data&&boot_data.cache_ts_version||"unknown_version",do_compression:!TS.model.is_our_app&&"undefined"!==typeof window.Worker&&(!window.bowser||!bowser.phantom&&!bowser.msie),test:function e(){return{getLocalStorage:L,setLocalStorage:N,getKeys:k,set:j}},onStart:function t(){TS.storage.onStart=function(){};TS.storage.enterprise.start();if(!TS.storage.do_compression&&TS.boot_data.feature_force_ls_compression){TS.interop.console.info(e,"Special case: force-enabling LS compression for this session.");TS.storage.do_compression=true}TS.storage.version+=TS.storage.do_compression?"-compressed-LZString":"";var n=a||!B||function(){if(!TS.storage.storageAvailable()){C();if(!TS.storage.storageAvailable()){TS.interop.console.info(e,"TS.storage.storageAvailable() = false in onStart after flushing all our keys, so disabling");return true}}return false}();if(TS.has_pri[q]){TS.log(q,"TS.storage.onStart should_disable:"+n);TS.log(q,"TS.storage.do_compression:"+TS.storage.do_compression+" (_ls.getItem('is_compressed') === 'yes'):"+(B&&"yes"===B.getItem("is_compressed")))}TS.ui.window_unloaded_sig.add(M);TS.ui.window_focus_changed_sig.add(A);TS.storage.setDisabled(n);j("rxn_records",null);var r=TS.storage.fetchExpandableState();TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(r))},setDisabled:function e(t){if(a==t)return;if(t||!B){a=true;B&&C()}else{a=false;x()}TS.log(q,"_disabled:"+a)},storageAvailable:function e(){if(!B)return false;try{var t="test_to_see_if_we_can_write_to_local_storage";B.setItem(t,"foo");B.removeItem(t);return true}catch(e){return false}},storageSize:function t(n){var r=0;if(!B)return r;var i=k();var a=0;var o;var l;for(var u=0;u<i.length;u+=1){a+=1;o=i[u];l=B.getItem(o);if(l||""===l){r+=l.length;n&&TS.info(o+"="+(2*l.length/1024).toFixed(2)+"KB (total="+(r/1024).toFixed(2)+"KB)")}else TS.interop.console.info(e,o+" not measurable value, typeof:"+("undefined"===typeof l?"undefined":s()(l)))}n&&TS.info("total for "+a+" items is "+(r/1024).toFixed(2)+"KB");return r},completelyEmptyAllStorageAndReset:function e(){TS.info("completelyEmptyAllStorageAndReset running");I();TS.storage.storeLastEventTS("",true,true);var t=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_b4_flush:"+t);if(t){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+k().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}D(true,"completelyEmptyAllStorageAndReset");var n=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_after_flush:"+n);if(n){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+k().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}},flush:function e(t){TS.has_pri[q]&&TS.log(q,"TS.storage.flush()");C();t&&TS.storage.clearBufferAndCache()},clearBufferAndCache:function e(){TS.has_pri[q]&&TS.log(q,"TS.storage.clearBufferAndCache()");l={};u={};TS.compresion&&TS.compression.terminate()},fetchStorageVersion:function e(){return H("storage_version")},storeStorageVersion:function e(t){j("storage_version",t,true)},fetchCacheTSStorageVersion:function e(){return H("storage_cache_ts_version")},storeCacheTSStorageVersion:function e(t){j("storage_cache_ts_version",t,true)},_makeMsgInputId:function e(t){return"msg_input_"+t},fetchLastMsgInput:function e(t){var n=H(TS.storage._makeMsgInputId(t),null);if("\u4000"===n){TS.console.logError({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:s()(window.Worker),has_bowser:!!window.bowser},"decompress_general_compressed_fail");return""}return n},fetchLastMsgInputFromSSB:function e(n){if(!TS.storage.enterprise.supported())return;var r=TS.storage._makeMsgInputId(n);var i=t+"_"+r;return y[i]},storeLastMsgInput:function e(t,n){j(TS.storage._makeMsgInputId(t),n);TS.storage.enterprise.setLastMsgInput(t,n)},_makeCommentInputId:function e(t){return"comment_input_"+t},fetchLastCommentInput:function e(t){return H(TS.storage._makeCommentInputId(t),null)},storeLastCommentInput:function e(t,n){j(TS.storage._makeCommentInputId(t),n)},fetchOldestTs:function e(t){return H(i(t),null)},storeOldestTs:function e(t,n){j(i(t),n)},fetchActiveHistory:function e(){return H("active_history",[])||[]},storeActiveHistory:function e(t){j("active_history",t,true)},fetchLastEventTS:function e(t){return H("last_event_ts","",t)||""},storeLastEventTS:function e(t,n,r){j("last_event_ts",t,n,r)},fetchUIState:function e(){var t=H("ui_state",{})||{};_.isString(t)&&(t={});return t},storeUIState:function e(t){j("ui_state",t)},fetchExpandableState:function e(){var t=H("expandable_state",{});return t&&"object"===("undefined"===typeof t?"undefined":s()(t))?t:{}},storeExpandableState:function e(t){j("expandable_state",t)},fetchClientWindows:function e(){return H("client_windows",{})||{}},storeClientWindows:function e(t){j("client_windows",t)},fetchInputHistory:function e(){var t=H("input_history",[])||[];"string"===typeof t&&(t=[t]);var n=300;t.length>n&&(t.length=n);return t},storeInputHistory:function e(t){j("input_history",t)},fetchCustomEmoji:function e(){return H("custom_emoji",null)||null},storeCustomEmoji:function e(t){j("custom_emoji",t)},fetchStaticTranslations:function e(){return H("static_translations",null)||null},storeStaticTranslations:function e(t){j("static_translations",t)},fetchApps:function e(){return H("apps",null)||null},storeApps:function e(t){j("apps",t)},fetchAppsSearchResults:function e(){return H("apps_search",null)||null},storeAppsSearchResults:function e(t){j("apps_search",t)},fetchCmds:function e(){return H("cmds",null)||null},storeCmds:function e(t){j("cmds",t)},fetchChannelPageState:function e(){return H("channel_page_state",{})||{}},storeChannelPageState:function e(t){j("channel_page_state",t)},fetchInvitesState:function e(){return H("invites_state",[])||[]},storeInvitesState:function e(t){j("invites_state",t)},fetchBriefingOpensCount:function e(){return Number(H("briefing_opens_count",0))||0},storeBriefingOpensCount:function e(t){j("briefing_opens_count",t)},fetchReplyInput:function e(t,n){var r=H("reply_inputs")||[];var i=_.find(r,{model_ob_id:t,thread_ts:n});return i?i.text:""},storeReplyInput:function e(t,n,r){var i=10;var a=H("reply_inputs")||[];a=_.reject(a,{model_ob_id:t,thread_ts:n});a.length>i&&a.shift();a.push({model_ob_id:t,thread_ts:n,text:r});j("reply_inputs",a)},fetchFilterState:function e(){return H("team_filter_state","")||""},storeFilterState:function e(t){j("team_filter_state",t)},fetchCallsState:function e(){return H("calls_state",{})||{}},storeCallsState:function e(t){j("calls_state",t)},fetchFrecency:function e(t){return H("frecency_"+t)},storeFrecency:function e(t,n){j("frecency_"+t,n)},clearFrecency:function e(t){j("frecency_"+t,"")},fetchEnterpriseState:function e(){return H("enterprise_state",{})||{}},storeEnterpriseState:function e(t){j("enterprise_state",t)},enterprise:{supported:function e(){if(!TS.boot_data.feature_slackday_unsent_msg_sync||!TS.boot_data.page_needs_enterprise||!TS.model.is_our_app)return;if(!window.desktop||!window.desktop.enterpriseStorage)return;return true},start:function e(){if(!TS.storage.enterprise.supported())return;TS.storage.enterprise.initStorage();TS.storage.enterprise.subscribe()},initStorage:function e(){if(!TS.storage.enterprise.supported())return;var t=window.desktop.enterpriseStorage&&window.desktop.enterpriseStorage.storage;y=t||{};TS.storage.enterprise.processStorageData()},isEligibleChannel:function e(t){if("D"===t.charAt(0))return true;var n;if("C"===t.charAt(0)||"G"===t.charAt(0)){n=TS.redux.channels.getEntityById(t);if(!n)return;if(n.is_org_shared)return true;if(n.is_shared&&n.shared_team_ids&&n.shared_team_ids.length){var r=-1!==n.shared_team_ids.indexOf(TS.model.team.id);return r}}return false},makeLastMsgInputKey:function e(n){return""+t+TS.storage._makeMsgInputId(n)},getLastMsgInput:function e(t){if(!TS.storage.enterprise.supported())return;if(!TS.storage.enterprise.isEligibleChannel(t))return;var n=TS.storage.enterprise.makeLastMsgInputKey(t);var r=y[n]||"";return r},setLastMsgInput:function e(t,n){if(!TS.storage.enterprise.supported())return;if(!TS.storage.enterprise.isEligibleChannel(t))return;var r=TS.storage.enterprise.makeLastMsgInputKey(t);var i={last_msg_input:n};TS.storage.enterprise.set(r,i)},get:function e(t){if(!TS.storage.enterprise.supported())return;var n=window.desktop.enterpriseStorage.getItem(t);return n},set:function e(t,n){if(!TS.storage.enterprise.supported())return;window.desktop.enterpriseStorage.setItem(t,n)},subscribe:function e(){if(!TS.storage.enterprise.supported())return;window.desktop.enterpriseStorage.addListener("update",TS.storage.enterprise.storageUpdatedFromSSB)},updateStorageData:function e(t){var n=w(t);if(!n)return;if(!TS.storage.enterprise.isEligibleChannel(n))return;var r=TS.storage.enterprise.get(t);y[t]=r},storageUpdatedFromSSB:function e(t){TS.ensureFullyBooted().then(function(){if(!TS.storage.enterprise.supported())return;if(!t)return;t.added&&t.added.length&&t.added.forEach(function(e){TS.storage.enterprise.updateStorageData(e)});t.updated&&t.updated.length&&t.updated.forEach(function(e){TS.storage.enterprise.updateStorageData(e)});t.deleted&&t.deleted.length&&t.deleted.forEach(function(e){delete y[e]});TS.storage.enterprise.processStorageData()})},processStorageData:function e(){if(!TS.storage.enterprise.supported())return;var t=TS.shared.legacyGetActiveModelOb();Object.keys(y).forEach(function(e){var n=w(e);var r=TS.redux.channels.getEntityById(n);if(!r)return;var i=y[e];if(!i||void 0===i.last_msg_input)return;if(r.last_msg_input===i.last_msg_input)return;r.last_msg_input=i.last_msg_input;r.has_draft=i.last_msg_input.length;t&&n===t.id&&(i.last_msg_input.length?TS.client.msg_input.populateWithLast():TS.client.msg_input.populate(""))})}}});var t=window.boot_data.user_id+"_";var n="channel_msgs_";var r="oldest_msg_ts_";var i=function e(t){return r+t};var a;var o=false;var l={};var u={};var d=1e3;var c=false;var m=1e3;var f=false;var p=1e3;var h=false;var g=false;var S=null;var T=3e5;var v=1e4;var b=1e3;var y={};var w=function e(t){if(!t||!t.length)return;var n=t.split&&t.split("_");if(!n||!n.length)return;var r=n[n.length-1];return r};var k=function e(){var t=[];if(!B)return t;var n=B.length;if(!n)return t;for(var r=0;r<n;r+=1)t.push(B.key(r));return t};var x=function n(){var r;if(!a){var i=TS.storage.fetchStorageVersion()||"";var s=-1!=i.indexOf("-compressed")||"yes"===B.getItem("is_compressed");if(TS.storage.do_compression&&!s){TS.interop.console.info(e,"migrating to compressed format");r=k();r.forEach(function(e){var n=e.replace(t,"");var r=$(e,B.getItem(e));var i="converting: "+e+" -> "+n+" val.length: "+(void 0===r||null===r?-1:String(r).length);j(n,null);j(n,r);H(n)==r?TS.has_pri[q]&&TS.log(q,i+" SUCCESS _get(name) has a value:"+!!H(n)+", and it it the same as val"):TS.error(i+" FAILURE _get(name) !== val")});TS.interop.console.info(e,"migration to compressed format complete, "+r.length+" migrated");TS.storage.storeStorageVersion(TS.storage.version)}else TS.has_pri[q]&&TS.log(q,"no migration needed");B.setItem("is_compressed",TS.storage.do_compression?"yes":"no")}var o=TS.storage.fetchCacheTSStorageVersion();TS.has_pri[q]&&TS.log(q,"storage_cache_ts_version:"+o);var l=TS.storage.fetchStorageVersion()||"";if(TS.has_pri[q]){TS.log(q,"TS.storage.version:"+TS.storage.version);TS.log(q,"storage_version:"+l);TS.log(q,"TS.storage last_unload_flushing: "+H("last_unload_flushing"));TS.log(q,"TS.storage.storageAvailable(): "+TS.storage.storageAvailable())}r=k();TS.has_pri[q]&&TS.dir(q,r,"_getKeys()");if(TS.storage.storageAvailable()){if(l!=TS.storage.version){TS.log(q,"storage_version:"+l+" does not match TS.storage.version:"+TS.storage.version+" so flushing all our keys: "+r.join(", "));C()}else if(!TS.storage.fetchLastEventTS()){TS.log(q,"TS.storage.fetchLastEventTS() is empty so flushing channel data");I()}}else{TS.log(q,"TS.storage.storageAvailable() = false so flushing all our keys");C()}TS.storage.storeStorageVersion(TS.storage.version);TS.redux.socket.connectedSig.addOnce(E)};var C=function e(){k().forEach(function(e){0===e.indexOf(t)&&B.removeItem(e)})};var I=function e(){var i=k();TS.has_pri[q]&&TS.log(q,i,"_getKeys()");var a;for(var s=0;s<i.length;s+=1){a=i[s];if(0!==a.indexOf(t))continue;if(-1==a.indexOf(n)&&-1==a.indexOf(r))continue;B.removeItem(a);delete l[a]}for(a in l){if(0!==a.indexOf(t))continue;if(-1==a.indexOf(n)&&-1==a.indexOf(r))continue;delete l[a]}u={};i=k();TS.dir(488,i,"_getKeys()")};var M=function e(){o=true;j("last_unload_flushing",(new Date).toString(),true);D(true,"_windowUnloaded");TS.compression.terminate()};var A=function e(){D(true,"_windowBlurred")};var E=function e(){if(S){window.clearInterval(S);S=null}S=window.setInterval(P,T)};var P=function e(){if(!TS.model)return;var t=Object.keys(l).length;if(!t)return;var n=false;var r="";if(!TS.model.ui.is_window_focused){r="window blurred!";n=true}var i=Date.now()-TS.model.client.last_user_active_timestamp;if(!n&&i>=v){r="window focused, but user has been idle long enough "+i+" >= "+v;n=true}TS.has_pri[q]&&TS.log(q,"_maybeFlushBuffer ok_to_flush_all:"+n);if(n){D(true,"maybeFlushBuffer ("+t+") "+r);return}var a=i>b;TS.has_pri[q]&&TS.log(q,"_maybeFlushBuffer ok_to_flush_some:"+a);r="window focused, but user has been idle long enough "+i+" >= "+b;a&&D(false,"maybeFlushBuffer ("+t+") "+r)};var F=function e(t){return"string"!==typeof t&&"number"!==typeof t&&t?JSON.stringify(t):t};var O=function e(t){if("undefined"===t)return null;if("null"===t)return null;return t};var D=function e(t,n){if(a)return;var r=new Date;var i=Date.now();var s;var o=0;var d;var c=TS.model&&TS.model.team&&TS.model.team.domain&&TS.boot_data.feature_tinyspeck;var _;var m;var f;var S;var T;for(d in l){if(l[d].being_flushed)continue;S=F(l[d].val);if(void 0===S||null===S){B.removeItem(d);delete l[d];delete u[d]}else try{R(d,S)}catch(e){TS.error(0,e);C();delete l[d];delete u[d];continue}o+=1;s=Date.now()-i;c&&TS.has_pri[q]&&TS.log(q,"_flushBuffer _ls.setItem "+d+": "+s+"ms "+(l[d]&&l[d].val&&l[d].val.toString?l[d].val.toString().substr(0,100):"NULL?"));if(!t){_=new Date-r;if(!h&&_>p){h=true;f=new Date;try{m=TS.storage.storageSize()}catch(e){}f=new Date-f;T="Took "+_+"ms for "+o+" item (!all case) (threshold is "+p+" ms). Key: "+d+". Buffer length: "+(l[d]&&l[d].val&&l[d].val.toString()?l[d].val.toString().length:"unknown (not a string)")+". localStorage size: "+(m||"unknown")+". Time to read LS size: "+f;TS.info("_flushBuffer exceeded slow write threshold: "+T)}}l[d]&&(l[d].being_flushed=true);if(!t){TS.has_pri[q]&&TS.log(q,"_flushBuffer: Wrote one item. why: "+n);return}u={}}if(o&&!g){_=new Date-r;if(_>p){g=true;try{m=TS.storage.storageSize()}catch(e){}T="Took "+_+"ms for "+o+" items (threshold is "+p+" ms). localStorage size: "+m+". App open for "+((Date.now()-TS.boot_data.start_ms)/1e3/60).toFixed(2)+" min. why: "+n;TS.info("_flushBuffer exceeded slow write threshold (all case): "+T)}}TS.has_pri[q]&&(0===o?TS.log(q,"_flushBuffer: Nothing to save."):TS.log(q,"_flushBuffer: Saved "+o+(1===o?" item":" items")+" why: "+n))};var H=function e(n,r,i){var s=t+n;i&&TS.info("_get name:"+n+" k:"+s+" disabled:"+a+' _buffer["'+s+'"].val:'+(l[s]&&l[s].val));if(a)return l[s]&&l[s].val||r;if(s in l)return l[s]&&l[s].val||r;if(u.hasOwnProperty(s))return u[s];var o=$(s,G(s,B.getItem(s)),r,i);u[s]=o;return o};var $=function e(t,n,r,i){var a=new Date;var o=O(n);i&&TS.info("_get _correctBadValsFromStorage(_ls.getItem(k)) k:"+t+" typeof result:"+("undefined"===typeof o?"undefined":s()(o))+" /^[{[]/.test(result):"+/^[{[]/.test(o));var l;o&&"string"===typeof o&&/^[{[]/.test(o)&&(o=TS.utility.parseJSONOrElse(o)||o);o=o||(void 0!==r?r:null);a=new Date-a;if(!c&&a>d){c=true;try{l=TS.storage.storageSize()}catch(e){}var u="_get took longer than threshold: Took "+a+"ms to read "+t+" (theshold is "+d+"ms), length = "+(o&&!isNaN(o.length)?o.length:"unknown")+". Storage size: "+l;TS.info(u)}return o};var j=function n(r,i,s,o){var d=false;var c=new Date;var _;var p=t+r;l[p]={val:i,being_flushed:false};u[p]=l[p].val;o&&TS.info("_set immediate:"+s+" name:"+r+" k:"+p+" disabled:"+a+" do_compression:"+TS.storage.do_compression+' _buffer["'+p+'"].val:'+l[p].val);if(s){if(!a){var h=F(i);if(void 0===h||null===h){B.removeItem(p);delete l[p]}else try{R(p,h,s)}catch(e){TS.interop.console.warn("_set _ls.setItem failed, flushing. TS.storage.storageSize():"+TS.storage.storageSize(false));d=true}}o&&TS.info("_set failed:"+d);if(!d){o&&TS.info('_set _buffer["'+p+'"]:'+(l[p]&&JSON.stringify(l[p])));c=new Date-c;if(c>m){TS.interop.console.info(e,"_set immediately "+r+": "+c+"ms "+(i&&i.toString?i.toString().substr(0,100):"NULL?"));if(!f){f=true;try{_=TS.storage.storageSize()}catch(e){}var g="_set exceeded slow set threshold (immediate): Took "+c+"ms to write "+p+" (theshold is "+m+"ms), length = "+(i&&!isNaN(i.length)?i.length:"unknown")+". Storage length: "+_;TS.info(g)}}else TS.has_pri[q]&&TS.log(q,"_set GOOD immediately: "+s+" "+r+": "+c+"ms",i)}}};var B=window.localStorage;var L=function e(){return B};var N=function e(t){B=t};var R=function e(t,n,r){n=String(n);if(TS.storage.do_compression){TS.compression.compress(t,n,r||o,U);return}U({k:t,str:n})};var U=function t(n){B.setItem(n.k,n.str);var r=function t(r){var i=B.getItem(n.k);if(i===n.str){r>1&&TS.interop.console.info(e,n.k+" now saved, try #"+r);delete l[n.k];delete u[n.k];return}if(r>1&&(!l[n.k]||l[n.k].val!=n.str)){TS.error("buffer changed for "+n.k+" so we don't care anymore, a new value is being set for it, try #"+r);return}TS.error("WTF not saved, try #"+r+" "+n.k+" "+(n.str||"").length+" typeof ob.str:"+s()(n.str)+" from_ls:"+("undefined"===typeof i?"undefined":s()(i)));B.setItem(n.k,n.str);setTimeout(t,1e3,r+1)};r(1)};var G=function e(t,n){if(!TS.storage.do_compression){if("\u4000"===n){TS.console.logError({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:s()(window.Worker),has_bowser:!!window.bowser},"decompress_empty_string_fail");return""}return n}var r=Date.now();n&&(n=LZString.decompress(n));var i=Date.now()-r;n&&TS.has_pri[q]&&TS.log(q,t+" took "+i+"ms to _decompress str.length: "+n.length);if("\u4000"===n){TS.console.logError({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:s()(window.Worker),has_bowser:!!window.bowser},"decompress_double_compressed_fail");return""}return n};var q=488})();var o=n(2880);var l=n(2881);var u=n(2882);var d=n(2883);var c=n(2884);var m=n(2885);var f=n(2886);var p=n(2887);var h=n(2888);var g=n(2889);var S=n(2890);var T=n(3);var v=n.n(T);(function(){TS.registerModule("redux.members",{onStart:function e(){if(TS.boot_data.no_login)return;d=TS.utility.enableFeatureForUser(1);m();Object.defineProperty(TS.model,"members",{get:function e(){return TS.redux.members.getAllMembers()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.members: Set TS.model.members");return false}});Object.defineProperty(TS.model,"user",{get:function e(){return r()}})},getPotentiallyUnknownMemberById:function e(t){t&&"@"===t[0]&&(t=t.substring(1));if(!TS.interop.utility.looksLikeMemberId(t)){d&&TS.console.logStackTraceToBackEnd("non-ID passed into getPotentiallyUnknownMemberById","member_name_as_id_lookup",1);if(TS.boot_data.feature_deprecate_get_member_by_name)return null;var r=TS.interop.members.getMemberByName(t);if(r)return r}var i=n(t);if(!i)return null;if(i.isUnknown){TS.members.legacySetMemberUnknown(t);return _.omit(v()({},i,{is_unknown:true}),"isUnknown")}if(i.isNonExistent)return _.omit(v()({},i,{is_non_existent:true}),"isNonExistent");return i},getMemberByEmail:function e(n){var r=t(n);if(!r||!r.profile)return null;return r},getAllMembers:function t(){var n=e();if(n===a)return s;s=_.values(n);a=n;return s},hasMemberWithId:function e(t){return i(t)},addMember:function e(t){if(!t)return;TS.interop.members.markObjectsAsFresh([t.id]);TS.redux.dispatch(TS.interop.redux.models.members.addMember(t))},addToBulkUpsertPayload:function e(t){o.push(t)},bulkUpsertMembers:function e(t){if(!_.isArray(t))return;if(!t.length)return;TS.interop.members.markObjectsAsFresh(t.map(function(e){return e.id}));TS.redux.dispatch(TS.interop.redux.models.members.bulkAddMembers(t))},logStats:function e(){var t=_(l).keys().union(_.keys(u)).value();var n={};_.forEach(t,function(e){n[e]={gets:l[e]||0,sets:u[e]||0}});TS.console.table(n)},test:function e(){var t={_addSignalListeners:m};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return o},set:function e(t){o=t}});return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getAllMembers");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getMemberByEmail");var n=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getMemberById");var r=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getCurrentMember");var i=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.hasMemberWithId");var a;var s;var o=[];var l={};var u={};var d;var c=function e(){if(o.length){TS.interop.members.markObjectsAsFresh(o.map(function(e){return e.id}));TS.redux.dispatch(TS.interop.redux.models.members.bulkAddMembers(o));o=[]}};var m=function e(){TS.members.batch_upserted_sig.add(c)}})();(function(){TS.registerModule("redux.bots",{onStart:function e(){Object.defineProperty(TS.model,"bots",{get:function e(){return TS.redux.bots.getAllBots()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.bots: Set TS.model.bots");return false}})},getBotByMsg:function e(n){var r=t(n);return r?l(r):null},getAllBots:function t(){return _.values(e())},upsertBot:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.bots.upsertBot(t))},bulkUpsertBots:function e(t){if(!_.isArray(t))return;TS.redux.dispatch(TS.interop.redux.models.bots.bulkUpsertBots({bots:t}))},logStats:function e(){var t=_(n).keys().union(_.keys(r)).value();var i={};_.forEach(t,function(e){i[e]={gets:n[e]||0,sets:r[e]||0}});TS.console.table(i)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getAllBots");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getBotByMsg");var n={};var r={};var i=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var a=function e(t,i){if("symbol"!==("undefined"===typeof i?"undefined":s()(i))){if(!_.isNumber(n[i])){n[i]=0;r[i]=0}n[i]+=1}return t[i]};var o=function e(t,i,a){if("symbol"!==("undefined"===typeof i?"undefined":s()(i))){if(!_.isNumber(r[i])){n[i]=0;r[i]=0}r[i]+=1}t[i]=a;return true};var l=function e(t){if(!window.Proxy||!i())return t;return new window.Proxy(t,{get:function e(t,n){return a(t,n)},set:function e(t,n,r){return o(t,n,r)}})}})();(function(){TS.registerModule("redux.user_groups",{onStart:function e(){u();Object.defineProperty(TS.model,"user_groups",{get:function e(){return TS.redux.user_groups.getAllUserGroups()},set:function e(){TS.error("TS.redux.user_groups: trying to set TS.model.user_groups???");return false}})},getUserGroupById:function e(n){var r=t(n);if(!r||TS.interop.rules.user_groups.isUnknownOrNonExistent(r)||r.id!==n)return null;return f(r)},getAllUserGroups:function t(){var i=e();if(i===n)return r;r=_.values(i).sort(TS.interop.i18n.mappedSorter("_name_lc"));n=i;return r},addUserGroup:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.userGroups.bulkAddGroups([t]))},addToBulkUpsertPayload:function e(t){o.push(t)},logStats:function e(){var t=_(i).keys().union(_.keys(a)).value();var n={};_.forEach(t,function(e){n[e]={gets:i[e]||0,sets:a[e]||0}});TS.console.table(n)},test:function e(){var t={_addSignalListeners:u};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return o},set:function e(t){o=t}});return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.userGroups.getAllUserGroups");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.userGroups.getUserGroupById");var n;var r;var i={};var a={};var o=[];var l=function e(){if(o.length){TS.redux.dispatch(TS.interop.redux.models.userGroups.bulkAddGroups(o));o=[]}};var u=function e(){TS.user_groups.batch_upserted_sig.add(l)};var d=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var c=function e(t,n){if("symbol"!==("undefined"===typeof n?"undefined":s()(n))){if(!_.isNumber(i[n])){i[n]=0;a[n]=0}i[n]+=1}return t[n]};var m=function e(t,n,r){if("symbol"!==("undefined"===typeof n?"undefined":s()(n))){if(!_.isNumber(a[n])){i[n]=0;a[n]=0}a[n]+=1}t[n]=r;return true};var f=function e(t){if(!window.Proxy||!d())return t;return new window.Proxy(t,{get:function e(t,n){return c(t,n)},set:function e(t,n,r){return m(t,n,r)}})}})();var b=n(2891);var y=n(2892);var w=n(2893);(function(){TS.registerModule("redux.messages",{addMessages:function e(t,n,r){var i=_.some(t,function(e){var t=TS.redux.messages.getMessageByTimestamp(e.channel,e.ts);return!t});TS.redux.dispatch(TS.interop.redux.models.messages.addMessages(t));if(n){var a=t&&t[0]&&t[0].channel;var s=_.map(t,"ts");var o={};r&&(o={oldest:_.min(s),hasMore:false});TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(_.assign({channelId:a,timestamps:s},o)))}return i},addMessage:function e(t,n,r){if(!t||!t.channel||!t.ts)return;var i=TS.redux.messages.getMessageByTimestamp(t.channel,t.ts);TS.redux.dispatch(TS.interop.redux.models.messages.addMessages([t]));var a={channelId:t.channel,timestamps:[t.ts],fromEvtLog:!!r};if(n){a.oldest=t.ts;a.hasMore=false;a.append=true}TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(a));TS.boot_data.feature_react_threads&&TS.interop.messages.isReply(t)&&TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(v()({},a,{channelId:TS.interop.threads.getThreadKey(t.channel,t.thread_ts)})));return!i},replaceMessage:function e(t,n){if(!t||!t.channel||!t.ts)return;var r=false;TS.redux.messages.addMessage(t,r,n)},removeMessage:function e(t,n){if(!t||!t.channel||!t.ts)return;TS.boot_data.feature_react_threads?TS.redux.dispatch(TS.interop.redux.actions.maybeAnimateDeleteMessage({channelId:t.channel,ts:t.ts,threadTs:t.thread_ts,fromEvtLog:n})):TS.interop.messages.isReply(t)&&"thread_broadcast"!==t.subtype?TS.redux.dispatch(TS.interop.redux.actions.removeMessageAndTimestamp({channelId:t.channel,ts:t.ts,fromEvtLog:n})):TS.redux.dispatch(TS.interop.redux.features.messagePane.maybeAnimateDeleteMessage(t,n))},channelHistoryChanged:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelHistory.removeAllTimestamps({channelId:t}))},getMessageByTimestamp:function e(t,n){if(!TS.interop.redux.models.messages.getMessageByTimestamp)return null;return TS.interop.redux.models.messages.getMessageByTimestamp(TS.redux.getState(),t,n)},getMessagesInChannel:function e(t,n,r){if(!t)return[];void 0===r&&(r=true);var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),t,n);var a=TS.interop.redux.models.messages.getMessagesByChannelId(TS.redux.getState(),t);var s=i&&i.timestamps||[];var o=_(s).map(function(e){return a[e]}).compact().value();o=TS.interop.messages.computeRollups(o).messages;var l=_(o).reject(TS.interop.rules.messages.isHidden).sortBy("ts");return r?l.reverse().value():l.value()},getRecentMessagesInChannel:function e(t,n){return TS.redux.messages.getMessagesInChannel(t,null,n)},getRecentMessagesInThread:function e(t,n,r){if(!TS.boot_data.feature_react_threads)return[];if(!t||!n)return[];var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),TS.interop.rules.threads.getThreadKey(t,n),null);if(!i)return[];var a=_.map(i.timestamps,function(e){return TS.redux.messages.getMessageByTimestamp(t,e)});if(!r)return a;return _.reverse(a)},getLastMessageInChannel:function e(t){if(!t)return null;var n=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),t);var r=n&&n.timestamps||[];var i=_.last(r);if(!i)return null;return TS.redux.messages.getMessageByTimestamp(t,i)},getExpandablesInChannel:function e(t){var n=TS.redux.messages.getMessagesInChannel(t,null,false);return _(n).map(function(e){var t=e.ts;if(e.file)return TS.interop.messages.getExpandableKey("file",t,{id:e.file});if(e.files)return e.files.map(function(e){return TS.interop.messages.getExpandableKey("file",t,{id:e})});if("sh_room_shared"===e.subtype||"sh_room_created"===e.subtype)return TS.interop.messages.getExpandableKey("call",t,{id:e._call_id});if(e.attachments)return _.map(e.attachments,function(e){return TS.interop.messages.getExpandableKey("attachment",t,{id:e.id,imageUrl:e.image_url,audioHtml:e.audio_html,videoHtml:e.video_html,thumbUrl:e.thumb_url})});return null}).flatten().compact().value()},getMessagesByProp:function e(t,n){var r=TS.interop.redux.models.messages.getMessagesByProps(TS.redux.getState(),t,n);return _(r).sortBy("ts").reverse().value()},getMessagesByChannelId:function e(t,n){void 0===n&&(n=true);var r=TS.interop.redux.models.messages.getMessagesByChannelId(TS.redux.getState(),t);return n?_(r).sortBy("ts").reverse().value():_(r).sortBy("ts").value()},recordDeletedMessage:function e(t,n){TS.redux.dispatch(TS.interop.redux.features.deletedMessages.recordMessageDeleted({channelId:t,ts:n}))},wasMessageDeleted:function e(t,n){var r=TS.redux.getState();return TS.interop.redux.features.deletedMessages.wasMessageDeleted(r,{channelId:t,ts:n})}})})();var k=n(2894);var x=n(2895);var C=n(2896);var I=n(2897);var M=n(2898);var A=n(2899);var E=n(2900);var P=n(2901);var F=n(2902);(function(){TS.registerModule("files",{team_file_added_sig:new signals.Signal,team_file_deleted_sig:new signals.Signal,team_file_deleted_success_sig:new signals.Signal,team_file_changed_sig:new signals.Signal,team_file_shared_sig:new signals.Signal,team_file_comment_added_sig:new signals.Signal,team_file_comment_edited_sig:new signals.Signal,team_file_comment_deleted_sig:new signals.Signal,file_uploaded_sig:new signals.Signal,file_uploading_sig:new signals.Signal,file_progress_sig:new signals.Signal,file_canceled_sig:new signals.Signal,file_queue_emptied_sig:new signals.Signal,channel_files_fetched_sig:new signals.Signal,user_changed_public_url_sig:new signals.Signal,uploadQ:[],uploading:false,polling_count:0,polling_file_id:null,polling_ticket:null,polling_tim:null,polling_handler:null,waiting_for_refresh:{},supported_audio_type_re:/^(m4a|mp3|wav)$/,supported_video_type_re:/^(mp4|mov|webm)$/,onStart:function e(){TS.prefs.team_disable_file_editing_changed_sig.add(TS.files.getFileActions,TS.files.upsertAndSignal);TS.boot_data.feature_degraded_send&&TS.files.file_uploaded_sig.add(i)},isFilePrivate:function e(t){return!t.is_public&&!t.is_external&&!t.is_shared},isFileAuthorExternal:function e(t){if(!_.isObject(t))return false;var n=TS.interop.members.getMemberById(t.user);if(!_.isObject(n))return false;return TS.interop.members.isExternal(n)},isFileUntitled:function e(t){return"-"===t.name},createPublicURL:function e(t,n){if(TS.prefs.getTeamPref("disallow_public_file_urls"))return;var r=function e(r,i,a){if(r){TS.files.upsertAndSignal({id:t.id,public_url_shared:true},"createPublicURL");TS.files.user_changed_public_url_sig.dispatch(i.file)}else if(i.error&&"not_allowed"===i.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);TS.boot_data.feature_external_files?TS.generic_dialog.alert(TS.interop.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this Post.","files")()):TS.generic_dialog.alert(TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this space.","files")())}n&&"function"===typeof n&&n(r,i,a)};return TS.interop.api.callExpedited("files.sharedPublicURL",{file:t.id}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},createSpace:function e(t){var n={};TS.boot_data.page_needs_enterprise&&(n.team=TS.model.team.id);var r=function e(n,r){if(n){var i=TS.files.upsertAndSignal(r.file,"createSpace").file;TS.web&&TS.ssb.upsertFileInSSBParentWin(i);t(i)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.interop.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}};return TS.interop.api.callExpedited("files.createSpace",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},createAndOpenNewSpace:function e(t,n){var r=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";TS.boot_data.page_needs_enterprise&&(r.length?r+="&origin_team="+TS.model.team.id:r="?origin_team="+TS.model.team.id);if(n||!TS.model.is_our_app){var i="/files/create/post"+r;TS.utility.openInNewTab(i,"_blank");"function"===typeof t&&t();return Promise.resolve()}return TS.files.createSpace(function(e){if(e){var n=e.permalink+r;TS.ssb.openNewFileWindow(e,n,r)||TS.utility.openInNewTab(n,e.id)}"function"===typeof t&&t()})},createDocs:function e(t){var n={};TS.boot_data.page_needs_enterprise&&(n.team=TS.model.team.id);var r=function e(n,r){if(n){var i=TS.files.upsertAndSignal(r.file).file;TS.web&&TS.ssb.upsertFileInSSBParentWin(i);t(i)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.interop.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}};return TS.interop.api.callExpedited("files.docs.create",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},createAndOpenNewDocs:function e(t,n){var r=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";TS.boot_data.page_needs_enterprise&&(r.length?r+="&origin_team="+TS.model.team.id:r="?origin_team="+TS.model.team.id);if(n||!TS.model.is_our_app){var i=TS.interop.environment.subdomain;var a=i?"https://app."+i+(i?".":"")+"slack.com/docs/"+TS.model.team.id+r:"https://app.slack.com/docs/"+TS.model.team.id+r;TS.utility.openInNewTab(a,"_blank");"function"===typeof t&&t();return Promise.resolve()}return TS.files.createDocs(function(e){if(e){var n=e.permalink+r;TS.ssb.openNewFileWindow(e,n,r)||TS.utility.openInNewTab(n,e.id)}"function"===typeof t&&t()})},promptForFileUnshare:function e(t,n){var r=TS.redux.channels.getEntityById(n);if(!r||r.is_im||r.is_mpim)return;var i=TS.interop.i18n.t("<p>Are you sure you want to un-share this file from the <strong>{channel_name}</strong> {is_private, select, true {private} other {}} channel?</p>\t\t\t<p>Un-sharing the file will not remove existing share and comment messages, but it will keep any future comments from appearing in the channel.</p>","files")({is_private:r.is_private||r.is_group,channel_name:r.is_channel&&!r.is_private?"#"+r.name:r.name});TS.generic_dialog.start({title:TS.interop.i18n.t("Un-share file","files")(),body:i,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, unshare this file","files")(),cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:function e(){TS.files.unshareFile(t,n)}})},shareFile:function e(t,n,r,i,a){var s={file:t,channel:n,comment:TS.format.cleanMsg(r)};s.resharing_aware=true;i&&(s.share_quietly=true);var o=function e(t,n,r){TS.files.onFileShare(t,n,r);a&&a(t,n,r)};return TS.interop.api.call("files.share",s).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileShare:function e(t,n,r){if(!t)return;TS.files.fetchFileInfo(r.file,function(e,t){TS.web&&TS.files.upsertAndSignal(t,"onFileShare")});TS.web&&TS.web.space&&TS.web.space.onFileShare(t,n,r)},unshareFile:function e(t,n,r){var i=function e(n,i,a){TS.files.onFileUnShare(n,i,a);r&&r(t,TS.files.getFileById(t))};TS.interop.api.call("files.unshare",{file:t,channel:n}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},fetchFileInfo:function e(t,n,r){var i=TS.redux.dispatch(TS.interop.files.fetchAndUpsertFileById({fileId:t,reason:r}));if(n)return i.tap(function(e){return n(t,e)}).catch(function(){return n(t,null)});return i},onFileUnShare:function e(t,n,r){if(!t)return;TS.files.fetchFileInfo(r.file,function(e,t){TS.web&&TS.files.upsertAndSignal(t,"onFileUnShare")})},fetchTeamFiles:function e(n,r){var i=function e(t,n,i){if(t&&n.files){var a;for(var s=0;s<n.files.length;s+=1){a=n.files[s];TS.files.upsertFile(a,"fetchTeamFiles")}}r&&r(t,n,i)};TS.interop.api.call("files.list",{types:n,count:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},fetchMemberFiles:function e(n,r,i){var a=function e(t,n,r){if(t&&n.files){var a;for(var s=0;s<n.files.length;s+=1){a=n.files[s];TS.files.upsertFile(a,"fetchMemberFiles")}}i&&i(t,n,r)};TS.interop.api.call("files.list",{user:n,types:r,count:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}})},fetchChannelFiles:function e(t,n,r,i){var a=i&&i.length?i.join(","):"";if(n){var s=function e(t,r,i){t&&TS.files.onChannelFetch(t,r,i);n(t,r,i)};TS.interop.api.call("files.list",{channel:t,types:a,count:r}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}else TS.interop.api.call("files.list",{channel:t,types:a}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.files.onChannelFetch&&TS.files.onChannelFetch(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.files.onChannelFetch&&TS.files.onChannelFetch(i,t,n,r);return{data:t,args:n,request_id:r}})},onChannelFetch:function e(t,n,r){if(!t)return;if(n.files){var i;for(var a=0;a<n.files.length;a+=1){i=n.files[a];TS.files.upsertFile(i,"onChannelFetch")}}TS.files.channel_files_fetched_sig.dispatch(r.channel,n.files)},addComment:function e(t,n,r,i){var a={file:t,comment:n,channel:r||"",override_ft:true};var s=function e(t,n,r){TS.files.onFileComment(t,n,r);i&&i(t,n,r)};TS.interop.api.callExpedited("files.comments.add",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileComment:function e(t,n,r){if(!t)return;var i=TS.files.getFileById(r.file);if(!i){TS.error("no file? "+r.file);return}TS.files.addCommentToFile(n.comment,i)},getFileById:function e(t){return TS.redux.files.getFileById(t)},getFileByDownloadUrlPrivate:function e(t){return TS.files.getFileByProp("url_private_download",t)},getFileByProp:function e(t,n){return TS.redux.files.getFileByProp(t,n)},getFileActions:function e(t){if(!t)return;var n={};var r=false;t.user==TS.model.user.id&&(r=true);t.is_public?n.share=true:r?n.share=true:n.share_private_file=true;n.comment=true;t.public_url_shared||"external"===t.mode||TS.model.user.is_restricted||TS.prefs.getTeamPref("disallow_public_file_urls")||(t.is_public?n.create_public_link=true:r&&(n.create_public_link=true));!t.public_url_shared||TS.model.user.is_restricted||!TS.model.user.is_admin&&!r||TS.prefs.getTeamPref("disallow_public_file_urls")||(n.revoke_public_link=true);"hosted"!==t.mode&&"snippet"!==t.mode||(n.download=true);(t.mimetype&&0===t.mimetype.indexOf("image/")||"pdf"===t.filetype||"external"===t.mode||"snippet"===t.mode||"email"===t.mode)&&(n.open_original=true);TS.web&&("post"!==t.mode&&"snippet"!==t.mode&&"space"!==t.mode&&"email"!==t.mode&&"docs"!==t.mode||(n.print=true));"space"!==t.mode||"USLACKBOT"===t.user&&"Getting_Started_with_Posts"===t.name||(n.learn_more=true);"space"!==t.mode&&"docs"!==t.mode||(n.new_window=true);"space"===t.mode&&"locked"!==t.state&&(n.edit=true);if(r){"snippet"!==t.mode&&"post"!==t.mode&&"space"!==t.mode&&"docs"!==t.mode||(n.edit=true);"hosted"!==t.mode&&"email"!==t.mode||(n.edit_title=true);n.delete_file=true}if(TS.model.user.is_admin){var i=TS.interop.members.isExternalById(t.user);n.delete_file=!i}TS.clipboard.canWriteText()&&(n.copy_file_link=true);"external"===t.mode&&(r||TS.model.user.is_admin)&&(n.refresh=true);window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled")&&"hosted"===t.mode&&(n.save_to_dropbox=true);if(TS.client){var a=TS.shared.legacyGetActiveModelOb();if(TS.pins.canUserPinHere(a))if(t.pinned_to&&-1!==t.pinned_to.indexOf(a.id))n.unpin_file=true;else{var s=!!t.is_public;t.channels?s=s||-1!==t.channels.indexOf(a.id):TS.warn("No channels array for file object in getFileActions(): "+t.id);t.groups?s=s||-1!==t.groups.indexOf(a.id):TS.warn("No groups array for file object in getFileActions(): "+t.id);t.ims?s=s||-1!==t.ims.indexOf(a.id):TS.warn("No ims array for file object in getFileActions(): "+t.id);s&&(n.pin_file=true)}}n.rxn_file=true;if(TS.prefs.getTeamPref("disable_file_editing")){n.edit=false;n.edit_title=false}TS.prefs.getTeamPref("disable_file_deleting")&&(n.delete_file=false);if(t.is_tombstoned){n.edit=false;n.edit_title=false;n.delete_file=false}return n},getFileCommentActions:function e(t,n){if(!t)return{};var r={can_edit:!TS.boot_data.feature_file_threads,can_delete:true};t.user!=TS.model.user.id?r.can_edit=false:TS.prefs.getTeamPref("msg_edit_window_mins")>-1&&(Date.now()-TS.interop.datetime.toDateObject(t.timestamp))/6e4>TS.prefs.getTeamPref("msg_edit_window_mins")&&(r.can_edit=false);TS.prefs.getTeamPref("allow_message_deletion")?t.user!=TS.model.user.id&&(TS.model.user.is_admin||(r.can_delete=false)):TS.model.user.is_admin||(r.can_delete=false);if(TS.client){var i=TS.shared.legacyGetActiveModelOb();if(TS.pins.canUserPinHere(i))if(t.pinned_to&&-1!==t.pinned_to.indexOf(i.id))r.can_unpin=true;else{var a=!!n.is_public;n.channels?a=a||-1!==n.channels.indexOf(i.id):TS.warn("No channels array for file object in getFileCommentActions(): "+n.id);n.groups?a=a||-1!==n.groups.indexOf(i.id):TS.warn("No groups array for file object in getFileCommentActions(): "+n.id);n.ims?a=a||-1!==n.ims.indexOf(i.id):TS.warn("No ims array for file object in getFileCommentActions(): "+n.id);a&&(r.can_pin=true)}}r.rxn_file_comment=!TS.boot_data.feature_file_threads;return r},getThumbSrcForFile:function e(t,n){try{t=r(t)}catch(e){return false}var i=v()({suppressAnimations:!TS.prefs.getPref("a11y_animations"),featurePjpeg:TS.boot_data.feature_pjpeg},n);return TS.interop.files.getThumbSrcForFile(t,i)},fileIsImage:function e(t){try{t=r(t)}catch(e){return false}return TS.interop.files.fileIsImage(t)},fileHasRichPreview:function e(t){try{t=r(t)}catch(e){return false}var n=t.mimetype&&-1!==t.mimetype.indexOf("image/");return t.has_rich_preview&&!n},fileIsPDF:function e(t){try{t=r(t)}catch(e){return false}return"pdf"===t.filetype||t.converted_pdf},getFileTemplateArguments:function e(t,n){var r={};r.current_user_id=TS.model.user.id;r.file_partial="generic";/(snippet|post|email|docs)/.test(t.mode)&&(r.file_partial=t.mode);/(space)/.test(t.mode)&&(r.file_partial="post");if(TS.interop.files.isTombstone(t)){r.file_partial="tombstone";r.file_tombstone=true}if(TS.files.fileIsImage(t)){r.file_partial="image";r.image_src=TS.files.getThumbSrcForFile(t,{maxSize:n});r.image_width=360===n?t.thumb_360_w:t.thumb_480_w||t.thumb_360_w;r.image_height=360===n?t.thumb_360_h:t.thumb_480_h||t.thumb_360_h;r.preserve_aspect_ratio=r.image_width>0&&r.image_height>0;r.preview_actions_class="";(r.image_width<170||r.image_height<50)&&(r.preview_actions_class+=" overflow_preview_actions");r.image_width<170&&(r.preview_actions_class+=" overflow_preview_actions_width")}/(post|space|email|docs|generic)/.test(r.file_partial)&&(r.title_hider=true);"snippet"===t.mode&&(r.title_hider="Untitled"===t.title);r.filesize=t.size>2e4&&!/(gdoc|gpres|gsheet|gdraw)/.test(t.filetype);/(space|post)/.test(t.filetype)||(r.meta_filetype=new Handlebars.SafeString(TS.templates.builders.makeFiletypeHTML(t)));TS.templates.builders.makeExternalFiletypeHTML(t)===r.meta_filetype&&(r.meta_filetype=false);if(TS.interop.files.fileIsHostedSupportedMedia(t)){if(TS.interop.files.fileIsSupportedVideo(t)){r.file_is_video=true;var i={width:t.width,height:t.height,source:t.url_private,size:t.size};if(t.video){r.transcoding_status=t.video.status;if(t.video.outputs)for(var a=t.video.outputs.length-1;a>=0;a-=1){var s=t.video.outputs[a];if(!s.source)continue;(!i.width||s.width>i.width)&&(i=s)}}r.video_height=TS.model.native_video_embed_height;t.thumb_video&&(r.poster=t.thumb_video);r.best_source=i.source}if(TS.interop.files.fileIsSupportedAudio(t)){r.file_is_audio=true;r.audio_preload="metadata";t.size<=TS.model.native_media_preload_limit_bytes&&(r.audio_preload="auto")}}return r},getFileDetailsMetaTemplateArguments:function e(t){var n=TS.files.getFileActions(t);var r="post"===t.mode;var i="space"===t.mode||"post"===t.mode;var a="snippet"===t.mode;var s="docs"===t.mode;var o={file:t,user:TS.model.user,download:"hosted"===t.mode,edit_link:r?t.edit_link:t.permalink,edit:(i||a)&&t.user===TS.model.user.id,is_post:r,is_post_or_space:i,is_snippet:a,is_docs:s,show_open_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls"),show_revoke_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls")&&n.revoke_public_link};if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}t&&t.id&&("snippet"!==t.mode&&"post"!==t.mode&&"space"!==t.mode||t.content||t.content_html||t.content_highlight_html||TS.files.fetchFileInfo(t.id));return o},createFileCommentsGroup:function e(t){var n={};function r(e,t,r){var i=TS.redux.channels.getEntityById(t);var a=i&&TS.interop.rules.channels.getDisplayNameForChannel(i);var s=e.share_info&&e.share_info[t];var o=s&&s.timestamp;var l=TS.interop.members.getMemberById(s&&s.user_id);var u=l&&TS.interop.members.getPrefCompliantMemberName(l);n[t]={name:a,first_share:{name:u,timestamp:o},comments:r?[r]:[]}}for(var i=t.comments.length-1;i>=0;i-=1){var a=t.comments[i];a.channel&&(n[a.channel]?n[a.channel].comments.unshift(a):r(t,a.channel,a))}_.each([t.channels,t.groups,t.ims,t.mpims],function(e){if(e)for(var i=e.length-1;i>=0;i-=1){var a=e[i];n[a]||r(t,a)}});t._comments_grouped=n},resetFileCommentsGroup:function e(t){t._comments_grouped=null},sortFiles:function e(t){function n(e,t){if(e.timestamp<t.timestamp)return 1;if(e.timestamp>t.timestamp)return-1;return 0}t.sort(n)},getFileCommentById:function e(t,n){var r;for(var i=0;i<t.comments.length;i+=1){r=t.comments[i];if(r.id==n)return r}return null},addCommentToFile:function e(t,n){var r=TS.files.getFileCommentById(n,t.id);if(r)return r;t._rxn_key=TS.rxns.getRxnKey("file_comment",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;n.comments.push(t);TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_added_sig.dispatch(n,t);return t},editCommentOnFile:function e(t,n){var r;var i=false;var a=false;for(var s=0;s<n.comments.length;s+=1){r=n.comments[s];if(r.id==t.id){i=true;n.comments[s]=t;r.is_starred&&(t.is_starred=true);r._rxn_key&&(t._rxn_key=r._rxn_key);r.pinned_to&&!t.pinned_to&&(t.pinned_to=r.pinned_to);if(n.initial_comment&&r.id==n.initial_comment.id){n.initial_comment=t;a=true}break}}if(!i)return false;TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_edited_sig.dispatch(n,t);a&&TS.files.team_file_changed_sig.dispatch(n);return true},deleteCommentOnFile:function e(t,n){var r;var i=[];var a;for(var s=0;s<n.comments.length;s+=1){r=n.comments[s];if(r.id==t){a=r;n.initial_comment&&r.id==n.initial_comment.id&&(n.initial_comment=null);continue}i.push(r)}if(i.length==n.comments.length)return;n.comments=i;TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_deleted_sig.dispatch(n,t,a);TS.files.team_file_changed_sig.dispatch(n)},sortCommentsOnFile:function e(t){function n(e,t){if(e.timestamp>t.timestamp)return 1;if(e.timestamp<t.timestamp)return-1;return 0}t.comments.sort(n)},upsertFile:function e(t,r){r=r||"no reason";var i="NOOP";var a=[];if(Object.keys(t).length<2){TS.error("upserting a bad file object! it has less than 2 properties",t);return{status:i,file:t,what_changed:a}}if(t&&_.isString(t)&&TS.interop.utility.looksLikeFileId(t)){TS.interop.files.markObjectsAsFresh([t]);t=TS.files.getFileById(t)}else TS.interop.files.markObjectsAsFresh([t.id]);var o=TS.files.getFileById(t.id);var l;var u;var d;t=TS.interop.files.processFileForUpserting(t);if(o){t._rxn_key=TS.rxns.getRxnKey("file",t.id);u=TS.rxns.getExistingRxnsByKey(t._rxn_key);u&&!t.reactions?TS.error("file:"+t.id+" ("+r+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments)for(d=0;d<t.comments.length;d+=1){l=t.comments[d];l._rxn_key=TS.rxns.getRxnKey("file_comment",l.id);u=TS.rxns.getExistingRxnsByKey(l._rxn_key);u&&!l.reactions?TS.warn("comment:"+t.id+" ("+r+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(l._rxn_key,l.reactions);delete l.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);u=TS.rxns.getExistingRxnsByKey(t.initial_comment._rxn_key);u&&!t.initial_comment.reactions?TS.warn("initial_comment:"+t.id+" ("+r+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}for(var c in t)if("channels"===c||"ims"===c||"groups"===c||"pinned_to"===c||"to"===c||"from"===c||"cc"===c||"attachments"===c){var m=false;var f=_.isArray(t[c])?t[c]:[];var p=_.isArray(o[c])?o[c]:[];"to"===c||"from"===c||"cc"===c||"attachments"===c?p.length!=f.length&&(m=true):p.join("")!=f.join("")&&(m=true);if(m){i="CHANGED";a.push(c)}}else if("preview"===c){if(o[c]!==t[c]){i="CHANGED";a=a.concat([c,"content","content_html","content_highlight_html"])}}else if("comments"===c){if(t[c]&&!TS.utility.areSimpleObjectsEqual(t[c],o[c],"file:"+t.id+" "+t.name)){i="CHANGED";a.push(c)}}else if("content"===c){if(t[c]&&o[c]!=t[c]){i="CHANGED";a.push(c)}}else if("editor"===c||"state"===c){if(t[c]!=o[c]){a.push(c);i="CHANGED"}}else if("initial_comment"===c);else if("reactions"===c);else if("channel_map"!==c&&"group_map"!==c&&"im_map"!==c&&"teams"!==c&&"teams_shared_with"!==c&&"users"!==c||TS.utility.isScalar(t[c])){if("video"===c){if(t[c]&&!TS.utility.areSimpleObjectsEqual(t[c],o[c],"file:"+t.id+" "+t.name)){i="CHANGED";a.push(c)}}else if("shares"===c)TS.boot_data.feature_file_threads&&(TS.utility.areSimpleObjectsEqual(o[c],t[c])||(i="CHANGED"));else if("pinned_info"===c){if(!TS.utility.areSimpleObjectsEqual(o[c],t[c])){i="CHANGED";a.push(c)}}else if(o[c]!=t[c])if(t[c]&&!TS.utility.isScalar(t[c]))TS.warn(c+" is not scalar! it needs to be handled by upsertFile specifically to test if it has changed! "+s()(t[c]));else if("boolean"!==typeof t[c]||!t[c]!=!o[c]){a.push(c+" ["+o[c]+"] -> ["+t[c]+"]");i="CHANGED"}}else;o=t}else if(t&&_.isObject(t)){i="ADDED";t._rxn_key=TS.rxns.getRxnKey("file",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments){for(d=0;d<t.comments.length;d+=1){l=t.comments[d];l._rxn_key=TS.rxns.getRxnKey("file_comment",l.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(l._rxn_key,l.reactions);delete l.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}}var h=TS.redux.members.getPotentiallyUnknownMemberById(t.user);if(h){h.files.push(t);TS.files.sortFiles(h.files)}else TS.error("hmmm, file "+t.id+" does not have a known user "+t.user);n(t);o=t}if("CHANGED"===i){n(t);_.includes(a,"comments")&&TS.utility.msgs.updateCommentReferences(o)}"NOOP"!==i&&TS.redux.dispatch(TS.interop.redux.models.files.addFile(o));return{status:i,file:o,what_changed:a}},upsertAndSignal:function e(t,n){var r=TS.files.upsertFile(t,n);"CHANGED"===r.status?TS.files.team_file_changed_sig.dispatch(r.file):"ADDED"===r.status&&TS.files.team_file_added_sig.dispatch(r.file);return r},removeFile:function e(t){TS.log(4,'removing file "'+t+'"');var n=TS.files.getFileById(t);n&&(n.is_deleted=true);if(TS.boot_data.feature_file_threads_dark_launch&&n){TS.redux.dispatch(TS.interop.redux.models.files.tombstoneFile({fileId:t}));n=TS.files.getFileById(t)}TS.model.channels.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.groups.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.ims.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.mpims.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});n&&TS.files.team_file_deleted_sig.dispatch(n)},upload:function e(t){TS.files.uploading?TS.files.uploadQ.push(t):TS.files.actuallyUpload(t)},actuallyUpload:function t(n){TS.files.uploading=true;n.retry_num=n.retry_num||0;var r=new FormData;var i;var a=!!n.file;n.title&&(n.title=TS.emoji.maybeGetCanonicalEmojiString(n.title));if(n.text){i=n.title||n.filetype;TS.files.file_uploading_sig.dispatch(i,n.retry_num>0,a);r.append("content",n.text);n.filetype&&r.append("filetype",n.filetype);n.filename&&TS.warn("ignoring filename because it makes no sense for text files")}else{i=n.title||n.filename||n.file&&n.file.name||"blob";TS.files.file_uploading_sig.dispatch(i,n.retry_num>0,a);"string"===typeof n.file?r.append("content64",n.file):r.append("file",n.file);n.filename&&r.append("filename",n.filename);n.filetype&&TS.warn("ignoring filetype we send a filename which can intuit it")}r.append("token",TS.model.api_token);if(n.channels&&n.channels.length){var s="";"string"===typeof n.channels?s=n.channels:n.channels.join&&(s=n.channels.join(","));r.append("channels",s)}r.append("title",n.title);n.initial_comment&&r.append("initial_comment",TS.format.cleanMsg(n.initial_comment));var o="files.uploadAsync";if(n.link){n.is_dropbox&&(o="files.uploadExternal");n.is_box&&(o="files.uploadExternal");r.append("link",n.link)}if(TS.boot_data.feature_file_threads){n.thread_ts&&r.append("thread_ts",n.thread_ts);n.broadcast&&r.append("broadcast",n.broadcast)}var l;l="files.uploadAsync"===o?TS.model.async_api_url+o:TS.model.api_url+o;var u=n;var d=false;e=$.ajax({url:l,data:r,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=parseInt(100*e.loaded/e.total,10);TS.files.file_progress_sig.dispatch(t)}else TS.info("Upload length not computable")},false);return e},error:function e(t,r,a){d=true;TS.info("Error: Failed to upload file.");TS.info("textStatus:"+r+" errorThrown:"+a);TS.info("data:"+t);if("abort"===r){TS.files.file_canceled_sig.dispatch(i);TS.files.uploadOver(false);return}if(0===n.retry_num){n.retry_num+=1;TS.files.actuallyUpload(n)}else TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadOver(false)}})},complete:function e(t){if(d)return;t=jQuery.parseJSON(t.responseText);if(t&&t.ok&&t.file)if("files.uploadAsync"===o){var r=function e(t,n,r){if(!TS.files.polling_file_id)return;if(t)if("complete"===n.status){var i=TS.files.upsertAndSignal(n.file,"actuallyUploadAsync");TS.files.uploadProcessingOver(true,i.file.id,u)}else if("failed"===n.status){var a="";n.debug&&TS.boot_data.feature_tinyspeck&&(a="<br><br>TS only Debugging:<br><br>"+n.debug);TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")()+a,go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){r.retry_num+=1;TS.files.actuallyUpload(r)},onCancel:function e(){TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}})}else TS.files.pollForUploadProcessing();else{TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload.","files")(),show_cancel_button:true});TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}};TS.files.startPollingForUploadProcessing(t.file,t.ticket,r)}else{var i=TS.files.upsertAndSignal(t.file,"actuallyUpload");TS.files.uploadOver(t.ok,i.file.id,u)}else{TS.info("Error: Failed to upload file.");TS.info(t);if(t)if(0===n.retry_num){n.retry_num+=1;TS.files.actuallyUpload(n)}else"folders_not_supported"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Folders not supported","files")(),body:TS.interop.i18n.t("<p>Sorry, <strong>{folder_name}</strong> is a folder, and folder uploads are not supported by Slack.</p>\t\t\t\t\t\t\t\t\t<p>Try uploading a .zip version of the file instead.</p>","files")({folder_name:_.escape(n.filename)}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}}):"request_timeout"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("File upload timed out","files")(),body:TS.interop.i18n.t('<p>It looks like you\u2019re on a slow or inconsistent internet connection. You may want to try your file upload again later. Or, try again now and it might work if you cross your fingers!</p>\t\t\t\t\t\t\t\t\t<p>If you\u2019re still having problems, you can:</p>\t\t\t\t\t\t\t\t\t<ul><li><a href="/help/test" target="{new_win_name}" class="bold">Run our Self-Help Tests</a></li>\t\t\t\t\t\t\t\t\t<li><a href="/help/requests/new" target="{new_win_name}" class="bold">Contact our support team</li></ul>',"files")({new_win_name:TS.templates.builders.newWindowName()}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}}):"file_uploads_disabled"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}}):"file_uploads_except_images_disabled"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, only images can be uploaded to this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}}):TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadOver(false)}});else{alert("Upload failed.");TS.files.uploadOver(false)}}}})},startPollingForUploadProcessing:function e(t,n,r){TS.files.polling_count=0;TS.files.polling_file_id=t;TS.files.polling_ticket=n;TS.files.polling_handler=r;TS.files.pollForUploadProcessing()},pollForUploadProcessing:function e(){TS.files.polling_count+=1;TS.files.polling_tim=setTimeout(function(){if(!TS.files.polling_ticket)return;var e=function e(t,n,r){if(!TS.files.polling_ticket)return;TS.files.polling_handler(t,n,r)};TS.interop.api.callExpedited("files.uploadStatus",{ticket:TS.files.polling_ticket}).then(function(t){var n=t.data,r=t.args,i=t.request_id;var a=true;e(a,n,r,i);return{data:n,args:r,request_id:i}}).catch(function(t){var n=t.data,r=t.args,i=t.request_id;var a=false;e(a,n,r,i);return{data:n,args:r,request_id:i}})},1e3*TS.files.polling_count)},uploadProcessingOver:function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(TS.files.polling_file_id!=n)return;TS.info("TS.files.uploadProcessingOver polling_file_id:"+TS.files.polling_file_id+" polling_ticket:"+TS.files.polling_ticket+" polling_count:"+TS.files.polling_count);TS.files.polling_count=0;TS.files.polling_file_id=null;TS.files.polling_ticket=null;TS.files.polling_handler=null;clearTimeout(TS.files.polling_tim);TS.files.uploadOver(t,n,r)},uploadOver:function t(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};TS.files.file_uploaded_sig.dispatch(n,r,i);TS.files.uploading=false;e=null;TS.files.uploadQ.length?TS.files.actuallyUpload.call(null,TS.files.uploadQ.shift()):TS.files.file_queue_emptied_sig.dispatch()},cancelCurrentUpload:function t(){e&&e.abort()},deleteFile:function e(t){TS.interop.api.call("files.delete",{file:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.files.onFileDelete&&TS.files.onFileDelete(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.files.onFileDelete&&TS.files.onFileDelete(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileDelete:function e(t){!t},endEditFileTitle:function e(){$("#file_edit_title_container").addClass("hidden");$("#file_title_container").removeClass("hidden")},saveEditFileTitle:function e(t){var n=TS.files.getFileById(t);if(!n)return;var r=$("#file_edit_title_input").val();if(!$.trim(r)){TS.sounds.play("beep");return}var i=n.title;if(i==r){TS.files.endEditFileTitle();return}var a=function e(n){if(!n){TS.files.upsertAndSignal({id:t,title:i},"saveEditFileTitle");TS.generic_dialog.alert(TS.interop.i18n.t("Something\u2019s gone wrong, and your change didn\u2019t save. If you see this message more than once, you may want to try restarting Slack.","files")(),TS.interop.i18n.t("Oh, crumbs!","files")(),TS.interop.i18n.t("Got it","files")())}};TS.interop.api.callExpedited("files.edit",{file:t,title:TS.emoji.maybeGetCanonicalEmojiString(r)}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}});r=_.escape(r);TS.files.upsertAndSignal({id:t,title:r},"saveEditFileTitleOptimistic");TS.files.endEditFileTitle()},editFileTitle:function e(t){var n=TS.files.getFileById(t);if(!n)return;var r=n.title;r=r?TS.format.unFormatMsg(r):n.name;$("#file_title_container").addClass("hidden");$("#file_edit_title_container").removeClass("hidden");$("#file_edit_title_input").val(r);$("#file_edit_title_input").select()},openBoxChooser:function e(t,n){TS.utility.box.unregister(TS.utility.box.SUCCESS_EVENT_TYPE,TS.files.onBoxChooser);TS.boot_data.feature_file_threads?TS.utility.box.success(function(e){TS.files.onBoxChooser(e,t,n)}):TS.utility.box.success(TS.files.onBoxChooser);TS.utility.box.launchPopup()},onBoxChooser:function e(t,n,r){var i=new Array(t.length);for(var a=0;a<t.length;a+=1){var s=t[a];i[a]={name:s.name,link:s.url,is_box:true}}TS.boot_data.feature_file_threads?TS.redux.dispatch(TS.interop.redux.actions.openFileUploadDialog({files:i,initialChannelId:n||TS.model.active_cid,threadTs:r})):TS.ui.upload_dialog.startWithCommentFromChatInput(i)},openDropboxChooser:function e(t,n){var r="preview";var i=TS.files.onDropboxChooser;TS.boot_data.feature_file_threads&&(i=function e(r){TS.files.onDropboxChooser(r,t,n)});Dropbox.choose({success:i,linkType:r,multiselect:true})},onDropboxChooser:function e(t,n,r){var i=[];for(var a=0;a<t.length;a+=1){var s=t[a];i.push({name:s.name,size:s.bytes,link:s.link,icon:s.icon,is_dropbox:true})}TS.boot_data.feature_file_threads?TS.redux.dispatch(TS.interop.redux.actions.openFileUploadDialog({files:i,initialChannelId:n||TS.model.active_cid,threadTs:r})):TS.ui.upload_dialog.startWithCommentFromChatInput(i)},makeFileNameFromFile:function e(t){return t.name||TS.interop.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toFilenameFriendlyDate(Date.now()/1e3)})+".png"},makeFileTitleFromFile:function e(t){return t.name||TS.interop.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toDate(Date.now()/1e3)})},justUploadTheseFileNow:function e(t,n,r){var i;for(var a=0;a<t.length;a+=1){i=t[a];if(i.size>TS.model.upload_file_size_limit_bytes)continue;TS.boot_data.feature_file_threads?TS.files.upload({file:i,filename:TS.files.makeFileNameFromFile(i),title:TS.files.makeFileTitleFromFile(i),channels:[n||TS.shared.legacyGetActiveModelOb().id],initial_comment:"",thread_ts:r}):TS.files.upload({file:i,filename:TS.files.makeFileNameFromFile(i),title:TS.files.makeFileTitleFromFile(i),channels:[TS.shared.legacyGetActiveModelOb().id],initial_comment:""})}},refreshFile:function e(t){TS.files.startRefreshingFile(t);TS.interop.api.call("files.refresh",{file:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.files.onFileRefresh&&TS.files.onFileRefresh(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.files.onFileRefresh&&TS.files.onFileRefresh(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileRefresh:function e(t,n,r){var i=r.file;if(t)TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.interop.i18n.t("File refreshed!","files")()).end();else if(!t){TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("Refresh failed.","files")()+"</span>",5e3);TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.interop.i18n.t("Refresh failed","files")()).end()}t&&!n.will_refresh&&TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("File refreshed < 1 minute ago.","files")()+"</span>",5e3);if(TS.web&&t){TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.interop.i18n.t("Reloading...","files")());TS.reload(false,"TS.files.onFileRefresh")}if(!t&&"file_deleted"===n.error){var a=TS.files.getFileById(i);a&&TS.files.removeFile(a.id)}},fileWasMaybeRefreshed:function e(t){if(!t)return;if(!TS.files.waiting_for_refresh[t.id])return;TS.files.doneRefreshingFile(t.id,'<span class="kelly_green">'+TS.interop.i18n.t("File refreshed!","files")()+"</span>",6e4)},startRefreshingFile:function e(t){TS.files.waiting_for_refresh[t]=true;$('.file_refresh[data-file-id="'+t+'"]').addClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').removeClass("hidden")},doneRefreshingFile:function e(t,n,r){delete TS.files.waiting_for_refresh[t];$('.file_refresh_status[data-file-id="'+t+'"]').html(n);setTimeout(function(){$('.file_refresh[data-file-id="'+t+'"]').removeClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').text(TS.interop.i18n.t("Refreshing file...","files")()).addClass("hidden")},r)},reShareConfirmation:function e(t,n){var r=t.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e.user,true)});r=_.uniq(r);var i=TS.shared.legacyGetActiveModelOb();var a=TS.interop.rules.channels.isExternallySharedChannel(i);var s;var o;if(a&&(i.is_im||i.is_mpim||i.is_private)){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} could be shared with anyone from <strong>{workspace_name}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(r).join("")),workspace_name:TS.interop.i18n.safeString(i.is_im?_.escape(TS.teams.getTeamNameByMemberId(i.user)):TS.interop.i18n.listify(_.map(i.shared_team_ids,TS.teams.getTeamNameById)).join("")),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(a&&i.is_channel){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} will be viewable by anyone from <strong>{workspace_names}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(r).join("")),workspace_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(_.map(i.shared_team_ids,TS.teams.getTeamNameById)).join("")),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_im){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by <strong>{recipient_name}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(r).join("")),recipient_name:TS.interop.i18n.safeString(TS.templates.builders.makeModelObNameForDisplay(i)),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_mpim){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by everyone in this conversation.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(r).join("")),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else{s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by anyone in <strong>{channel_name}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(r).join("")),channel_name:TS.interop.i18n.safeString(TS.templates.builders.makeModelObNameForDisplay(i)),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}TS.generic_dialog.start({title:s,body:o,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Share {file_count, plural, =1 {file} other {files}}","files")({file_count:t.length}),cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:n})},updateFileListItem:function e(t,n){var r=n.find('.file_list_item[data-file-id="'+t.id+'"]');if(r.length){r.replaceWith(TS.templates.builders.fileHTML(t));TS.files.fileIsImage(t)&&n.find(".lazy").lazyload()}},containerHasFileListItem:function e(t,n){return!!n.find('.file_list_item[data-file-id="'+t.id+'"]').length},nonImageCanUseFSFV:function e(t){if(!t)return false;return TS.model.pdf_viewer_enabled&&"hosted"===t.mode&&TS.files.fileIsPDF(t)&&t.size<=5e7},maybePruneChannels:function e(t){if(!t)return;if(t.channels&&t.channel_map){var n=_(t.channel_map).map(function(e){return TS.interop.rules.channels.isOrgShared(e)||e.team===TS.model.team.id?e.id:void 0}).compact().value();t.channels=_.intersection(t.channels,n)}},getMessageListener:function e(t){return function(e){if(e.origin!==window.location.origin)return;if(e.data.method!==t.method)return;e.data.ok?t.resolve(e.data):t.reject(new Error(t.method+" not ok"))}},test:function e(){return{_handleFileUploaded:i}}});var e=null;var t=20;var n=function e(t){if(!TS.files.fileIsImage(t))return;var n={width:t.thumb_360_w,height:t.thumb_360_h,link_url:t.url_private,internal_file_id:t.id};"gif"===t.filetype&&(t.deanimate_gif?TS.inline_imgs.makeInternalInlineImg(t.deanimate_gif,n):t.thumb_160&&TS.inline_imgs.makeInternalInlineImg(t.thumb_160,n));if(t.thumb_480_gif||t.thumb_360_gif){t.thumb_480_gif&&TS.inline_imgs.makeInternalInlineImg(t.thumb_480_gif,n);t.thumb_360_gif&&TS.inline_imgs.makeInternalInlineImg(t.thumb_360_gif,n)}else{t.thumb_720&&TS.inline_imgs.makeInternalInlineImg(t.thumb_720,n);t.thumb_480&&TS.inline_imgs.makeInternalInlineImg(t.thumb_480,n);t.thumb_360&&TS.inline_imgs.makeInternalInlineImg(t.thumb_360,n);TS.boot_data.feature_pjpeg&&t.pjpeg&&TS.inline_imgs.makeInternalInlineImg(t.pjpeg,n);TS.boot_data.feature_pdf_thumb&&t.thumb_pdf&&TS.inline_imgs.makeInternalInlineImg(t.thumb_pdf,n)}};var r=function e(t){var n=_.isString(t)?TS.files.getFileById(t):t;if(!_.isObject(n))throw new Error("Expected file or file ID.");return n};var i=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return;var i=TS.files.getFileById(n);if(!i)return;if(TS.boot_data.feature_file_threads&&r.thread_ts){var a=r.channels;var s=r.thread_ts;TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:a,threadTs:s}));r.broadcast&&TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:a}))}else{var o=TS.interop.files.getFileShareLocations(i);o.forEach(function(e){return TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:e}))})}}})();var O=n(2903);var D=n(2904);var H=n(2905);var j=n(2906);var B=n(2907);var L=n(24);var N=n.n(L);(function(){TS.registerModule("members",{presence_changed_sig:new signals.Signal,ds_presence_changed_sig:new signals.Signal,user_color_changed_sig:new signals.Signal,joined_team_sig:new signals.Signal,changed_current_status_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_real_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_profile_sig:new signals.Signal,changed_tz_sig:new signals.Signal,changed_account_type_sig:new signals.Signal,changed_admin_perms_sig:new signals.Signal,changed_owner_perms_sig:new signals.Signal,changed_self_sig:new signals.Signal,lazily_added_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,member_was_upserted_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,legacy_is_in_bulk_upsert_mode:false,onStart:function e(){TS.channels.joined_sig.add(function(){TS.members.invalidateMembersUserCanSeeArrayCaches()});TS.channels.left_sig.add(function(){TS.members.invalidateMembersUserCanSeeArrayCaches()});TS.redux.socket.disconnectedSig.add(x);TS.channels.member_joined_sig.add(function(e,t){var n=true;var r=TS.interop.members.getMemberById(t);I(r,n)},TS.members,-1);TS.channels.member_left_sig.add(function(e,t){var n=TS.interop.members.getMemberById(t);M(n)},TS.members,-1);TS.channels.joined_sig.add(w);TS.channels.left_sig.add(w);TS.client&&TS.client.login_sig.addOnce(function(){TS.members.changed_deleted_sig.add(function(e){var t=!e.deleted;I(e,t)},TS.members,-1)})},legacySetAccessibleUserIds:function e(t,n){if(!TS.model.user.is_restricted||TS.boot_data.feature_scg_api_filters)return;l.length=0;TS.model.guest_accessible_user_ids=t;TS.model.need_guest_accessible_user_ids=!!n},legacyMaybeFetchAccessibleUserIds:function e(){if(TS.isPartiallyBooted()&&!TS._did_full_boot)return Promise.resolve();if(!TS.model.user.is_restricted||TS.boot_data.scg_api_filters)return Promise.resolve();TS.model.guest_accessible_user_ids=TS.model.guest_accessible_user_ids||[];return TS.interop.api.call("conversations.guestVisibleMembers").then(function(e){var t=e.data;var n=t.members;if(!_.isEqual(_.sortBy(n),_.sortBy(TS.model.guest_accessible_user_ids))){var r=false;TS.members.legacySetAccessibleUserIds(n,r)}y=Date.now()})},legacyUpsertAndSignal:function e(t){var n=TS.members.legacyUpsertMember(t);return O(n,t)},legacyUpsertMember:function t(n){var r=TS.redux.members.hasMemberWithId(n.id)&&TS.interop.members.getRawMemberById(n.id);var i="NOOP";var a=[];n=TS.interop.members.processMemberForUpserting(n);if(r){TS.has_pri[P]&&TS.log(P,'updating existing member "'+n.id+'"');var s=S(r,n);i=s.status;a=s.what_changed;if(_.includes(a,"deleted")){var o=TS.redux.channels.getImByMemberId(n.id);o&&(o.is_archived=n.deleted)}}else if(n.id){i="ADDED";_.includes(u,n.id)&&a.push("is_unknown");T(n);TS.has_pri[P]&&TS.log(P,'adding member "'+n.id+'" color:'+n.color+" member_color:"+n.member_color)}else TS.error("bad error, no member.id");if(n.is_self&&n.deleted){TS.reload(null,"member.is_self && member.deleted");return}if(!TS.members.legacy_is_in_bulk_upsert_mode){TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches()}TS.members.member_was_upserted_sig.dispatch();if(!TS.members.legacy_is_in_bulk_upsert_mode){if("NOOP"!==i){TS.redux.dispatch(TS.interop.redux.models.members.addMember(n));TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:n.id,presence:n.presence}))}TS.interop.members.markObjectsAsFresh([n.id])}var l={status:i,member:n,what_changed:a};TS.members.legacy_is_in_bulk_upsert_mode&&e.push(l);return l},setMemberUserColor:function e(t,n){n=_.escape(n);t.member_color=n||t.color;n&&n!=t.color?TS.model.user_colors[t.id]=n:delete TS.model.user_colors[t.id];TS.members.user_color_changed_sig.dispatch(t)},getActiveMembersWithSelfAndNotSlackbot:function e(){t.length||(t=d(t,{include_self:true,include_slackbot:false,include_bots:true}));return t},getActiveMembersExceptSelfAndSlackbot:function e(){n.length||(n=d(n,{include_self:false,include_slackbot:false,include_bots:true}));return n},getActiveMembersWithSelfAndSlackbot:function e(){i.length||(i=d(i,{include_self:true,include_slackbot:true,include_bots:true}));return i},getMembersWithOptions:function e(t){var n=TS.members.getMembersForUser();var r=_.filter(n,function(e){if(e.is_stranger)return false;if(t.only_admins)return e.is_admin&&!e.deleted;if(t.only_local_team&&!e._is_local)return false;if(!t.include_deleted&&e.deleted)return false;if(!t.include_slackbot&&TS.interop.rules.members.isSlackbotOrTeambot(e,TS.boot_data.feature_teambot))return false;if(!t.include_self&&e.is_self)return false;if(!t.include_bots&&e.is_bot)return false;return true});return r},getMembersForUser:function e(){if(l.length)return l;if(!TS.model.user.is_restricted||TS.boot_data.feature_scg_api_filters){l=_.filter(TS.redux.members.getAllMembers(),function(e){return true!==e.is_stranger&&!!e.name});return l}var t={};(TS.model.guest_accessible_user_ids||[]).forEach(function(e){t[e]=true});l=Object.keys(t).filter(TS.redux.members.hasMemberWithId).map(function(e){return TS.interop.members.getMemberById(e)}).filter(function(e){return e&&!e.deleted&&!!e.name});return l},legacyGetPrefCompliantMemberNameLowerCase:function e(t,n){if(!t)return"";var r=function(){var e=TS.interop.members.getMemberRealNameLowerCase(t);!TS.interop.members.shouldDisplayRealNames()&&TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(t)&&(e=TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(t));return e}();return n?_.escape(r):r},invalidateMembersUserCanSeeArrayCaches:function e(){if(!TS.model.user)return;var t=l.length;if(!t)return;l.length=0;TS.members.invalidateActiveMembersArrayCaches()},invalidateActiveMembersArrayCaches:function e(){t.length=0;n.length=0;r.length=0;i.length=0;a.length=0;o.length=0},legacyMemberSorterByActiveWithBotsLast:function e(t){var n=t.filter(function(e){return e.is_bot||TS.interop.rules.members.isSlackbotOrTeambot(e,TS.boot_data.feature_teambot)});var r=n.filter(function(e){return"active"===e.presence});var i=n.filter(function(e){return"away"===e.presence});var a=t.filter(function(e){return!e.is_bot&&!TS.interop.rules.members.isSlackbotOrTeambot(e,TS.boot_data.feature_teambot)});var s=a.filter(function(e){return"active"===e.presence});var o=a.filter(function(e){return"away"===e.presence});var l=s.sort(function(e,t){var n=TS.interop.members.getPrefCompliantMemberName(e)||e.name;var r=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(n,r)});var u=o.sort(function(e,t){var n=TS.interop.members.getPrefCompliantMemberName(e)||e.name;var r=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(n,r)});var d=r.sort(TS.interop.i18n.mappedSorter("name"));var c=i.sort(TS.interop.i18n.mappedSorter("name"));var _=[];_.push.apply(_,N()(l).concat(N()(d),N()(u),N()(c)));return _},legacyEnsureMembersInDataArePresent:function e(t,n){var r=TS.interop.utility.extractAllMemberIds(t);if("T02J3DPUE"===_.get(TS,"model.team.id")&&!_.isEmpty(r)){var i=_.some(r,function(e){return"U"===e[0]});if(i){var a={message:"Fetching U users on W team from source: "+n,stack:TS.console.getStackTrace()};$.post(TS.boot_data.beacon_error_url,{description:"fetch_u_on_w_team",error_json:JSON.stringify(a),team:_.get(TS,"model.team.id","none"),user:TS.boot_data.user_id,version:TS.boot_data.version_ts})}}return TS.interop.members.ensureMembersArePresent(r)},fetchAndUpsertMembersWithQuery:function e(t){return TS.interop.members.fetchAndUpsertMembersWithQuery({query:t}).then(function(e){var t=e.members,n=e.next_marker;return{objects:t,next_marker:n}})},legacyEnsureMembersArePresentInModelObs:function e(t){var n=[];var r=[];t.forEach(function(e){if(e.is_im){n.push(e.user);r.push(e.id)}else if(e.is_mpim){n.push.apply(n,e.members||[]);r.push.apply(r,_.fill(Array(e.members&&e.members.length||0),e.id))}else if(e.is_channel);else if(e.is_group){n.push.apply(n,e.members||[]);r.push.apply(r,_.fill(Array(e.members&&e.members.length||0),e.id))}else TS.warn("legacyEnsureMembersArePresentInModelObs found an unexpected model_ob type")});if(!n.length)return Promise.resolve();return TS.interop.members.ensureMembersArePresent(n,r)},legacyStartBatchUpsert:function e(){if(TS.members.legacy_is_in_bulk_upsert_mode)return false;TS.members.legacy_is_in_bulk_upsert_mode=true;return true},legacyFinishBatchUpsert:function t(){if(!TS.members.legacy_is_in_bulk_upsert_mode)return false;TS.members.legacy_is_in_bulk_upsert_mode=false;TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches();var n=_.partition(e,function(e){return _.includes(e.what_changed,"is_unknown")});var r=n[0];TS.redux.dispatch(TS.interop.redux.models.members.bulkAddMembers(e.map(function(e){return e.member})));TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(e.map(function(e){return e.member})));r.length>0&&TS.members.changed_is_unknown_sig.dispatch({batch:_.map(r,"member")});TS.members.batch_upserted_sig.dispatch(e);TS.interop.members.markObjectsAsFresh(_.map(e,"member.id"));e=[];return true},legacyAllocateTeamListMembers:function e(t){var n;var r=[];var i=[];var a=[];var s=[];var o=[];var l=[];t.sort(function(e,t){var n=e._real_name_lc||e._name_lc;var r=t._real_name_lc||t._name_lc;if(n>r)return 1;if(r>n)return-1;return 0});for(var u=0;u<t.length;u+=1){n=t[u];n.deleted?n.is_bot?a.push(n):i.push(n):n.is_ultra_restricted?l.push(n):n.is_restricted?o.push(n):n.is_bot||TS.interop.rules.members.isSlackbotOrTeambot(n,TS.boot_data.feature_teambot)?s.push(n):r.push(n)}return{members:r,disabled_members:i,deleted_bots:a,bots:s,restricted_members:o,ultra_restricted_members:l}},promiseToSearchMembers:function e(t){return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e.query=e.query&&e.query.trim()||"";e.include_org=!!TS.boot_data.page_needs_enterprise&&!!e.include_org;e.org_team_ids=e.include_org&&Array.isArray(e.org_team_ids)?e.org_team_ids:[];e=m(e,TS.interop.searcher.isNewMemberSearch(e));if(e._is_new||e.num_remaining>0)return f(e);return Promise.resolve(e)})},readyMemberSearcher:function e(t,n){return m(t,n)},buildPromiseToSearchMembersArguments:function e(t){return p(t)},userAddedToTeam:function e(t){var n=_.merge({},TS.model.user);n.enterprise_user.teams=_.uniq(n.enterprise_user.teams.concat(t));TS.members.legacyUpsertMember(n);w();TS.members.user_added_to_team_sig.dispatch(t)},userRemovedFromTeam:function e(t){var n=_.merge({},TS.model.user);n.enterprise_user.teams=n.enterprise_user.teams.filter(function(e){return e!==t});TS.members.legacyUpsertMember(n);w();TS.members.user_removed_from_team_sig.dispatch(t)},legacyEnsureMemberObjectsForUserProfileFields:function e(t){var n=[];t.is_restricted&&t.profile.guest_invited_by&&n.push(t.profile.guest_invited_by);var r=TS.team.getVisibleTeamProfileFieldsForMember(t);var i=_.chain(r).filter({type:"user"}).reduce(function(e,t){return e.concat(t.value.split(/\s*,\s*/))},[]).value();n=_.chain(n).concat(i).compact().uniq().value();if(!n.length)return Promise.resolve();return TS.interop.members.ensureMembersArePresent(n)},maybeUpdateMembersUserCanSee:function e(t){if(!t)return k();return TS.interop.members.ensureMembersArePresent([t]).then(function(){var e=true;return I(TS.interop.members.getMemberById(t),e)})},legacySetMemberUnknown:function e(t){u.push(t)},getAvatarBaseUrl:function e(){return TS.model.team&&TS.model.team.avatar_base_url},test:function e(){var e={};Object.defineProperty(e,"_maybeRefetchAccessibleUserIds",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(e,"_is_refetching_accessible_user_ids",{get:function e(){return v},set:function e(t){v=t}});Object.defineProperty(e,"_did_receive_multiple_calls_to_refetch_accessible_user_ids",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(e,"_accessible_user_ids_last_fetched_ts",{get:function e(){return y},set:function e(t){y=t}});Object.defineProperty(e,"_processNewMemberForUpserting",{get:function e(){return T},set:function e(t){T=t}});Object.defineProperty(e,"_processExistingMemberForUpserting",{get:function e(){return S},set:function e(t){S=t}});Object.defineProperty(e,"_fillMembersWithOptions",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(e,"_members_for_user",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(e,"_setMustUpdateMembersUserCanSee",{get:function e(){return x},set:function e(t){x=t}});Object.defineProperty(e,"_mustUpdateMembersUserCanSee",{get:function e(){return C},set:function e(t){C=t}});Object.defineProperty(e,"_maybeSetMemberUserCanSee",{get:function e(){return I},set:function e(t){I=t}});Object.defineProperty(e,"_maybeUpdateMemberVisibility",{get:function e(){return M},set:function e(t){M=t}});return e}});var e=[];var t=[];var n=[];var r=[];var i=[];var a=[];var o=[];var l=[];var u=[];var d=function e(t,n){if(!_.isArray(t))throw new TypeError("members passed to _fillMembersWithOptions is not an array!");t.length=0;var r=TS.members.getMembersWithOptions(n);_.each(r,function(e){t.push(e)});return t};var c=function e(t){var n=!!t&&t.is_unknown;t&&t.is_unknown&&(t.is_unknown=false);_.pull(u,t.id);return n};var m=function e(t,n){t=t||{};t.hasOwnProperty("_searcher_p")&&n&&t._searcher_p.cancel();t.hasOwnProperty("_cursor_mark")&&!n||(t._cursor_mark="");t.hasOwnProperty("full_profile_filter")||(t.full_profile_filter=true);t.hasOwnProperty("include_bots")||(t.include_bots=true);t.hasOwnProperty("include_deleted")||(t.include_deleted=false);t.hasOwnProperty("include_self")||(t.include_self=false);t.hasOwnProperty("include_slackbot")||(t.include_slackbot=true);t.hasOwnProperty("only_local_team")||(t.only_local_team=false);t.hasOwnProperty("only_admins")||(t.only_admins=false);t.hasOwnProperty("items")&&!n||(t.items=[]);t.hasOwnProperty("not_member_of")||(t.not_member_of=[]);t.hasOwnProperty("member_of")||(t.member_of=[]);t.hasOwnProperty("num_found")&&!n||(t.num_found=0);t.hasOwnProperty("num_remaining")&&!n||(t.num_remaining=0);t.hasOwnProperty("num_new")&&!n||(t.num_new=0);t.hasOwnProperty("max_api_results")||(t.max_api_results=100);if(n){t._last_query=t.query;t._last_include_org=t.include_org;t._last_org_team_ids=t.org_team_ids}t._is_new=!!n;return t};var f=function e(t){var n=function e(){return h(t)};t._is_new?t._searcher_p=n():t._searcher_p=t._searcher_p.then(n);return t._searcher_p};var p=function e(t){var n=[TS.utility.search.makeClause("is","user")];if(t._last_query){var r=t._last_query.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!t.full_profile_filter)return TS.utility.search.makeConjunction("OR",[TS.utility.search.makeClause("real_name",e),TS.utility.search.makeClause("display_name",e)]);return TS.utility.search.makeClause("fuzzy_with_email",e)});n=n.concat(r)}if(t.not_member_of&&t.not_member_of.length){var i=t.not_member_of.map(function(e){return TS.utility.search.makeClause("not_member_of",e)});n.push(i.length>1?TS.utility.search.makeConjunction("OR",i):i[0])}if(t.member_of&&t.member_of.length){var a=t.member_of.map(function(e){return TS.utility.search.makeClause("member_of",e)});n.push(a.length>1?TS.utility.search.makeConjunction("OR",a):a[0])}if(t._last_include_org&&t._last_org_team_ids.length){var s=t._last_org_team_ids.map(function(e){return TS.utility.search.makeClause("belongs_to_team_id",e)});n.push(s.length>1?TS.utility.search.makeConjunction("OR",s):s[0])}var o=n.length>1?TS.utility.search.makeConjunction("AND",n):n[0];var l={query:o,count:t.max_api_results,include_bots:t.include_bots,include_deleted:t.include_deleted,ignore_guest_accounts:t.ignore_guest_accounts,only_local_team:t.only_local_team,only_admins:t.only_admins,raw_query:t.query};t._last_include_org&&(l.all_of_org=t._last_include_org);t._cursor_mark&&(l.cursor_mark=t._cursor_mark);t.determine_membership_for_channel&&(l.determine_membership_for_channel=t.determine_membership_for_channel);return l};var h=function e(t){var n=p(t);t.num_new=0;return TS.utility.search.promiseToSearch(n).then(function(e){if(!e.data.items.length)return Promise.resolve(t);if(!t.num_remaining){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}t.num_remaining-=e.data.items.length;t._cursor_mark=e.data.next_cursor_mark;var n=e.data.items.map(function(e){var n=TS.interop.members.getMemberById(e.id);if(!n){if(t._last_include_org&&e.team_id!==TS.model.team.id){e.is_primary_owner=false;e.is_owner=false;e.is_admin=false}n=TS.members.legacyUpsertMember(e).member}return n}).filter(function(e){if(e.is_self&&!t.include_self||TS.interop.rules.members.isSlackbotOrTeambot(e,TS.boot_data.feature_teambot)&&!t.include_slackbot){t.num_found-=1;return false}if(t.limit_by_model_relevancy)return TS.utility.members.isMemberRelevantToModel(e,t.limit_by_model_relevancy);return true});t.num_new=n.length;t.items.push.apply(t.items,n);return Promise.resolve(t)})};var g=function e(t){if(!_.isObject(t))return t;return _.omitBy(t,function(e,t){return 0===t.indexOf("image_")})};var S=function e(t,n){var r="NOOP";var i=[];Object.keys(n).forEach(function(e){if("profile"===e){var a=g(t.profile);var o=g(n.profile);if(_.isObject(o)){if(a.status_text!==o.status_text||a.status_emoji!==o.status_emoji){r="CHANGED";i.push("current_status")}var l=Object.keys(a).filter(function(e){return"undefined"===typeof o[e]}).concat(["status_text","status_emoji"]);a=_.omit(a,l);o=_.omit(o,l);if(!_.isEqual(a,o)){r="CHANGED";i.push(e)}}}else if("enterprise_user"===e)if(t[e]){for(var u in n[e])if(!_.isEqual(t[e][u],n[e][u])){r="CHANGED";i.push(e)}}else{r="CHANGED";i.push(e)}else if("id"===e){var d=t.id!=n.id&&t.enterprise_user&&n.enterprise_user;if(d){var c=t.enterprise_user.id===t.id;var m=n.id!=n.enterprise_user.id;if(c&&m){r="CHANGED";i.push(e)}}}else if("teams"===e){r="CHANGED";i.push(e)}else if(t[e]!=n[e]){if("is_admin"===e&&TS.has_pri[F]){TS.warn(F,e+"is changing from `"+t[e]+"` to `"+n[e]+"`");TS.console.trace(F)}if(n[e]&&!TS.utility.isScalar(n[e])){t[e]=n[e];TS.warn(e+" is not scalar! it needs to be handled by upsertMember specifically to test if it has changed! "+s()(n[e]))}else if("boolean"!==typeof n[e]||!n[e]!=!t[e]){i.push(e);r="CHANGED"}}});c(t)&&i.push("is_unknown");return{status:r,what_changed:i}};var T=function e(t){TS.members.user_color_changed_sig.dispatch(t)};var v=false;var b=false;var y=0;var w=function e(){if(!TS.model.user.is_restricted||TS.boot_data.feature_scg_api_filters)return;if(v){b=true;return}v=true;var t=12e4;var n=Date.now()-y;var r;r=n<t?new Promise(function(e){setTimeout(e,t-n)}):Promise.resolve();r.then(function(){b=false;return TS.members.legacyMaybeFetchAccessibleUserIds()}).finally(function(){v=false;if(b){b=false;w()}});return r};var k=function e(){TS.members.invalidateMembersUserCanSeeArrayCaches();return w()};var x=function e(){if(TS.boot_data.feature_scg_api_filters)return;TS.model.need_guest_accessible_user_ids=true};var C=function e(t){if(TS.boot_data.feature_scg_api_filters)return false;return!t||!TS.model.user||!TS.model.user.is_restricted||!TS.model.guest_accessible_user_ids||!TS.model.guest_accessible_user_ids.length||TS.model.need_guest_accessible_user_ids||v};var I=function e(t,n){if(TS.boot_data.feature_scg_api_filters)return Promise.resolve();if(C(t))return k();if(n){if(_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();TS.model.guest_accessible_user_ids.push(t.id)}else{if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id)}TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var M=function e(t){if(TS.boot_data.feature_scg_api_filters)return Promise.resolve();if(C(t))return k();if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();var n=_.concat(_.flatMap(TS.model.mpims,"members"),_.map(TS.model.ims,"user"));if(_.includes(n,t.id))return Promise.resolve();var r=A(t);var i=r[0];var a=r[1];if(a.length>E)return k();if(a.length)return Promise.map(a,function(e){return TS.membership.ensureChannelMembershipIsKnownForUsers(e.model_ob.id,[t.id])}).then(function(){return M(t)});if(_.some(i,"membership.is_member"))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id);TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var A=function e(t){return _(_.concat(TS.interop.redux.models.channels.getPublicChannelsUserIsIn(TS.redux.getState()),TS.model.groups)).map(function(e){var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(e.id,t.id);return{model_ob:e,membership:n}}).partition("membership.is_known").value()};var E=10;var P=4;var F=1975;var O=function e(t,n){if("ADDED"===t.status)TS.members.lazily_added_sig.dispatch(t.member);else if("CHANGED"===t.status){if(-1!==t.what_changed.indexOf("is_unknown")){TS.members.changed_is_unknown_sig.dispatch(t.member);return t}-1!==t.what_changed.indexOf("current_status")&&TS.members.changed_current_status_sig.dispatch(t.member);-1!==t.what_changed.indexOf("profile")&&TS.members.changed_profile_sig.dispatch(t.member);-1===t.what_changed.indexOf("is_restricted")&&-1===t.what_changed.indexOf("is_ultra_restricted")||TS.members.changed_account_type_sig.dispatch(t.member);-1!==t.what_changed.indexOf("real_name")&&TS.members.changed_real_name_sig.dispatch(t.member);-1===t.what_changed.indexOf("member_color")&&-1===t.what_changed.indexOf("color")||TS.members.user_color_changed_sig.dispatch(t.member);-1!==t.what_changed.indexOf("name")&&TS.members.changed_name_sig.dispatch(t.member);-1!==t.what_changed.indexOf("tz")&&TS.members.changed_tz_sig.dispatch(t.member);-1!==t.what_changed.indexOf("deleted")&&TS.members.changed_deleted_sig.dispatch(t.member);-1!==t.what_changed.indexOf("presence")&&TS.members.presence_changed_sig.dispatch(t.member);-1!==t.what_changed.indexOf("is_owner")&&TS.members.changed_owner_perms_sig.dispatch(t.member);-1!==t.what_changed.indexOf("is_admin")&&TS.members.changed_admin_perms_sig.dispatch(t.member);-1!==t.what_changed.indexOf("member_visibility")&&w();n.is_self&&TS.members.changed_self_sig.dispatch(t.member)}return t}})();(function(){TS.registerModule("team",{team_profile_changed_sig:new signals.Signal,team_email_domain_changed_sig:new signals.Signal,team_domain_changed_sig:new signals.Signal,team_name_changed_sig:new signals.Signal,onStart:function e(){TS.interop.Flannel.useSocket()&&TS.redux.socket.connectedSig.add(n,TS.team);TS.boot_data.feature_team_rename_m11n&&TS.team.team_name_changed_sig.add(l)},upsertAndSignal:function e(t){if(!t)return;var n=TS.team.upsertTeam(t);if("CHANGED"===n.status){-1!=n.what_changed.indexOf("profile")&&TS.team.team_profile_changed_sig.dispatch(n.team);-1!=n.what_changed.indexOf("email_domain")&&TS.team.team_email_domain_changed_sig.dispatch(n.team);-1!=n.what_changed.indexOf("domain")&&TS.team.team_domain_changed_sig.dispatch(n.team)}return n},upsertTeam:function e(t){i(t);var n=_.assign({profile:{fields:[]}},TS.model.team);var r="NOOP";var l=[];if(t){TS.has_pri[4]&&TS.log(4,'updating team "'+t.id+'"');for(var u in t)if("profile"===u){if(t.profile.fields&&t.profile.fields.length){var d=_.clone(n.profile.fields);"object"===s()(t.profile.fields[0])?d=a(d,t.profile.fields):"string"===typeof t.profile.fields[0]&&(d=o(d,t.profile.fields));if(t.profile.fields[0]){n.profile=_.assign({},n.profile,{fields:d});l.push(u);r="CHANGED"}}}else if("prefs"===u){TS.redux.prefs.setTeamPrefs(t.prefs);delete t.prefs}else if("icon"===u||"cannot_leave_reasons"===u)n[u]=t[u];else if(n[u]!=t[u])if(t[u]&&!TS.utility.isScalar(t[u])){n[u]=t[u];TS.warn(u+" is not scalar! it needs to be handled by upsertTeam specifically to test if it has changed! "+s()(t[u]))}else if("boolean"!==typeof t[u]||!t[u]!=!n[u]){n[u]=t[u];l.push(u);r="CHANGED"}TS.teams.upsertTeam(n)}return{status:r,team:n,what_changed:l}},ensureTeamProfileFields:function e(){if(t)return t;t=TS.interop.api.call("team.profile.get").then(function(e){TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:e.data.profile}))});return t},getTeamProfileFieldById:function e(t){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getTeamProfileFieldById");for(var n=0;n<TS.model.team.profile.fields.length;n+=1)if(TS.model.team.profile.fields[n].id===t)return TS.model.team.profile.fields[n];return null},getVisibleTeamProfileFields:function e(){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return!e.is_hidden})},getHiddenTeamProfileFields:function e(){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getHiddenTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return e.is_hidden})},getTeamCustomStatusPresets:function e(){return _.map(TS.prefs.getTeamPref("custom_status_presets"),function(e){return{text:e[1],canonical:e[2]||null,emoji:e[0]}})},sortTeamProfileFieldsByOrdering:function e(t){if(t&&t.length)return _.clone(t).sort(function(e,t){return e.ordering-t.ordering});TS.warn("Ensure profile fields exist before calling sortTeamProfileFieldsByOrdering")},getVisibleTeamProfileFieldsForMember:function e(t,n){if(!(t&&t.profile))return[];TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFieldsForMember");return TS.model.team.profile.fields.filter(function(e){return(n||_.get(t.profile,["fields",e.id,"value"]))&&!e.is_hidden}).map(function(e){var n=_.get(t.profile,["fields",e.id,"value"]);var r=_.get(t.profile,["fields",e.id,"alt"]);var i=n&&"date"===e.type?TS.interop.datetime.convertISOtoUTCReadableDate(n):r;return $.extend(true,{value:n,alt:i},e)})},isEntireTeamLoaded:function t(){return e}});var e=false;var t;var n=function e(){t=null};var r=function e(t){t&&t.length&&_.remove(t,function(e){return!e});return!(t&&t.length)};var i=function e(t){if(!t)return;if(_.get(window,"TS.model.team.profile.fields"))return;_.set(t,"profile.fields",_.get(t,"profile.fields",[]));TS.teams.upsertTeam(t)};var a=function e(t,n){if(r(n))return;var i=false;var a=false;var s=t.reduce(function(e,t){e[t.id]=t;return e},{});n.forEach(function(e){var n=s[e.id];if(n){a=a||d(n,e);i=i||n.ordering!==e.ordering;$.extend(true,n,e)}else{t.push(e);TS.model.members&&"options_list"===e.type&&(a=true)}});i&&(t=TS.team.sortTeamProfileFieldsByOrdering(t));a&&u(n);return t};var o=function e(t,n){if(r(n))return;_.remove(t,function(e){return-1!==n.indexOf(e.id)});u(n);return t};var l=function e(){$("#team_name").text(TS.model.team.name);if(!TS.boot_data.feature_incremental_unread_counts){document.title=document.title.replace(TS.model.last_team_name,TS.model.team.name);TS.model.last_team_name=TS.model.team.name}};var u=function e(t){if(!t||!t.length)return;if(!TS.model.members)return;t.forEach(function(e){TS.model.members.forEach(function(t){if(t.profile.fields&&t.profile.fields[e.id||e]){if(e.id){if("options_list"!==e.type)return;var n=-1!==e.possible_values.indexOf(t.profile.fields[e.id].value);if(n)return}var r=$.extend(true,{},t);delete r.profile.fields[e.id||e];TS.members.legacyUpsertMember(r)}})})};var d=function e(t,n){if(TS.model.members&&"options_list"===n.type)return n.possible_values.some(function(e){return t.possible_values&&-1===t.possible_values.indexOf(e)});return false}})();(function(){TS.registerModule("apps",{onStart:function t(){var n=true;e=TS.utility.throttleFunc(e,3e3,n);TS.client&&TS.boot_data.feature_app_actions_fe_refactor&&_.defer(function(){return TS.interop.apps.loadAppActions()})},isCurrentModelViewAnApp:function e(){var t=TS.shared.legacyGetActiveModelOb();if(!t)return false;var n=TS.interop.members.getMemberById(_.get(t,"user"));var r=_.get(n,"profile.bot_id");return!!r},resetUpApps:function t(){TS.storage.storeApps("");e()},setUp:function e(){return TS.apps.fetchApps()},ingestApps:function e(t){if("object"!==("undefined"===typeof t?"undefined":s()(t))||!t)return;TS.storage.storeApps({data:t,cache_ts:TS.model.apps_cache_ts});TS.interop.apps.clearApps();TS.interop.apps.ingestApps(_.isArray(t)?t:_.values(t))},fetchApps:function e(){var t=TS.storage.fetchApps();if(t&&TS.model.apps_cache_ts==t.cache_ts){TS.model.did_we_load_with_app_cache=true;TS.apps.ingestApps(t.data);return Promise.resolve()}return TS.interop.api.call("apps.list").then(function(e){TS.model.apps_cache_ts=e.data.cache_ts;TS.apps.ingestApps(e.data.apps)}).catch(_.noop)},legacyGetAppByName:function e(t){if(!_.isString(t))return null;var n=TS.model.apps;if(!n){TS.warn("Trying to look up app by name ("+t+") but TS.model.apps is not present.");return null}var r=_.find(TS.model.apps,function(e){return e.name.toLowerCase()==t.toLowerCase()});if(r){r.is_app=true;return r}TS.warn("Trying to look up app by name ("+t+") but it is not present.");return null},startFlexPaneByAppId:function e(t,n,r){return TS.apps.promiseToGetFullAppProfile(null,t,n,r).then(function(e){TS.client.ui.app_profile.openWithApp(e,null,t,r);TS.client.flexDisplaySwitched("apps",e.id,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},startFlexPaneByBotId:function e(t,n,r){return TS.apps.promiseToGetFullAppProfile(n,t,null,r).then(function(e){e.is_slack_integration&&!_.get(e,"config.is_custom_integration")?TS.client.ui.app_profile.openWithApp(e,null,t,r):TS.client.ui.app_profile.openWithApp(e,n,t,r);TS.client.flexDisplaySwitched("apps",n,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},promiseToGetFullAppProfile:function e(t,n,r,i){if(t&&!_.isString(t))return null;if(r&&!_.isString(r))return null;return new Promise(function(e,a,s){var o=TS.interop.api.call("apps.profile.get",{bot:t,bot_home_team:n,app:r,show_auth_summary:!!i}).then(function(n){if(n.data.ok&&n.data.app_profile){var r=n.data.app_profile;TS.interop.apps.ingestApps([r]);e(r)}else{a(n.data.error);TS.warn("Trying to look up app by bot id ("+t+") but it failed.")}}).catch(function(e){TS.warn("Trying to look up app by bot id ("+t+") but it failed.");a(e.data)});s(function(){o.cancel()})})},constructTemplateArgsForCardAndProfile:function e(t,n,r,i,a){if(!t)return TS.warn("Trying to build app card but it failed.");void 0==a&&(a=true);var s=TS.teams.getTeamById(i);var o=s&&s.domain;var l=o&&TS.interop.url.buildWorkspaceUrl(TS.redux.getState(),o);var u=l?l+"/apps/"+t.id:"/apps/"+t.id;n&&(u=l?l+"/services/"+n:"/services/"+n);var d={settings_url:u,name:t.name,desc:t.desc,app_icons:t.icons,app_id:t.id,bot_id:n,is_slack_integration:t.is_slack_integration,is_directory_published:t.is_directory_published,is_distributed:t.is_distributed,commands:_.toArray(t.commands),is_external_app:t.is_external,app_team_id:i,is_xoxa_app:t.is_xoxa_app};var c=_.get(t,"bot_user.id");var m;r&&(m=TS.interop.members.getMemberById(r));var f;if(t.app_card_color){d.color=TS.utility.hex2rgb(t.app_card_color);d.color.hex=t.app_card_color}if(t.config&&t.config.is_custom_integration){if(t.config.icons)if(t.config.icons.emoji){var p=TS.emoji.graphicReplace(_.escape(t.config.icons.emoji),{force_img:true});d.emoji_img_tag=new Handlebars.SafeString(p)}else d.bot_icons=t.config.icons;f=t.config.real_name?t.config.real_name:t.bot_user?t.bot_user.username:t.config.username;d.name=f;d.desc=t.config.descriptive_label;d.username=t.config.username;d.custom_integration_type=t.config.custom_integration_type;d.date_created=t.config.date_created;var h='<a class="bold member charcoal_grey" data-member-id='+t.config.created_by+">"+TS.interop.members.getPrefCompliantMemberNameById(t.config.created_by,true,true)+"</a>";d.custom_integration_creator=new Handlebars.SafeString(h)}if(TS.boot_data.feature_app_space_links){var g=_.get(t,"config.icons")||t.icons||{};d.avatar=g.image_512||g.image_192||g.image_96||g.image_72}else _.get(t.config,"icons")?t.config.icons.image_96?d.avatar=t.config.icons.image_96:d.avatar=t.config.icons.image_72:t.icons&&(t.is_slack_integration?d.avatar=t.icons.image_192:d.avatar=t.icons.image_96);t.screenshots&&(d.screenshots=t.screenshots);if(t.youtube_url){var S=TS.utility.getYoutubeIdFromURL(t.youtube_url);d.youtube_url=t.youtube_url;d.youtube_id=S}var T=t.screenshots||t.youtube_url;d.has_screenshots=T;if(_.get(t.config,"date_deleted")>0||true===_.get(t.auth,"revoked")){d.deleted=true;d.app_id=t.id}t.is_slack_integration?t.is_slack_integration&&(t.is_slack_integration&&t.is_external?d.disabled=false:t.config&&1===parseInt(t.config.is_active,10)&&0===parseInt(t.config.date_deleted,10)||(d.disabled=true)):t.is_external?d.disabled=false:i!==TS.model.team.id?d.disabled=false:t.auth&&!t.auth.revoked||(d.disabled=true);!a||t.is_external||!c&&t.is_slack_integration||t.is_xoxa_app&&!TS.boot_data.feature_app_space_links||(d.show_settings_section=true);if(TS.model.user.is_restricted||TS.model.user.is_ultra_restricted){d.user_is_restricted=true;d.show_settings_section=false;d.disabled=false}if(t.installation_summary&&!t.is_xoxa_app){var v=t.installation_summary.replace(/<@([A-Z0-9]+)>/g,function(e,t){if(TS.interop.members.getMemberById(t))return'<span class="app_card_member_link" data-member-profile-link='+t+">"+TS.interop.members.getPrefCompliantMemberNameById(t,true,true)+"</span>";return'<span class="app_card_member_link" data-member-profile-link='+t+">A user</span>"});v=v.replace(/#([a-z0-9-]+)/g,function(e,t){var n=TS.redux.channels.getPublicChannelByName(t);if(n){var r=TS.templates.builders.makeChannelPrefix(n);return'<span class="app_card_channel_link internal_channel_link" data-channel-id="'+n.id+'">'+r+t+"</span>"}return t});d.installation_summary=new Handlebars.SafeString(v)}if(c){d.bot_user=t.bot_user.id;d.username=t.bot_user.username;d.bot_user_channel_count=t.bot_user.memberships_count;t.bot_user.memberships_count<1&&t.is_slack_integration&&(d.show_settings_section=false)}else m&&m.is_bot&&!m.is_stranger&&(d.allow_dm=true);if(c||d.is_xoxa_app){if(!d.disabled){TS.model.user.is_ultra_restricted||(d.show_channel_invite=true);d.allow_dm=true}true===d.deleted&&(d.hide_link_to_app_profile=true)}t.long_desc_formatted&&(d.long_description=new Handlebars.SafeString(t.long_desc_formatted));t.long_desc&&(d.long_description_raw=new Handlebars.SafeString(t.long_desc));t.support_url&&(d.support_url=t.support_url);t.url&&(d.website_url=t.url);t.user_can_manage&&(d.user_can_manage=t.user_can_manage);var b=_.isEmpty(_.get(t,"commands"));(t.is_slack_integration&&b||TS.utility.strGetWordCount(t.long_desc||"")<350||!T&&b)&&(d.hide_expand_button=true);return d}});var e=function e(){TS.apps.setUp()}})();var R=n(2908);var U=n(2909);var G=n(2910);(function(){TS.registerModule("members.view",{team_filter_changed_sig:new signals.Signal,filter_timer:null,onStart:function e(){E=TS.web&&TS.web.admin;var t=500;l=TS.utility.debounceWithPromise(w,t);u=TS.utility.debounceWithPromise(w,t);d=TS.utility.debounceWithPromise(w,t)},switchTabs:function e(t){E&&"invites"===TS.web.admin.view?$("#"+t+"_invites_tab").trigger("click"):TS.client?$("#"+t+"_members_tab").find("a").trigger("click"):$("#"+t+"_members_tab").trigger("click")},bindTeamFilter:function t(n,r,i){i=i||{};var a=$(n);var s=a.find("input.member_filter");var o=a.find(".icon_close");f(r,i);e=null;i.full_profile_filter&&!i.is_long_list_view&&s.on("focus",function(){TS.team.ensureTeamProfileFields()});s.bind("keyup update-team-filter",function(){var t=s.val();TS.members.view.filter_timer&&window.clearTimeout(TS.members.view.filter_timer);var a=function a(){t.trim().toLocaleLowerCase()!==e&&TS.members.view.filterTeam(t,n,r,i).then(function(){TS.view&&TS.view.rebuildUserGroupList()});o.toggleClass("hidden",!t.trim())};i.is_long_list_view?a():TS.members.view.filter_timer=window.setTimeout(a,TS.members.getMembersForUser().length>500?250:50)});o.bind("click",function(){TS.members.view.clearFilter(n,r);TS.view&&TS.view.rebuildUserGroupList();e=null;setTimeout(function(){s.focus()},0)})},filterTeam:function e(t,n,r,i){var a=p(r);if(_.get(i,"full_profile_filter")||_.get(a,"full_profile_filter"))return TS.team.ensureTeamProfileFields().then(function(){if(m(a))return T(t,n,r,a);k(t,n,r,i);return Promise.resolve()});k(t,n,r);return Promise.resolve()},getTeamFilter:function t(){return e},selectMatch:function e(t){var n=$(t);var r=n.data("list-items-id");var i=$(r);var a=i.find(".member_item");var s=a.filter(".active");if(1==s.length){var o=s.first();var l=o.data("member-id");if(l){TS.ims.legacyStartImByMemberId(l);TS.menu.end()}}},clearFilter:function n(r,i){var a=p(i);var s=$(r);var o=s.find("input.member_filter");var l=s.find(".icon_close");var u=s.data("list-items-id");var d=$(u);var c=d.find(".member_item");e="";TS.storage.storeFilterState(e);if(TS.members.view.filter_timer){window.clearTimeout(TS.members.view.filter_timer);TS.members.view.filter_timer=null}o.val("");l.addClass("hidden");if(m(a)){S(i);TS.members.view.filterTeam(e,r,i,a)}else{$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").removeClass("hidden");d.find(".no_results").addClass("hidden");c.addClass("active");if(t[i]){t[i].detachEvents();delete t[i]}d.find(".member_item.clone").remove();d.find(".filter_header").remove();TS.members.view.team_filter_changed_sig.dispatch("",TS.members.getMembersForUser().length);if(TS.client&&i){var _=$(i);_.trigger("resize-immediate");TS.ui.utility.updateClosestMonkeyScroller(_)}}},onTeamDirectoryItemClick:function e(t){if($(t.target).closest("a").length)return;var n=$(this);var r=n.data("member-id");var i=TS.interop.members.getMemberById(r);if(!i)return;TS.client&&TS.client.ui.previewMember(r)},findMatchesInMemberList:function e(t,n,r){return P(t,n,r)},getHeaderLabelForMatchKey:function e(t){return x(t)}});var e="";var t={};var n={};var r={};var i={};var a={members:{},restricted:{},deleted:{}};var s=100;var o=TS.client?92:116;var l;var u;var d;var c=function e(){if("list"===_.get(TS,"web.admin.view")&&TS.boot_data.page_needs_enterprise)return false;return TS.boot_data.page_needs_enterprise};var m=function e(t){if(TS.boot_data.page_needs_enterprise&&t&&t.is_long_list_view)return true;if("list"===_.get(TS,"web.admin.view")&&(TS.boot_data.page_needs_enterprise||TS.boot_data.feature_api_admin_page_not_ent))return true};var f=function e(t,n){r[t]=n};var p=function e(t){var n=r[t];if(!n){TS.error("Missing arguments for a bound filter");return}_.isFunction(n)&&(n=n()||{});n.include_org=c();return n};var h=function e(t){var n=$(t).find(".ts_icon_search");if(n.next().is(t+"_spinner"))return;var r=TS.templates.loading_indicator({id:t.substring(1)+"_spinner"});n.after(r);n.addClass("hidden")};var g=function e(t){$(t).find(".ts_icon_search").removeClass("hidden");$(t+"_spinner").remove()};var S=function e(t){a.filter_p&&a.filter_p.cancel();a.filtered_items&&(a.filtered_items={});a.filter_last_query=null;a.filter_last_include_org=null;a.members.filter_cursor_mark="";a.members.filter_num_remaining=0;a.members.filter_num_found=0;a.members.filter_scroll_mark=0;a.restricted.filter_cursor_mark="";a.restricted.filter_num_remaining=0;a.restricted.filter_num_found=0;a.restricted.filter_scroll_mark=0;a.deleted.filter_cursor_mark="";a.deleted.filter_num_remaining=0;a.deleted.filter_num_found=0;a.deleted.filter_scroll_mark=0;TS.client?$(t).off("scroll.filter").scrollTop(0):TS.web&&$(window).off("scroll.filter").scrollTop(0)};var T=function t(n,r,i,s){var o=n.trim();e=o.toLocaleLowerCase();TS.storage.storeFilterState(e);var l=a.filter_last_query!==e||a.filter_last_include_org!==s.include_org||a.filter_last_sort!==s.sort||a.filter_last_sort_dir!==s.sort_dir;if(l){S(i);a.filter_last_query=e;a.filter_last_include_org=s.include_org;s.sort&&(a.filter_last_sort=s.sort);s.sort_dir&&(a.filter_last_sort_dir=s.sort_dir)}h(r);var u=function t(){return Promise.resolve().then(function(){return v(a,l,e,s)}).then(function(t){g(r);return b(t,a,l,e,o,r,i,s)}).finally(function(){TS.utility.rAF(function(){TS.client&&TS.ui.utility.updateClosestMonkeyScroller($(i))})})};a.filter_p=l?u():a.filter_p.then(u);return a.filter_p};var v=function e(t,n,r,i){var a=n||"active_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;var s=n||"restricted_members"===TS.model.ui_state.tab_name&&t.restricted.filter_num_remaining;var o=n||"disabled_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;if(!a&&!s&&!o)return Promise.resolve(t.filtered_items);var c=_.assign({},i,{restricted:false});t.members.filter_p=a?l(t.members,r,c):Promise.resolve([]);var m=_.assign({},i,{restricted:true});t.restricted.filter_p=s?u(t.restricted,r,m):Promise.resolve([]);var f=_.assign({},i,{include_deleted:2,include_restricted_and_full_members:true});t.deleted.filter_p=o?d(t.deleted,r,f):Promise.resolve([]);return Promise.join(t.members.filter_p,t.restricted.filter_p,t.deleted.filter_p,function(e,r,a){var s=(i.sort?A:TS.members.legacyAllocateTeamListMembers)(e.concat(r,a));s.members=_.uniqBy(s.members,function(e){return e.id});s.disabled_members=_.uniqBy(s.disabled_members,function(e){return e.id});s.restricted_members=_.uniqBy(s.restricted_members,function(e){return e.id});s.ultra_restricted_members=_.uniqBy(s.ultra_restricted_members,function(e){return e.id});if(n)t.filtered_items=s;else{t.filtered_items.members.push.apply(t.filtered_items.members,s.members);t.filtered_items.disabled_members.push.apply(t.filtered_items.disabled_members,s.disabled_members);t.filtered_items.deleted_bots.push.apply(t.filtered_items.deleted_bots,s.deleted_bots);t.filtered_items.bots.push.apply(t.filtered_items.bots,s.bots);t.filtered_items.restricted_members.push.apply(t.filtered_items.restricted_members,s.restricted_members);t.filtered_items.ultra_restricted_members.push.apply(t.filtered_items.ultra_restricted_members,s.ultra_restricted_members)}return F([].concat(N()(t.filtered_items.restricted_members),N()(t.filtered_items.ultra_restricted_members))).then(function(){return Promise.resolve(t.filtered_items)})})};var b=function e(t,n,r,l,u,d,c,m){if(!t)return;if(_.get(TS,"web.admin"))return TS.web.admin.setLongListAdminListItems({items:t,no_dividers:!!l,query:l,new_query:!!r,num_found:{members:a.members.filter_num_found||0,restricted:a.restricted.filter_num_found||0,disabled:a.deleted.filter_num_found||0},remaining:{members:a.members.filter_num_remaining||0,restricted:a.restricted.filter_num_remaining||0,disabled:a.deleted.filter_num_remaining||0}},function(){T(l,d,c,m)});TS.client&&(i=TS.view.buildLongListTeamListItems(t,!!l));var f=false;"disabled_members"===TS.model.ui_state.tab_name&&0===(a.deleted.filter_num_found||0)&&(f=true);"restricted_members"===TS.model.ui_state.tab_name&&0===(a.restricted.filter_num_found||0)&&(f=true);var p=TS.model.user_groups.filter(function(e){return!e.date_delete});"user_groups"===TS.model.ui_state.tab_name&&0===p.length&&(f=true);if(f){TS.model.ui_state.tab_name="active_members";TS.storage.storeUIState(TS.model.ui_state);$("#active_members_tab").trigger("click")}var h=$("#active_members_list");if(h.length){h.longListView("setItems",i.active_members_list_items);r&&h.longListView("scrollToTop")}var g=$("#restricted_members_list");if(g.length){g.longListView("setItems",i.restricted_members_list_items);r&&g.longListView("scrollToTop")}var S=$("#deleted_members_list");if(S.length){S.longListView("setItems",i.deleted_members_list_items);r&&S.longListView("scrollToTop")}var v=t.members.concat(t.bots);var b=t.restricted_members.concat(t.ultra_restricted_members);var y=t.disabled_members.concat(t.deleted_bots);var w=[{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:v},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:b},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:y}];w.forEach(function(e){var t=$("#"+e.name+"_no_results");function n(){var n={query:u,tab:e,active_matches:v,show_active_matches:"active"!==e.name&&v.length>0,restricted_matches:b,show_restricted_matches:"restricted"!==e.name&&b.length>0,disabled_matches:y,show_disabled_matches:"disabled"!==e.name&&y.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").one("click",function(){TS.members.view.clearFilter(d,c)})}e.matches.length>0||!l?t.addClass("hidden").empty():n()});if(r){if("#team_list_scroller"===c)if(TS.client){var k=$(c);var x=k.find("#team_list_members_wrapper");k.on("scroll.filter",function(){var e=k.scrollTop()+k.height()+o;var t;if("active_members"===TS.model.ui_state.tab_name){if(e<=n.members.filter_scroll_mark)return;t=x.height();if(e>t&&n.members.filter_p&&n.members.filter_p.isResolved()){T(l,d,c,m);n.members.filter_scroll_mark=e}}if("restricted_members"===TS.model.ui_state.tab_name){if(e<=n.restricted.filter_scroll_mark)return;t=x.height();if(e>t&&n.restricted.filter_p&&n.restricted.filter_p.isResolved()){T(l,d,c,m);n.restricted.filter_scroll_mark=e}}})}else TS.web&&$(window).off("scroll.filter").on("scroll.filter",_.throttle(function(){var e=0;var t=0;var r=0;var u=null;if("active_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#active_members_list > .list_items").css("height"));t=_.reject(i.active_members_list_items,{is_divider:true}).length;r=n.members.filter_num_remaining;u=n.members.filter_p}if("restricted_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#restricted_members_list > .list_items").css("height"));t=_.reject(i.restricted_members_list_items,{is_divider:true}).length;r=n.restricted.filter_num_remaining;u=n.restricted.filter_p}if("disabled_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#disabled_members_list > .list_items").css("height"));t=_.reject(i.deleted_members_list_items,{is_divider:true}).length;r=n.deleted.filter_num_remaining;u=a.deleted.filter_p}var f=.9*Math.min(t,s);e=_.isNaN(e)?0:e;e-=f*o;e&&r&&$(this).scrollTop()>e&&u&&u.isResolved()&&T(l,d,c,m)},50,{leading:true}));var C=(n.members.filter_num_found||0)+(n.restricted.filter_num_found||0)+(n.deleted.filter_num_found||0);TS.members.view.team_filter_changed_sig.dispatch(u,C)}};var y=function e(t,n,r){var i=[];n&&(i=n.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!r.full_profile_filter){var t=TS.utility.search.makeClause("real_name",e);var n=TS.utility.search.makeClause("display_name",e);var i=TS.utility.search.makeConjunction("OR",[t,n]);return i}return TS.utility.search.makeClause("fuzzy_with_email",e)}));i.push(TS.utility.search.makeClause("is","user"));if(r.restricted){var a=TS.utility.search.makeClause("level","restricted");var o=TS.utility.search.makeClause("level","ultra_restricted");i.push(TS.utility.search.makeConjunction("OR",[a,o]))}var l=i.length>1?TS.utility.search.makeConjunction("AND",i):i[0];var u={query:l,count:s,include_bots:r.include_bots,exclude_slackbot:r.exclude_slackbot,include_deleted:r.include_deleted};r.sort&&(u.sort=r.sort);r.sort_dir&&(u.sort_dir=r.sort_dir);r.include_org&&(u.all_of_org=r.include_org);t.filter_cursor_mark&&(u.cursor_mark=t.filter_cursor_mark);r.endpoint&&(u.endpoint=r.endpoint);TS.web&&(u.solr=true);return u};var w=function e(t,n,r){var i=y(t,n,r);i.raw_query=n;return TS.utility.search.promiseToSearch(i).then(function(i){if(!t.filter_num_remaining){t.filter_num_remaining=i.data.num_found;t.filter_num_found=i.data.num_found}t.filter_num_remaining-=i.data.items.length;t.filter_cursor_mark=i.data.next_cursor_mark;if(!i.data.items.length)return Promise.resolve([]);var a=i.data.items.map(function(e){var t=TS.interop.members.getMemberById(e.id);t&&_.isEqual(t,e)||(t=TS.members.legacyUpsertMember(e).member);return t});r.restricted||r.include_restricted_and_full_members||(a=a.filter(function(e){return!e.is_restricted}));if(a.length)return Promise.resolve(a);if(t.filter_num_remaining)return e(t,n,r);return Promise.resolve([])})};var k=function n(r,i,a,s){var o=$(i);var l=r.trim();e=l.toLocaleLowerCase();var u=o.data("list-items-id");var d=$(u);var c=d.find(".member_item:not(.clone)");var _=c.filter(".active");var m=d.find(".member_item.clone");var f=d.find(".filter_header");var p=!TS.web&&"#team_filter"===i;var h={};var g;var S;var T;TS.storage.storeFilterState(e);var v=false;var b;E&&"#team_filter"===i&&(b=d.find(".tab_pane.selected"));b||TS.web||"#team_filter"!==i||(b=$("#team_list_members"));b&&b.length&&b.addClass("hidden");if(v){g=c.parent();S=document.activeElement?$(document.activeElement):null;c.detach()}if(t[a]){t[a].detachEvents();delete t[a]}m.remove();f.remove();_.removeClass("active");d.find(".no_results").addClass("hidden");if(v){g.append(c);S&&S.focus()}var y;if(E&&"invites"===TS.web.admin.view){var w=[];var k=[];var x=[];$.each(c,function(e,t){var n;t=$(t);n=t.data("invite-id");h[n]=t});k=P(TS.web.admin.pending_invites,e).name||[];x=P(TS.web.admin.accepted_invites,e).name||[];w=k.concat(x);if(w.length>0){$.each(w,function(e,t){t&&t.member&&t.member.id&&h[t.member.id]&&h[t.member.id].addClass("active")});a&&$(a).trigger("resize")}y=[{name:"pending",label:TS.interop.i18n.t("pending invitations","members_view")(),matches:k},{name:"accepted",label:TS.interop.i18n.t("accepted invitations","members_view")(),matches:x}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");if(e.matches.length>0){t.addClass("hidden").empty();return}var n={query:l,tab:e,pending_matches:k,show_pending_matches:"pending"!==e.name&&k.length>0,accepted_matches:x,show_accepted_matches:"accepted"!==e.name&&x.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})});T=w}else{var C;var I=[];var A=[];var F=[];C=E?r.length?TS.members.getMembersForUser():TS.web.admin.getMembersForUser():TS.members.getMembersForUser();$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").toggleClass("hidden",!!e);$.each(c,function(e,t){var n;t=$(t);n=t.data("member-id");h[n]=t});w=P(C,e,s.full_profile_filter);var O=Object.keys(w);if(O.length>0){M(w,O,h,F,A,I,p?a:"");if(a){var D=$(a);D.trigger("resize");TS.ui.utility.updateClosestMonkeyScroller(D)}}else if("#file_member_filter"===i){d.find(".query").text(l);d.find(".no_results").removeClass("hidden")}if("#team_filter"===i){y=[{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:I},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:A},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:F}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");function n(){var n={query:l,tab:e,active_matches:I,show_active_matches:"active"!==e.name&&I.length>0,restricted_matches:A,show_restricted_matches:"restricted"!==e.name&&A.length>0,disabled_matches:F,show_disabled_matches:TS.web&&"disabled"!==e.name&&F.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})}if(e.matches.length>0){t.addClass("hidden").empty();return}n()})}T=I.concat(A,F)}b&&b.length&&b.removeClass("hidden");TS.ui.utility.updateClosestMonkeyScroller($(a));TS.members.view.team_filter_changed_sig.dispatch(l,T.length)};var x=function e(t){return n[t]||t};var C=function e(t,n){var r=document.createElement("div");var i=document.createElement("strong");r.classList.add("filter_header");i.appendChild(document.createTextNode(t));n.length&&i.appendChild(document.createTextNode(": "));r.appendChild(i);n.forEach(function(e,t){r.appendChild(e);t<n.length-1&&r.appendChild(document.createTextNode(", "))});return r};var I=function e(t,n){var r=document.createElement("span");var i=document.createElement("strong");var a=t.split(n);i.appendChild(document.createTextNode(n));r.appendChild(document.createTextNode(a.shift()));r.appendChild(i);r.appendChild(document.createTextNode(a.join(n)));return r};var M=function e(r,i,a,s,o,l,u){var d=$(u);var c=document.createDocumentFragment();var _=document.createDocumentFragment();var m=document.createDocumentFragment();var f;var p;var h;var g=E&&TS.web.admin.isSubsetCase();i.sort(function(e,t){return TS.interop.i18n.sorter(n[e],n[t])}).forEach(function(e){var t=document.createDocumentFragment();var n=document.createDocumentFragment();var i=document.createDocumentFragment();var u=[];var d=[];var S=[];var T={};var v={};var b={};if(g&&!h){h=$("#active_members > div:first-of-type");p=$("#restricted_members > div:first-of-type");f=$("#disabled_members > div:first-of-type")}r[e].forEach(function(r){var c=r.member;var _;var m=false;if(c&&c.id){_=a[c.id];if(!_&&g){_=$(TS.web.admin.buildMemberHTML(c,false,false));m=true}if(_)if("name"!==e||m)if(c.deleted){f||(f=_.parent());r.value&&!T[r.value]&&(T[r.value]=u.push(I(r.value,r.match)));t.appendChild(_.clone().addClass("active clone").get(0))}else if(c.is_restricted){p||(p=_.parent());r.value&&!v[r.value]&&(v[r.value]=d.push(I(r.value,r.match)));n.appendChild(_.clone().addClass("active clone").get(0))}else{h||(h=_.parent());r.value&&!b[r.value]&&(b[r.value]=S.push(I(r.value,r.match)));i.appendChild(_.clone().addClass("active clone").get(0))}else _.addClass("active");c.deleted?s.push(c):c.is_restricted?o.push(c):l.push(c)}});if(t.childNodes&&t.childNodes.length){c.appendChild(C(x(e),u));c.appendChild(t)}if(n.childNodes&&n.childNodes.length){_.appendChild(C(x(e),d));_.appendChild(n)}if(i.childNodes&&i.childNodes.length){m.appendChild(C(x(e),S));m.appendChild(i)}t=null;n=null;i=null;u=null;d=null;S=null;T=null;v=null;b=null});f&&f.append(c);p&&p.append(_);h&&h.append(m);if(d.length){var S=d.find(".member_item.clone");t[u]=S.find(".lazy").lazyload({container:d,ignore_when_hidden_element:d,all_images_same_size:true});S.one("remove",function(){if(t[u]){t[u].detachEvents();delete t[u]}})}if(g){if(TS.web.admin.lazyload&&TS.web.admin.lazyload.detachEvents){TS.web.admin.lazyload.detachEvents();TS.web.admin.lazyload=null}TS.web.admin.lazyload||(TS.web.admin.lazyload=$("#admin_list").find(".lazy").lazyload())}c=null;_=null;m=null;f=null;p=null;h=null};var A=function e(t){return _.reduce(t,function(e,t){t.deleted?t.is_bot?e.deleted_bots.push(t):e.disabled_members.push(t):t.is_ultra_restricted?e.ultra_restricted_members.push(t):t.is_restricted?e.restricted_members.push(t):t.is_bot||TS.interop.rules.members.isSlackbotOrTeambot(t,TS.boot_data.feature_teambot)?e.bots.push(t):e.members.push(t);return e},{members:[],disabled_members:[],deleted_bots:[],bots:[],restricted_members:[],ultra_restricted_members:[]})};var E;var P=function e(t,r,i){var a=new RegExp("^"+TS.utility.regexpEscape(r),"i");var s=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(r),"i");var o={};var l=i&&r?TS.team.getVisibleTeamProfileFields():[];n={title:"What I Do",name:"Name"};t.forEach(function(e){var t;t=e._real_name_lc&&(e._real_name_lc.match(a)||e._real_name_lc.match(s))||e.email&&(e.email.match(a)||e.email.match(s))||e.profile&&e.profile.email&&(e.profile.email.match(a)||e.profile.email.match(s))||e.profile&&e.profile.real_name_normalized&&(e.profile.real_name_normalized.match(a)||e.profile.real_name_normalized.match(s))||e.profile&&e.profile.real_name&&(e.profile.real_name.match(a)||e.profile.real_name.match(s))||e.profile&&e.profile.display_name_normalized&&(e.profile.display_name_normalized.match(a)||e.profile.display_name_normalized.match(s))||e.profile&&e.profile.preferred_name&&(e.profile.preferred_name.match(a)||e.profile.preferred_name.match(s));if(t){o.name||(o.name=[]);o.name.push({member:e})}if(i&&r){t=e.profile&&e.profile.title&&(e.profile.title.match(a)||e.profile.title.match(s));if(t){o.title||(o.title=[]);o.title.push({member:e})}}l.length&&e.profile&&e.profile.fields&&l.forEach(function(r){var i=e.profile.fields[r.id];if(!i)return;t=null;if("user"===r.type){if(i.value){var l="";i.value.split(/\s*,\s*/).some(function(e){l=TS.interop.members.getPrefCompliantMemberNameById(e,false);return l.match(a)||l.match(s)});if(t){o[r.id]||(o[r.id]=[]);o[r.id].push({member:e,value:l,match:t[0]})}}}else{t=i.value&&(i.value.match(a)||i.value.match(s));if(t){o[r.id]||(o[r.id]=[]);o[r.id].push({member:e,value:i.value,match:t[0]})}else{t=i.alt&&(i.alt.match(a)||i.alt.match(s));if(t){o[r.id]||(o[r.id]=[]);o[r.id].push({member:e,value:i.alt,match:t[0]})}}}t&&!n[r.id]&&(n[r.id]=r.label)})});return o};var F=function e(t){if(!E)return Promise.resolve();var n=[];_.map(t,function(e){var t=_.get(TS.boot_data.channel_membership,e.id);if(t){var r=_.chain(t.channels).keys().concat(_.keys(t.groups)).value();n.push.apply(n,N()(r));e.channels=t.channels||{};e.groups=t.groups||{};e.more_groups=t.more_groups}});return TS.shared.ensureModelObsArePresent(n,"admin_guest_channels")}})();(function(){TS.registerModule("prefs",{all_notifications_prefs_changed_sig:new signals.Signal,highlight_words_changed_sig:new signals.Signal,seen_welcome_2_changed_sig:new signals.Signal,seen_new_search_ui_changed_sig:new signals.Signal,emoji_mode_changed_sig:new signals.Signal,obey_inline_img_limit_changed_sig:new signals.Signal,messages_theme_changed_sig:new signals.Signal,expand_inline_imgs_changed_sig:new signals.Signal,expand_internal_inline_imgs_changed_sig:new signals.Signal,expand_non_media_attachments_changed_sig:new signals.Signal,webapp_spellcheck_changed_sig:new signals.Signal,color_names_in_list_changed_sig:new signals.Signal,search_only_my_channels_changed_sig:new signals.Signal,search_exclude_channels_changed_sig:new signals.Signal,search_exclude_bots_changed_sig:new signals.Signal,search_only_current_team_changed_sig:new signals.Signal,box_enabled_changed_sig:new signals.Signal,dropbox_enabled_changed_sig:new signals.Signal,read_changed_sig:new signals.Signal,push_changed_sig:new signals.Signal,time24_changed_sig:new signals.Signal,sidebar_behavior_changed_sig:new signals.Signal,dtop_notif_changed_sig:new signals.Signal,muted_channels_changed_sig:new signals.Signal,mac_ssb_bullet_changed_sig:new signals.Signal,team_hide_referers_changed_sig:new signals.Signal,sidebar_theme_changed_sig:new signals.Signal,no_invites_widget_in_sidebar_changed_sig:new signals.Signal,k_key_omnibox_auto_hide_count_changed_sig:new signals.Signal,display_real_names_override_changed_sig:new signals.Signal,team_display_real_names_changed_sig:new signals.Signal,team_perms_pref_changed_sig:new signals.Signal,privacy_policy_seen_changed_sig:new signals.Signal,two_factor_update_seen_changed_sig:new signals.Signal,compliance_export_start_changed_sig:new signals.Signal,team_disallow_public_file_urls_changed_sig:new signals.Signal,mentions_exclude_at_channels_changed_sig:new signals.Signal,mentions_exclude_at_user_groups_changed_sig:new signals.Signal,team_auth_mode_changed_sig:new signals.Signal,team_sso_auth_restrictions_changed_sig:new signals.Signal,preferred_skin_tone_changed_sig:new signals.Signal,separate_private_channels_changed_sig:new signals.Signal,separate_shared_channels_changed_sig:new signals.Signal,whats_new_read_changed_sig:new signals.Signal,team_dnd_enabled_changed_sig:new signals.Signal,team_dnd_start_hour_changed_sig:new signals.Signal,team_dnd_end_hour_changed_sig:new signals.Signal,team_invites_only_admins_changed_sig:new signals.Signal,tz_changed_sig:new signals.Signal,keyboard_changed_sig:new signals.Signal,msg_input_send_btn_changed_sig:new signals.Signal,msg_input_send_btn_auto_set_changed_sig:new signals.Signal,team_allow_calls_changed_sig:new signals.Signal,team_calling_app_name_changed_sig:new signals.Signal,team_calling_app_id_changed_sig:new signals.Signal,frecency_jumper_changed_sig:new signals.Signal,jumbomoji_changed_sig:new signals.Signal,hide_hex_swatch_changed_sig:new signals.Signal,channel_sort_changed_sig:new signals.Signal,show_memory_instrument_changed_sig:new signals.Signal,enable_unread_view_changed_sig:new signals.Signal,enable_react_emoji_picker_changed_sig:new signals.Signal,team_disable_file_editing_changed_sig:new signals.Signal,team_disable_file_deleting_changed_sig:new signals.Signal,team_display_email_addresses_changed_sig:new signals.Signal,all_unreads_sort_order_changed_sig:new signals.Signal,email_alerts_changed_sig:new signals.Signal,team_uses_customized_custom_status_presets_changed_sig:new signals.Signal,team_loud_channel_mentions_limit_changed_sig:new signals.Signal,locale_changed_sig:new signals.Signal,enable_shared_channels_changed_sig:new signals.Signal,a11y_animations_changed_sig:new signals.Signal,prefs_loaded:false,setPrefs:function e(t){var n=TS.prefs.getPref("muted_channels");TS.redux.prefs.setUserPrefs(t);TS.prefs.prefs_loaded=true;TS.prefs.mergeEmojiUse(TS.prefs.getPref("emoji_use"));TS.prefs.mergeFrecencyJumper(TS.ui.frecency.isEnterprise()?TS.prefs.getPref("frecency_ent_jumper"):TS.prefs.getPref("frecency_jumper"));TS.prefs.setUserColors(TS.prefs.getPref("user_colors"));TS.prefs.setLoudChannels(TS.prefs.getPref("loud_channels"));TS.prefs.setSuppressedChannels(TS.prefs.getPref("at_channel_suppressed_channels"));TS.prefs.setPushSuppressedChannels(TS.prefs.getPref("push_at_channel_suppressed_channels"));TS.prefs.setNeverChannels(TS.prefs.getPref("never_channels"));TS.prefs.setMutedChannels(TS.prefs.getPref("muted_channels"),n);TS.prefs.setLoudChannelsSet(TS.prefs.getPref("loud_channels_set"));TS.prefs.setPushLoudChannels(TS.prefs.getPref("push_loud_channels"));TS.prefs.setPushMentionChannels(TS.prefs.getPref("push_mention_channels"));TS.prefs.setPushLoudChannelsSet(TS.prefs.getPref("push_loud_channels_set"));TS.prefs.setSearchExcludeChannels(TS.prefs.getPref("search_exclude_channels"));TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.setSidebarThemeCustomValues(TS.utility.parseJSONOrElse(TS.prefs.getPref("sidebar_theme_custom_values"),void 0));TS.emoji.setEmojiMode();TS.prefs.setTheme();TS.prefs.setPrefLocal("emoji_autocomplete_big",false)},setChannelSort:function e(t){TS.model.channel_sort=t},setHighlightWords:function e(t){TS.prefs.setPrefLocal("highlight_words",t)},setSuppressedChannels:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("at_channel_suppressed_channels",t);TS.model.at_channel_suppressed_channels=[];t&&"string"===typeof t&&(TS.model.at_channel_suppressed_channels=TS.model.at_channel_suppressed_channels.concat(t.split(",")))},setPushSuppressedChannels:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("push_at_channel_suppressed_channels",t);TS.model.push_at_channel_suppressed_channels=[];t&&"string"===typeof t&&(TS.model.push_at_channel_suppressed_channels=TS.model.push_at_channel_suppressed_channels.concat(t.split(",")))},setLoudChannels:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("loud_channels",t);TS.model.loud_channels=[];t&&"string"===typeof t&&(TS.model.loud_channels=TS.model.loud_channels.concat(t.split(",")))},setNeverChannels:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("never_channels",t);TS.model.never_channels=[];t&&"string"===typeof t&&(TS.model.never_channels=TS.model.never_channels.concat(t.split(",")))},setMutedChannels:function t(n,r){var i;r||(r=TS.prefs.getPref("muted_channels"));if(r===n&&e)return;i=TS.prefs.getPref("muted_channels")&&"string"===typeof TS.prefs.getPref("muted_channels")?TS.prefs.getPref("muted_channels").split(","):[];TS.prefs.setPrefLocal("muted_channels",n);e=true;var a;var s;var o=[];var l=[];if(n&&"string"===typeof n){o=o.concat(n.split(","));l=_.difference(i,o)}var u=false;for(a=0;a<o.length;a+=1){s=TS.redux.channels.getEntityById(o[a],u);if(!s)continue;if(!s.unread_cnt)continue;s._show_in_list_even_though_no_unreads=true}TS.model.channels.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.model.groups.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.redux.channels.updateMutedChannels(o);return l},setLoudChannelsSet:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("loud_channels_set",t);TS.model.loud_channels_set=[];t&&"string"===typeof t&&(TS.model.loud_channels_set=TS.model.loud_channels_set.concat(t.split(",")))},setPushLoudChannels:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("push_loud_channels",t);TS.model.push_loud_channels=[];t&&"string"===typeof t&&(TS.model.push_loud_channels=TS.model.push_loud_channels.concat(t.split(",")))},setPushMentionChannels:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("push_mention_channels",t);TS.model.push_mention_channels=[];t&&"string"===typeof t&&(TS.model.push_mention_channels=TS.model.push_mention_channels.concat(t.split(",")))},setPushLoudChannelsSet:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("push_loud_channels_set",t);TS.model.push_loud_channels_set=[];t&&"string"===typeof t&&(TS.model.push_loud_channels_set=TS.model.push_loud_channels_set.concat(t.split(",")))},setSearchExcludeChannels:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("search_exclude_channels",t);TS.model.search_exclude_channels=[];t&&"string"===typeof t&&(TS.model.search_exclude_channels=TS.model.search_exclude_channels.concat(t.split(",")))},mergeFrecencyJumper:function e(t){t&&"object"===("undefined"===typeof t?"undefined":s()(t))||(t=TS.utility.parseJSONOrElse(t||null)||{});TS.model.frecency_jumper=t;return true},mergeEmojiUse:function e(t){TS.model.emoji_names&&TS.model.emoji_names.length||TS.emoji.makeMenuLists();if(!t||"object"!==("undefined"===typeof t?"undefined":s()(t))){t=TS.utility.parseJSONOrElse(t||null)||{};t=_.pickBy(t,function(e,t){return _.includes(TS.model.emoji_names,t)})}var n=false;for(var r in t)if(!TS.model.emoji_use.hasOwnProperty(r)||t[r]>TS.model.emoji_use[r]){TS.model.emoji_use[r]=t[r];n=true}if(!n){TS.has_pri[777]&&TS.log(777,"mergeEmojiUse TS.model.emoji_use unchanged");return false}TS.has_pri[777]&&TS.dir(777,TS.model.emoji_use,"mergeEmojiUse TS.model.emoji_use set to:");return true},setUserColors:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.skipSettingLocalPref,i=void 0!==r&&r;i||TS.prefs.setPrefLocal("user_colors",t);var a=t?JSON.parse(t):{};TS.model.user_colors=a||{}},setTheme:function e(){"default"===TS.prefs.getPref("messages_theme")&&TS.prefs.setPrefLocal("messages_theme","light_with_avatars");TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true);if("dense"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","dense");TS.prefs.setPrefLocal("avatars",false)}else if("light"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",false)}else if("light_with_avatars"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true)}},legacyOnTeamPrefChanged:function e(t){if("msg_edit_window_mins"===t.name)TS.prefs.setTeamPrefLocal("msg_edit_window_mins",t.value);else if("allow_message_deletion"===t.name)TS.prefs.setTeamPrefLocal("allow_message_deletion",!!t.value);else if("hide_referers"===t.name){TS.prefs.setTeamPrefLocal("hide_referers",!!t.value);TS.prefs.team_hide_referers_changed_sig.dispatch()}else if("display_real_names"===t.name){TS.prefs.setTeamPrefLocal("display_real_names",!!t.value);TS.prefs.team_display_real_names_changed_sig.dispatch()}else if("display_email_addresses"===t.name){TS.prefs.setTeamPrefLocal("display_email_addresses",!!t.value);TS.prefs.team_display_email_addresses_changed_sig.dispatch()}else if(0===t.name.indexOf("who_can_")){if(TS.prefs.getTeamPref(t.name)!=t.value){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_perms_pref_changed_sig.dispatch(t.name)}}else if("compliance_export_start"===t.name){if(TS.prefs.getTeamPref("compliance_export_start")!=t.value){TS.prefs.setTeamPrefLocal("compliance_export_start",t.value);TS.prefs.compliance_export_start_changed_sig.dispatch()}}else if("disallow_public_file_urls"===t.name){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",!!t.value);TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch()}else if("auth_mode"===t.name){TS.prefs.setTeamPrefLocal("auth_mode",t.value);TS.prefs.team_auth_mode_changed_sig.dispatch()}else if("sso_auth_restrictions"===t.name){TS.prefs.setTeamPrefLocal("sso_auth_restrictions",t.value);TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch()}else if("dnd_enabled"===t.name){TS.prefs.setTeamPrefLocal("dnd_enabled",t.value);TS.prefs.team_dnd_enabled_changed_sig.dispatch()}else if("dnd_start_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_start_hour",t.value);TS.prefs.team_dnd_start_hour_changed_sig.dispatch()}else if("dnd_end_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_end_hour",t.value);TS.prefs.team_dnd_end_hour_changed_sig.dispatch()}else if("invites_only_admins"===t.name){TS.prefs.setTeamPrefLocal("invites_only_admins",t.value);TS.prefs.team_invites_only_admins_changed_sig.dispatch()}else if("allow_calls"===t.name){TS.prefs.setTeamPrefLocal("allow_calls",t.value);TS.prefs.team_allow_calls_changed_sig.dispatch()}else if("calling_app_id"===t.name){TS.prefs.setTeamPrefLocal("calling_app_id",t.value);TS.prefs.team_calling_app_id_changed_sig.dispatch()}else if("calling_app_name"===t.name){TS.prefs.setTeamPrefLocal("calling_app_name",t.value);TS.prefs.team_calling_app_name_changed_sig.dispatch()}else if("disable_file_editing"===t.name){TS.prefs.setTeamPrefLocal("disable_file_editing",t.value);TS.prefs.team_disable_file_editing_changed_sig.dispatch()}else if("disable_file_deleting"===t.name){TS.prefs.setTeamPrefLocal("disable_file_deleting",t.value);TS.prefs.team_disable_file_deleting_changed_sig.dispatch()}else if("who_can_post_general"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);var n=TS.interop.channels.getGeneralChannel().id;TS.permissions.members.canPostInGeneral()?TS.channels.read_only.removeChannelFromList(n):TS.channels.read_only.addChannelToList(n)}else if("uses_customized_custom_status_presets"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch()}else if("loud_channel_mentions_limit"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch()}else if("enable_shared_channels"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.enable_shared_channels_changed_sig.dispatch()}else TS.prefs.setTeamPrefLocal(t.name,t.value)},onTeamPrefChanged:function e(t){var n=t.name,r=t.value;if(!TS.boot_data.feature_team_prefs_modernization){TS.warn("onTeamPrefChanged called when feature_team_prefs_modernization was not enabled");return TS.prefs.legacyOnTeamPrefChanged({name:n,value:r})}if("hide_referers"===n)TS.prefs.team_hide_referers_changed_sig.dispatch();else if("display_real_names"===n)TS.prefs.team_display_real_names_changed_sig.dispatch();else if("display_email_addresses"===n)TS.prefs.team_display_email_addresses_changed_sig.dispatch();else if(0===n.indexOf("who_can_"))TS.prefs.team_perms_pref_changed_sig.dispatch(n);else if("compliance_export_start"===n)TS.prefs.compliance_export_start_changed_sig.dispatch();else if("disallow_public_file_urls"===n)TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch();else if("auth_mode"===n)TS.prefs.team_auth_mode_changed_sig.dispatch();else if("sso_auth_restrictions"===n)TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch();else if("dnd_enabled"===n)TS.prefs.team_dnd_enabled_changed_sig.dispatch();else if("dnd_start_hour"===n)TS.prefs.team_dnd_start_hour_changed_sig.dispatch();else if("dnd_end_hour"===n)TS.prefs.team_dnd_end_hour_changed_sig.dispatch();else if("invites_only_admins"===n)TS.prefs.team_invites_only_admins_changed_sig.dispatch();else if("allow_calls"===n)TS.prefs.team_allow_calls_changed_sig.dispatch();else if("calling_app_id"===n)TS.prefs.team_calling_app_id_changed_sig.dispatch();else if("calling_app_name"===n)TS.prefs.team_calling_app_name_changed_sig.dispatch();else if("disable_file_editing"===n)TS.prefs.team_disable_file_editing_changed_sig.dispatch();else if("disable_file_deleting"===n)TS.prefs.team_disable_file_deleting_changed_sig.dispatch();else if("who_can_post_general"===n){var i=TS.interop.channels.getGeneralChannel().id;TS.permissions.members.canPostInGeneral()?TS.channels.read_only.removeChannelFromList(i):TS.channels.read_only.addChannelToList(i)}else"uses_customized_custom_status_presets"===n?TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch():"loud_channel_mentions_limit"===n?TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch():"enable_shared_channels"===n&&TS.prefs.enable_shared_channels_changed_sig.dispatch()},getPref:function e(t){return TS.redux.prefs.getUserPref(t)},setPrefLocal:function e(t,n){TS.redux.prefs.setUserPref(t,n)},getTeamPref:function e(t){return TS.redux.prefs.getTeamPref(t)},setTeamPrefLocal:function e(t,n){TS.redux.prefs.setTeamPref(t,n)},setMultiplePrefs:function e(t){TS.redux.prefs.setMultipleUserPrefs(t)},legacyOnPrefChanged:function e(t){switch(t.name){case"all_notifications_prefs":TS.prefs.setPrefLocal("all_notifications_prefs",t.value);TS.prefs.all_notifications_prefs_changed_sig.dispatch(t.value);break;case"locale":TS.prefs.setPrefLocal("locale",t.value);TS.prefs.locale_changed_sig.dispatch(t.value);break;case"flannel_server_pool":TS.prefs.setPrefLocal("flannel_server_pool",t.value);break;case"color_names_in_list":TS.prefs.setPrefLocal("color_names_in_list",!!t.value);TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.prefs.setPrefLocal("display_real_names_override",t.value);TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.prefs.setPrefLocal("growls_enabled",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":if(TS.prefs.getPref("sidebar_theme")!==t.value){TS.prefs.setPrefLocal("sidebar_theme",t.value);TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"sidebar_theme_custom_values":if(TS.prefs.getPref("sidebar_theme_custom_values")!==t.value){TS.prefs.setSidebarThemeCustomValues(JSON.parse(t.value));TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"expand_inline_imgs":TS.prefs.setPrefLocal("expand_inline_imgs",!!t.value);TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.prefs.setPrefLocal("webapp_spellcheck",!!t.value);TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.prefs.setPrefLocal("expand_internal_inline_imgs",!!t.value);TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.prefs.setPrefLocal("expand_non_media_attachments",!!t.value);TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.prefs.setPrefLocal("messages_theme",t.value);TS.prefs.setTheme();TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.setHighlightWords(t.value);TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(t.value);TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(t.value);break;case"never_channels":TS.prefs.setNeverChannels(t.value);break;case"muted_channels":var n=TS.prefs.setMutedChannels(t.value);TS.view.prefs.mutedChannelsChanged(n);TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(t.value);break;case"push_mention_channels":TS.prefs.setPushMentionChannels(t.value);break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(t.value);TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":TS.prefs.mergeEmojiUse(t.value)&&TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),function(e){var t=TS.interop.members.getMemberById(e);t&&TS.members.setMemberUserColor(t,t.color)});TS.prefs.setUserColors(t.value);_.forOwn(TS.model.user_colors,function(e,t){var n=TS.interop.members.getMemberById(t);n&&TS.members.setMemberUserColor(n,e)});break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("graphic_emoticons",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.prefs.setPrefLocal("ss_emojis",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();var r=t.value;"as_text"!==t.value&&(r=TS.interop.rules.emoji.getEmojiMode({forceDisplay:true}));TS.emoji.setEmojiMode(r);TS.prefs.setPrefLocal("emoji_mode",t.value);TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.prefs.setPrefLocal("obey_inline_img_limit",t.value);TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":case"search_only_current_team":case"search_exclude_bots":break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(t.value);TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"has_uploaded":TS.prefs.setPrefLocal("has_uploaded",!!t.value);break;case"has_invited":TS.prefs.setPrefLocal("has_invited",!!t.value);break;case"has_created_channel":TS.prefs.setPrefLocal("has_created_channel",!!t.value);break;case"no_joined_overlays":TS.prefs.setPrefLocal("no_joined_overlays",!!t.value);break;case"no_created_overlays":TS.prefs.setPrefLocal("no_created_overlays",!!t.value);break;case"seen_welcome_2":TS.prefs.setPrefLocal("seen_welcome_2",!!t.value);TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"seen_new_search_ui":TS.prefs.setPrefLocal("seen_new_search_ui",!!t.value);TS.prefs.seen_new_search_ui_changed_sig.dispatch();break;case"box_enabled":TS.prefs.setPrefLocal("box_enabled",!!t.value);TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.prefs.setPrefLocal("dropbox_enabled",!!t.value);TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":if(TS.prefs.getPref("mark_msgs_read_immediately")!==!!t.value){TS.prefs.setPrefLocal("mark_msgs_read_immediately",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"start_scroll_at_oldest":if(TS.prefs.getPref("start_scroll_at_oldest")!==!!t.value){TS.prefs.setPrefLocal("start_scroll_at_oldest",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"mac_ssb_bullet":if(TS.prefs.getPref("mac_ssb_bullet")!==!!t.value){TS.prefs.setPrefLocal("mac_ssb_bullet",!!t.value);TS.prefs.mac_ssb_bullet_changed_sig.dispatch()}break;case"all_channels_loud":if(TS.prefs.getPref("all_channels_loud")!==!!t.value){TS.prefs.setPrefLocal("all_channels_loud",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch()}break;case"push_everything":if(TS.prefs.getPref("push_everything")!==!!t.value){TS.prefs.setPrefLocal("push_everything",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_mention_alert":if(TS.prefs.getPref("push_mention_alert")!==!!t.value){TS.prefs.setPrefLocal("push_mention_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_dm_alert":if(TS.prefs.getPref("push_dm_alert")!==!!t.value){TS.prefs.setPrefLocal("push_dm_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"time24":if(TS.prefs.getPref("time24")!==!!t.value){TS.prefs.setPrefLocal("time24",!!t.value);TS.prefs.time24_changed_sig.dispatch()}break;case"sidebar_behavior":if(TS.prefs.getPref("sidebar_behavior")!=t.value){TS.prefs.setPrefLocal("sidebar_behavior",t.value);TS.prefs.sidebar_behavior_changed_sig.dispatch()}break;case"two_factor_update_seen":if(TS.model.two_factor_update_seen!=t.value){TS.mode.prefs.two_factor_update_seen=t.value;TS.prefs.two_factor_update_seen_changed_sig.dispatch()}break;case"privacy_policy_seen":if(TS.prefs.getPref("privacy_policy_seen")!=t.value){TS.prefs.setPrefLocal("privacy_policy_seen",t.value);TS.prefs.privacy_policy_seen_changed_sig.dispatch()}break;case"last_seen_at_channel_warning":TS.prefs.getPref("last_seen_at_channel_warning")!=t.value&&TS.prefs.setPrefLocal("last_seen_at_channel_warning",t.value);break;case"winssb_run_from_tray":TS.prefs.getPref("winssb_run_from_tray")!=t.value&&TS.prefs.setPrefLocal("winssb_run_from_tray",t.value);break;case"winssb_window_flash_behavior":TS.prefs.getPref("winssb_window_flash_behavior")!=t.value&&TS.prefs.setPrefLocal("winssb_window_flash_behavior",t.value);break;case"mentions_exclude_at_channels":if(TS.prefs.getPref("mentions_exclude_at_channels")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_channels",t.value);TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch()}break;case"mentions_exclude_at_user_groups":if(TS.prefs.getPref("mentions_exclude_at_user_groups")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_user_groups",t.value);TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch()}break;case"no_invites_widget_in_sidebar":if(TS.prefs.getPref("no_invites_widget_in_sidebar")!=t.value){TS.prefs.setPrefLocal("no_invites_widget_in_sidebar",t.value);TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch()}break;case"k_key_omnibox_auto_hide_count":if(TS.prefs.getPref("k_key_omnibox_auto_hide_count")!=t.value){TS.prefs.setPrefLocal("k_key_omnibox_auto_hide_count",t.value);TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch()}break;case"show_sidebar_quickswitcher_button":TS.prefs.getPref("show_sidebar_quickswitcher_button")!=t.value&&TS.prefs.setPrefLocal("show_sidebar_quickswitcher_button",t.value);break;case"preferred_skin_tone":if(TS.prefs.getPref("preferred_skin_tone")!=t.value){TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("preferred_skin_tone",t.value);TS.prefs.preferred_skin_tone_changed_sig.dispatch()}break;case"separate_private_channels":if(TS.prefs.getPref("separate_private_channels")!=t.value){TS.prefs.setPrefLocal("separate_private_channels",t.value);TS.prefs.separate_private_channels_changed_sig.dispatch()}break;case"separate_shared_channels":if(TS.prefs.getPref("separate_shared_channels")!=t.value){TS.prefs.setPrefLocal("separate_shared_channels",t.value);TS.prefs.separate_shared_channels_changed_sig.dispatch()}break;case"whats_new_read":if(TS.prefs.getPref("whats_new_read")!=t.value){TS.prefs.setPrefLocal("whats_new_read",t.value);TS.prefs.whats_new_read_changed_sig.dispatch()}break;case"tz":if(TS.prefs.getPref("tz")!=t.value){TS.prefs.setPrefLocal("tz",t.value);TS.prefs.tz_changed_sig.dispatch()}break;case"keyboard":if(TS.prefs.getPref("keyboard")!=t.value){TS.prefs.setPrefLocal("keyboard",t.value);TS.prefs.keyboard_changed_sig.dispatch()}break;case"msg_input_send_btn":if(TS.prefs.getPref("msg_input_send_btn")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn",t.value);TS.prefs.msg_input_send_btn_changed_sig.dispatch()}break;case"msg_input_send_btn_auto_set":if(TS.prefs.getPref("msg_input_send_btn_auto_set")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn_auto_set",t.value);TS.prefs.msg_input_send_btn_auto_set_changed_sig.dispatch()}break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_TEAM_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),t.value);TS.prefs.mergeFrecencyJumper(t.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_ORG_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),t.value);TS.log(666,"Received a pref_change event for frecency_ent_jumper.");TS.prefs.mergeFrecencyJumper(t.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":if(TS.prefs.getPref("jumbomoji")!=t.value){TS.prefs.setPrefLocal("jumbomoji",t.value);TS.prefs.jumbomoji_changed_sig.dispatch()}break;case"hide_hex_swatch":if(TS.prefs.getPref("hide_hex_swatch")!=t.value){TS.prefs.setPrefLocal("hide_hex_swatch",t.value);TS.prefs.hide_hex_swatch_changed_sig.dispatch()}break;case"a11y_animations":if(TS.prefs.getPref("a11y_animations")!==t.value){TS.prefs.setPrefLocal("a11y_animations",t.value);TS.prefs.a11y_animations_changed_sig.dispatch();TS.client&&TS.interop.clog.track("PREF_USER_CLIENT_UPDATE",{a11y_animations:TS.prefs.getPref("a11y_animations")})}break;case"show_memory_instrument":if(TS.prefs.getPref("show_memory_instrument")!==t.value){TS.prefs.setPrefLocal("show_memory_instrument",t.value);TS.prefs.show_memory_instrument_changed_sig.dispatch()}break;case"channel_sort":if(TS.prefs.getPref("channel_sort")!==t.value){TS.prefs.setPrefLocal("channel_sort",t.value);TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.channel_sort_changed_sig.dispatch()}break;case"enable_unread_view":if(TS.prefs.getPref("enable_unread_view")!==t.value){TS.prefs.setPrefLocal("enable_unread_view",t.value);TS.prefs.enable_unread_view_changed_sig.dispatch()}break;case"enable_react_emoji_picker":if(TS.prefs.getPref("enable_react_emoji_picker")!==t.value){TS.prefs.setPrefLocal("enable_react_emoji_picker",t.value);TS.prefs.enable_react_emoji_picker_changed_sig.dispatch()}break;case"client_logs_pri":TS.prefs.setPrefLocal(t.name,t.value);TS.console.setAppropriatePri();break;case"email_alerts":TS.prefs.setPrefLocal(t.name,t.value);TS.prefs.email_alerts_changed_sig.dispatch();break;default:TS.prefs.setPrefLocal(t.name,t.value)}},onPrefChanged:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.name,r=t.value;if(!TS.boot_data.feature_prefs_modernization){TS.warn("onPrefChanged called when feature_prefs_modernization was not enabled");return TS.prefs.legacyOnPrefChanged({name:n,value:r})}switch(n){case"all_notifications_prefs":TS.prefs.all_notifications_prefs_changed_sig.dispatch(r);break;case"locale":TS.prefs.locale_changed_sig.dispatch(r);break;case"color_names_in_list":TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":TS.prefs.sidebar_theme_changed_sig.dispatch();break;case"sidebar_theme_custom_values":TS.prefs.setSidebarThemeCustomValues(JSON.parse(r));TS.prefs.sidebar_theme_changed_sig.dispatch();break;case"expand_inline_imgs":TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.prefs.setTheme();TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(r,{skipSettingLocalPref:true});TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(r,{skipSettingLocalPref:true});TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(r,{skipSettingLocalPref:true});break;case"never_channels":TS.prefs.setNeverChannels(r,{skipSettingLocalPref:true});break;case"muted_channels":var i=TS.prefs.setMutedChannels(r);TS.view.prefs.mutedChannelsChanged(i);TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(r,{skipSettingLocalPref:true});TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(r,{skipSettingLocalPref:true});break;case"push_mention_channels":TS.prefs.setPushMentionChannels(r,{skipSettingLocalPref:true});break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(r,{skipSettingLocalPref:true});TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":TS.prefs.mergeEmojiUse(r)&&TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),function(e){var t=TS.interop.members.getMemberById(e);t&&TS.members.setMemberUserColor(t,t.color)});TS.prefs.setUserColors(r,{skipSettingLocalPref:true});_.forOwn(TS.model.user_colors,function(e,t){var n=TS.interop.members.getMemberById(t);n&&TS.members.setMemberUserColor(n,e)});break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("graphic_emoticons",r);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();var a=r;"as_text"!==r&&(a=TS.interop.rules.emoji.getEmojiMode({forceDisplay:true}));TS.emoji.setEmojiMode(a);TS.prefs.setPrefLocal("emoji_mode",r);TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":TS.prefs.search_only_my_channels_changed_sig.dispatch();break;case"search_only_current_team":TS.prefs.search_only_current_team_changed_sig.dispatch();break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(r,{skipSettingLocalPref:true});TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"search_exclude_bots":TS.prefs.search_exclude_bots_changed_sig.dispatch();break;case"seen_welcome_2":TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"seen_new_search_ui":TS.prefs.seen_new_search_ui_changed_sig.dispatch();break;case"box_enabled":TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":TS.prefs.read_changed_sig.dispatch();break;case"start_scroll_at_oldest":TS.prefs.read_changed_sig.dispatch();break;case"mac_ssb_bullet":TS.prefs.mac_ssb_bullet_changed_sig.dispatch();break;case"all_channels_loud":TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_everything":TS.prefs.push_changed_sig.dispatch();break;case"push_mention_alert":TS.prefs.push_changed_sig.dispatch();break;case"push_dm_alert":TS.prefs.push_changed_sig.dispatch();break;case"time24":TS.prefs.time24_changed_sig.dispatch();break;case"sidebar_behavior":TS.prefs.sidebar_behavior_changed_sig.dispatch();break;case"two_factor_update_seen":TS.prefs.two_factor_update_seen_changed_sig.dispatch();break;case"privacy_policy_seen":TS.prefs.privacy_policy_seen_changed_sig.dispatch();break;case"mentions_exclude_at_channels":TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch();break;case"mentions_exclude_at_user_groups":TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch();break;case"no_invites_widget_in_sidebar":TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch();break;case"k_key_omnibox_auto_hide_count":TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch();break;case"preferred_skin_tone":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("preferred_skin_tone",r);TS.prefs.preferred_skin_tone_changed_sig.dispatch();break;case"separate_private_channels":TS.prefs.separate_private_channels_changed_sig.dispatch();break;case"separate_shared_channels":TS.prefs.separate_shared_channels_changed_sig.dispatch();break;case"whats_new_read":TS.prefs.whats_new_read_changed_sig.dispatch();break;case"tz":TS.prefs.tz_changed_sig.dispatch();break;case"keyboard":TS.prefs.keyboard_changed_sig.dispatch();break;case"msg_input_send_btn":TS.prefs.msg_input_send_btn_changed_sig.dispatch();break;case"msg_input_send_btn_auto_set":TS.prefs.msg_input_send_btn_auto_set_changed_sig.dispatch();break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_TEAM_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),r);TS.prefs.mergeFrecencyJumper(r)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_ORG_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),r);TS.log(666,"Received a pref_change event for frecency_ent_jumper.");TS.prefs.mergeFrecencyJumper(r)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":TS.prefs.jumbomoji_changed_sig.dispatch();break;case"hide_hex_swatch":TS.prefs.hide_hex_swatch_changed_sig.dispatch();break;case"a11y_animations":TS.prefs.a11y_animations_changed_sig.dispatch();TS.client&&TS.interop.clog.track("PREF_USER_CLIENT_UPDATE",{a11y_animations:TS.prefs.getPref("a11y_animations")});break;case"show_memory_instrument":TS.prefs.show_memory_instrument_changed_sig.dispatch();break;case"channel_sort":TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.channel_sort_changed_sig.dispatch();break;case"enable_unread_view":TS.prefs.enable_unread_view_changed_sig.dispatch();break;case"enable_react_emoji_picker":TS.prefs.enable_react_emoji_picker_changed_sig.dispatch();break;case"client_logs_pri":TS.console.setAppropriatePri();break;case"email_alerts":TS.prefs.email_alerts_changed_sig.dispatch();break;default:break}},hex_regex:new RegExp(/^#?([0-9a-f]{6})$/i),conditionallyClogFrecencyDueToSizeChange:function e(t,n,r){r.length/n.length<.1&&TS.interop.clog.track(t,{updated_user_client_prefs:{existing_frecency:n,new_frecency:r}})},setSidebarThemeCustomValues:function e(t){var n=false;t&&"object"===("undefined"===typeof t?"undefined":s()(t))&&void 0===t.length&&_.forOwn(t,function(e,r){n=false;if(!e)return false;if(!e.substr)return false;t[r]=e.substr(0,7);if(!e.match(TS.prefs.hex_regex))return false;n=true});if(n)TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(t));else{TS.prefs.setPrefLocal("sidebar_theme","default");TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(TS.sidebar_themes.default_themes.default_theme))}},setMultiPrefsByAPI:function e(t,n){var r="";_.forOwn(t,function(e,t){r+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(!r){TS.error(" no prefs to set?");return}var i={prefs:r};return TS.prefs.setPrefByAPI(i,n)},setPrefByAPI:function e(t,n){return TS.interop.api.callExpedited("users.prefs.set",t).then(function(e){var t=true;var r=e.data,i=e.args;if(TS.boot_data.feature_degraded_send&&r&&r.prefs&&i){var a=i.name&&[i.name]||_.keys(TS.interop.url.queryStringParse(i.prefs));_.forEach(a,function(e){return TS.prefs.legacyOnPrefChanged({name:e,value:r.prefs[e]})})}if(n)return n(t,r,i)}).catch(function(e){var t=e.args;var n;t.hasOwnProperty("name")?n="pref name: "+t.name:t.prefs&&(n="(multiple prefs)");TS.logError(n,"TS.prefs.setPrefByAPI call got a not ok rsp","API response error");setTimeout(function(){t.prefs?TS.error("multi preferences setting failed."):TS.error('"'+t.name+'" preference setting failed.')},0)})},setTeamPrefByAPI:function e(t,n,r){return TS.interop.api.callExpedited("team.prefs.set",{prefs:JSON.stringify(t)}).then(function(e){var n=e.data;if(TS.web){r=r||[];var i=Object.keys(t).concat(r);i.forEach(function(e){n.prefs.hasOwnProperty(e)&&(t.hasOwnProperty(e)||TS.prefs.getTeamPref(e)!==n.prefs[e])&&TS.prefs.legacyOnTeamPrefChanged({name:e,value:n.prefs[e]})})}return Promise.resolve(n.prefs)}).catch(function(e){var t=e.data;n&&n(t);return Promise.reject(t)})},saveHighlightWords:function e(t,n){var r=TS.interop.prefs.cleanHighlightWords(t);if(n||TS.notifs.getGlobalHighlightWords()!=r)return TS.notifs.setGlobalHighlightWords(r);return Promise.resolve()},getReadStateTrackingPref:function e(){if(TS.boot_data.feature_prefs_modernization)return TS.interop.prefs.getReadStateTrackingPref();var t="default";TS.prefs.getPref("mark_msgs_read_immediately")&&TS.prefs.getPref("start_scroll_at_oldest")?t="immediate_scroll":TS.prefs.getPref("mark_msgs_read_immediately")&&(t="immediate");return t},setReadStateTrackingPref:function e(t,n){var r={};if("immediate_scroll"===t||"immediate"===t){r.mark_msgs_read_immediately=true;TS.prefs.setPrefLocal("mark_msgs_read_immediately",true);if("immediate_scroll"===t){r.start_scroll_at_oldest=true;TS.prefs.setPrefLocal("start_scroll_at_oldest",true)}else{r.start_scroll_at_oldest=false;TS.prefs.setPrefLocal("start_scroll_at_oldest",false)}}else{r.mark_msgs_read_immediately=false;TS.prefs.setPrefLocal("mark_msgs_read_immediately",false);r.start_scroll_at_oldest=false;TS.prefs.setPrefLocal("start_scroll_at_oldest",false)}TS.prefs.setMultiPrefsByAPI(r,n)},removeTeamFromEnterpriseExcludeTeamPref:function e(t){if(!TS.boot_data.page_needs_enterprise)return;var n=TS.prefs.getPref("enterprise_excluded_app_teams");if(!n)return;var r=n?n.split(","):[];_.pull(r,t);TS.prefs.setPrefByAPI({name:"enterprise_excluded_app_teams",value:r.join(",")})}});var e=false})();var q=n(2911);var W=n(2912);var z=n(2913);var K=n(2914);(function(){TS.registerModule("templates.builders",{debug_items:{},debug_items_index:0,buildStarComponents:function e(n,r,i,a){return t(n,r,i,a)},fileHTML:function e(t,n){n=n||{};var r=TS.utility.members.getEntityFromFile(t);var i=TS.files.getFileActions(t);var a;var s="hosted"===t.mode||"external"===t.mode;var o={member:r,file:t,for_search:n.for_search,is_enterprise:n.is_enterprise,for_files_list:!n.for_share_dialog,show_channel_name:n.show_channel_name,icon_class:TS.utility.getImageIconClass(t,"thumb_80"),is_email:"email"===t.mode,is_space:"space"===t.mode,is_post:"post"===t.mode,is_docs:"docs"===t.mode,is_snippet:"snippet"===t.mode,is_hosted_or_external:s,has_image:s&&t.thumb_80&&!t.has_rich_preview,can_share:!!i.share&&"docs"!==t.mode,feature_file_threads:TS.boot_data.feature_file_threads};TS.client&&(o.info_pane_visible="details"===TS.model.ui_state.flex_name);o.supports_line_clamp=TS.environment.supports_line_clamp;"external"===t.mode&&(o.external_filetype_html=TS.templates.builders.makeExternalFiletypeHTML(t));if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}a=TS.templates.file_list_item(o);return a},buildReplyBarHTML:function e(t,n){var r={msg:t,model_ob:n,conversation_permalink:TS.utility.msgs.constructConversationPermalink(n,t.thread_ts)};var i=t.replies;if(t.reply_users){r.num_replies=t.reply_count;r.first_repliers=_.chain(t.reply_users).take(5).map(function(e){var t=TS.interop.utility.looksLikeBotId(e);if(t)return TS.interop.bots.getBotById(e);return TS.redux.members.getPotentiallyUnknownMemberById(e)}).compact().value();r.additional_reply_count=t.reply_users_count-r.first_repliers.length}else if(i&&i.length){r.num_replies=i.length;var a=_.chain(i).uniqBy("user").map(function(e){var t=TS.interop.utility.looksLikeBotId(e.user);if(t)return TS.interop.bots.getBotById(e.user);return TS.redux.members.getPotentiallyUnknownMemberById(e.user)}).compact().value();r.first_repliers=_.take(a,5);r.additional_reply_count=a.length-r.first_repliers.length}if(r.num_replies){var s=t.latest_reply?t.latest_reply:i&&i.length&&_.last(i).ts;var o=TS.interop.datetime.toDateObject(s);TS.interop.datetime.isSameDay(o,new Date)?1===r.num_replies?r.last_reply_at=TS.interop.i18n.t("Today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})}):r.last_reply_at=TS.interop.i18n.t("Last reply today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})}):1===r.num_replies?r.last_reply_at=TS.interop.datetime.toTimeAgo(s):r.last_reply_at=TS.interop.i18n.t("Last reply {time_ago}","threads")({time_ago:TS.interop.datetime.toTimeAgo(s)})}return TS.templates.message_reply_bar(r)},formatSoundUrl:function e(t,n){return""},buildAttachmentActions:function e(t,n,r){var i=t.actions.map(function(e){switch(e.type){case"button":return TS.templates.builders.buildAttachmentActionButtonHTML(e,r);case"select":return TS.templates.builders.buildAttachmentActionSelectHTML(e,r,n,t.id);default:break}return});var a=i.join("");return a},buildAttachmentHTML:function e(t){var n=t.msg_dom_id||TS.templates.makeMsgDomId(t.msg.ts);var r=t.attachment;var i=t.model_ob||TS.shared.legacyGetActiveModelOb();if(TS.templates.builders.shouldDoSimpleAttachment(r,t.msg)){if(r.video_html)return TS.templates.builders.buildInlineVideoTogglerAndDiv(r.from_url,n);if(r.image_url)return TS.templates.builders.buildInlineImgTogglerAndDiv(r.from_url,n,t);if(r.audio_url)return" "+TS.templates.builders.formatSoundUrl(r,t.msg)}if(r.color){"number"===typeof r.color&&(r.color=r.color.toString());if(r.color.indexOf)r.color=r.color.replace(/#/g,"");else{TS.warn("msg "+t.msg.ts+" has an invalid (non string) color:"+r.color+" (removed in client)");delete r.color}}var a=[];var s=[];if(r.fields){var o;var l;var u;for(var d=0;d<r.fields.length;d+=1){l=true;o=r.fields[d];u&&o.short&&u.short&&u._new_row&&(l=false);o._new_row=l;u=o;o.short?a.push(o):s.push(o)}}var c=!r._always_expand&&r._short_text&&!TS.inline_attachments.shouldExpandText(TS.templates.makeMsgAttachmentTextExpanderDomId(t.msg.ts,r._index));var m=!!r.more;var f=r.from_url||r.ts_link||r.title_link||r.author_link;var p="reply_broadcast"===_.get(t.msg,"subtype");var h=r.thumb_link||f;var g=false;i?false!==t.can_delete&&(g=(r.id||0===r.id)&&(r.from_url||t.msg.text)&&(TS.model.user.is_admin&&!i.is_im||TS.model.user.id==t.msg.user)&&"pinned_item"!==t.msg.subtype&&!p):TS.warn("need to get model_ob passed in here somehow! for expanding messages in activity feed");var S=r.thumb_url&&!r.image_url&&!r.video_html&&!r.audio_html;var T=S?r.proxied_thumb_url||r.thumb_url:null;var v=false;var b="";if(r.is_msg_unfurl){var y=TS.utility.msgs.getMsg(r.ts,i.msgs);if(y&&y.pinned_to&&y.pinned_to.length>0){v=_.some(y.pinned_to,function(e){return e===i.id});v&&!p&&(b=TS.templates.builders.buildPinInfoHtml(y))}}var w=false;p&&(w=r.ts?TS.interop.datetime.toTime(r.ts,{do24hrTime:TS.utility.date.do24hrTime()}):TS.interop.datetime.toTime(t.msg.ts,{do24hrTime:TS.utility.date.do24hrTime()}));var k=r.from_url&&t.has_container;p&&(k=true);var x={is_text_collapsed:c,has_more:m,attachment:r,attachment_meta:w,pin_html:b,short_fields:a,long_fields:s,msg:t.msg,msg_dom_id:n,real_src:TS.utility.attachments.getMediaSource(r),is_standalone:!t.msg.text||t.msg.ignore_if_attachments_supported||!r.pretext,show_fields_table:"0"!=TS.qs_args.show_fields_table,can_delete:g,thumb_link:h,small_thumb_url:T,show_fallback:TS.model.show_attachment_fallback,enable_slack_action_links:true===t.enable_slack_action_links,render_file_threads:r.is_msg_unfurl&&TS.interop.messages.shouldRenderFileThread(r)};if(!t.from_post){var C="web"===TS.boot_data.app||true!==t.enable_slack_action_links;var I;C&&(I="web"===TS.boot_data.app?"ARCHIVES":TS.shared.legacyGetActiveModelOb().is_channel&&!TS.shared.legacyGetActiveModelOb().is_member?"CHANNEL_PREVIEW":"OTHER");x=_.assign(x,{attachment:r,has_actions:!!(!_.isEmpty(r.actions)||!_.isEmpty(r.legacy_actions)),has_source:_.some(r._source),has_border:t.has_border,has_indent:r.indent,has_container:t.has_container,has_media:t.show_media_caret,has_text_content:!!(r.text||r.title),has_thumb:!!S,has_footer:!!(r.footer||r.footer_icon||r.ts||r._attribution)&&!p,disable_actions:C,disable_actions_reason:I,border_color:r.color&&"#"+r.color||null,break_border:t.break_border,caret_location:TS.utility.attachments.getMediaCaretLocation(r)});x.applied_classes=TS.utility.getAppliedClasses({inline_attachment:true,standalone:x.is_standalone,has_thumb:x.has_thumb,can_delete:x.can_delete,clickable:k,message_unfurl:r._unfurl_type_message,reply_broadcast:p,is_pinned:v});if(r.callback_id){var M=TS.attachment_actions.client_buttons.fetchClientButtonData(t.msg);if(M){x.client_buttons=TS.attachment_actions.client_buttons.generateActions(M,r);x.has_text_content=!x.client_buttons.actions}}if(x.has_footer&&x.attachment.is_msg_unfurl){var A=TS.utility.attachments.getSlackMessageFooterText(x.attachment,x.msg);A&&(x.attachment.footer=A)}return TS.templates.message_attachment(x)}var E=true;var P="";if(t.show_initial_caret||t.show_media_caret){var F=TS.utility.attachments.getMediaType(r);switch(F){case"video":var O=TS.model.inline_videos[r.from_url||r.thumb_url];if(O){var D=true;P=TS.templates.builders.buildInlineVideoToggler(r.from_url||r.thumb_url,n,D);E=TS.inline_videos.shouldExpand(n,O)}break;case"audio":var H=TS.model.inline_audios[r.audio_html||r.audio_url];if(H){P=TS.templates.builders.buildInlineAudioToggler(r.audio_html||r.audio_url,n);E=TS.inline_audios.shouldExpand(n,H)}break;case"other":var $=TS.model.inline_others[r.other_html];if($){P=TS.templates.builders.buildInlineOtherToggler(r.other_html,n);E=TS.inline_others.shouldExpand(n,$)}break;case"image":var j=TS.model.inline_imgs[r.from_url||r.image_url];if(j){var B=!t.show_media_caret;P=TS.templates.builders.buildInlineImgToggler(r.from_url||r.image_url,n,B);E=TS.inline_imgs.shouldExpand(n,j)}break;default:var L=TS.model.inline_attachments[r.from_url];if(L){P=TS.templates.builders.buildInlineAttachmentToggler(r.from_url,n);E=TS.inline_attachments.shouldExpand(n,L)}else TS.warn("no inline_attachment for "+r.from_url);break}}_.assign(x,{initial_caret_html:t.show_initial_caret?new Handlebars.SafeString(P):"",media_caret_html:t.show_media_caret?new Handlebars.SafeString(P):"",expand_media:!t.show_media_caret||E,expand_it:!t.show_initial_caret||E,bg_color:r.color||"e3e4e6",thumb_at_top:true,ts_link:f,small_thumb:S,max_width_class:S?"right_thumb_max_w":"",show_action_links:true===t.enable_slack_action_links,has_content:t.has_content});return TS.templates.spaces_attachment(x)},buildAttachmentActionButtonHTML:function e(t,n){n=true===n;var r={_disabled:n,_loading:false,id:"",name:"",style:"default",text:"",value:""};var i={default:"",primary:"btn_primary",danger:"btn_danger"};var a=t.clicked&&t.clicked_text?t.clicked_text:t.text;var s=TS.emoji.graphicReplace(a);var o=_.merge({},r,t,{btn_class:i[t.style],current_text:a,formatted_text:new Handlebars.SafeString(s)});t.url&&(o.url=TS.interop.url.simpleIsUrl(t.url)?t.url:"#");o.data_qa_value="button-"+o.name.replace("_","-");return TS.templates.attachment_actions_button(o)},buildAttachmentActionSelectHTML:function e(t,n,r,i){var a=TS.attachment_actions.select.getActionModel(t,n);if(a._disabled){var s='ts-message[data-ts="'+r+'"]';var o='[data-attachment-id="'+i+'"]';var l='[data-action-id="'+t.id+'"]';var u=[s,o,l].join(" ");var d=$(u).next(".lazy_filter_select");if(!d.length)return"";var c=d.clone().addClass("disabled");return c[0].outerHTML}return TS.templates.attachment_actions_select(a)},shouldDoSimpleAttachment:function e(t,n){var r=false;if(n.standalone_attachment)return false;if((t.image_url||t.audio_url)&&t.from_url){if(n&&n.text){-1!=n.text.indexOf(t.from_url)&&(r=true);TS.model.ampersands_are_inconsistent_in_from_urls&&-1!=n.text.indexOf(t.from_url.replace(/&/g,"&amp;"))&&(r=true)}(t.service_name||t.title)&&(r=false)}return r},formatAttachments:function e(t,n,r,i){if(!t.attachments)return"";var a="";var s;var o=[];var l;var u=t.attachments.length;var d=20;if(t.attachments.length>=d){t._shown_attachments||(t._shown_attachments=d);u=t._shown_attachments}for(s=0;s<u;s+=1){l=t.attachments[s];(l.pretext||0===s)&&o.push([]);_.last(o).push(l)}for(s=0;s<o.length;s+=1)a+=TS.templates.builders.formatAttachmentGroup(o[s],t,r,i,n);t._shown_attachments<t.attachments.length&&(a+=TS.templates.builders.getShowMoreAttachmentHTML(t));return a},formatAttachmentGroup:function e(t,n,r,i,a){r=true===r;var s="";var o=false;t=t.map(function(e){return TS.utility.attachments.getDecoratedAttachment(e,n)});var l=n&&"reply_broadcast"===n.subtype;l&&(o=true);var u=o&&_.some(t,TS.utility.attachments.getMediaType);var d=!o||_.some(t,"color");var c=_.some(t,"from_url");var m=_.some(t,"indent");var f=false;if(l){var p=n.channel_id||_.get(t[1],"channel_id");var h=n.broadcast_thread_ts;if((!p||!/\d+\.\d+/.test(h))&&t[1]&&t[1].from_url){var g=t[1].from_url;var S=TS.interop.url.urlQueryStringParse(g);S.cid&&(p=S.cid);S.thread_ts&&(h=S.thread_ts)}a=TS.redux.channels.getEntityById(p);if(a&&h){h.indexOf(".")<0&&(h=h.substr(0,10)+"."+h.substr(10));var T={thread_ts:h,model_ob_id:a.id,convo_href:TS.utility.msgs.constructConversationPermalink(a,h)};f=TS.templates.reply_broadcast_preamble(T);f=new Handlebars.SafeString(f)}}var v;for(var b=0;b<t.length;b+=1){v=t[b];if(!v){TS.info("formatAttachments bad attach");TS.dir(0,n);continue}if(v.from_url&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(v,n))){s+="";continue}v.ts&&(v.ts_link=TS.utility.msgs.constructMsgPermalink(a,v.ts.toString()));if(!TS.inline_attachments.legacyShouldShow(v,n)){s+="";continue}if(v.actions&&v.actions.length){var y=["button","select"];var w;var k=[];var x=[];for(var C=0;C<v.actions.length;C+=1){w=v.actions[C];_.includes(y,w.type)?x.push(w):k.push(w)}k.length&&(v.legacy_actions=k);x.length&&(v.actions=x)}var I=TS.utility.attachments.hasContent(v,["pretext"]);if(I){var M=t[b+1];s+=TS.templates.builders.buildAttachmentHTML({model_ob:a,attachment:v,has_border:d,has_indent:m,has_container:o,break_border:d&&M&&v.color!=M.color,url:null,msg:n,msg_dom_id:i,show_initial_caret:TS.templates.builders.shouldDoSimpleAttachment(v,n),show_media_caret:v.video_html||v.image_url||v.audio_html||v.audio_url||v.other_html,enable_slack_action_links:r,has_content:I})}l&&0===b&&(s+=TS.templates.reply_broadcast_count(v))}if(s||v.pretext)return TS.templates.attachment_group({model_ob:a,first_attachment:t[0],preamble:f,msg:n,has_border:d,has_indent:m,has_container:o,has_link:c,use_shrink_wrap:u,attachments_html:s&&new Handlebars.SafeString(s),enable_slack_action_links:r});return s},getShowMoreAttachmentHTML:function e(t){var n=t.attachments.length-t._shown_attachments;var r="";var i=t.ts;var a=TS.shared.legacyGetActiveModelOb();var s=false;if(!TS.client||a.is_channel&&!a.is_member)r=TS.interop.i18n.t("{count, plural, =1 {# more attachment} other {# more attachments}}","attachments")({count:n});else{s=true;r=t.attachments.length-t._shown_attachments>20?TS.interop.i18n.t("Show next 20 items","attachments")():TS.interop.i18n.t("{count, plural, =1 {Show remaining # item} other {Show remaining # items}}","attachments")({count:n})}return TS.templates.show_more_attachment({ts:i,btn_text:r,clickable_show_more_link:s})},formatMessageAsAttachment:function e(t,n){var r;var i;var a;t.user?i=t.user:"file_comment"===t.subtype&&t.comment&&t.comment.user?i=t.comment.user:t.bot_id&&(a=t.bot_id);if(!t.text&&t.attachments&&t.attachments.length>=1&&t.attachments[0].is_share)r={author_name:t.attachments[0].author_name,author_subname:t.attachments[0].author_subname,author_icon:t.attachments[0].author_icon,author_link:t.attachments[0].author_link};else if(i){var s=TS.interop.members.getMemberById(i);r={};r.author_name=TS.interop.members.getPrefCompliantMemberName(s);s.profile&&(r.author_icon=s.profile.image_24);r.author_link="/team/"+i}else if(a){var o=TS.redux.bots.getBotByMsg(t);r={author_subname:t.username||o.name,author_icon:o&&o.icons&&o.icons.image_48,author_link:"/services/"+a};t.icons&&t.icons.emoji&&t.icons.image_64&&(r.author_icon=t.icons.image_64)}if(!r){TS.error("no author for msg "+t.ts);return""}var l=_.extend({},r,{is_msg_unfurl:true,id:1,ts:t.ts,from_url:TS.utility.msgs.constructAbsoluteMsgPermalink(n,t.ts),msg_subtype:t.subtype});if(t.text){l.text=t.text;l.mrkdwn_in_hash={text:true}}else if(t.attachments&&t.attachments.length>=1){var u=t.attachments[0];l.text=u.text||u.pretext}if(TS.interop.messages.shouldRenderFileThread(t)){var d=TS.utility.msgs.getFileOnMsg(t);var c=_.isString(d)?TS.files.getFileById(d):d;l.files=[c]}TS.inline_attachments.massageAttachment(l,0);l=TS.utility.attachments.getDecoratedAttachment(l,t);var m=TS.templates.builders.buildAttachmentHTML({attachment:l,msg:t,can_delete:false,has_content:true,has_border:true});m=TS.templates.attachment_group({msg:t,attachments_html:new Handlebars.SafeString(m)});return m},getMemberCurrentStatusForDisplay:function e(t,n){var r=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),t&&t.id);var i="";r.text&&(i+='<span class="prevent_copy_paste" aria-label=" "></span>'+TS.format.formatCurrentStatus(r.text,void 0,n));var a=TS.format.formatCurrentStatus(r.emoji,void 0,_.assign({transform_missing_emoji:true},n));return a+i},buildBotStr:function e(t,n){var r;r=TS.interop.utility.isModelObjectExternal(n)||TS.interop.rules.channels.isOrgShared(n)?t.bot_link?TS.interop.bots.getBotNameByBotLink(t.bot_link):TS.interop.bots.getBotNameByBotLink(t.text):TS.interop.bots.getBotNameById(t.bot_id);var i=_.escape(r);var a=TS.interop.i18n.safeString("<"+TS.boot_data.team_url+"services/"+t.bot_id+"/|"+i+">");switch(t.subtype){case"bot_add":return TS.interop.i18n.t("added an integration to this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_enable":return TS.interop.i18n.t("enabled an integration in this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_disable":return TS.interop.i18n.t("disabled an integration in this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_remove":return TS.interop.i18n.t("removed an integration from this channel: {bot_url}","templates_builders")({bot_url:a});default:return TS.interop.i18n.t("updated an integration in this channel: {bot_url}","templates_builders")({bot_url:a})}},formatMessageByType:function e(t,n,r,i){var a="";var s;if(t.ignore_if_attachments_supported)return a;n=true===n;r=true===r;var o;var l;var u;var d;var c;var m;var f;var p;var h;var g;var S;var T="TS.shared.legacyCloseArchivedChannel";if(t._jl_rollup_hash&&t.user in t._jl_rollup_hash.users){var v=false;var b=true;var y=function e(t){t=t.map(function(e){return e.id});var n=_.remove(t,function(e){return!TS.redux.members.hasMemberWithId(e)});if(0===t.length)return[];var r;var i=100;if(t.length>i+1){var a=t.length-i+n.length;t=t.splice(0,i);r=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:a})}else n.length&&(r=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:n.length}));t=t.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e,false,v)});r&&t.push(r);return t};var w=function e(t){var n=TS.interop.members.getPrefCompliantMemberNameById(t,b,v);return TS.interop.i18n.safeString('<button type="button" class="btn_unstyle internal_member_link member_preview_link" data-member-id="'+t+'">'+n+"</button>")};var k;var x;var C;var I;var M;var A={joined:[],joined_left:[],left:[],left_rejoined:[]};for(var E in t._jl_rollup_hash.users)if(E!==t.user){I=t._jl_rollup_hash.users[E];var P={id:E,inviter:I.inviter};I.is_in?I.left&&I.joined?A.left_rejoined.push(P):A.joined.push(P):I.joined&&I.left?A.joined_left.push(P):A.left.push(P)}u=i.is_group||i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:"no_name";I=t._jl_rollup_hash.users[t.user];if(I.is_in)if(I.left&&I.joined)if(I.inviter){var F=A.left_rejoined.filter(function(e){return e.inviter===I.inviter});A.left_rejoined=A.left_rejoined.filter(function(e){return e.inviter===I.inviter});k=F.length?F[0].id:null;M=y(F);a=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:F.length,user:w(k),channel_name:u,inviter:w(I.inviter),others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else{k=A.left_rejoined.length?A.left_rejoined[0].id:null;M=y(A.left_rejoined);a=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.left_rejoined.length,user:w(k),channel_name:u,others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.joined_left=[]}else if(I.inviter){var O=A.joined.filter(function(e){return e.inviter===I.inviter});A.joined=A.joined.filter(function(e){return e.inviter!==I.inviter});k=O.length?O[0].id:null;M=y(O);a=TS.interop.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:O.length,user:w(k),channel_name:u,inviter:w(I.inviter),others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else{k=A.joined.length?A.joined[0].id:null;M=y(A.joined);a=TS.interop.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.joined.length,user:w(k),channel_name:u,others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.joined=[]}else if(I.joined&&I.left){k=A.joined_left.length?A.joined_left[0].id:null;M=y(A.joined_left);a=TS.interop.i18n.t('joined and left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.joined_left.length,user:w(k),channel_name:u,others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.joined_left=[]}else{k=A.left.length?A.left[0].id:null;M=y(A.left);a=TS.interop.i18n.t('left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.left.length,user:w(k),channel_name:u,others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.left=[]}var D=true;if(A.left_rejoined.length){x=A.left_rejoined.shift().id;C=A.left_rejoined.length?A.left_rejoined[0].id:null;var H=D?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left");D=false;M=y(A.left_rejoined);a+=" ";a+=H({count:A.left_rejoined.length,userA:w(x),userB:w(C),others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(A.joined.length){x=A.joined.shift().id;C=A.joined.length?A.joined[0].id:null;var $=D?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left");D=false;M=y(A.joined);a+=" ";a+=$({count:A.joined.length,userA:w(x),userB:w(C),others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(A.joined_left.length){x=A.joined_left.shift().id;C=A.joined_left.length?A.joined_left[0].id:null;var j=D?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left");D=false;M=y(A.joined_left);a+=" ";a+=j({count:A.joined_left.length,userA:w(x),userB:w(C),others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(A.left.length){x=A.left.shift().id;C=A.left.length?A.left[0].id:null;var B=D?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left");D=false;M=y(A.left);a+=" ";a+=B({count:A.left.length,userA:w(x),userB:w(C),others:TS.interop.i18n.listify(M).join(""),classes:M.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}}else if("channel_join"===t.subtype||"app_conversation_join"===t.subtype){l=TS.interop.members.getMemberById(t.inviter);k=TS.interop.members.getMemberById(t.user);u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();if(l){d=TS.interop.i18n.safeString("<@"+l.id+"|"+l.name+">");s=k&&k.is_app_user?TS.interop.i18n.t("was added to this conversation by {inviter}.","templates_builders")({inviter:d}):TS.interop.i18n.t("joined {channel_name} from an invitation by {inviter}","templates_builders")({channel_name:u,inviter:d});a=TS.format.formatNoHighlightsNoSpecials(s,t)}else a=TS.interop.i18n.t("joined {channel_name}","templates_builders")({channel_name:u})}else if("app_conversation_created"===t.subtype&&TS.boot_data.feature_wta_conversations_api_channel_created_msg)a=TS.interop.i18n.t("created and joined this conversation.","templates_builders")();else if("channel_leave"===t.subtype||"app_conversation_leave"===t.subtype){l=TS.interop.members.getMemberById(t.inviter);k=TS.interop.members.getMemberById(t.user);u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();if(l&&k&&k.is_app_user){d=TS.interop.i18n.safeString("<@"+l.id+"|"+l.name+">");s=TS.interop.i18n.t("was removed from this conversation by {inviter}.","templates_builders")({inviter:d});a=TS.format.formatNoHighlightsNoSpecials(s,t)}else a=TS.interop.i18n.t("left {channel_name}","templates_builders")({channel_name:u})}else if("channel_name"===t.subtype)a=TS.interop.i18n.t('renamed the channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("channel_topic"===t.subtype)if(t.topic){m=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel topic: <span class="topic no_jumbomoji">{topic}</span>',"templates_builders")({topic:TS.interop.i18n.safeString(m)})}else a=TS.interop.i18n.t("cleared the channel topic","templates_builders")();else if("channel_purpose"===t.subtype)if(t.purpose){f=TS.format.formatWithOptions(t.purpose,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel purpose: <span class="purpose no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:TS.interop.i18n.safeString(f)})}else a=TS.interop.i18n.t("cleared the channel purpose","templates_builders")();else if("group_join"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();l=TS.interop.members.getMemberById(t.inviter);if(l){d=TS.interop.i18n.safeString("<@"+l.id+"|"+l.name+">");s=TS.interop.i18n.t("joined {group_name} from an invitation by {inviter}","templates_builders")({group_name:c,inviter:d});a=TS.format.formatNoHighlightsNoSpecials(s,t)}else a=TS.interop.i18n.t("joined {group_name}","templates_builders")({group_name:c})}else if("group_leave"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();a=TS.interop.i18n.t("left {group_name}","templates_builders")({group_name:c})}else if("group_name"===t.subtype)a=TS.interop.i18n.t('renamed the private channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("group_topic"===t.subtype)if(t.topic){m=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel topic: <span class="no_jumbomoji">{topic}</span>',"templates_builders")({topic:TS.interop.i18n.safeString(m)})}else a=TS.interop.i18n.t("cleared the channel topic","templates_builders")();else if("group_purpose"===t.subtype)if(t.purpose){f=TS.format.formatWithOptions(t.purpose,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel purpose: <span class="no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:TS.interop.i18n.safeString(f)})}else a=TS.interop.i18n.t("cleared the channel purpose","templates_builders")();else if("group_archive"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();p=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));g=TS.interop.i18n.t("your workspace admin","templates_builders")();if(t.user){h=TS.interop.members.getMemberById(t.user);g=TS.format.formatNoHighlightsNoSpecials("<@"+h.id+"|"+h.name+">")}if(TS.client&&o&&o.is_archived)if(TS.model.archive_view_is_showing)a=1==o.is_moved?TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:c,enterprise_name:p,mover_name:g,name_for_url:o.id}):TS.interop.i18n.t("archived {group_name}. The contents will still be browsable and available in search.","templates_builders")({group_name:c,name_for_url:o.id});else{var L="'"+o.id+"'";a=1==o.is_moved?TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:c,enterprise_name:p,mover_name:g,name_for_url:o.id}):TS.interop.i18n.t('archived {group_name}. The contents will still be browsable and available in search. \t\t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="{method}({group_id})">click here</a>.',"templates_builders")({group_name:c,name_for_url:o.id,method:T,group_id:L})}else 1==o.is_moved?a=TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace","templates_builders")({group_name:c,enterprise_name:p}):0==o.is_moved&&(a=TS.interop.i18n.t("archived {group_name}","templates_builders")({group_name:c}))}else if("group_unarchive"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();a=TS.interop.i18n.t("un-archived {group_name}","templates_builders")({group_name:c})}else if("channel_archive"===t.subtype){var N="'"+i.id+"'";u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();p=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));if(TS.client&&1==i.is_moved){if(t.user){h=TS.interop.members.getMemberById(t.user);g=TS.format.formatNoHighlightsNoSpecials("<@"+h.id+"|"+h.name+">")}a=TS.model.archive_view_is_showing?TS.interop.i18n.t("moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({channel_name:u,enterprise_name:p,mover_name:g,name_for_url:i.id}):TS.interop.i18n.t('moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search. \t\t\t\t\t\tTo close it now, <a onclick="{method}({channel_id})">click here</a>.',"templates_builders","8d6936bca8ef3eff15651b717bf3903d36058e80")({channel_name:u,enterprise_name:p,mover_name:g,name_for_url:i.id,channel_id:N,method:T})}else TS.client&&i?a=TS.model.archive_view_is_showing?TS.interop.i18n.t("archived {channel_name}. The contents will still be browsable and available in search.","templates_builders")({channel_name:u,name_for_url:i.id}):TS.interop.i18n.t('archived {channel_name}. The contents will still be browsable and available in search. \t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="{method}({channel_id})">click here</a>.',"templates_builders","6199331bdb807ec02beefa6b7f858864dd52dff5")({channel_name:u,name_for_url:i.id,channel_id:N,method:T}):i&&1==i.is_moved&&(a=TS.interop.i18n.t("moved {channel_name} to another {enterprise_name} workspace","templates_builders")({channel_name:u,enterprise_name:p}))}else if("channel_unarchive"===t.subtype){u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();a=TS.interop.i18n.t("un-archived {channel_name}","templates_builders")({channel_name:u})}else if("me_message"===t.subtype)a="<i>"+TS.format.formatWithOptions(t.text,t,{do_inline_imgs:n})+"</i>";else if("play_sound"===t.subtype)a=TS.interop.i18n.t('played "{msg_sound}"',"templates_builders")({msg_sound:t.sound});else if("bot_add"===t.subtype||"bot_enable"===t.subtype||"bot_updated"===t.subtype||"bot_disable"===t.subtype||"bot_remove"===t.subtype){S=TS.templates.builders.buildBotStr(t,i);a=TS.format.formatWithOptions(S,t,{do_inline_imgs:n,enable_slack_action_links:r,no_highlights:true})}else a="reminder_add"===t.subtype||"reminder_delete"===t.subtype?TS.format.formatWithOptions(t.text,t,{do_inline_imgs:n,enable_slack_action_links:r,no_highlights:true}):TS.format.formatWithOptions(t.text,t,{do_inline_imgs:n,enable_slack_action_links:r});if(!a&&""!==a){TS.warn("no html msg.subtype:"+t.subtype);return""}a=TS.utility.msgs.handleSearchHighlights(a);return a},search_ellipsis:'<span class="extract_ellipsis">&hellip;</span>',buildStar:function e(n,r,i){var a=t(n,r,i);if(!_.isObject(a))return{};return TS.templates.star(a)},buildStarWithTip:function e(n,r,i){var a=t(n,r,i);if(!_.isObject(a))return{};return TS.templates.star_with_tip(a)},buildMentionHTML:function e(t){var n=t.message;var r="";if(!n)return r;if(("file_share"===n.subtype||"file_mention"===n.subtype||"file_comment"===n.subtype||"file_reaction"===n.subtype)&&!n.file)return r;var i=TS.redux.channels.getEntityById(t.channel);if(!i)return r;var a;var s=4;var o=[];var l="";var u="";var d="";var c="reaction"===t.type;u=TS.templates.builders.strBuilder('<button type="button" class="btn_link msg_right_link msg_jump" data-cid="${cid}">'+TS.interop.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id});d=TS.templates.builders.msgs.buildHTML({msg:n,model_ob:i,standalone:true,jump_link:u,no_attachments:!!n.text,for_mention_display:true,for_mention_rxn_display:c});r=d;if(c){var _=TS.rxns.getRxnKeyByMsgType(n);a=TS.rxns.getExistingRxnsByKey(_);if(!a)return"";var m=a[a.length-1];var f=m.users[m.users.length-1];if(!TS.rxns.getRxnFromRxns(a,m.name))return"";var p=TS.redux.members.getPotentiallyUnknownMemberById(f);var h=TS.rxns.getAllUniqueRxners(a,f);var g=h.length+1;var S="file_reaction"===n.subtype;var T;if(2==g){var v=TS.redux.members.getPotentiallyUnknownMemberById(h[0]);T=p.is_self?S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">You & {another_user}</span> reacted',"rxn","b25e820975ef39fc1dd861b65a10b5b45e9a90e9"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">You & {another_user}</span> reacted',"rxn","5b0148d549601f26b8df5d5ea4dfb43045a40ac6"):v.is_self?S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & you</span> reacted',"rxn","9c0186d6025ec62dcd6c95f75ab4ecf4bcc742f3"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & you</span> reacted',"rxn","4b6ce1bd157c02f79c5bb95c447f9526e64297c9"):S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted',"rxn","569d95d8c177122f37f38461d5dfdce3fd78b28a"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted',"rxn","f93d4069461fa27749a477d2ee58b07ccf6be813");l=T({user:TS.interop.i18n.safeString(TS.templates.builders.makeMemberPreviewLink(p,true)),another_user:TS.interop.i18n.safeString(TS.templates.builders.makeMemberPreviewLink(v))})}else if(g>2){var b=false;var y=false;var w=h.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e,b,y)});var k=g-1;T=S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_float ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted',"rxn","6f0a22bddc3f2374e7a726720a8029721a8f8339"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_float ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted',"rxn","4b641d765f8195bb9504ae9a0abec4b3ff9edcc3");l=T({user:TS.interop.i18n.safeString(TS.templates.builders.makeMemberPreviewLink(p,true)),names:TS.interop.i18n.safeString(TS.interop.i18n.listify(w).join("")),count:k})}else{T=S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted',"rxn","4a7cc50b841cfcf8765678ccc8f92b46cc18a5c2"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted',"rxn","4d6d2417764e9c3b36d561eb79e9adfe2f702d49");l=T({user:TS.interop.i18n.safeString(TS.templates.builders.makeMemberPreviewLink(p,true))})}o=a.filter(function(e){return TS.emoji.isValidName(e.name)}).slice(0,s).map(function(e){return new Handlebars.SafeString(TS.emoji.graphicReplace(":"+e.name+":"))});var x={ts:n.ts,rxns_to_display:o,msg_html:new Handlebars.SafeString(d),rxn_members:new Handlebars.SafeString(l),jump_link_html:new Handlebars.SafeString(u),is_file_reaction:S};n.thread_ts&&(x.thread_ts=n.thread_ts);r=TS.templates.mentions_rxn(x)}return r},buildMentions:function e(){TS.mentions.weaveInRxnRecords();var t="";var n=null;var r=TS.mentions.getAllMentions();if(!r||!r.length)return t;$.each(r,function(e,r){var i;try{i=TS.templates.builders.buildMentionHTML(r)}catch(e){TS.error("Problem building mention html for "+r.message.ts+" in "+r.channel);TS.error(e)}if(!i)return;var a="";var s=TS.redux.channels.getEntityById(r.channel);var o=r.message;var l=!n;n&&!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(n.rxn_ts||n.message.ts),TS.interop.datetime.toDateObject(r.rxn_ts||o.ts))&&(l=true);if(l){n&&(a="</div>");a+='<div class="mention_day_container_div">'+TS.templates.messages_day_divider({ts:r.rxn_ts||o.ts})}var u=n&&n.channel;s&&(s.is_channel||s.is_mpim||s.is_group)&&(u!=s.id||l)&&(a+=TS.templates.mentions_item({model_ob:s}));t+=a+i;n=r});t&&(t+="</div>");return t},buildStarredItemHTML:function e(t){var n="<div class='star_item'>";var r={star:t,current_user_id:TS.model.user.id};var i;if("message"===t.type){var a=t.message;var s=false;i=TS.redux.channels.getEntityById(t.channel);if(!i){TS.warn("channel "+t.channel+" for this starred message was probably deleted");return""}if(i.is_im){var o=TS.interop.members.getMemberById(i.user);t.message.recipient=o;TS.interop.channels.isImWithDeletedMember(i)&&(s=true)}var l="";s||(l=TS.templates.builders.strBuilder('<button type="button" class="btn_unstyle star_jump msg_right_link btn btn_outline" data-cid="${cid}">'+TS.interop.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id}));n+=TS.templates.builders.msgs.buildHTML({msg:a,model_ob:i,standalone:true,starred_items_list:true,starred_items_actions:true,jump_link:l,no_attachments:!!a.text,full_date:true})}else if("file"===t.type)n+=TS.templates.builders.fileHTML(t.file);else if("channel"===t.type||"group"===t.type){i=TS.redux.channels.getEntityById(t.channel);if(!i){TS.warn("channel or group "+t.channel+" was probably deleted");return""}r.model_ob=i;n+=TS.templates.star_item(r)}else{r.from_starred_item=true;n+=TS.templates.star_item(r)}n+="</div>";return n},buildPinInfoHtml:function e(t){var n={};var r=TS.interop.channels.getChannelPinnedItemByMessage({message:t,channel:TS.shared.legacyGetActiveModelOb()});var i={};if(r.createdBy&&r.createdTs){i=TS.redux.members.getPotentiallyUnknownMemberById(r.createdBy);n.user=i;n.ts=r.createdTs;n.complete_data=n.user&&n.ts}else n.complete_data=false;n.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member({id:i.id}));var a=TS.templates.pinned_message_info(n);return new Handlebars.SafeString(a)},buildHighlightsInfoHtml:function e(t){var n=TS.templates.highlights_message_info(t);return new Handlebars.SafeString(n)},buildInlineImgTogglerAndDiv:function e(t,n,r){var i=TS.model.inline_imgs[t];if(!i)return"";return TS.templates.builders.buildInlineImgToggler(t,n)+" "+TS.templates.builders.buildInlineImgDiv(t,n,r)},buildInlineImgToggler:function e(t,n,r,i){var a=TS.model.inline_imgs[t];if(!a){TS.warn(8675309,"buildInlineImgToggler did not find anything in TS.model.inline_imgs for key:"+t);return""}var s=TS.inline_imgs.shouldExpand(n,a,i);var o=a.link_url||t;var l=a.bytes&&a.bytes>TS.model.inline_img_byte_limit;var u=a.width&&a.height&&a.width*a.height>TS.model.inline_img_pixel_limit;var d=!u;var c="";var m="";if(!s&&(!TS.prefs.getPref("obey_inline_img_limit")||l)||u){var f=!a.internal_file_id&&TS.prefs.getPref("expand_inline_imgs")&&false!==TS.model.expandable_state["img_"+n+a.src];if(f&&u){d=false;m=TS.interop.i18n.t("(Not automatically expanded because {img_width}x{img_height} is too large to display inline.)","templates_builders")({img_width:a.width,img_height:a.height});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}else if(f&&l){var p=TS.interop.i18n.t("Open original in new tab","templates_builders")();var h="<a "+TS.utility.makeRefererSafeLink(o)+' target="_blank" title="'+p+'">';if(TS.model.show_inline_img_size_pref_reminder&&!TS.model.shown_inline_img_size_pref_reminder_once){m=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>. \t\t\t\t\t\tYou can also <a class="cursor_pointer" onclick="TS.ui.prefs_dialog.start(\'messages_media\', \'#prefs_inline_media\')">change your preferences</a> to allow images of any file size to auto expand.)',"templates_builders")({file_size:TS.interop.utility.convertFilesize(a.bytes),real_src:TS.interop.i18n.safeString(_.escape(a.src)),referer_link_a_tag:TS.interop.i18n.safeString(h)});TS.model.shown_inline_img_size_pref_reminder_once=true}else m=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders")({file_size:TS.interop.utility.convertFilesize(a.bytes),real_src:TS.interop.i18n.safeString(_.escape(a.src)),referer_link_a_tag:TS.interop.i18n.safeString(h)});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}}var g=a.bytes&&true!==r?'<span class="inline_img_bytes '+(c?"hidden":"")+'"> ('+TS.interop.utility.convertFilesize(a.bytes)+")</span>":"";var S={collapser_class:"msg_inline_img_collapser",expander_class:"msg_inline_img_expander",real_src:a.src,expand_it:s};var T=TS.templates.inline_attachment_toggler({inline_attachment:S});return g+c+(d?T:"")},buildInlineImgDiv:function e(t,n,r){r=r||{};var i=TS.model.inline_imgs[t];if(!i)return"";var a=TS.inline_imgs.shouldExpand(n,i,r);var s=i.link_url||t;var o=!r.flush_with_attachment&&i.width>0&&i.height>0;var l;i.internal_file_id&&(l=TS.files.getFileById(i.internal_file_id));var u="";var d="clear_both msg_inline_img_holder msg_inline_holder";a||(d+=" hidden");var c=i.height<50;var m=i.width<200;var f=m||c;if(f){d+=" overflow_preview_actions";m&&(d+=" overflow_preview_actions_width")}l&&(d+=" file_container");d+=" msg_inline_holder_rounded";o||(d+=" file_container_fixed_dimensions");u+='<div data-real-src="'+_.escape(i.src)+'" class="'+d+'" ';i.internal_file_id&&(u+='data-file-id="'+i.internal_file_id+'" ');o&&(u+='style="width:'+i.width+'px;" ');u+=">";var p="ctrl";TS.model.is_mac&&(p="cmd");var h=TS.interop.i18n.t("{cmd_key}+click to open original in new tab","templates_builders")({cmd_key:p});var g=!r||!r.hasOwnProperty("maybe_show_file_viewer")||r.maybe_show_file_viewer;var S;if(i.internal_file_id)if(l&&0===l.mimetype.indexOf("image/")){S=g;if("dropbox"===l.external_type||"gdrive"===l.external_type||"box"===l.external_type||"onedrive"===l.external_type){var T=l.thumb_720?l.thumb_720:l.thumb_360;u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+h+'" class="file_viewer_external_link" data-src="'+_.escape(T)+'"data-link-url="'+_.escape(s)+'">'}else u+=S?'<a href="'+s+'" target="_blank" class="file_viewer_channel_link file_viewer_link" data-file-id="'+i.internal_file_id+'">':'<a href="'+s+'" target="_blank" title="'+h+'" class="file_preview_link thumbnail_link" data-file-id="'+i.internal_file_id+'">'}else u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" class="'+l.filetype+'">';else{var v="";var b="";g?v="file_viewer_external_link":b=TS.interop.i18n.t("Click to open original in new tab","templates_builders")();u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+b+'" class="'+v+'" data-src="'+_.escape(i.src)+'" data-link-url="'+_.escape(i.link_url)+'"';i.width&&(u+=' data-width="'+_.escape(i.width)+'"');i.height&&(u+=' data-height="'+_.escape(i.height)+'"');i.rotation&&(u+=' data-rotation="'+_.escape(i.rotation)+'"');i.content_type&&(u+=' data-content-type="'+_.escape(i.content_type)+'"');u+=">"}o&&(u=u.replace("<a ",'<a style="width:'+i.width+'px;" '));u+='<div class="msg_inline_img_container">';u+='<div class="file_preview_preserve_aspect_ratio" ';if(o)if(l&&f)u+='style="padding-top: '+i.height+'px;" ';else{var y="calc("+i.height+" / "+i.width+" * 100% )";u+='style="padding-top: -moz-'+y+"; padding-top: -webkit-"+y+"; padding-top: "+y+';" '}else{var w=574;var k=300;var x=w/k;var C=i.display_w||i.width;var I=i.display_h||i.height;var M=C/I;var A;var E;if(C<=w&&I<=k){A=C;E=I}else if(x>M){A=C*k/I;E=k}else{A=w;E=I*w/C}u+='style="width: '+Math.round(A)+"px; height: "+Math.round(E)+'px;"'}u+=">";i.proxied_src=TS.utility.getImgProxyURLWithOptions(i.src,{rotate:true});var P=_.escape(i.proxied_src||i.src);var F="msg_inline_img msg_inline_child";var O="style=\"background-image:url('"+P+"');\"";var D='src="'+P+'"';u+='<figure class="'+F+'" '+O+">";u+="<img "+D+" />";u+="</figure>";u+="</div>";u+="</div>";u+="</a>";l&&(u+=TS.templates.message_file_preview_actions({file:l,download:"hosted"===l.mode,new_window:true,external_file_author:TS.files.isFileAuthorExternal(l)}));u+="</div>";return u},buildInlineEmailDiv:function e(t,n){var r=TS.files.getFileById(t);if(!r)return"";var i={file:r,is_message:true,to_more_count:r.to.length-1,cc_more_count:r.cc.length-1,msg_dom_id:n};return TS.templates.file_email(i)},buildInlineAttachmentToggler:function e(t,n){var r=TS.model.inline_attachments[t];if(!r)return"";var i=TS.inline_attachments.shouldExpand(n,r);var a={real_src:r.from_url,expand_it:i};var s=TS.templates.inline_attachment_toggler({inline_attachment:a});return s},buildInlineAudioToggler:function e(t,n){var r=TS.model.inline_audios[t];if(!r)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_audios.shouldExpand(n,r),src:r.src,media_type:"audio"})},buildInlineAudioDiv:function e(t,n,r){var i=TS.model.inline_audios[t];if(!i)return"";var a=TS.inline_audios.shouldExpand(n,i);var s={src:i.src,expand_it:a,content:r};var o=TS.templates.attachment_inline_audio_div({inline_audio:s});return o},buildInlineOtherToggler:function e(t,n){var r=TS.model.inline_others[t];if(!r)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_others.shouldExpand(n,r),src:r.src,media_type:"other"})},buildInlineOtherDiv:function e(t,n,r){var i=TS.model.inline_others[t];if(!i)return"";var a=TS.inline_others.shouldExpand(n,i);return'<div data-real-src="'+_.escape(i.src)+'" class="clear_both msg_inline_other_holder msg_inline_holder '+(a?"":"hidden")+'">'+r+"</div>"},buildInlineVideoTogglerAndDiv:function e(t,n){var r=TS.model.inline_videos[t];if(!r)return"";return TS.templates.builders.buildInlineVideoToggler(t,n)+" "+TS.templates.builders.buildInlineVideoDiv(t,n)},buildInlineVideoToggler:function e(t,n,r){var i=TS.model.inline_videos[t];if(!i)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_videos.shouldExpand(n,i),src:i.src,title:r?"":i.title,media_type:"video",is_keyboard_navigable:true})},buildInlineVideoDiv:function e(t,n){var r=TS.model.inline_videos[t];if(!r)return"";var i=TS.inline_videos.shouldExpand(n,r);var a=r.link_url||t;var s=true;r.html||(s=false);var o={real_src:r.src,data_url:t,referrer_safe_url_attributes:TS.utility.makeRefererSafeLink(a),show_play:s,proxied_src_or_src:r.proxied_src||r.src,display_w:r.display_w,display_h:r.display_h,expand_it:i};var l=TS.templates.message_inline_video({inline_video:o});return l},buildComments:function e(t){var n;var r=t.comments;var i="";for(var a=0;a<r.length;a+=1){n=TS.redux.members.getPotentiallyUnknownMemberById(r[a].user);i+=TS.templates.builders.buildCommentHTML({file:t,comment:r[a],show_comment_actions:true,member:n})}return i},buildCommentHTML:function e(t){return TS.templates.comment(t)},buildCommentStandalone:function e(t,n){var r=TS.utility.members.getEntityFromFile(n);var i;"snippet"===n.mode?i="snippet":"post"===n.mode?i="post":"space"===n.mode?i="space":"hosted"!==n.mode&&"external"!==n.mode||(i="file");return TS.templates.comment_standalone({comment:t,file:n,file_type:i,entity:r,current_user_id:TS.model.user.id})},buildTeamListHTML:function e(t,n,r){var i=t.filter(function(e){return!TS.interop.members.isExternal(e)});var a=TS.members.legacyAllocateTeamListMembers(i);var s=a.members;var o=a.disabled_members;var l=a.deleted_bots;var u=a.bots;var d=a.restricted_members;var c=a.ultra_restricted_members;var _=false;(u.length||l.length)&&(_=true);var m=false;(d.length||c.length||r)&&(m=true);var f=false;(o.length||r)&&(f=true);var p=false;var h=false;var g;p=""!==TS.model.team.plan&&!TS.model.user.is_restricted;g=TS.model.user_groups.filter(function(e){return!e.date_delete});h=!g.length;var S=$("#team_tabs");var T=TS.permissions.members.canEditUserGroups();var v=TS.permissions.members.canCreateAndDeleteUserGroups();S.html(TS.templates.user_group_tabs({show_members:!!s.length,members:r?[]:s,show_restricted_members:m,restricted_members:r?[]:d.concat(c),show_disabled_members:f,disabled_members:r?[]:o,show_user_groups:p,user_groups:g,show_user_groups_edit:T,show_user_groups_add:v,is_enterprise:TS.boot_data.page_needs_enterprise}));var b={full_profile_filter:true,is_long_list_view:n,include_bots:true,include_deleted:false};TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",b);$("#team_filter input").bind("focus",function(){$("#team_filter .icon_search").addClass("indifferent_grey")}).bind("blur",function(){$("#team_filter .icon_search").removeClass("indifferent_grey")});if(p){var y=S.find(".tab_action:not(#search)");var w=$("#team_block");S.find("li a").on("click",function(){var e=$(this).data("action");var t=TS.permissions.members.canEditUserGroups();var n=TS.permissions.members.canCreateAndDeleteUserGroups();y.addClass("hidden");if("user_group_edit"===e){if(!t&&!n)return;y.removeClass("hidden");w.addClass("hidden")}else w.removeClass("hidden");S.find("#"+e).removeClass("hidden")})}$("#team_tabs").find("li.tab").on("click",function(e){var t=$(e.currentTarget).find("a").data("name");TS.model.ui_state.tab_name=t;TS.storage.storeUIState(TS.model.ui_state);var n=$("#search");TS.client&&TS.ui.utility.updateClosestMonkeyScroller($("#team_list_members"));$("#team_list_members").trigger("resize");if("user_groups"===t){TS.view.rebuildUserGroupList();n.toggleClass("hidden",!TS.model.user_groups.length)}else n.removeClass("hidden")});return TS.templates.team_list({members:s,bots:u,show_bots:_,show_restricted_members:m,restricted_members:d,ultra_restricted_members:c,show_disabled_members:f,disabled_members:o,deleted_bots:l,show_user_groups:p,user_groups:g,show_user_groups_help:h,is_long_list_view:n})},buildUserGroupHTML:function e(t,n){return TS.templates.user_group_list_item({user_group:t,is_flexpane:n})},buildUserGroupListHTML:function e(t,n){var r;var i=[];var a=[];var s=TS.permissions.members.canCreateAndDeleteUserGroups();for(var o=0;o<t.length;o+=1){r=t[o];if(r.date_delete){r.can_delete=!r.auto_type&&!r.is_external;a.push(r)}else i.push(r)}var l=!n&&!i.length&&!a.length||n&&!i.length;return TS.templates.user_group_list({user_groups:i,disabled_user_groups:a,show_toggle:s,is_flexpane:n,show_user_groups_help:l})},makeChannelPrefix:function e(t){if(!t)return"";if(t.is_mpim||t.is_im)return"";if(t.is_group||t.is_private)return'<ts-icon class="ts_icon_lock"></ts-icon>';if(t.is_channel)return"#";return""},makeModelObNameForDisplay:function e(t,n){if(!t)return"ERROR: MISSING CHANNEL";n=n||{};var r=_.trim(TS.templates.builders.maybeMakeSharedIcon(t,n.show_tooltip,n.tooltip_position,n.inherit_font_size));var i=TS.templates.builders.makeChannelPrefix(t);var a;a=t.is_im?TS.interop.members.getPrefCompliantMemberNameById(t.user):t.is_mpim?TS.mpims.legacyGetDisplayName(t):t.name;a=_.escape(a);var s=n.allow_wrap?"<span>":'<span class="no_wrap">';n.overflow_ellipsis&&(s+='<span class="overflow_ellipsis">');s+=n.omit_prefix?"":i;s+=a;n.overflow_ellipsis&&(s+="</span>");s+=r+"</span>";return s},makeChannelLink:function e(t,n){if(!t)return"ERROR: MISSING CHANNEL";n=n||{};var r=t.id;var i=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+r+'"':"";var a=TS.templates.builders.makeModelObNameForDisplay(t,n);if(n.overflow_ellipsis)return'<a href="/archives/'+r+'" '+i+' class="channel_link display_flex flex_wrap_none" data-channel-id="'+t.id+'">'+a+"</a>";return'<a href="/archives/'+r+'" '+i+' class="channel_link" data-channel-id="'+t.id+'">'+a+"</a>"},maybeMakeSharedIcon:function e(t,n,r,i){var a="";!TS.interop.rules.channels.isOrgShared(t)||t.is_mpim||t.is_im?!TS.interop.rules.channels.isExternallySharedChannel(t)||t.is_mpim||t.is_im||(a=TS.templates.shared_channels_icon({model_ob:t,tooltip:_.isUndefined(n)||n,tooltip_position:r,shared_team_ids:TS.interop.rules.channels.isPendingExternallySharedChannel(t)?t.pending_shared:t.shared_team_ids,inherit:i})):a=TS.templates.shared_channel_icon({tooltip:n,tooltip_position:r});return new Handlebars.SafeString(a)},makeChannelPath:function e(t){return"/messages/"+t.id},makeChannelLinkAriaLabelSafe:function t(n){n||TS.warn("No valid channel to make channel link aria label");var r=_.escape(n.name);var i=TS.model.active_channel_id===n.id?TS.interop.i18n.t("active channel","templates_builders")():TS.interop.i18n.t("channel","templates_builders")();var a=e(n);var s=null;TS.templates.builders.legacyShowDraftIcon(n)&&(s=TS.interop.i18n.t("draft","messages")());var o=r+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeGroupLink:function e(t,n){if(!t)return"ERROR: MISSING GROUP";n=n||{};var r=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+t.id+'"':"";var i=TS.templates.builders.makeModelObNameForDisplay(t,n);if(n.overflow_ellipsis)return'<a href="/archives/'+t.id+'" '+r+' class="group_link display_flex flex_wrap_none" data-group-id="'+t.id+'">'+i+"</a>";return'<a href="/archives/'+t.id+'" '+r+' class="group_link" data-group-id="'+t.id+'">'+i+"</a>"},makeGroupLinkAriaLabelSafe:function t(n){n||TS.warn("No valid group to make private channel link aria label");var r=_.escape(n.name);var i=TS.model.active_group_id===n.id?TS.interop.i18n.t("active channel","templates_builders")():TS.interop.i18n.t("channel","templates_builders")();var a=e(n);var s=null;TS.templates.builders.legacyShowDraftIcon(n)&&(s=TS.interop.i18n.t("draft","messages")());var o=r+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeMpimLink:function e(t,n){if(!t)return"ERROR: MISSING MPIM";var r;var i;var a="/archives/"+t.id;TS.utility.shouldLinksHaveTargets()&&(r="/archives/"+t.id);if(n){var s=TS.mpims.legacyGetMembersInDisplayOrder(t);var o=s.map(function(e){if(e.profile.real_name)return e.profile.real_name;return e.name});var l=o.join(", ");i=l===TS.mpims.legacyGetDisplayName(t)?"":l}return TS.templates.mpim_link({target:r,href:a,title:i,mpim:t})},makeMemberPreviewLink:function e(t,n){if(!t)return"";true!==n&&(n=false);var r=TS.templates.builders.makeMemberColorClass(t);var i;var a;if(t.is_service){a=TS.utility.shouldLinksHaveTargets()?'target="/services/'+t.id+'"':"";r+=" app_preview_link";i='<a href="/services/'+t.id+'" '+a+' data-bot-id="'+t.id+'" class="message_sender service_link '+r+'">'}else{a=TS.utility.shouldLinksHaveTargets()?'target="/team/'+t.id+'"':"";r+=t.is_bot?" app_preview_link":" member member_preview_link";r+=" "+TS.templates.builders.makeMemberTypeBadgeClass(t);i='<a href="/team/'+t.id+'" '+a+' class="message_sender '+r+'" data-member-id="'+t.id+'">'}n&&t.id==TS.model.user.id?i+=TS.interop.i18n.t("You","templates_builders")():i+=TS.interop.members.getPrefCompliantMemberName(t,true);i+=TS.templates.builders.makeMemberTypeBadgeCompact(t,false);i+="</a>";(t.is_bot||t.is_service)&&(i+='<span class="c-app_label">'+TS.interop.i18n.t("APP","templates_builders")()+"</span>");t.is_unknown&&(i=TS.templates.unknown_member({id:t.id}));return i},legacyShowDraftIcon:function e(t){if(!_.isObject(t))return false;var n;var r=t.id;n=t.last_msg_input;if(TS.interop.utility.looksLikeMemberId(t.id)){var i=TS.redux.channels.getImByMemberId(t.id);if(!i)return false;n=i&&i.last_msg_input;r=i&&i.id}var a=TS.shared.legacyGetActiveModelOb();if(a){var s=a.id;s&&s==r&&!TS.client.activeChannelIsHidden()&&(n=null)}t.is_channel&&(!t.is_archived&&t.is_member||(n=null));t.is_group&&!t.is_mpim&&t.is_archived&&(n=null);TS.permissions.members.canPostInChannel(t)||(n=null);if(_.trim(n))return true;return false},makeProfileImage:function e(t,n){if(_.isString(t)){var r=TS.interop.members.getMemberById(t);t=r||TS.interop.bots.getBotById(t)}if(!t)return false;var i=n.hash.is_lazy||false;var a=t.profile||t.icons||{};var s=n.hash.title||false;var o;o=a.emoji?"64":"48";var l=n.hash.size||o;var u=Object.keys(TS.constants.avatar_size_map).reduce(function(e,t){if(t===l&&m(a,t))return t;return e},o);var d={entity:t,size:l,css_classes:f(t,l),image:c(t,m(a,u)),is_lazy:i,is_targettable:TS.utility.shouldLinksHaveTargets(),title:s};function c(e,t){var n=[];n.push("url('"+t+"')");return n.join(",")}function m(e,t){var n="image_"+t;if(e.hasOwnProperty(n)){if(TS.environment.is_retina)return e[TS.constants.avatar_size_map[t].retina]||e[TS.constants.avatar_size_map[t].standard];return e[TS.constants.avatar_size_map[t].standard]}return false}function f(e,t){var n=[];n.push("thumb_"+t);if(e.is_bot){n.push("is_bot");n.push("app_preview_link")}else n.push("member_preview_link");return n.join(" ")}return new Handlebars.SafeString(TS.templates.member_profile_image(d))},makeMemberPreviewLinkImage:function e(t,n,r,i,a,o,l){var u;u="object"===("undefined"===typeof t?"undefined":s()(t))?t:TS.redux.members.getPotentiallyUnknownMemberById(t);if(!u||!u.profile)return"";r=true===r;i=true===i;a=true===a;o=true===o;l="string"===typeof l&&l;"USLACKBOT"===t&&l&&(u=TS.utility.slackbot.getWithFeels(l));var d=TS.templates.builders.getImageStyleForMemberPreviewImage(u,n,r);var c={omit_link:i,omit_badge:a,lazy:r,member:u,size:n,include_restricted_overlay:!o||true,bg_img_style:d};return TS.templates.member_preview_link_image(c)},getImageStyleForMemberPreviewImage:function e(t,n,r){var i;var a;var s;a="background-image: ";s=[];switch(n){case 20:i=TS.environment.is_retina?t.profile.image_48:t.profile.image_24;break;case 24:i=TS.environment.is_retina?t.profile.image_48:t.profile.image_24;break;case 32:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_32;break;case 36:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break;case 48:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break;case 72:i=TS.environment.is_retina?t.profile.image_192:t.profile.image_72;break;case 192:i=TS.environment.is_retina&&t.profile.image_512||t.profile.image_192;break;case 512:i=TS.environment.is_retina?t.profile.image_1024||t.profile.image_512||t.profile.image_192:t.profile.image_512||t.profile.image_192;break;default:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break}s.push("url('"+i+"')");if(512===n){var o=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;s.push("url('"+o+"')")}a=r?s.length?s.join(", "):"":s.length?a+s.join(", "):"";return a},makeMemberPreviewCardLinkImage:function e(t){var n=TS.redux.members.getPotentiallyUnknownMemberById(t);if(!n||!n.profile)return"";var r=TS.templates.builders.makeMemberPreviewCardLinkImageBackground(t);var i=TS.utility.shouldLinksHaveTargets()?'target="/team/'+n.id+'"':"";return'<a href="/team/'+n.id+'" '+i+' class="member_preview_link member_image thumb_512" data-member-id="'+n.id+'" data-thumb-size="512" style="background-image: '+r+'" aria-hidden="true"></a>'},makeMemberPreviewCardLinkImageBackground:function e(t){var n=TS.redux.members.getPotentiallyUnknownMemberById(t);if(!n||!n.profile)return"";var r;r=TS.environment.is_retina?n.profile.image_1024||n.profile.image_512||n.profile.image_192:n.profile.image_512||n.profile.image_192;var i=TS.environment.is_retina?n.profile.image_72:n.profile.image_48;var a=!TS.model.mac_version||0!==TS.utility.compareSemanticVersions(TS.model.mac_version,"10.7")&&0!==TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8")?"":"-webkit-";var s=[a+"linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0) 34%, rgba(0,0,0,0.2) 66%, rgba(0,0,0,0.2) 83%, rgba(0,0,0,0.6))","url('"+r+"')","url('"+i+"')"];return s.join(", ")},makeMemberLinkAriaLabelSafe:function t(n){n||TS.warn("No valid direct message object to make member link aria label");var r=n.member;var i=n.model_ob;var a="";if(r&&i){var s=_.escape(TS.ims.getDisplayNameOfUserForIm(i));var o=TS.model.active_im_id===r.id?TS.interop.i18n.t("active direct message","templates_builders")():TS.interop.i18n.t("direct message","templates_builders")();var l=TS.templates.makeMemberPresenceStateAriaLabel(r);var u=e(i);var d=null;TS.templates.builders.legacyShowDraftIcon(i)&&(d=TS.interop.i18n.t("draft","messages")());a=s+", "+o+", "+l+(u?", "+u:"")+(d?", "+d:"")}return new Handlebars.SafeString(a)},makePendingUserImage:function e(t,n){if(!t||!n)return"";var r=48;36===n&&(r=72);var i="/img/new_channel_modal/airplane_"+r.toString()+".png";var a="url('"+vvv(i)+"')";var s={restricted:t.invite_prefs&&"restricted"===t.invite_prefs.type,img_url:a,size:n};return TS.templates.pending_user_image(s)},newWindowName:function e(){if("web"===TS.boot_data.app||"calls"===TS.boot_data.app)return"_self";return"new_"+n.toString()},getBotIdentifier:function e(t){if(!t.bot_id&&!t.username)return null;var n=TS.redux.bots.getBotByMsg(t);var r=!t.username&&n&&n.name?n.name:t.username;var i=n?n.id:"NOBOTID";return i+"_"+r},getBotName:function e(t){var n=t.username;if(!n){var r=TS.redux.bots.getBotByMsg(t);r&&r.name&&(n=r.name)}return n},getBotNameWithLink:function e(t){var n=t.username;var r=TS.redux.bots.getBotByMsg(t);var i=TS.templates.builders.makeBotLink(r);n||(r&&r.name?n=r.name:t.bot_profile&&t.bot_profile.name&&(n=t.bot_profile.name));return new Handlebars.SafeString(i.start_a+_.escape(n)+i.end_a)},makeBotLink:function e(t,n){var r="";var i="";var a=n||{};if(t&&!t.deleted){r='<a class="app_preview_link '+(a.classes?a.classes:" ")+'" target="/services/'+t.id+'" style="'+(a.style?a.style:" ")+'" href="/services/'+t.id+'">';i=(a.external_badge?a.external_badge:" ")+"</a>"}else{r='<a class="app_preview_link">';i="</a>"}return{start_a:r,end_a:i}},makeFiletypeHTML:function e(t){if(t.external_type)return TS.templates.builders.makeExternalFiletypeHTML(t);var n="";n+='<a href="'+t.url_private_download+'" ';n+='target="'+t.url_private_download+'" ';n+='title="'+TS.interop.i18n.t("Download this file","templates_builders")()+'" ';n+='data-file-id="'+t.id+'" ';n+='class="subtle_silver file_ssb_download_link">';n+=TS.interop.utility.convertFilesize(t.size)+" ";n+="<span>"+t.pretty_type+"</span>";"snippet"===t.mode&&(n+=" "+TS.interop.i18n.t("snippet","templates_builders")());n+="</a>";return n},makeExternalFiletypeHTML:function e(t){if(!t.is_external)return;var n="";switch(t.external_type){case"gdrive":switch(t.filetype){case"gsheet":n=TS.interop.i18n.t("Spreadsheet from Google Drive","templates_builders")();break;case"gdoc":n=TS.interop.i18n.t("Document from Google Drive","templates_builders")();break;case"gpres":n=TS.interop.i18n.t("Presentation from Google Drive","templates_builders")();break;case"gdraw":n=TS.interop.i18n.t("Drawing from Google Drive","templates_builders")();break;default:n=TS.interop.i18n.t("<span>{file_type}</span> from Google Drive","templates_builders")({file_type:t.pretty_type})}break;case"dropbox":n=TS.interop.i18n.t("<span>{file_type}</span> from Dropbox","templates_builders")({file_type:t.pretty_type});break;case"box":n=TS.interop.i18n.t("<span>{file_type}</span> from Box","templates_builders")({file_type:t.pretty_type});break;case"onedrive":n=TS.interop.i18n.t("<span>{file_type}</span> from OneDrive","templates_builders")({file_type:t.pretty_type});break;default:n=TS.interop.i18n.t("File","templates_builders")()}return n},makeUnshareLink:function e(t,n){var r=(t.is_channel?"#":"")+t.name;var i=TS.interop.i18n.t("Unshare from {channel}","templates_builders")({channel:r});return'<a class="unshare_link ts_tip ts_tip_top ts_tip_float ts_tip_unshare_link ts_tip_multiline" onclick="TS.files.promptForFileUnshare(\''+n.id+"', '"+t.id+'\')"><span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+i+'</span></span><i class="ts_icon ts_icon_minus_circle_small"></i></a>'},updateFileShareLabels:function e(t){var n=$('.file_share_label[data-file-id="'+t.id+'"]');n.each(function(){$(this).replaceWith(TS.templates.builders.makeFileShareLabel(t))});if(t.is_shared){$('.file_share_shared_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').addClass("hidden")}else{$('.file_share_shared_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').removeClass("hidden")}if(t.is_public){$('.file_share_private_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').removeClass("hidden")}else{$('.file_share_private_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').addClass("hidden")}},makeFileShareLabel:function e(t){var n='<span class="file_share_label" data-file-id="'+t.id+'">';var r=TS.templates.builders.makeFileGroupChannelList(t);r.length?n+=TS.interop.i18n.t("in {share_list}","templates_builders")({share_list:TS.interop.i18n.safeString(r)}):t.is_public||t.user===TS.model.user.id||(n+=TS.interop.i18n.t("shared with you","templates_builders")());n+="</span>";return n},makeFileGroupChannelList:function e(t){var n=[];var r;var i;var a;var s=_.get(t,"channels.length",0);for(a=0;a<s;a+=1){i=TS.interop.channels.getPublicChannelById(t.channels[a]);if(!i)continue;if(i.is_mpim)continue;r='<span class="no_wrap">';r+=TS.templates.builders.makeChannelLink(i,{inherit_font_size:true});r+="&nbsp;"+TS.templates.builders.makeUnshareLink(i,t);r+="</span>";n.push(r)}var o;var l=_.get(t,"groups.length",0);for(a=0;a<l;a+=1){o=TS.interop.channels.getGroupById(t.groups[a]);if(!o)continue;r='<span class="no_wrap">';r+=TS.templates.builders.makeGroupLink(o,{inherit_font_size:true});r+="&nbsp;"+TS.templates.builders.makeUnshareLink(o,t);r+="</span>";n.push(r)}if(!n.length)return"";return n.join(", ")},makeFileCommentHelpHTML:function e(t){if(t&&t.is_public&&(t.channels&&t.channels.length||t.groups&&t.groups.length)){var n=[];t.channels&&t.channels.length&&(n=n.concat(t.channels));t.groups&&t.groups.length&&(n=n.concat(t.groups));n=_.chain(n).map(function(e){return TS.redux.channels.getEntityById(e)}).filter(function(e){return e&&!e.is_im&&!e.is_mpim&&!TS.interop.rules.channels.isExternallySharedChannel(e)}).value();if(n.length<1)return"";return TS.interop.i18n.t("Commenting in {channel_names}","templates_builders")({channel_names:TS.interop.i18n.safeString(TS.templates.builders.makeLinksFromModelObs(n))})}return""},makeLinksFromModelObs:function e(t,n){n=n||{};t=TS.utility.parseJSONOrElse(t,t);t=_.isArray(t)?t:[t];var r=0;t=_.chain(t).map(function(e){if(_.isString(e))return TS.redux.channels.getEntityById(e);return e}).filter(function(e){e||(r+=1);return e&&!e.is_im&&!e.is_mpim}).value();var i=TS.sorter.search("",{groups:t},{allow_empty_query:true});var a=i.sort().map(function(e){var t=n.new_lines?'<span class="block">':"";t+=e.is_channel?TS.templates.builders.makeChannelLink(e,{overflow_ellipsis:n.overflow_ellipsis,inherit_font_size:n.inherit_font_size}):TS.templates.builders.makeGroupLink(e,{overflow_ellipsis:n.overflow_ellipsis,inherit_font_size:n.inherit_font_size});t+=n.new_lines?"</span>":"";return t});if(r){var s=TS.interop.i18n.t("{private_channel_or_group_count, plural, =1{# private channel}other{# private channels}}","templates_builders")({private_channel_or_group_count:r});a.push('<span class="no_wrap'+(n.new_lines?" block":"")+'">'+s+"</span>")}if(n.new_lines)return a.join("");return TS.interop.i18n.listify(a,{noEscape:true}).join("")},makeMessageShareLabelSafe:function e(t){var n='<span class="message_share_label">';var r="";if(t.is_channel)r=TS.templates.builders.makeChannelLink(t,{inherit_font_size:true});else{if(!t.is_group)return"";r=TS.templates.builders.makeGroupLink(t,{inherit_font_size:true})}n+=TS.interop.i18n.t("in {channel}","templates_builders")({channel:TS.interop.i18n.safeString(r)});n+="</span>";return new Handlebars.SafeString(n)},makeMessageLinkLabelSafe:function e(t){var n=TS.interop.i18n.t("From URL:","templates_builders")()+" <a "+TS.utility.makeRefererSafeLink(t)+' class="external_link"title="'+_.escape(t)+'"target="_blank">'+_.escape(t)+"</a>";return new Handlebars.SafeString(n)},buildFileSharingControls:function e(t,n,r,i,a){var s;TS.client?TS.client.activeChannelIsHidden()||(s=TS.shared.legacyGetActiveModelOb()):TS.web&&TS.web.space&&(s=TS.redux.channels.getEntityById(TS.web.space.getOriginChannel()));s&&TS.interop.rules.channels.isRequired(s)&&!TS.permissions.members.canPostInChannel(s)&&(s={});var o=[];var l=[];var u=[];r=r||"";$("#file_sharing_div").remove();var d=false;var c=false;if(t){if(t.user===TS.model.user.id)d=true;else if(t.user){var m=TS.interop.members.getMemberById(t.user);m&&m.is_external&&(c=TS.teams.getTeamNameByMember(m))}}else d=true;if(t&&t.id&&TS.files.isFilePrivate(t)&&!d&&!t.bot_id)var f=new Handlebars.SafeString(TS.interop.i18n.t("This file was sent to you privately. You may want to check with <strong>{user_names}</strong> before sharing it.","files")({user_names:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(t.user))),file_owners_count:1,file_count:1,file_title:t.title?TS.format.formatNoSpecials(t.title||"Untitled"):""}));if(TS.interop.rules.channels.isExternallySharedChannel(s)&&!TS.interop.rules.channels.isPendingExternallySharedChannel(s)&&s.shared_team_ids&&s.shared_team_ids.length){var p=TS.interop.i18n.listify(_.map(s.shared_team_ids,TS.teams.getTeamNameById)).join("");var h=new Handlebars.SafeString(TS.interop.i18n.t("<strong>This is a Shared channel</strong>. Messages and files sent here will be seen by members of <strong>{shared_teams_list}</strong>.","shared_channels")({shared_teams_list:p}))}var g=TS.web&&TS.web.space&&d&&!TS.prefs.getTeamPref("disable_file_editing")&&!t.channels.concat(t.groups).concat(t.ims).length;if(t&&t&&t.mimetype&&-1!=t.mimetype.indexOf("application/vnd.google-apps")){var S=t.pretty_type?t.pretty_type.replace(/GDocs /,""):null;if(S){var T={teamFileSpreadsheet:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Spreadsheet","templates_builders"),teamFilePresentation:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Presentation","templates_builders"),teamFileDocument:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Document","templates_builders"),fileSpreadsheet:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Spreadsheet","templates_builders"),filePresentation:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Presentation","templates_builders"),fileDocument:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Document","templates_builders"),fallback:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google file","templates_builders")};var v;TS.model.team.name?S&&"Document"===S?v=T.teamFileDocument({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}):S&&"Spreadsheet"===S?v=T.teamFileSpreadsheet({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}):S&&"Presentation"===S&&(v=T.teamFilePresentation({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)})):TS.model.team.name?v=T.fallback():S&&"Document"===S?v=T.fileDocument():S&&"Spreadsheet"===S?v=T.fileSpreadsheet():S&&"Presentation"===S&&(v=T.filePresentation())}}return TS.templates.file_sharing({channels:o,groups:l,members:u,model_ob:s,file:t,shared_channel_warning:h,file_sharing_notice:v,is_owner:d,owner_team:c,reshare_private_file:f,has_title:i,hide_checkbox:n,comment:r,selection:a,show_channel_join_note:s&&s.is_channel&&!s.is_member&&!s.is_archived,disable_file_sharing_dialog_comment:c||s&&TS.interop.utility.isModelObjectExternal(s),enable_collab_editing:g})},buildNonDefaultNotificationBlock:function e(t){t=t||"";var n="";var r;var i=TS.notifs.getCorGsNotUsingGlobalNotificationSetting();if(i.everything.length){n+='<div class="'+t+'">'+TS.interop.i18n.t("Set to notify for <strong>all activity</strong>:","templates_builders")();for(r=0;r<i.everything.length;r+=1)n+=" "+("C"===i.everything[r].id.charAt(0)?"#":"")+i.everything[r].name+(r!=i.everything.length-1?",":"");n+="</div>"}if(i.mentions.length){n+='<div class="'+t+'">'+TS.interop.i18n.t("Set to notify only for <strong>Highlight Words</strong>:","templates_builders")();for(r=0;r<i.mentions.length;r+=1)n+=" "+("C"===i.mentions[r].id.charAt(0)?"#":"")+i.mentions[r].name+(r!=i.mentions.length-1?",":"");n+="</div>"}if(i.nothing.length){n+='<div class="'+t+'">'+TS.interop.i18n.t("Set to <strong>never notify</strong>:","templates_builders")();for(r=0;r<i.nothing.length;r+=1)n+=" "+("C"===i.nothing[r].id.charAt(0)?"#":"")+i.nothing[r].name+(r!=i.nothing.length-1?",":"");n+="</div>"}return n},strBuilder:function e(t,n){return t.replace(/\${([a-z_]+)}/g,function(e,t){if(t.indexOf("_html")>-1)return n[t];return _.escape(n[t])})},buildRxnTitle:function e(t,n){if(!n&&!TS.web)return;var r;var i=":"+t.name+":";TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(i=TS.emoji.maybeGetLocalizedEmojiString(i));if(t.is_handy||t.is_poll&&!t.count){r=_.escape(i||t.name);return TS.interop.i18n.t("Add reaction {emoji}","rxn")({emoji:TS.interop.i18n.safeString(r)})}var a=false;var s=false;var o=true;r=_.escape(i||t.name);TS.emoji.isValidName(t.name)||t.url||(r+=" "+TS.interop.i18n.t("(emoji has been removed)","rxn")());if(1===t.count){if(t.user_reacted)return TS.interop.i18n.t('You (click to remove) <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({emoji:r});return TS.interop.i18n.t('{user} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({user:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(t.member_ids[0],a,s,o))),emoji:TS.interop.i18n.safeString(r)})}var l=false;var u=t.member_ids.length!=t.count;var d=t.member_ids.map(function(e,t){var n;if(TS.model.user.id===e){l=true;n=0===t?TS.interop.i18n.t("You","rxn")():TS.interop.i18n.t("you","rxn")()}else n=TS.interop.members.getPrefCompliantMemberNameById(e,a,s,o);return n});u&&d.push(TS.interop.i18n.t("others","rxn")());if(l)return TS.interop.i18n.t('{users_and_you} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users_and_you:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(d,{noEscape:true}).join(""))),emoji:TS.interop.i18n.safeString(r)});return TS.interop.i18n.t('{users} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(d,{noEscape:true}).join(""))),emoji:TS.interop.i18n.safeString(r)})},buildRxnHtml:function e(t){var n;var r=TS.emoji.isValidName(t.name);if(t.url)n='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+t.url+');"></span>';else if(r){var i=t.is_handy&&TS.emoji.isNameSkinToneModifiable(t.name)?TS.emoji.getChosenSkinToneModifier():"";n=TS.emoji.graphicReplace(":"+t.name+":"+i,{no_skin_tone_squares:t.is_handy,obey_emoji_mode_pref:true})}else n=TS.emoji.MISSING_EMOJI_HTML;var a=TS.templates.builders.buildRxnTitle(t);var s=[];t.user_reacted&&s.push("user_reacted");t.is_handy&&s.push("is_handy");t.is_hidden&&s.push("hidden");"as_text"===TS.prefs.getPref("emoji_mode")&&s.push("plain_text");return TS.templates.rxns_rxn({name:t.name,url:t.url,css_classes:s.join(" "),emoji_html:new Handlebars.SafeString(n),title:new Handlebars.SafeString(a||""),count:t.count,is_handy:!!t.is_handy,is_web:!!TS.web})},updateRxnHtml:function e(t,n){var r=t.children('.rxn[data-emoji="'+n.name+'"]');if(r.length){r.find(".emoji_rxn_count").attr("aria-label",n.count);r.toggleClass("user_reacted",n.user_reacted);var i=true;var a=TS.templates.builders.buildRxnTitle(n,i);var s;var o=r.find(".ts_tip_tip_inner");o.length||(o=r.find(".ts_tip_multiline_inner"));if(o.length){s=o.html();s!=a&&TS.tips.updateTipTitle(r,a)}else{s=r.prop("title");s!=a&&TS.tips.updateTipTitle(r,a)}n.animate_it_dramatically?setTimeout(n.animate_callback,0):n.animate_it&&setTimeout(n.animate_callback,0)}else{t.children(".rxn_hover_container").before($(TS.templates.builders.buildRxnHtml(n)));r=t.children('.rxn[data-emoji="'+n.name+'"]');n.animate_it_dramatically?r.css("opacity",0).transition({opacity:1},300,n.animate_callback):n.animate_it&&r.css("opacity",0).transition({opacity:1},300,n.animate_callback)}},updateRxnPanels:function e(t,n,r){var i=TS.rxns.getExistingRxnsByKey(t);var a=$("."+TS.templates.makeRxnKeyDomClass(t));var s=function e(a){var s;var o;i&&i.forEach(function(e){s=e.name==n;o=s&&r==TS.model.user.id;TS.templates.builders.updateRxnHtml(a,{animate_it:s,animate_it_dramatically:o,name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(i,e.name),member_ids:e.users,rxn_key:t})});var l=a.children(".rxn");l.each(function(e,t){var n=$(t);var r=String(n.data("emoji"));if(!TS.rxns.doesRxnsHaveRxn(i,r)){n.addClass("going_away");n.transition({opacity:0},300,function(){n.remove()})}});TS.ui.messages.maybeUpdateMessageHoverContainer(a.closest("ts-message"));var u=a.children(".rxn_hover_container").find(".rxn.is_handy");u.each(function(e,t){var n=$(t);var r=String(n.data("emoji"));n.toggleClass("hidden",TS.rxns.doesRxnsHaveSkinlessRxn(i,r))})};a.each(function(e,n){var r=$(n);if(!i){r.empty();TS.ui.messages.maybeUpdateMessageHoverContainer(r.closest("ts-message"));return}r.children().length||(r=$(TS.templates.builders.rxnPanel(t)).replaceAll(r));s(r)})},rxnPanel:function e(t){if(!t)return;var n=[];var r={};var i="";var a=TS.rxns.getExistingRxnsByKey(t);var s="";var o=function e(){if(a){a=_.sortBy(a,function(e){return TS.emoji.isValidName(e.name)?0:1});a.forEach(function(e){s+=TS.templates.builders.buildRxnHtml({name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(a,e.name),member_ids:e.users,rxn_key:t})})}_.each(_.keys(r.items),function(e){i+=TS.templates.builders.buildRxnHtml({name:e,is_handy:true,is_hidden:TS.rxns.doesRxnsHaveSkinlessRxn(a,e),rxn_key:t})})};o();return TS.templates.rxns_panel({css_classes:n.join(" "),rxn_key:t,rxns_html:new Handlebars.SafeString(s),handy_rxns_html:new Handlebars.SafeString(i),id_class:TS.templates.makeRxnKeyDomClass(t),has_hovers:!r.is_poll})},filePreviewBackIcon:function e(){return'<i class="ts_icon ts_icon_chevron_medium_left back_icon"></i>'},buildQuickSwitcherBtnHtml:function e(){var t=TS.interop.i18n.t("Quick Switcher","templates_builders")();(TS.model.is_our_app||TS.prefs.getPref("k_key_omnibox"))&&(t+=[" ",'<span class="subtle_silver">(',TS.model.is_mac?"&#8984K":"Ctrl+K",")</span>"].join(""));return'<i class="ts_icon ts_icon_filter"></i><span id="quick_switcher_label" class="ts_tip_tip">'+t+"</span>"},atLabel:function e(t){"group"===t&&(t="channel");var n=(_.keyBy(TS.interop.broadcast_keywords.getAllBroadcastKeywords(),"ms_name")[t]||{}).name||"channel";return"@"+n},makeMemberTypeBadgeClass:function e(t){if(!TS.boot_data.page_needs_enterprise)return"";if(!t.is_restricted)return"";return"has_member_type_badge"},makeMemberColorClass:function e(t){var n="color_";n+=t?t.id+" color_"+t.color:"unknown";return n},makeMemberTypeBadgeCompact:function e(t,n){if(!TS.boot_data.page_needs_enterprise)return"";"boolean"!==typeof n&&(n=false);var r={icon_class:"",with_tooltip:n,tooltip:{member_type:"",type_description:""}};var i=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("organization directory","templates_builders")():TS.interop.i18n.t("workspace directory","templates_builders")();if(t.is_external)return"";if(t.is_ultra_restricted){r.icon_class="ts_icon_single_channel_guest";r.tooltip.member_type=TS.interop.i18n.t("Single-Channel Guests","templates_builders")();r.tooltip.type_description=TS.interop.i18n.t("see a partial {directory_name} and can only access messages and files from the channel they belong to.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(r)}if(t.is_restricted){r.icon_class="ts_icon_restricted_user";r.tooltip.member_type=TS.interop.i18n.t("Multi-Channel Guests","templates_builders")();r.tooltip.type_description=TS.interop.i18n.t("see only a partial {directory_name} and can only access messages and files from selected channels.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(r)}return""},getMemberTypeClass:function e(t){if(t.is_restricted)return" ra";return""},makeTeamlabel:function e(t){if(!t)return"ERROR: MISSING TEAM ID";var n="";var r=TS.teams.getTeamById(t);if(!r)return"ERROR: UNABLE TO GET TEAM INFO";n='<span class="org_team_tag_name">'+_.escape(r.name)+"</span>";return n},loadingHTML:function e(){var t=cdn_url+"/9c217/img/loading_hash_animation_@2x.gif";var n=cdn_url+"/9c217/img/loading_hash_animation.gif";var r=TS.interop.i18n.t("loading&hellip;","templates_builders")();return'<div class="loading_hash_animation"><img src="'+t+'" alt="'+r+'" srcset="'+n+" 1x, "+t+' 2x" /><br />'+r+"</div>"},buildThreadMsgHTML:function e(t,n,r,i){var a=!!_.get(i,"inline");var s=a?TS.templates.makeMsgDomId(t.ts):TS.templates.makeMsgDomIdInThreadsView(t.ts);return TS.templates.builders.msgs.buildHTML({msg_dom_id:s,model_ob:n,msg:t,is_threads_view:true,is_new_reply:TS.interop.messages.isReply(t)&&r&&t.ts>r.initial_last_read,relative_ts:true,enable_slack_action_links:true})},buildThreadParticipantListHTML:function e(t){var n;if(t.reply_users)n=t.reply_users;else{n=_.map(t.replies,"user");var r=_.map(t.replies,"bot_id");n=n.concat(r)}n=_.without(n,"U00",void 0);"tombstone"!==t.subtype&&t.user&&n.unshift(t.user);n=_.uniq(n);if(_.includes(n,TS.model.user.id)){n=_.without(n,TS.model.user.id);n.push(TS.model.user.id)}var i=_.map(n,function(e){var t;t="B"===e.charAt(0)?TS.interop.bots.getBotNameById(e):e===TS.model.user.id?TS.interop.i18n.t("you","threads")():TS.interop.members.getPrefCompliantMemberNameById(e);return t});if(1===n.length){if(n[0]===TS.model.user.id)return TS.interop.i18n.t("Just you","threads")();return _.escape(i[0])}if(2===n.length){if(n[1]===TS.model.user.id)return TS.interop.i18n.t("{user_name} and you","threads")({user_name:TS.interop.i18n.safeString(_.escape(i[0]))});return TS.interop.i18n.t("{user_name1} and {user_name2}","threads")({user_name1:TS.interop.i18n.safeString(_.escape(i[0])),user_name2:TS.interop.i18n.safeString(_.escape(i[1]))})}if(3===n.length){if(n[2]===TS.model.user.id)return TS.interop.i18n.t("{user_name1}, {user_name2}, and you","threads")({user_name1:TS.interop.i18n.safeString(_.escape(i[0])),user_name2:TS.interop.i18n.safeString(_.escape(i[1]))});return TS.interop.i18n.t("{user_name1}, {user_name2}, and {user_name3}","threads")({user_name1:TS.interop.i18n.safeString(_.escape(i[0])),user_name2:TS.interop.i18n.safeString(_.escape(i[1])),user_name3:TS.interop.i18n.safeString(_.escape(i[2]))})}if(n.length>3){var a=t.reply_users_count?t.reply_users_count:n.length;var s=a-2;var o=_.drop(i,2);if(t.reply_users_count&&o.length<s)o.push(TS.interop.i18n.t("others","threads")());else{var l=25;if(o.length>l){o=_.take(o,l);o.push(TS.interop.i18n.t("others","threads")())}}var u=TS.interop.i18n.listify(o,{noEscape:true}).join("");return TS.templates.thread_participants_with_overflow({num_others:s,user_name1:i[0],user_name2:i[1],other_names:u})}},buildBroadcastRepliersSummaryHTML:function e(t){var n=t.reply_count;var r;var i;if(t.reply_users){r=t.reply_users;i=t.reply_users_count}else{var a=t.replies;if(!a||!a.length)return"";r=_.map(a,"user");r=_.uniq(r);i=r.length}var s=_.map(r,function(e){if("U00"===e)return null;var t=e.charAt(0);var n;n="B"===t?TS.interop.bots.getBotById(e):TS.redux.members.getPotentiallyUnknownMemberById(e);return n});s=_.compact(s);if(!n||!s.length)return"";if(1===n)return TS.interop.i18n.t("1 reply","threads")();var o=!!_.find(s,{is_self:true});if(o){s=_.reject(s,{is_self:true});s.push(TS.model.user)}var l=_.map(s,function(e){if(e.is_bot)return e.name;if(e.is_self)return TS.interop.i18n.t("you","threads")();return TS.interop.members.getPrefCompliantMemberName(e)});if(1===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from you","threads")({reply_count:n});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name}","threads")({reply_count:n,user_name:TS.interop.i18n.safeString(_.escape(l[0]))})}if(2===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name} and you","threads")({reply_count:n,user_name:TS.interop.i18n.safeString(_.escape(l[0]))});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1} and {user_name2}","threads")({reply_count:n,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1]))})}if(3===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and you","threads")({reply_count:n,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1]))});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and {user_name3}","threads")({reply_count:n,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1])),user_name3:TS.interop.i18n.safeString(_.escape(l[2]))})}if(s.length>3){var u=_.drop(l,2);u.length<i-2&&u.push(TS.interop.i18n.t("others","threads")());var d=TS.interop.i18n.listify(u,{noEscape:true}).join("");return TS.templates.thread_broadcast_repliers_with_overflow({reply_count:n,num_others:i-2,user_name1:l[0],user_name2:l[1],other_names:d})}return""},buildMemberCustomStatusExpiration:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),t.id);if(r&&r.expiration){var i=TS.interop.datetime.formatDate(r.expiration,"{status_expiration}",{do24hrTime:TS.prefs.getPref("time24")});var a=TS.interop.i18n.t("Until {expirationDate}","current_status")({expirationDate:i});var s=n.inline?"span":"p";var o=n.inline?"no_wrap":"no_bottom_margin";return"<"+s+' class="sk_dark_gray current_status_expiration '+o+'" data-member-id="'+t.id+'">'+a+"</"+s+">"}return""},replaceEmojiForPosts:function e(t){if(t.childNodes)for(var n=0;n<t.childNodes.length;n+=1)TS.templates.builders.replaceEmojiForPosts(t.childNodes[n]);if(t.nodeType==Node.TEXT_NODE){var r=_.escape(t.textContent);var i=TS.emoji.graphicReplace(TS.emoji.legacyReplaceEmoticons(r),{include_title:true,include_text:false});if(i!==r){var a=$("<span>").html(i)[0];[].slice.apply(a.childNodes).forEach(function(e){t.parentNode.insertBefore(e,t)});t.parentNode.removeChild(t)}}},formatPostsForModern:function e(t){var n=$("<div>").html(t);TS.templates.builders.replaceEmojiForPosts(n[0]);TS.utility.makeSureAllLinksHaveTargets(n);return n.html()},proxyImgUrlsForEmails:function e(t){t.find("img").each(function(){var e=$(this).attr("src");var t=$(this).attr("width");var n=$(this).attr("height");var r;r=t&&n?TS.utility.getImgProxyURL(e,t,n):TS.utility.getImgProxyURL(e);$(this).attr("src",r)})},formatEmailsForModern:function e(t){var n=$("<div>").html(t);TS.templates.builders.proxyImgUrlsForEmails(n);TS.utility.makeSureAllLinksHaveTargets(n);return n.html()},formatFileTitle:function e(t){if(!t||!t.title)return"";var n=t.title;n=_.unescape(n);n=_.escape(n);return TS.format.formatWithOptions(n,null,{no_specials:true})},test:function e(){var n={};Object.defineProperty(n,"_buildStarComponents",{get:function e(){return t},set:function e(n){t=n}});return n}});function e(e){var t="";var n=e.unread_highlight_cnt;var r=e.unread_cnt;n&&!e.is_im?t+=n+" "+TS.interop.i18n.t("unread highlight","templates_builders")()+" ":r&&(t+=r+" "+TS.interop.i18n.t("unread","templates_builders")()+" ");r&&(t+=TS.interop.i18n.t("{count, plural, =1 {message} other {messages}}","templates_builders")({count:r}));return t}function t(e,t,n,r){if(!e)return{};!t||"string"!==typeof t||"channel"!==e&&"group"!==e&&"mpim"!==e&&"im"!==e||(t=TS.redux.channels.getEntityById(t));if(!t)return{};if("message"===e&&n&&"string"===typeof n){var i=n;n=TS.interop.channels.getPublicChannelById(i);n||(n=TS.interop.channels.getImById(i));n||(n=TS.interop.channels.getGroupById(i))}var a={};var s=[];var o=[];o=["star","ts_icon","ts_icon_star_o","ts_icon_inherit"];var l="ts_tip_top";var u=t.id||t.ts;var d=n?n.id:null;if("message"===e){if(!d)return{};a["data-msg-id"]=u;a["data-c-id"]=d;TS.interop.rules.messages.isTempMsg(t)&&o.push("invisible")}else if("file"===e)a["data-file-id"]=u;else if("file_comment"===e){a["data-comment-id"]=u;a["data-file-id"]=d;o.push("star_comment")}else if("channel"===e){l="ts_tip_bottom";a["data-channel-id"]=u}else if("group"===e){l="ts_tip_bottom";a["data-group-id"]=u}else if("im"===e){TS.interop.apps.isAppSpaceEnabled()&&TS.apps.isCurrentModelViewAnApp()&&(e="app");l="ts_tip_bottom";a["data-im-id"]=u}else{if("mpim"!==e){TS.error("buildStar needs to handle star item type:"+e);return{}}l="ts_tip_bottom";a["data-mpim-id"]=u}o=_.concat(o,l);if(t.is_starred){o.push("starred","ts_icon_star");o.splice(o.indexOf("ts_icon_star_o"),1)}o.push("star_"+e);$.each(a,function(e,t){s.push(e+'="'+t+'"')});var c={message:TS.interop.i18n.t("message","templates_builders")(),file:TS.interop.i18n.t("file","templates_builders")(),file_comment:TS.interop.i18n.t("file comment","templates_builders")(),channel:TS.interop.i18n.t("channel","templates_builders")(),group:TS.interop.i18n.t("channel","templates_builders")(),im:TS.interop.i18n.t("direct message","templates_builders")(),app:TS.interop.i18n.t("app","templates_builders")(),mpim:TS.interop.i18n.t("direct message","templates_builders")()};var m;var f;switch(e){case"message":if(r){m=TS.interop.i18n.t("Star message","templates_builders","34b1d30c4ba28fdac168af2100272fd9aeac1ad5")();f=TS.interop.i18n.t("Unstar message","templates_builders","1e8aec29618ad627c4756e1922c40c8fcb3aea86")()}else{m=TS.interop.i18n.t("Star this message","templates_builders")();f=TS.interop.i18n.t("Unstar this message","templates_builders")()}break;case"file":if(r){m=TS.interop.i18n.t("Star file","templates_builders","42dd9b61d10f324bfe3bb8f2a5e7dc13ae2d8fea")();f=TS.interop.i18n.t("Unstar file","templates_builders","92e7358e95824d6d7d58ad708dbb20e47656ad6d")()}else{m=TS.interop.i18n.t("Star this file","templates_builders")();f=TS.interop.i18n.t("Unstar this file","templates_builders")()}break;case"file_comment":if(r){m=TS.interop.i18n.t("Star file comment","templates_builders","23db127e219e9451f6f2cc9adbc4cc57ba9f8b07")();f=TS.interop.i18n.t("Unstar file comment","templates_builders","6981fc4436ea029ab4dd573937de729fc0f7a50b")()}else{m=TS.interop.i18n.t("Star this file comment","templates_builders")();f=TS.interop.i18n.t("Unstar this file comment","templates_builders")()}break;case"channel":case"group":if(r){m=TS.interop.i18n.t("Star channel","templates_builders","f314f33a825d5dc3ac1683638acc464b2aae62fc")();f=TS.interop.i18n.t("Unstar channel","templates_builders","1f6e79ac454ab33de1d19b242a90c340317ae97e")()}else{m=TS.interop.i18n.t("Star this channel","templates_builders")();f=TS.interop.i18n.t("Unstar this channel","templates_builders")()}break;case"im":case"mpim":if(r){m=TS.interop.i18n.t("Star direct message","templates_builders","a04b360e228e052a9853fbe7203ab22697daade3")();f=TS.interop.i18n.t("Unstar direct message","templates_builders","d7d5187810a018277ffe3561a0e29edcc5b3528d")()}else{m=TS.interop.i18n.t("Star this direct message","templates_builders")();f=TS.interop.i18n.t("Unstar this direct message","templates_builders")()}break;case"app":if(r){m=TS.interop.i18n.t("Star app","templates_builders","74f6a6535ed4abed0178d1f93f41429ea6a3ed6a")();f=TS.interop.i18n.t("Unstar app","templates_builders","fc640532bd4741f719542e97c41e2a68db1b3b52")()}else{m=TS.interop.i18n.t("Star this app","templates_builders")();f=TS.interop.i18n.t("Unstar this app","templates_builders")()}break;default:m=TS.interop.i18n.t("Star","templates_builders")();f=TS.interop.i18n.t("Unstar","templates_builders")();break}return{attributes:s,class_names:o,html_attrs:a,readable_type:c[e],type:e,is_starred:t.is_starred,star_str:m,unstar_str:f}}var n=Date.now()})();var V=n(2915);(function(){TS.registerModule("templates.helpers",{onStart:function e(){TS.templates.helpers.register()},register:function r(){Handlebars.registerHelper("debugger",function(){});Handlebars.registerHelper("i18n_ns",function(e){if(!_.isObject(this)){TS.warn('Cannot set i18n namespace "'+e+'". Chances are you\u2019ve inadvertently changed the context in a Handlebars partial to something that\u2019s not an object.');return}this._i18n_ns&&(this._i18n_ns_history?this._i18n_ns_history.push(this._i18n_ns):this._i18n_ns_history=[this._i18n_ns]);this._i18n_ns=e});Handlebars.registerHelper("_i18n_ns_end",function(){this._i18n_ns_history&&this._i18n_ns_history.length&&(this._i18n_ns=this._i18n_ns_history.pop())});Handlebars.registerHelper("i18n_img",function(e){var t=e.fn(this);var n=e&&e.hash&&e.hash.locales?e.hash.locales:null;if(n){n=n.replace(/\s/g,"");n.split(",").indexOf(TS.interop.i18n.locale)>-1&&(t=t.replace(/(\..+$)/,"."+TS.interop.i18n.locale+"$1"))}return t});Handlebars.registerHelper("t",function(e){var t;if("string"===typeof e){t=e;e=arguments[1]}else t=e.fn();var n;n=void 0!==e.hash.ns?e.hash.ns:void 0!==this._i18n_ns?this._i18n_ns:e.data.root&&e.data.root._i18n_ns?e.data.root._i18n_ns:"";var r=this;_.isObject(r)||(r={this:r});var i={};var a;_.forOwn(e.hash,function(e,t){i[t]=r[t];r[t]=Handlebars.Utils.escapeExpression(e)});var s=t.match(/{[^\s}]+}/g);if(s&&s.length){var o=function e(t){var n=t.split(".");if(n.length>1){var i=0;var a=n.length;var s=r;for(i;i<a;i+=1){s=s[n[i]];if(void 0===s)return}return s}return r[t]};var l;var u=0;var d=s.length;for(u;u<d;u+=1){a=s[u].slice(1,-1);if(void 0===e.hash[a]){l=o(a);if(void 0!==l){i[a]=r[a];r[a]=Handlebars.Utils.escapeExpression(l)}}}}if(e.hash.debug){TS.info("debug handlerbars t helper");TS.info(this)}r.__handlebars=true;t=TS.interop.i18n.t(t,n)(r);_.forOwn(i,function(e,t){r[t]=e});return t});Handlebars.registerHelper("zdLocale",function(){return TS.interop.i18n.zdLocale()});Handlebars.registerHelper("hcTrackingToken",function(){return TS.utility.getHCAttributionQS()});Handlebars.registerHelper("exampleEmail",function(e){return TS.utility.exampleEmailAddress(e)});Handlebars.registerHelper("convertTimestampToMilliseconds",function(e){return 1e3*e});Handlebars.registerHelper("i18n_number",function(e){return TS.interop.i18n.number(e)});Handlebars.registerHelper("listify",function(e,t){t.hash.map&&(e=_.map(e,t.hash.map));var n=_.get(t.hash,"conjunction");var r=_.get(t.hash,"strong");var i=_.get(t.hash,"no_escape");var a=TS.interop.i18n.listify(e,{conj:n,strong:r,noEscape:i});return new Handlebars.SafeString(a.join(""))});Handlebars.registerHelper("ifInArray",function(e,t,n){if(t.indexOf(e)>-1)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getDisplayNames",function(e){var t=e.map(function(e){var t=_.isString(e)?e:e.id;return TS.interop.members.getPrefCompliantMemberNameById(t,true,false)});return t});Handlebars.registerHelper("isClient",function(e){if("client"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChrome",function(e){if(TS.model.is_chrome_desktop||TS.model.is_chrome_mobile)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isFF",function(e){if(TS.model.is_FF)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isSafariDesktop",function(e){if(TS.model.is_safari_desktop)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWeb",function(e){if("web"===TS.boot_data.app||"space"===TS.boot_data.app||"calls"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isMac",function(e){if(TS.model.is_mac)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWin",function(e){if(TS.model.is_win)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isLin",function(e){if(TS.model.is_lin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isOurApp",function(e){if(TS.model.is_our_app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("needCrossWorkspaceLink",function(e,t){if(TS.model.is_our_app&&e&&(TS.enterprise.getChannelById(e.id)||TS.enterprise.getGroupById(e.id)||TS.interop.rules.channels.isFromAnotherTeam(e)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isCrossWorkspace",function(e,t){if(e&&(TS.enterprise.getChannelById(e.id)||TS.enterprise.getGroupById(e.id)||TS.interop.rules.channels.isFromAnotherTeam(e)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessOurApp",function(e){return Handlebars.helpers.isOurApp.call(this,{fn:e.inverse,inverse:e.fn,hash:e.hash})});Handlebars.registerHelper("feature",function(e){var t=e.hash.flag;if(1==TS.qs_args[t]||1==TS.boot_data[t])return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("pageNeedsEnterprise",function(e){if(TS.boot_data.page_needs_enterprise)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("sharedChannelsEnabled",function(e){if(TS.permissions.members.canRequestSharedChannel())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("canDisconnectSharedChannels",function(e){if(TS.permissions.members.canDisconnectSharedChannels())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChannelRequired",function(e,t){return TS.interop.rules.channels.isRequired(e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("isTeambot",function(e,t){return TS.interop.rules.members.isTeambot(e,TS.boot_data.feature_teambot)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("canPostInModelOb",function(e,t){return TS.permissions.members.canPostInModelOb(e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("experiment",function(e){var t=e.hash.name;var n=e.hash.group||"treatment";if(TS.interop.experiments.getGroupForUser(t)===n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("enterprisePOEmail",function(){if(TS.boot_data.page_needs_enterprise){var e=TS.redux.enterprise.getEnterprise().primary_owner.email;return e}return""});Handlebars.registerHelper("versioned_x_icon",function(){return cdn_url+"/52b9/img/enterprise/icon_times_in_circle.svg"});Handlebars.registerHelper("comments",function(e){return new Handlebars.SafeString(TS.templates.builders.buildComments(e))});Handlebars.registerHelper("comment_standalone",TS.templates.builders.buildCommentStandalone);Handlebars.registerHelper("star",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStar(e,t,n))});Handlebars.registerHelper("starWithTip",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStarWithTip(e,t,n))});Handlebars.registerHelper("isInlineFilePreviewExpanded",function(e){var n=e.hash.container_id;var r=e.hash.file_id;var i=360;var a=false;var s=t(r,i);a=s?TS.inline_imgs.shouldExpand(n,TS.model.inline_imgs[s]):TS.inline_file_previews.shouldExpand(n,r);if(a)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("shouldTruncateInlineFilePreview",function(e,t){"string"===typeof e&&(e=TS.files.getFileById(e));if(e&&TS.inline_file_previews.shouldTruncate(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("shouldNotTruncateInlineFilePreview",function(e,t){return Handlebars.helpers.shouldTruncateInlineFilePreview.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("isInlineFilePreviewTruncated",function(e,t,n){"string"===typeof t&&(t=TS.files.getFileById(t));if(t&&TS.inline_file_previews.isTruncated(e,t))return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("isInlineFilePreviewNotTruncated",function(e,t,n){return Handlebars.helpers.isInlineFilePreviewTruncated.call(this,e,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})});Handlebars.registerHelper("formatActionLink",function(e,t,n){if(!e)return"";var r="<"+e.url+"|"+e.title+">";var i=TS.format.formatWithOptions(r,t,{no_highlights:true,no_specials:true,enable_slack_action_links:true===n});return new Handlebars.SafeString(i)});Handlebars.registerHelper("ellipsize",function(e,t){TS.info("len"+t);return TS.utility.ellipsize(e,t)});Handlebars.registerHelper("stripWhitespace",function(e){return e.replace(/\s+/g,"")});Handlebars.registerHelper("cash",function(e){var t=e.hash.all_digits||false;var n=e.hash.currency_code||"USD";var r=parseInt(e.hash.value,10);return TS.interop.currency.formatCurrency(r,n,{displayTrailingZeroes:t})});Handlebars.registerHelper("possessive",function(e){return TS.interop.i18n.possessive(e)});Handlebars.registerHelper("fullPossessiveString",function(e){return TS.interop.i18n.fullPossessiveString(e)});Handlebars.registerHelper("possessiveForMemberById",function(e){var t=TS.interop.members.getMemberById(e);if(!t)return"";return Handlebars.helpers.possessiveForMember(t)});Handlebars.registerHelper("possessiveForMember",function(e){var t=TS.interop.members.getPrefCompliantMemberName(e);return TS.interop.i18n.possessive(t)});Handlebars.registerHelper("concatStr",function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).join("")});Handlebars.registerHelper("initialsSafe",function(e){var t=TS.interop.rules.teams.getTeamInitials(e,{limit:2});return new Handlebars.SafeString(t)});Handlebars.registerHelper("json",function(e){if("object"===("undefined"===typeof e?"undefined":s()(e))&&null!==e&&"json"===e.name)return JSON.stringify(this);return JSON.stringify(e)});Handlebars.registerHelper("prettyJson",function(e){if("object"===("undefined"===typeof e?"undefined":s()(e))&&null!==e&&"json"===e.name)return JSON.stringify(this,null,2);return JSON.stringify(e,null,2)});Handlebars.registerHelper("currentTeamName",function(){return _.escape(_.get(TS.model.team,"name",""))});Handlebars.registerHelper("currentTeamNameSafe",function(){return new Handlebars.SafeString(_.escape(_.get(TS.model.team,"name","")))});Handlebars.registerHelper("currentTeamHostSafe",function(){return new Handlebars.SafeString(window.location.hostname)});Handlebars.registerHelper("canUserCreateGroups",function(e){return TS.permissions.members.canCreateGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canCreateMpims",function(e){return TS.permissions.members.canCreateMpims()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromChannels",function(e){return TS.permissions.members.canKickFromChannels()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromGroups",function(e){return TS.permissions.members.canKickFromGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("shouldShowMemberEmail",function(e){return e.is_self||TS.prefs.getTeamPref("display_email_addresses")});Handlebars.registerHelper("isTeambot",function(e){return TS.interop.rules.members.isTeambot(e,TS.boot_data.feature_teambot)});Handlebars.registerHelper("isSlackbotOrTeambot",function(e){return TS.interop.rules.members.isSlackbotOrTeambot(e,TS.boot_data.feature_teambot)});Handlebars.registerHelper("teamUsesCustomizedCustomStatusPresets",function(e){return TS.prefs.getTeamPref("uses_customized_custom_status_presets")?e.fn(this):e.inverse(this)});Handlebars.registerHelper("numberWithMax",function(e,t){if(e>=t)return t-1+"+";return e});Handlebars.registerHelper("convertFilesize",function(e){return TS.interop.utility.convertFilesize(e)});Handlebars.registerHelper("roundToThree",function(e){return TS.utility.roundToThree(e)});Handlebars.registerHelper("toDate",function(e){return TS.interop.datetime.toDate(e)});Handlebars.registerHelper("toCalendarDate",function(e){return TS.interop.datetime.toCalendarDate(e)});Handlebars.registerHelper("toCalendarDateShort",function(e){var t={shortenMonth:true};return TS.interop.datetime.toCalendarDate(e,t)});Handlebars.registerHelper("toCalendarDateOrNamedDay",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e)});Handlebars.registerHelper("toCalendarDateIfYesterdayOrToday",function(e){return TS.interop.datetime.toCalendarDateIfYesterdayOrToday(e)});Handlebars.registerHelper("toCalendarDateOrNamedDayShort",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e,{shortenMonth:true})});Handlebars.registerHelper("dayDividerPretty",function(e){return TS.interop.datetime.formatDate(e,"{day_divider_pretty}")});Handlebars.registerHelper("toTime",function(e,t,n){e&&!_.isObject(e)||(e=window.moment().unix());return TS.interop.datetime.toTime(e,{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:false!==t,includeSeconds:true===n})});Handlebars.registerHelper("toTimeShort",function(e){if(TS.utility.date.do24hrTime())return TS.interop.datetime.toTime(e,{timeFormat:"HH:mm"});return TS.interop.datetime.toTime(e,{timeFormat:"h:mm"})});Handlebars.registerHelper("toTimeAgo",function(e){return TS.interop.datetime.toTimeAgo(e,{alwaysAgo:true})});Handlebars.registerHelper("toTimeAgoShort",function(e,t){t=!!_.isBoolean(t)&&t;var n=TS.interop.datetime.toTimeAgo(e,{compact:t,alwaysAgo:true});var r='<span class="relative_ts" data-ts="'+_.escape(e)+'" data-really-short="'+!!t+'">'+_.escape(n)+"</span>";return new Handlebars.SafeString(r)});Handlebars.registerHelper("toTimeDuration",function(e){return TS.interop.datetime.toTimeDuration(e)});Handlebars.registerHelper("msgTsTitle",function(e,t){var n;var r;var i=TS.model.unread_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInUnreadView(e.ts);var a=TS.model.threads_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInThreadsView(e.ts);var s=TS.client&&TS.ui.replies.activeConvoThreadTs()===e.thread_ts&&_.isString(t)&&TS.templates.makeMsgDomIdInConversation(e.ts)===t;i?r=TS.interop.i18n.t("Jump to conversation","templates_helpers")():a?r=e.ts===e.thread_ts?TS.interop.i18n.t("Open in channel","templates_helpers")():TS.interop.i18n.t("Open in sidebar","templates_helpers")():s&&e.ts===e.thread_ts&&(r=TS.interop.i18n.t("Open in channel","templates_helpers")());var o=TS.interop.i18n.t("{date} at {time}","templates_helpers")({date:TS.interop.datetime.toCalendarDateOrNamedDay(e.ts,{shortenMonth:true}),time:TS.interop.datetime.toTime(e.ts,{do24hrTime:TS.utility.date.do24hrTime(),includeSeconds:true})}).replace(/\s/g,"&nbsp;");n=r?r+'<br><span class="subtle_silver no_wrap">'+o+"</span>":o;return new Handlebars.SafeString(n)});Handlebars.registerHelper("toHour",function(e){return TS.interop.datetime.toHour(e)});Handlebars.registerHelper("memberLocalTime",function(e){var t=e&&e.tz?e.tz:"America/Los_Angeles";var n=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[e.tz]&&TS.boot_data.dst_offsets[e.tz].tz_offset?TS.boot_data.dst_offsets[e.tz].tz_offset:-25200;var r=TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:t,timeZoneOffset:n,do24hrTime:TS.utility.date.do24hrTime()});var i=TS.interop.i18n.t('<span class="timezone_value">{local_time}</span> local time',"date_utilities")({local_time:r});return new Handlebars.SafeString(i)});Handlebars.registerHelper("memberUTCOffset",function(e){return TS.utility.date.memberUTCOffset(e)});Handlebars.registerHelper("isInDifferentTimeZone",function(e,t){if(e.tz_offset!==TS.model.user.tz_offset)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isToday",function(e,t){if(TS.interop.datetime.isToday(TS.interop.datetime.toDateObject(e)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("toMonthYearFormat",function(e){return TS.interop.datetime.toCalendarDate(e,{excludeDay:true})});Handlebars.registerHelper("if_equal",function(t,n){n=e(n);if(t==n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_not_equal",function(t,n){n=e(n);if(t!=n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_gt",function(t,n){n=e(n);if(t>n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_lt",function(t,n){n=e(n);if(t<n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("or",function(t,n,r){r=e(r);if(t||n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("and",function(t,n,r){r=e(r);if(t&&n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("foreach",function(e,t){if(t.inverse&&!e.length)return t.inverse(this);return e.map(function(n,r){var i={index:r,value:n,length:e.length};i.first=0===r;i.last=r===e.length-1;return t.fn(i)}).join("")});Handlebars.registerHelper("repeat",function(e,t){var n="";for(var r=0;r<e;r+=1)n+=t.fn(r);return n});Handlebars.registerHelper("makeDayDividerDomId",function(e){return TS.templates.makeDayDividerDomId(e)});Handlebars.registerHelper("getFileShareMetaTextHtml",function(e){var t=TS.templates.builders.msgs.buildFileShareMetaText(e);return new Handlebars.SafeString(t)});Handlebars.registerHelper("formatFileTitle",function(e){return new Handlebars.SafeString(TS.templates.builders.formatFileTitle(e))});Handlebars.registerHelper("formatMessageByType",function(e,t,n,r,i){return new Handlebars.SafeString(TS.templates.builders.formatMessageByType(e,t,n,r,i))});Handlebars.registerHelper("formatAttachments",function(e,t,n,r){return new Handlebars.SafeString(TS.templates.builders.formatAttachments(e,t,n,r))});Handlebars.registerHelper("formatMessage",function(e,t){return new Handlebars.SafeString(TS.format.formatDefault(e,t))});Handlebars.registerHelper("formatNoHighlightsNoSpecials",function(e,t){return TS.format.formatNoHighlightsNoSpecials(e,t)});Handlebars.registerHelper("formatMessageAttachmentPartEscaped",TS.utility.attachments.formatMessageAttachmentPart);Handlebars.registerHelper("formatMessageAttachmentPart",function(e,t,n,r,i,a){return new Handlebars.SafeString(TS.utility.attachments.formatMessageAttachmentPart(e,t,n,r,i,a))});Handlebars.registerHelper("formatMessageAttachmentSlackFooter",function(e,t){var n;if(TS.boot_data.feature_grid_archive_link_fixes){if(!e.channel_name||!e.channel_id){n=TS.format.formatJustText(TS.format.cleanMsg(e.footer));return new Handlebars.SafeString(n)}n=TS.utility.attachments.getSlackMessageFooterText(e,t,true)}else n=TS.format.formatJustText(TS.format.cleanMsg(e.footer));return new Handlebars.SafeString(n)});Handlebars.registerHelper("getAttachmentPermalinkText",function(e,t){return new Handlebars.SafeString(TS.utility.attachments.getSlackMessageFooterPermalinkText(e,t))});Handlebars.registerHelper("formatTopicOrPurpose",function(e){return new Handlebars.SafeString(TS.utility.formatTopicOrPurpose(e))});Handlebars.registerHelper("unFormatMessage",function(e,t){return TS.format.unFormatMsg(e,t)});Handlebars.registerHelper("formatCurrentStatus",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,t))});Handlebars.registerHelper("formatCurrentStatusWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("rxnPanel",function(e){var t=TS.templates.builders.rxnPanel(e);if(!t)return"";return new Handlebars.SafeString(t)});Handlebars.registerHelper("makeRefererSafeLink",function(e){if("string"!==typeof e.hash.url)return"";return new Handlebars.SafeString(TS.utility.makeRefererSafeLink(e.hash.url))});Handlebars.registerHelper("makeSafeForDomId",TS.utility.makeSafeForDomId);Handlebars.registerHelper("makeMsgAttachmentTextExpanderDomId",TS.templates.makeMsgAttachmentTextExpanderDomId);Handlebars.registerHelper("makeMsgDomId",TS.templates.makeMsgDomId);Handlebars.registerHelper("makeMsgLabelDomId",TS.templates.makeMsgLabelDomId);Handlebars.registerHelper("makeMSRDomId",TS.templates.makeMSRDomId);Handlebars.registerHelper("makeMSRDomIdWithModule",TS.templates.makeMSRDomIdWithModule);Handlebars.registerHelper("makeMemberColorClass",function(){return TS.templates.builders.makeMemberColorClass.apply(this,arguments)});Handlebars.registerHelper("getAttachmentAuthorMemberId",function(e){var t=TS.utility.attachments.getDecoratedAttachment(e);if(!t)return"";return t._slack_author_id||""});Handlebars.registerHelper("newWindowName",TS.templates.builders.newWindowName);Handlebars.registerHelper("nl2br",function(e){if(!e)return e;e=_.escape(e);return e.replace(/\n/g,"<br />").replace(/&amp;#95;/g,"_")});Handlebars.registerHelper("smartnl2br",function(e){if(!e)return e;e=_.escape(e);e=e.replace(/\n\r\n\r/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\r\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(e.replace(/&amp;#95;/g,"_"))});Handlebars.registerHelper("truncate",function(e,t){var n=truncate(e,t);return n.replace(/&#64;/g,"@")});Handlebars.registerHelper("truncateToNearestWordBoundary",TS.utility.truncateToNearestWordBoundary);Handlebars.registerHelper("proxyImgUrls",function(e){var t=$("<div>"+e+"</div>");TS.templates.builders.proxyImgUrlsForEmails(t);return t.html()});Handlebars.registerHelper("stripImageTags",function(e){var t=$("<div>"+e+"</div>");var n=t.find("img").remove().end().html();return new Handlebars.SafeString(n)});Handlebars.registerHelper("generalName",function(){var e=TS.interop.channels.getGeneralChannel();return e?e.name:""});Handlebars.registerHelper("makeChannelDomId",function(e){return TS.templates.makeChannelDomId(e)});Handlebars.registerHelper("makeLinksFromModelObs",function(e){return new Handlebars.SafeString(TS.templates.builders.makeLinksFromModelObs(e,{new_lines:true,overflow_ellipsis:true}))});Handlebars.registerHelper("makeChannelDragData",function(e){return TS.templates.makeChannelDragData(e)});Handlebars.registerHelper("makeFileDragData",function(e){return TS.templates.makeFileDragData(e)});Handlebars.registerHelper("ChannelNameMaxLength",function(){return TS.model.channel_name_max_length});Handlebars.registerHelper("ChannelPurposeMaxLength",function(){return TS.model.channel_purpose_max_length});Handlebars.registerHelper("ChannelTopicMaxLength",function(){return TS.model.channel_topic_max_length});Handlebars.registerHelper("makeUnreadMsgsDomId",function(e){return TS.templates.makeUnreadMsgsDomId(e)});Handlebars.registerHelper("getCorGNameWithPrefixById",function(e,t){var n=TS.redux.channels.getEntityById(e);if(!n){var r="getCorGNameWithPrefixById: Could not find model ob for ID "+e;TS.warn(r);if(t)return;return e}if(n.is_group)return TS.model.group_prefix+n.name;if(n.is_channel)return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(n)+n.name);if(t)return;return e});Handlebars.registerHelper("makeChannelPrefix",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(e))});Handlebars.registerHelper("makeChannelLink",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeChannelLink(e,t))});Handlebars.registerHelper("makeModelObNameForDisplay",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(e,t))});Handlebars.registerHelper("makeChannelPath",TS.templates.builders.makeChannelPath);Handlebars.registerHelper("makeChannelLinkById",function(e){var t=TS.interop.channels.getPublicChannelById(e);if(t)return TS.templates.builders.makeChannelLink(t)});Handlebars.registerHelper("makeChannelLinkAriaLabelSafe",TS.templates.builders.makeChannelLinkAriaLabelSafe);Handlebars.registerHelper("makeUnreadHighlightDomId",function(e){return TS.templates.makeUnreadHighlightDomId(e)});Handlebars.registerHelper("makeChannelDomClass",function(e){var t="";TS.model.active_channel_id!=e.id||TS.client.activeChannelIsHidden()||(t+="active ");e.unread_cnt>0&&(t+="unread ");e.unread_highlight_cnt>0&&(t+="mention ");e.is_starred&&(t+="is_starred ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("makeChannelOrGroupLinkById",function(e,t){var n=TS.redux.channels.getEntityById(e);var r="";n.is_mpim?r=TS.templates.builders.makeMpimLink(n,false):n.is_group?r=TS.templates.builders.makeGroupLink(n,{omit_prefix:t}):n.is_channel&&(r=TS.templates.builders.makeChannelLink(n,{omit_prefix:t}));return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeChannelOrGroupSSBLinkById",function(e){var t=TS.redux.channels.getEntityById(e);if(!t)return;var n;var r="slack://channel?team="+TS.model.team.id+"&id="+e;if(t.is_mpim){n=_.escape(TS.mpims.legacyGetDisplayName(t));return"<a href="+r+">"+n+"</a>"}if(t.is_group||t.is_private){n=TS.model.group_prefix+t.name;return"<a href="+r+">"+n+"</a>"}if(t.is_channel){var i=TS.interop.channels.getPublicChannelById(e);n="#"+i.name;return"<a href="+r+">"+n+"</a>"}});Handlebars.registerHelper("isEnterpriseTeam",function(e){return TS.boot_data.page_needs_enterprise?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isLocalTeam",function(t,n){n=e(n);if(!TS.boot_data.page_needs_enterprise)return n.inverse(this);if(t==TS.model.team.id)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("currentEnterpriseName",function(){if(!TS.boot_data.page_needs_enterprise)return"";var e=TS.redux.enterprise.getEnterpriseOrgName();return e||""});Handlebars.registerHelper("getEnterpriseOrgURL",function(){if(!TS.boot_data.page_needs_enterprise)return"";return TS.interop.enterprise.getOrgURL()});Handlebars.registerHelper("isOnEnterpriseTeam",function(e){if(!TS.boot_data.page_needs_enterprise)return e.inverse(this);return TS.model.user.enterprise_user.teams.indexOf(e.hash.team_id)>-1?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isModelObPendingExtShared",function(e,t){if(TS.interop.rules.channels.isPendingExternallySharedChannel(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isModelObExtShared",function(e,t){if(TS.interop.utility.isModelObjectExternal(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isModelObSharedLocally",function(t,n){n=e(n);if(!TS.boot_data.page_needs_enterprise)return n.inverse(this);if(t.is_org_shared)return n.fn(this);if(t.shared_team_ids&&-1!==t.shared_team_ids.indexOf(TS.model.team.id))return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("shouldUseInitialsIcon",function(e,t,n){if(e&&e.icon&&(e.icon.image_default||t))return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("makeTeamlabel",function(e,t){var n=TS.templates.builders.makeTeamlabel(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeTeamNameList",function(e,t){t=t||{};t=t.hash||t;if(!e)return"";var n=_.map(e,function(e){return TS.teams.getTeamById(e)}).map(function(e){return TS.interop.rules.teams.isUnknown(e)?TS.templates.unknown_team({id:e.id,subtler:t.subtler}):_.escape(TS.interop.rules.teams.getTeamDisplayName(e))});var r=TS.interop.i18n.listify(n,v()({},t,{noEscape:true})).join("");if(r)return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeGroupDomId",function(e){return TS.templates.makeGroupDomId(e)});Handlebars.registerHelper("groupPrefix",function(){return new Handlebars.SafeString(TS.model.group_prefix)});Handlebars.registerHelper("makeGroupLink",function(e,t){t=t||{};t=t.hash||t;var n=TS.templates.builders.makeGroupLink(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeGroupLinkById",function(e){var t=TS.interop.channels.getGroupById(e);if(t)return TS.templates.builders.makeGroupLink(t)});Handlebars.registerHelper("makeGroupLinkAriaLabelSafe",TS.templates.builders.makeGroupLinkAriaLabelSafe);Handlebars.registerHelper("makeGroupDomClass",function(e){var t="";TS.model.active_group_id!=e.id||TS.client.activeChannelIsHidden()||(t+="active ");e.unread_cnt>0&&(t+="unread ");e.unread_highlight_cnt>0&&(t+="mention ");e.is_starred&&(t+="is_starred ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("mpimMemberCount",function(e){return TS.mpims.getMemberCount(e)});Handlebars.registerHelper("mpimDisplayName",function(e,t,n,r,i){t=true===t;i=true===i;var a=TS.mpims.legacyGetDisplayName(e,t,true===n,r,i);if(t||i)return new Handlebars.SafeString(a);return a});Handlebars.registerHelper("makeMpimDomClass",function(e){var t="";if(!e)return t;e.id!==TS.model.active_mpim_id||TS.client.activeChannelIsHidden()||(t+="active ");(e.unread_cnt>0||e.unread_highlight_cnt>0)&&(t+="unread mention ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");e.is_starred&&(t+="is_starred ");_.trim(e.last_msg_input)&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("makeMpimDomId",function(e){return TS.templates.makeMpimDomId(e)});Handlebars.registerHelper("makeMpimLink",function(e,t){var n=TS.templates.builders.makeMpimLink(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("mpimArchivesPath",function(e){return"/archives/"+e.id});Handlebars.registerHelper("isCorGMuted",function(e,t){if(TS.notifs.isCorGMuted(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("currentUserId",function(){return TS.model.user.id});Handlebars.registerHelper("makeMemberDomId",function(e){return TS.templates.makeMemberDomId(e)});Handlebars.registerHelper("makeChannelListDomId",function(e){return TS.templates.makeChannelListDomId(e)});Handlebars.registerHelper("makeMemberPresenceDomClass",function(e){return TS.templates.makeMemberPresenceDomClass(e.id)});Handlebars.registerHelper("makeMemberPresenceIcon",function(e){TS.client||TS.warn("Presence icons should not be used outside of the client application, because they rely on a WS connection to keep presence up to date. Rendering anyway, but be careful out there!");return new Handlebars.SafeString(TS.templates.makeMemberPresenceIcon(e))});Handlebars.registerHelper("makeMemberStatusDomClass",function(e){return TS.templates.makeMemberStatusDomClass(e.id)});Handlebars.registerHelper("makeMemberDomClass",function(e){var t="";if(!e)return t;var n=TS.redux.presence.getPresenceByMemberId(e.id);e.is_self||"away"!==n||(t+="away ");if(TS.model.active_im_id){var r=TS.interop.channels.getImById(TS.model.active_im_id);r.user!=e.id||TS.client.activeChannelIsHidden()||(t+="active ")}var i=TS.redux.channels.getImByMemberId(e.id);if(i){(i.unread_cnt>0||i.unread_highlight_cnt>0)&&(t+="unread mention ");i.is_starred&&(t+="is_starred ");_.trim(i.last_msg_input)&&(t+="show_in_list_even_though_no_unreads ")}return t});Handlebars.registerHelper("showDraftIcon",function(e,t){if(TS.templates.builders.legacyShowDraftIcon(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeMemberListDomClass",function(e){var t="member ";var n=TS.redux.presence.getPresenceByMemberId(e.id);"away"===n&&(t+="away ");return t});Handlebars.registerHelper("makeMemberPreviewLink",function(){var e=TS.templates.builders.makeMemberPreviewLink.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberPreviewLinkById",function(e,t){true!==t&&(t=false);var n=TS.redux.members.getPotentiallyUnknownMemberById(e);n&&!n.is_non_existent||(n=TS.interop.bots.getBotById(e));if(!n)return new Handlebars.SafeString(_.escape(e));return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(n,t))});Handlebars.registerHelper("makeMemberPreviewLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeMemberPreviewCardLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewCardLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeProfileImage",TS.templates.builders.makeProfileImage);Handlebars.registerHelper("makePendingUserImage",function(){return new Handlebars.SafeString(TS.templates.builders.makePendingUserImage.apply(this,arguments))});Handlebars.registerHelper("emojiGraphicReplace",function(e,t){var n={};t&&"string"===typeof t?n.force_style=t:n.obey_emoji_mode_pref=true;return new Handlebars.SafeString(TS.emoji.graphicReplace(e,n))});Handlebars.registerHelper("emojiGraphicReplaceByName",function(e){return TS.emoji.graphicReplace(":"+e+":")});Handlebars.registerHelper("emojiModePref",function(){return TS.interop.rules.emoji.getEmojiMode()});Handlebars.registerHelper("makeUsernameImage",function(e,t){var r;var i;var a;var s;var o;var l=TS.redux.bots.getBotByMsg(e);e.icons?o=e.icons:l&&l.icons?o=l.icons:e.bot_profile&&e.bot_profile.icons&&(o=e.bot_profile.icons);o&&(o.image_36&&!TS.environment.is_retina?r=o.image_36:o.image_72&&TS.environment.is_retina?r=o.image_72:o.image_48?r=o.image_48:o.emoji&&":"===o.emoji.substr(0,1)&&":"===o.emoji.substr(o.emoji.length-1,1)&&(a=o.emoji));var u={};var d=TS.templates.builders.makeBotLink(l,u);var c=e&&e.is_ephemeral&&"slackbot"===e.username?TS.interop.members.getMemberById("USLACKBOT"):null;switch(t){case 24:i="thumb_24";s=cdn_url+"/66f9/img/avatars/ava_0002-24.png";c&&(s=c.profile.image_24);break;case 32:i="thumb_32";s=cdn_url+"/0180/img/avatars/ava_0002-32.png";c&&(s=c.profile.image_32);break;case 36:i="thumb_36";s=cdn_url+"/66f9/img/avatars/ava_0002-48.png";c&&(s=c.profile.image_48);break;case 72:i="thumb_72";s=cdn_url+"/66f9/img/avatars/ava_0002-72.png";c&&(s=c.profile.image_72);break;case 192:i="thumb_192";s=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";c&&(s=c.profile.image_192);break;default:i="thumb_48";s=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";c&&(s=c.profile.image_48);break}var m;if(r)if(e.bot_profile&&TS.interop.bots.isBotExternal(e.bot_profile)){u.classes="member_image "+i;u.style="background-image:url('"+r+"')";u.external_badge=TS.templates.member_type_external_badge({team:TS.teams.getTeamById(e.bot_profile.team_id),size:t,badge_size:n(16),with_tooltip:true});d=TS.templates.builders.makeBotLink(l,u);m=""+d.start_a+d.end_a}else m=d.start_a+'<img style="border: 0" src="'+r+'" class="member_image '+i+'" />'+d.end_a;else if(a){var f;TS.boot_data.feature_sonic_emoji&&(f={emojiSize:TS.interop.emojiComponent.EmojiSizes.LARGE});m=d.start_a+'<div style="border: 0" class="member_image '+i+'">'+TS.emoji.graphicReplace(_.escape(a),f)+"</div>"+d.end_a}else m=c?d.start_a+'<img src="'+s+'" class="member_image '+i+'" />'+d.end_a:d.start_a+'<img src="'+s+'" class="member_image bot_icon_default '+i+'" />'+d.end_a;return new Handlebars.SafeString(m)});Handlebars.registerHelper("getMemberPreviewLinkImageArgs",function(e,t,n,r,i,a,o){var l;l="object"===("undefined"===typeof e?"undefined":s()(e))?e:TS.interop.members.getMemberById(e);if(!l||!l.profile)return"";n=true===n;r=true===r;i=true===i;a=true===a;o="string"===typeof o&&o;"USLACKBOT"===e&&o&&(l=TS.utility.slackbot.getWithFeels(o));var u;var d;var c;d="background-image: ";c=[];switch(t){case 20:u=TS.environment.is_retina?l.profile.image_48:l.profile.image_24;break;case 24:u=TS.environment.is_retina?l.profile.image_48:l.profile.image_24;break;case 32:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_32;break;case 36:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break;case 48:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break;case 56:u=TS.environment.is_retina?l.profile.image_192:l.profile.image_72;break;case 72:u=TS.environment.is_retina?l.profile.image_192:l.profile.image_72;break;case 192:u=TS.environment.is_retina&&l.profile.image_512||l.profile.image_192;break;case 512:u=TS.environment.is_retina?l.profile.image_1024||l.profile.image_512||l.profile.image_192:l.profile.image_512||l.profile.image_192;break;default:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break}c.push("url('"+u+"')");if(512===t){var _=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;c.push("url('"+_+"')")}d=n?c.length?c.join(", "):"":c.length?d+c.join(", "):"";var m={omit_link:r,omit_badge:i,lazy:n,member:l,size:t,include_restricted_overlay:!a||true,bg_img_style:d};return m});Handlebars.registerHelper("getGuestBadgeSize",function(e){var t;switch(e){case 24:t=10;break;case 32:case 36:case 48:t=16;break;case 72:t=24;break;case 192:t=48;break;case 512:t=96;break;default:t=16}return t});Handlebars.registerHelper("getTeamBadgeSize",n);Handlebars.registerHelper("getMemberNameById",function(e){var t=TS.interop.members.getMemberById(e);return t?t.name:e});Handlebars.registerHelper("getPrefCompliantMemberNameById",function(e){return TS.interop.members.getPrefCompliantMemberNameById(e)});Handlebars.registerHelper("getMemberNameNoModel",function(e,t){if(TS.boot_data.name_tagging_client)return e.display_name||e.real_name||t;return e.real_name||t});Handlebars.registerHelper("getMemberComponentPrimaryName",function(e,t){if(t){if("real_name"===t)return TS.interop.members.getMemberRealName(e);return TS.interop.members.getMemberMentionName(e)}return TS.interop.members.getPrefCompliantMemberName(e,false,false)});Handlebars.registerHelper("memberComponentHasSecondaryName",function(e,t,n){var r=false;e&&(r=t?"real_name"===t?!!TS.interop.members.getMemberProfileFieldDisplayName(e):!!TS.interop.members.getMemberRealName(e):!!TS.interop.members.getMemberSecondaryName(e));if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getMemberComponentSecondaryName",function(e,t){if(t){if("real_name"===t)return TS.interop.members.getMemberProfileFieldDisplayName(e);if("display_name"===t){if(TS.interop.members.getMemberProfileFieldDisplayName(e))return TS.interop.members.getMemberRealName(e);return""}}return TS.interop.members.getMemberSecondaryName(e)});Handlebars.registerHelper("getPrefCompliantMemberName",function(e,t,n){return TS.interop.members.getPrefCompliantMemberName(e,true===t,true===n)});Handlebars.registerHelper("getMemberAsContentsString",function(e){return TS.interop.texty.getMemberAsContentsString(e)});Handlebars.registerHelper("shouldShowMemberRestrictionBanner",function(t,n){n=e(n);_.isString(t)&&(t=TS.interop.members.getMemberById(t));if(!t)return n.inverse(this);var r=t.is_restricted||t.is_external;if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("shouldShowMemberActionBar",function(t,n){n=e(n);_.isString(t)&&(t=TS.interop.members.getMemberById(t));var r=t&&(!t.is_stranger||TS.redux.channels.getImByMemberId(t.id));if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getTeamNameByMember",function(e){if(!_.isObject(e))return null;var t=TS.teams.getTeamById(e.team_id);if(TS.interop.rules.teams.isUnknown(t))return new Handlebars.SafeString(TS.templates.unknown_team({id:t.id}));return TS.interop.rules.teams.getTeamDisplayName(t)});Handlebars.registerHelper("getTeamById",function(e){return TS.teams.getTeamById(e)});Handlebars.registerHelper("getTeamNameById",function(e){var t=TS.teams.getTeamById(e);if(TS.interop.rules.teams.isUnknown(t))return new Handlebars.SafeString(TS.templates.unknown_team({id:e}));return TS.interop.rules.teams.getTeamDisplayName(t)});Handlebars.registerHelper("getTeamDisplayName",function(e){if(TS.interop.rules.teams.isUnknown(e))return new Handlebars.SafeString(TS.templates.unknown_team({id:e.id}));return TS.interop.rules.teams.getTeamDisplayName(e)});Handlebars.registerHelper("getMemberPreviewLinkTarget",function(e){if(TS.utility.shouldLinksHaveTargets())return new Handlebars.SafeString('target="/team/'+e.id+'"');return""});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("getMemberSecondaryName",function(e){return TS.interop.members.getMemberSecondaryName(e)});Handlebars.registerHelper("memberHasSecondaryName",function(e,t){var n=false;e&&(n=!!TS.interop.members.getMemberSecondaryName(e));if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasSecondaryName",function(e,t){return Handlebars.helpers.memberHasSecondaryName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("memberHasProfileFieldDisplayName",function(e,t){var n=false;e&&(n=!!TS.interop.members.getMemberProfileFieldDisplayName(e));if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasProfileFieldDisplayName",function(e,t){return Handlebars.helpers.memberHasProfileFieldDisplayName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("memberHasDifferentDisplayAndFullName",function(e,t){var n=false;e&&(n=!!TS.interop.members.getMemberProfileFieldDisplayName(e)&&TS.interop.members.getMemberProfileFieldDisplayName(e)!==TS.interop.members.getMemberRealName(e));if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getMemberRealName",function(e){return TS.interop.members.getMemberRealName(e)});Handlebars.registerHelper("getMemberProfileFieldDisplayNameandRealNameInCorrectOrder",function(e){var t=_.escape(TS.interop.members.getPrefCompliantMemberName(e));var n;n=e.is_self?TS.interop.i18n.t("(you)","templates_helpers")():_.escape(TS.interop.members.getMemberSecondaryName(e));var r='<span class="member_real_name">'+t+"</span>";var i='<span class="member_preferred_name">'+n+"</span>";return new Handlebars.SafeString(r+i)});Handlebars.registerHelper("getMemberCurrentStatusEmoji",function(e,t){t=t||{};t=t.hash||t;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e&&e.id).emoji,_.assign({transform_missing_emoji:true,show_icon_for_emoji_in_as_text_mode:true},t))});Handlebars.registerHelper("getMemberCurrentStatusText",function(e){var t=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e&&e.id).text;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(t,{prevent_copy_paste:false})});Handlebars.registerHelper("getMemberCurrentStatusForDisplay",function(e){return new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e))});Handlebars.registerHelper("getMemberCurrentStatusForDisplayWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("getMemberCurrentStatusExpiration",function(e,t){t=t||{};t=t.hash||t;if(e&&!e.is_self)return"";return new Handlebars.SafeString(TS.templates.builders.buildMemberCustomStatusExpiration(e,t))});Handlebars.registerHelper("seesCurrentStatusInProfileView",function(t,n){n=e(n);if(t.profile.status_text||t.profile.status_emoji||"client"===TS.boot_data.app&&t.is_self)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getTeamCustomStatusPresets",function(){return TS.team.getTeamCustomStatusPresets()});Handlebars.registerHelper("getDisplayNameOfUserForIm",function(e){if(!e)return"MISSING_IM";return TS.ims.getDisplayNameOfUserForIm(e)});Handlebars.registerHelper("getIMIdByMemberId",function(e){var t=TS.redux.channels.getImByMemberId(e);return t?t.id:""});Handlebars.registerHelper("memberHasIm",function(e){var t=e.hash.member;var n=false;t&&TS.redux.channels.getImByMemberId(t.id)&&(n=true);if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberHasImUnreadCount",function(e){var t=e.hash.member;var n=false;if(t){var r=TS.redux.channels.getImByMemberId(t.id);r&&r.unread_cnt&&(n=true)}if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("getUnreadCountForIMByMemberId",function(e){var t=TS.redux.channels.getImByMemberId(e);if(t)return t.unread_cnt;return""});Handlebars.registerHelper("makeMemberLinksWithDisplayNames",function(e){if(!e)return"";var t=e.split(/\s*,\s*/).map(function(e){return TS.templates.builders.makeMemberPreviewLink(TS.interop.members.getMemberById(e))}).join(", ");return new Handlebars.SafeString(t)});function i(e){var t=TS.interop.members.getMemberById(e.user);if(!t){TS.warn("Missing member in makeIMLink: "+e.user);return TS.templates.search_im_link({im_exists:false,im_member_id:e.user,im_name:e.user,im_id:e.id,member_color:"unknown"})}var n={im_exists:!TS.interop.channels.isImWithDeletedMember(e),im_member_id:t.id,im_name:TS.ims.getDisplayNameOfUserForIm(e),im_id:e.id,member_color:"color_"+(t?t.id+" color_"+t.color:"unknown")};if(TS.utility.shouldLinksHaveTargets()){var r="/messages/"+e.id;TS.interop.channels.isImWithDeletedMember(e)&&(r=TS.templates.builders.newWindowName());n.target=r}return TS.templates.search_im_link(n)}Handlebars.registerHelper("makeIMLink",function(e){return new Handlebars.SafeString(i(e))});Handlebars.registerHelper("makeIMLinkById",function(e){var t=TS.interop.channels.getImById(e);if(t)return new Handlebars.SafeString(i(t))});Handlebars.registerHelper("getBotName",TS.templates.builders.getBotName);Handlebars.registerHelper("getBotNameWithLink",TS.templates.builders.getBotNameWithLink);function a(e){if(!e)return"color_unknown";return"color_bot_"+TS.utility.makeSafeForDomClass(e)}Handlebars.registerHelper("getBotColorClassByUserName",a);function o(e){var t=TS.interop.members.getMemberById(e);if(!t)return"color_unknown";return"color_"+t.id+" color_"+t.color}Handlebars.registerHelper("getMemberColorClassById",o);Handlebars.registerHelper("getMemberColorClassByImId",function(e){var t=TS.interop.channels.getImById(e);if(!t)return"color_unknown";return o(t.user)});Handlebars.registerHelper("makeMemberLinkAriaLabelSafe",TS.templates.builders.makeMemberLinkAriaLabelSafe);Handlebars.registerHelper("msgIsFromSelf",function(e){var t=e.hash.msg;var n=t.user;!n&&"file_comment"===t.subtype&&t.comment&&(n=t.comment.user);var r=TS.interop.members.getMemberById(n);if(!r)return e.inverse(this);if(r.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsSelf",function(e){var t=TS.interop.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsAdmin",function(e){var t=TS.interop.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsAdmin",function(e){if(TS.model.user.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsOwner",function(e){if(TS.model.user.is_owner)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsRA",function(e){if(TS.model.user.is_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsURA",function(e){if(TS.model.user.is_ultra_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("tinyspeck",function(e){if(TS.boot_data.feature_tinyspeck)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("makeUnshareLinkById",function(e){var t=TS.files.getFileById(TS.web.file.file_id);var n=TS.redux.channels.getEntityById(e);if(n)return TS.templates.builders.makeUnshareLink(n,t)});Handlebars.registerHelper("makeUnshareLink",function(e){var t=TS.files.getFileById(TS.web.file.file_id);return TS.templates.builders.makeUnshareLink(e,t)});Handlebars.registerHelper("makeFileDomId",function(e){return TS.templates.makeFileDomId(e)});Handlebars.registerHelper("makeFileCommentsDomId",function(e){return TS.templates.makeFileCommentsDomId(e)});Handlebars.registerHelper("makeFileContentsDomId",function(e){return TS.templates.makeFileContentsDomId(e)});Handlebars.registerHelper("makeFileCommentHelpHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileCommentHelpHTML(e))});Handlebars.registerHelper("makeFileHeader",function(e,t){var n=TS.files.getFileActions(e);n.file=e;n.is_post="space"===e.mode||"post"===e.mode;n.download="hosted"===e.mode;n.member=t;return TS.templates.file_header(n)});Handlebars.registerHelper("makeFilePreviewHeader",function(e,t){var n=TS.files.getFileActions(e);n.file=e;n.member=t;n.download="hosted"===e.mode;n.edit_link="post"===e.mode?e.edit_link:e.permalink;n.is_post="space"===e.mode||"post"===e.mode;n.is_snippet="snippet"===e.mode;n.preview=true;return new Handlebars.SafeString(TS.templates.file_header(n))});Handlebars.registerHelper("makeFileSize",function(e){return TS.interop.utility.convertFilesize(e.size)+" "+e.pretty_type});Handlebars.registerHelper("formatSpaceHtml",function(e){var t=$("<div>").html(e);TS.templates.builders.replaceEmojiForPosts(t[0]);TS.utility&&TS.utility.attachments&&TS.utility.attachments.unfurlPlaceholders(t);return new Handlebars.SafeString(t.html())});Handlebars.registerHelper("fileIsImage",function(e){var t=TS.files.getFileById(e.hash.id);if(!t)return e.inverse(this);if(t.mimetype&&0===t.mimetype.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("mimeTypeIsImage",function(e){if(e.hash.type&&0===e.hash.type.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("fileDefaultIsNewWindow",function(t){t=e(t);var n=TS.files.getFileById(t.hash.id);if(!n)return t.inverse(this);var r=n.mimetype&&0===n.mimetype.indexOf("image/")&&-1===n.mimetype.indexOf("svg");var i="pdf"===n.filetype;if(r||i)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileOpensOnTeamSite",function(t){t=e(t);if(!TS.boot_data.feature_file_threads)return t.fn(this);var n=TS.files.getFileById(t.hash.id);if(!n)return t.inverse(this);var r=n.mode;if("space"===r||"email"===r||"snippet"===r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileIconTypeDownload",function(){var t=Array.prototype.slice.call(arguments);var n=e(t.pop());var r=t[0];"string"===typeof r&&(r=TS.files.getFileById(r));if(!r)return n.inverse(this);var i="external"===r.mode;var a=r.mimetype&&0===r.mimetype.indexOf("image/")&&-1===r.mimetype.indexOf("svg");var s="pdf"===r.filetype;if(i||a||s)return n.inverse(this);return n.fn(this)});Handlebars.registerHelper("nonImageCanUseFSFV",function(e,t){if(TS.files.nonImageCanUseFSFV(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeFilePrivacyLabel",function(e){var t="";var n=e.is_public;var r=e.groups.length>0||e.ims.length>0;var i="email"===e.mode;var a="snippet"===e.mode;var s="post"!=e.mode&&"space"!=e.mode&&!i&&!a;"post"===e.mode||"space"===e.mode?t=n?TS.interop.i18n.t("Shared","templates_helpers")():r?TS.interop.i18n.t("Private","templates_helpers")():TS.interop.i18n.t("Draft","templates_helpers")():n&&i?t=TS.interop.i18n.t("Shared email","templates_helpers")():n&&a?t=TS.interop.i18n.t("Shared snippet","templates_helpers")():n&&s?t=TS.interop.i18n.t("Shared file","templates_helpers")():r&&i?t=TS.interop.i18n.t("Private email","templates_helpers")():r&&a?t=TS.interop.i18n.t("Private snippet","templates_helpers")():r&&s&&(t=TS.interop.i18n.t("Private file","templates_helpers")());return t});Handlebars.registerHelper("makeExternalFiletypeHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeExternalFiletypeHTML(e))});Handlebars.registerHelper("makeFileShareLabel",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileShareLabel(e))});Handlebars.registerHelper("isFileAuthorExternal",function(e){return TS.files.isFileAuthorExternal(e)});Handlebars.registerHelper("nl2brAndHighlightSearchMatches",function(e){if(!e)return;e=_.escape(e);e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("maybeGetIconForTeamProfileField",function(e){var t=["slack","apple","android","twitter","github","google","windows","youtube","skype","facebook","asana","linkedin","tumblr","instagram","soundcloud","flickr","pinterest","tripit","hangouts","viber","line"];e=e.toLowerCase();if(t.indexOf(e)>-1)return'<i class="ts_icon ts_icon_'+e+'"></i>'});Handlebars.registerHelper("getVisibleTeamProfileFieldsForMember",function(e,t){var n=TS.team.getVisibleTeamProfileFieldsForMember(e);return new Handlebars.SafeString(TS.templates.team_profile_fields({fields:n,lazy_load_profile_fields:t&&t.hash.lazy_load_profile_fields}))});Handlebars.registerHelper("isSkypeTeamProfileField",function(e,t){if("text"===e.type&&"skype"===e.label.toLocaleLowerCase())return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getSafeSkypeURLComponent",function(e){var t=e.match(/^[a-zA-Z][a-zA-Z0-9.,\-_@]{5,31}/);return t?t[0]:""});Handlebars.registerHelper("highlightSearchMatches",function(e){if(!e)return;e=_.escape(e);return TS.utility.msgs.handleSearchHighlights(e)});Handlebars.registerHelper("highlightSearchMatchesInSpacesHtml",function(e){if(!e)return;var t=Handlebars.helpers.formatSpaceHtml(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(t))});Handlebars.registerHelper("highlightSearchMatchesInFileTitle",function(e){if(!e)return;e=_.unescape(e);e=_.escape(e);e=TS.emoji.graphicReplace(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("makeUnreadMessagesDomId",function(e){return TS.templates.makeUnreadMessagesDomId(e)});Handlebars.registerHelper("makeUnreadGroupMessagesDomId",function(e){return TS.templates.makeUnreadGroupMessagesDomId(e)});Handlebars.registerHelper("makeUnreadDmsDomId",function(e){return TS.templates.makeUnreadDmsDomId(e)});Handlebars.registerHelper("makeSentMessagesDomId",function(e){return TS.templates.makeSentMessagesDomId(e)});Handlebars.registerHelper("makeSentGroupMessagesDomId",function(e){return TS.templates.makeSentGroupMessagesDomId(e)});Handlebars.registerHelper("makeSentDmsDomId",function(e){return TS.templates.makeSentDmsDomId(e)});Handlebars.registerHelper("makeIssueListDomId",function(e){return TS.templates.makeIssueListDomId(e)});Handlebars.registerHelper("math",function(e,t,n){if(arguments.length<4){n=t;t="+"}e=parseFloat(e);n=parseFloat(n);return{"+":e+n,"-":e-n,"*":e*n,"/":e/n,"%":e%n}[t]});Handlebars.registerHelper("loadingHTML",function(){return new Handlebars.SafeString(TS.templates.builders.loadingHTML())});Handlebars.registerHelper("versioned_loading_animation",function(){return cdn_url+"/9c217/img/loading.gif"});Handlebars.registerHelper("versioned_loading_hash_animation",function(){return cdn_url+"/9c217/img/loading_hash_animation_@2x.gif"});Handlebars.registerHelper("versioned_mac_dock_badge",function(){return cdn_url+"/9135/img/prefs_mac_dock_badge@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_clean",function(){return cdn_url+"/e5d8/img/prefs_messages_clean@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_compact",function(){return cdn_url+"/e5d8/img/prefs_messages_compact@2x.png"});Handlebars.registerHelper("versioned_services_box_32",function(){return cdn_url+"/7f1a0/plugins/box/assets/service_32.png"});Handlebars.registerHelper("versioned_services_gdrive_16",function(){return cdn_url+"/66f9/img/services/gdrive_16.png"});Handlebars.registerHelper("versioned_services_onedrive_32",function(){return cdn_url+"/7f1a0/plugins/onedrive/assets/service_32.png"});Handlebars.registerHelper("versioned_slackbot_48",function(){if(TS.boot_data.feature_new_slackbot_icons)return cdn_url+"/2ae2f/img/slackbot_avatar_48.png";return cdn_url+"/7f1a0/plugins/slackbot/assets/service_48.png"});Handlebars.registerHelper("versioned_slackbot_72",function(){if(TS.boot_data.feature_new_slackbot_icons)return cdn_url+"/2ae2f/img/slackbot_avatar_72.png";return cdn_url+"/0180/img/slackbot_72.png"});Handlebars.registerHelper("versioned_teambot_72",function(){return cdn_url+"/2ae2f/img/teambot_avatar_72.png"});Handlebars.registerHelper("versioned_twitter_64",function(){return cdn_url+"/66f9/img/services/twitter_64.png"});Handlebars.registerHelper("versioned_upload_file_icon",function(e){if("1x"===e)return cdn_url+"/a079/img/upload_file_icon.png";if("2x"===e)return cdn_url+"/a079/img/upload_file_icon@2x.png"});Handlebars.registerHelper("versioned_default_application_icon",function(){if(TS.boot_data.feature_vogue)return cdn_url+"/28fb8/img/apps/default_new_app_icon_vogue.png";return cdn_url+"/bfaba/img/apps/default_new_app_icon.png"});Handlebars.registerHelper("versioned_join_shared_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel.png";if("2x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel@2x.png"});Handlebars.registerHelper("versioned_tos_book_illustration",function(e){if("1x"===e)return cdn_url+"/ead48/img/signup/book_illustration.png";if("2x"===e)return cdn_url+"/ead48/img/signup/book_illustration@2x.png"});Handlebars.registerHelper("versioned_join_team_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel.png";if("2x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel@2x.png"});Handlebars.registerHelper("versioned_signin_no_teams",function(e){if("1x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams.png";if("2x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_coming_soon",function(e){if("1x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon.png";if("2x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon@2x.png"});Handlebars.registerHelper("versioned_slack_logo_240",function(){if(TS.boot_data.feature_vogue)return cdn_url+"/7371/img/slack_logo_240_vogue.png";return cdn_url+"/16749/marketing/img/slack_logo@2x.png"});Handlebars.registerHelper("versioned_file_drop_blue",function(){return cdn_url+"/c3881/img/file-drop-blue@2x.png"});Handlebars.registerHelper("versioned_ill_team",function(e){if("1x"===e)return cdn_url+"/436da/img/quick_promo/ill_team.png";if("2x"===e)return cdn_url+"/436da/img/quick_promo/ill_team@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_upsell_banner_image",function(){return cdn_url+"/436da/img/enterprise/ent_basic_analytics_upsell_banner_image.gif"});Handlebars.registerHelper("pinToLabel",function(e){var t="";e.is_channel&&(t+="#");e.is_im||e.is_mpim?t+=TS.interop.i18n.t("this conversation","pins")():t+=_.escape(e.name);return new Handlebars.SafeString(t)});Handlebars.registerHelper("preventWidow",function(e){var t=e.split(" ");if(t.length>1){t[t.length-2]+="&nbsp;"+t[t.length-1];t.pop();e=t.join(" ")}return new Handlebars.SafeString(e)});Handlebars.registerHelper("number",function(e){return TS.interop.i18n.number(e)||""});Handlebars.registerHelper("buildReplyBarHTML",function(e,t){return new Handlebars.SafeString(TS.templates.builders.buildReplyBarHTML(e,t))});Handlebars.registerHelper("atLabel",function(e){return TS.templates.builders.atLabel(e)});Handlebars.registerHelper("renderAttachmentActions",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildAttachmentActions(e,t,n))});Handlebars.registerHelper("renderAttachmentActionSelectOption",function(e,t){var n=_.merge({},e,{is_group_item:t.hash.is_group_item});var r=TS.templates.attachment_actions_select_option(n);return new Handlebars.SafeString(r)});Handlebars.registerHelper("renderAttachmentMedia",function(e,t){var n;var r=TS.utility.attachments.getMediaType(e);var i;switch(r){case"other":e.other_html&&(n=TS.templates.builders.buildInlineOtherDiv(e.other_html,t,e.safe_other_html));break;case"video":if(e.video_html&&e.thumb_url){i=e.from_url||e.thumb_url;n=TS.templates.builders.buildInlineVideoDiv(i,t)}break;case"image":if(e.image_url){i=e.from_url||e.image_url;var a={};a.flush_with_attachment=true;a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;n=TS.templates.builders.buildInlineImgDiv(i,t,a)}break;case"audio":e.audio_html?n=TS.templates.builders.buildInlineAudioDiv(e.audio_html,t,e.safe_audio_html):e.audio_url&&(n=TS.templates.builders.formatSoundUrl(e));break;default:break}if(n)return new Handlebars.SafeString(n)});Handlebars.registerHelper("renderAttachmentFile",function(e){var t=TS.files.getFileTemplateArguments(e);var n="";if(TS.interop.files.isTombstone(e))n=TS.templates.file_tombstone();else if(TS.interop.files.fileIsImage(e))n=TS.templates.file_image(v()({},t,{file:e}));else{var r=v()({},e,{thumb_pdf:void 0,thumb_480:void 0,has_rich_preview:void 0,filetype:"space"===e.filetype?"post":e.filetype});n=TS.templates.file_generic(v()({},t,{file:r,attachment_file:true,file_is_video:void 0,file_is_audio:void 0,action:TS.interop.files.getMainAction(e,TS.boot_data.feature_file_threads)}))}return new Handlebars.SafeString(n)});Handlebars.registerHelper("getFileMetaText",function(e){if(!TS.boot_data.feature_file_threads_dark_launch)return"";var t=TS.interop.rules.files.getFileType(e);var n="image"===t||"snippet"===t;var r=e.pretty_type||TS.interop.i18n.t("file","files");var i=new Handlebars.SafeString(TS.templates.builders.formatFileTitle(e))||e.name||TS.interop.i18n.t("Untitled","files");return n?i:r});Handlebars.registerHelper("shouldIncludeUploaderName",function(e,t,n){var r=e&&t&&e.user!==t.user&&e.bot_id!==t.bot_id;if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getMemberTypeClass",TS.templates.builders.getMemberTypeClass);Handlebars.registerHelper("inlineSaver",function(e){var t=TS.templates.inline_saver({hide_text:e.hash.hide_text,target:e.hash.target});return new Handlebars.SafeString(t)});Handlebars.registerHelper("dangerouslyRenderHTML",function(e){return new Handlebars.SafeString(e)});Handlebars.registerHelper("attachmentMediaCaret",function(e,t){var n="";var r=TS.utility.attachments.getMediaType(e);var i;switch(r){case"video":i=e.from_url||e.thumb_url;n=TS.templates.builders.buildInlineVideoToggler(i,t,true);break;case"audio":i=e.audio_html||e.audio_url;n=TS.templates.builders.buildInlineAudioToggler(i,t);break;case"other":n=TS.templates.builders.buildInlineOtherToggler(e.other_html,t);break;case"image":i=e.from_url||e.image_url;var a={};a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;n=TS.templates.builders.buildInlineImgToggler(i,t,false,a);break;default:n=TS.templates.builders.buildInlineAttachmentToggler(e.from_url,t);break}n&&(n='<span class="media_caret">'+n+"</span>");return new Handlebars.SafeString(n)});Handlebars.registerHelper("isMsgReply",function(e){var t=e.hash.msg;var n=TS.interop.messages.isReply(t);if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("buildMsgHTMLForThreadsView",function(e,t,n,r){var i=TS.templates.builders.buildThreadMsgHTML(e,t,n,r);return new Handlebars.SafeString(i)});Handlebars.registerHelper("buildThreadParticipantListHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.buildThreadParticipantListHTML(e))});Handlebars.registerHelper("getTeamIconOfSize",function(e,t){if(e&&e.icon)return e.icon["image_"+t];return null});Handlebars.registerHelper("listItemCount",function(e){if(_.isUndefined(e)){TS.error("The template helper listItemCount failed because it was passed undefined");return 0}e=TS.utility.parseJSONOrElse(e,e);if(_.isString(e)&&e.length)return e.split(",").length;return e.length});Handlebars.registerHelper("objectKeyCount",function(e){return _.isObject(e)?_.keys(e).length:0});Handlebars.registerHelper("getIconSizeToFit",function(e){return TS.interop.utility.getIconSizeToFit(e,[230,132,102,88,68,44,34])});Handlebars.registerHelper("prefsNotificationExampleAll",function(){var e=TS.interop.rules.teams.getTeamDisplayName(TS.model.team);TS.model.is_mac||(e=TS.interop.i18n.t("from {team_name}","prefs")({team_name:e}));var t=TS.templates.prefs_notification_example({name:e,text:TS.interop.i18n.t("Good morning everyone!","prefs")()});return new Handlebars.SafeString(t)});Handlebars.registerHelper("prefsNotificationExampleMentions",function(){var e=TS.interop.rules.teams.getTeamDisplayName(TS.model.team);TS.model.is_mac||(e=TS.interop.i18n.t("from {team_name}","prefs")({team_name:e}));var t=":wave:";var n=TS.emoji.getChosenSkinTone();n&&(t+=":"+n+":");var r=TS.emoji.graphicReplace(t);var i=TS.templates.prefs_notification_example({name:e,text:new Handlebars.SafeString(TS.interop.i18n.t("{wave_emoji} Hi <strong>@{username}</strong>","prefs")({wave_emoji:TS.interop.i18n.safeString(r),username:TS.interop.i18n.safeString(TS.interop.members.getPrefCompliantMemberName(TS.model.user,true))}))});return new Handlebars.SafeString(i)});Handlebars.registerHelper("prefsNotificationSettingReadable",function(e){if(!e.desktop&&!e.mobile)return"";var t="";var n=TS.boot_data.feature_turn_mpdm_notifs_on?"mentions_dms":"mentions";if(e.desktop===e.mobile)"everything"===e.desktop?t+=TS.interop.i18n.t("<strong>Desktop and Mobile:</strong> All new messages","prefs")():e.desktop===n?t+=TS.interop.i18n.t("<strong>Desktop and Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")():t+=TS.interop.i18n.t("<strong>Desktop and Mobile:</strong> Nothing","prefs")();else{e.desktop&&("everything"===e.desktop?t+=TS.interop.i18n.t("<strong>Desktop:</strong> All new messages","prefs")():e.desktop===n?t+=TS.interop.i18n.t("<strong>Desktop:</strong> Direct messages, mentions &amp; keywords","prefs")():t+=TS.interop.i18n.t("<strong>Desktop:</strong> Nothing","prefs")());e.desktop&&e.mobile&&(t+="<br>");e.mobile&&("everything"===e.mobile?t+=TS.interop.i18n.t("<strong>Mobile:</strong> All new messages","prefs")():e.mobile===n?t+=TS.interop.i18n.t("<strong>Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")():t+=TS.interop.i18n.t("<strong>Mobile:</strong> Nothing","prefs")())}return new Handlebars.SafeString(t)});Handlebars.registerHelper("teamRetentionDuration",function(){return TS.prefs.getTeamPref("retention_duration")});Handlebars.registerHelper("teamRetentionType",function(){return TS.prefs.getTeamPref("retention_type")});Handlebars.registerHelper("formatWorkspaceDiscoverability",function(e){return TS.utility.enterprise.getWorkspaceVisibilityLabel(e)});Handlebars.registerHelper("escape",function(e){return _.escape(e)});Handlebars.registerHelper("crossWorkspaceJumperLink",function(e){if(TS.boot_data.feature_legacy_flannel_xws){if(!e||!e.id)return"";var t=TS.interop.rules.channels.teamIdForChannelFromAnotherTeam(TS.redux.getState(),e);var n=TS.teams.getTeamById(t);return TS.utility.enterprise.buildTeamUrl(_.get(n,"domain"))+"messages/"+e.id}if(!e||!e.id||!e.team_id)return"";var r=TS.teams.getTeamById(e.team_id);return TS.utility.enterprise.buildTeamUrl(_.get(r,"domain"))+"messages/"+e.id});Handlebars.registerHelper("getTeamIdForChannelFromAnotherTeam",function(e){if(!e)return"";if(!TS.boot_data.feature_legacy_flannel_xws)return e.team_id;return TS.interop.rules.channels.teamIdForChannelFromAnotherTeam(TS.redux.getState(),e)});Handlebars.registerHelper("pinnedItemFileMessage",function(e){if(!e)return"";if(!TS.interop.messages.shouldRenderFileThread(e))return"";var t=_.first(e.files);if(!t)return"";var n=_.isString(t)?TS.files.getFileById(t):t;if(!n)return"";var r=TS.templates.builders.formatFileTitle(n);var i=TS.interop.i18n.safeString('<a class="file_preview_link" data-file-id="'+n.id+'" href="'+n.permalink+'">'+r+"</a>");var a="";a=e.upload?TS.interop.i18n.t("Uploaded a file: {name}","pinned_item")({name:i}):TS.interop.i18n.t("Shared a file: {name}","pinned_item")({name:i});var s=["greigh"];e.text&&s.push("very_small_top_margin");return new Handlebars.SafeString('<div class="'+s.join(" ")+'">'+a+"</div>")})},test:function n(){return{_optionsFnInverseBooleanHelper:e,_inlineImgSrcForFile:t}}});var e=function e(t){"function"!==typeof t.fn&&(t.fn=function(){return true});"function"!==typeof t.inverse&&(t.inverse=function(){return false});return t};var t=function e(t,n){"string"===typeof t&&(t=TS.files.getFileById(t));if(!t)return false;if(!TS.files.fileIsImage(t))return false;n||(n=480);return TS.files.getThumbSrcForFile(t,{maxSize:n})};var n=function e(t){var n;switch(t){case 32:case 36:case 48:n=16;break;case 72:n=22;break;case 192:case 512:break;default:n=16}return n}})();var Y=n(2916);var J=n(3275);var Q=n(2917);var X=n(1988);var Z=n(2918);var ee=n(2919);var te=n(2920);var ne=n(67);var re=n.n(ne);(function(){TS.registerModule("menu.channel",{onStart:function e(){},channel:null,startWithChannel:function t(n,r){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;TS.model.menu_is_showing||(e=void 0);TS.menu.buildIfNeeded();TS.menu.clean();var i=false;TS.menu.channel.channel=TS.interop.channels.getPublicChannelById(r,i)||TS.interop.channels.getMpimById(r,i);var a=TS.menu.channel.channel;TS.menu.$menu_header.addClass("hidden").empty();var s={channel:a,user:TS.model.user};TS.notifs.isCorGMuted(a.id)&&(s.channel_is_muted=true);TS.permissions.channels.canSeeDataRetentionChannelOption(a)&&(s.show_message_retention=true);if(a.is_mpim){s.show_mpim_create=TS.permissions.members.canCreateMpims();s.show_mpim_convert=TS.permissions.members.canCreateGroups()&&!TS.interop.rules.channels.isExternallySharedChannel(a);s.show_export_history=TS.permissions.members.canExportMessageHistory(TS.menu.channel.channel)}else{s.can_delete_channel=TS.model.user.is_admin&&TS.interop.rules.channels.isPublicChannel(a)&&!TS.interop.rules.channels.isRequired(a);TS.interop.rules.channels.isRequired(a)&&!TS.permissions.members.canPostInChannel(a)||0===a.purpose.last_set&&!TS.model.user.is_ultra_restricted&&a.is_member&&(s.show_purpose_item=true);!a.is_member||TS.interop.rules.channels.isRequired(a)&&!TS.permissions.members.canPostInChannel(a)||(s.show_advanced_item=true);if(TS.boot_data.page_needs_enterprise){var o=TS.permissions.members.canCreateConvertOrgSharedChannels();s.show_advanced_item&&!o&&TS.interop.rules.channels.isOrgShared(a)&&(s.show_advanced_item=false);TS.interop.rules.channels.isOrgShared(a)&&(s.is_not_allowed_integrations=true)}s.is_moved=a.is_moved}TS.apps.permissions.areXoxaAppsInstalled()&&(s.show_add_apps=true);TS.menu.$menu_items.html(TS.templates.menu_channel_items(s));TS.menu.$menu_header.bind("click.menu",TS.menu.channel.onChannelHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.channel.onChannelItemClick);TS.menu.start(n);TS.menu.$menu.attr("data-qa","channel_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();var l="#channel_name";var u="#channel_actions_toggle";e||(e=$(n.target).closest(l).length);var d=e?$(l):$(u);var c=d.height();var _=e?c+6:c;var m=18;var f=e?m:6;TS.menu.positionAt(d,f,_)},onChannelHeaderClick:function e(t){t.preventDefault()},onChannelItemClick:function e(t){var n=$(this).attr("id");var r=TS.menu.channel.channel;if($(this).hasClass("disabled")){TS.menu.channel.end();return}if("channel_join_item"===n){t.preventDefault();TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==TS.menu.channel.channel.id?TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:TS.menu.channel.channel.id})).catch(_.noop):TS.channels.legacyDisplayChannel({id:TS.menu.channel.channel.id})}else if("channel_details_item"===n){t.preventDefault();TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name?$("#details_tab").highlight(null,"channel_page_details_highlighter"):TS.client.ui.flex.openFlexTab("details")}else if("channel_display_item"===n){t.preventDefault();TS.channels.legacyDisplayChannel({id:TS.menu.channel.channel.id})}else if("channel_close_archived_item"===n){t.preventDefault();TS.shared.legacyCloseArchivedChannel(TS.menu.channel.channel.id)}else if("channel_leave_item"===n){t.preventDefault();TS.channels.leave(TS.menu.channel.channel.id)}else if("channel_email_item"===n);else if("channel_retention_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"retention")}else if("channel_advanced_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id)}else if("channel_convert_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"manage_teams")}else if("channel_delete_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"delete")}else if("channel_unarchive_item"===n){t.preventDefault();var i=function e(t,n){if(t)return;var r;r="restricted_action"===n.error?TS.interop.i18n.t("<p>You don\u2019t have permission to un-archive channels.</p><p>Talk to your Workspace Owner.</p>","channel_menu")():TS.interop.i18n.t("Un-archiving failed with error","channel_menu")()+' "'+n.error+'"';setTimeout(TS.generic_dialog.alert,100,r)};TS.interop.api.call("conversations.unarchive",{channel:TS.menu.channel.channel.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})}else if("channel_archives_item"===n);else{if("channel_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);return}if("channel_mute_item"===n){t.preventDefault();TS.notifs.muteOrUnmuteCorG(r.id)}else if("channel_invite_item"===n){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.channel.channel.id)}else if("channel_notification_prefs"===n){t.preventDefault();TS.ui.channel_prefs_dialog.start(r.id)}else if("channel_add_service_item"===n);else if("channel_mpim_message_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(r.id,"retention")}else if("channel_mpim_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(r.id,"export")}else if("channel_create_mpim_item"===n){t.preventDefault();setTimeout(function(){TS.ui.im_browser.startWithMpim(r)},1)}else if("convert_to_private_channel"===n){t.preventDefault();var a=TS.shared.legacyGetActiveModelOb();TS.ui.mpim_conversion_modal.startMpimConversionModal(a)}else{if("channel_add_apps_item"!==n){TS.warn("not sure what to do with clicked element id:"+n);return}t.preventDefault();var s="CHANNEL_SETTINGS";var o={action:"CLICK",ui_element:"BTN_ADD_APPS"};TS.interop.clog.track(s,{contexts:{ui_context:o}});TS.ui.apps_browser.startAddApps(s,o)}}TS.menu.channel.end()},startWithChannelPickerForChange:function e(t,r){if(TS.menu.isRedundantClick(t))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.interop.members.getMemberById(r);var a=_.partition(TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()).filter(function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)}),TS.interop.rules.channels.isPublicChannel);var s={user_id:r,channels:a[0],groups:a[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(s));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(s)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickChangeChannel);TS.menu.start(t);var o=$(t.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(o,16-o.offset().left,0):TS.menu.positionAt(o,-TS.menu.$menu.width()+o.outerWidth(),o.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});n(r);TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickChangeChannel:function e(){var t=$(this).data("user-id");var n=$(this).data("channel-id");var r=$(this).data("group-id");n?TS.interop.api.call("users.admin.changeURAChannel",{user:t,channel:n}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}}):r&&TS.interop.api.call("users.admin.changeURAChannel",{user:t,channel:r}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}});TS.menu.channel.end()},startWithChannelPickerForInvite:function e(t,r){if(TS.menu.isRedundantClick(t))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.interop.members.getMemberById(r);var a=_.partition(TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()).filter(function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)}),TS.interop.rules.channels.isPublicChannel);var s={user_id:r,channels:a[0],groups:a[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(s));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(s)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickInviteChannel);TS.menu.start(t);var o=$(t.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(o,16-o.offset().left,0):TS.menu.positionAt(o,10-o.width(),o.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});n(r);TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickInviteChannel:function e(){var t=$(this).data("user-id");var n=$(this).data("channel-id");var r=$(this).data("group-id");var i=n||r;i&&TS.interop.api.call("conversations.invite",{users:t,channel:i}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;n&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(s,t,i,a):r&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}},function(e){var t=e.data,i=e.args,a=e.request_id;var s=false;n&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(s,t,i,a):r&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}});TS.menu.channel.end()},end:function e(){TS.menu.channel.channel=null;TS.menu.end()}});var e;var t;var n=function e(n){var i=TS.menu.$menu.find(".no_matches");var a=TS.menu.$menu.find(".icon_close");var s=TS.menu.$menu.find(".menu_filter");a.click(function(){s.val("").trigger("input");s.focus()});s.on("input",function(){var e=$(this).val();t&&t.cancel();t=r(n,e).then(function(t){var r=t.channels,s=t.groups;var o=!!(r.length||s.length);a.removeClass("hidden");var l={user_id:n,channels:r,groups:s};TS.menu.$menu_items.html(TS.templates.menu_channel_picker(l));if(o)i.addClass("hidden");else{i.find(".query").text(e);i.removeClass("hidden")}TS.ui.utility.updateClosestMonkeyScroller(TS.menu.$menu.find("#menu_items_scroller"),true)});TS.kb_nav.clearHighlightedItem();a.toggleClass("hidden",!e)});s.focus()};var r=function e(t,n){var r=TS.interop.members.getMemberById(t);var i={prefer_exact_match:false,frecency:false,allow_empty_query:true,prefer_channels_user_belongs_to:false};var a={channels:{include_archived:false},groups:{include_archived:false},sort:false};return TS.searcher.search(n,a).then(function(e){var t=_(TS.sorter.search(n,e,i)).filter(function(e){return!(r&&r.channels&&(r.channels[e.id]||r.groups[e.id]))}).partition(TS.interop.rules.channels.isPublicChannel).value(),a=re()(t,2),s=a[0],o=a[1];return{groups:o,channels:s}})}})();var ie=n(2921);var ae=n(2922);var se=n(2923);(function(){TS.registerModule("cmd_handlers",{server_cmds:null,onStart:function t(){var n=true;o=TS.utility.throttleFunc(o,3e3,n);TS.prefs.team_allow_calls_changed_sig.add(l);if(!_.get(window,"desktop.app.toggleDevTools")){delete TS.cmd_handlers["/slackdevtools"];delete TS.cmd_handlers["/slackgpuinfo"];delete TS.cmd_handlers["/slackmediainfo"];delete TS.cmd_handlers["/slackaccessibility"]}_.get(window,"desktop.stats.downloadCookies")||delete TS.cmd_handlers["/slackcookies"];_.get(window,"desktop.app.openTaskManager")||delete TS.cmd_handlers["/slacktaskmanager"];_.get(window,"desktop.stats.restartWithNetlog")||delete TS.cmd_handlers["/slacknetlog"];TS.client&&TS.client.traces.canTrace()||delete TS.cmd_handlers["/slacktrace"];if(!TS.boot_data.feature_degraded_send){delete TS.cmd_handlers["/debugdegrade"];delete TS.cmd_handlers["/debugrecover"]}TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&e.push("/"+TS.interop.i18n.t("active","cmd_handlers")());var r=TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts);r||delete TS.cmd_handlers["/redox"];TS.boot_data.feature_modernize_slash_cmds&&TS.redux.dispatch(TS.interop.slashCommand.loadSlashCommands())},test:function e(){return{_maybeInviteUserToModelOb:p,_maybeInviteUserGroupToModelOb:h,_getUserIdentifier:g}},groupCmdsByType:function e(t){var n=[u(t),d(t),f(t)];var r=Array.prototype.concat.apply([],n);var i=r.filter(function(e){return e.cmds.length>0});return i},getAvailableUserCmds:function e(t){var n={};var r=TS.shared.legacyGetActiveModelOb();t=t||{};_.forOwn(TS.cmd_handlers,function(e,i){if(0!==i.indexOf("/"))return;if("function"===typeof e.autocomplete&&!e.autocomplete()||false===e.autocomplete||e.alias_of)return;if(t.in_thread&&!TS.cmd_handlers.isCmdSupportedInThreads(i))return;switch(i){case"/archive":if(!TS.permissions.channels.canSeeArchiveChannelOption(r))return;break;case"/unarchive":if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",false)&&TS.interop.rules.channels.isOrgDefaultChannel(r))return;if(TS.interop.rules.channels.isRequired(r))return;if(r.is_im)return;if(r.is_mpim)return;if((r.is_group||r.is_private)&&TS.model.user.is_restricted)return;if(r.is_channel&&!TS.permissions.members.canArchiveChannels())return;if(TS.interop.rules.channels.isExternallySharedChannel(r))return;break;case"/kick":case"/remove":if(!TS.interop.rules.user.canKickFromChannel(r.id))return;break;case"/join":if(TS.model.user.is_restricted)return;break;case"/feed":if(TS.model.user.is_restricted)return;break;case"/invite":if(TS.model.user.is_ultra_restricted)return;break;case"/invite_people":if(!TS.ui.admin_invites.canInvite())return;break;case"/topic":case"/purpose":if(r.is_im)return;if(r.is_mpim)return;if(TS.model.user.is_restricted)return;if(TS.interop.rules.channels.isRequired(r)&&!TS.permissions.members.canPostInChannel(r))return;break;case"/leave":if(r.is_group||r.is_private)return;break;case"/rename":if(!TS.permissions.channels.canSeeRenameChannelOption(r))return;break;default:break}if(("custom"===e.type||"service"===e.type)&&TS.prefs.commands_only_regular&&TS.model.user.is_restricted)return;n[i]=e});return n},parseArgs:function e(t){var n=t;t=TS.interop.texty.convertContentsStringForSlashCommands(t);var r={cmd:"",rest:"",words:[]};if(!_.isString(t))return r;var i=t.trim();if(!i)return r;r.words=i.split(/\s+/);r.cmd=r.words[0].toLowerCase().replace(/\u2019/g,"'");r.disp=r.words[0];r.rest=i.substring(r.cmd.length).trim();r.original_txt=n;return r},setUpCmds:function e(){if(TS.boot_data.feature_modernize_slash_cmds)return;if(!TS.boot_data.page_needs_custom_cmds){l();return Promise.resolve()}i();if(s()){var t=TS.storage.fetchCmds();TS.model.did_we_load_with_cmd_cache=true;TS.cmd_handlers.mergeInServerCmds(t.data);l();TS.apps.permissions.areXoxaAppsInstalled()&&m(t.data);return Promise.resolve()}var n=true;return TS.interop.api.call("commands.list",{},null,n).then(function(e){if(!e.data.commands)return;a(e.data.commands,e.data.cache_ts)}).catch(_.noop)},removeCommand:function e(t,n){delete TS.cmd_handlers.server_cmds[t];a(TS.cmd_handlers.server_cmds,n)},updateCommand:function e(t,n){TS.cmd_handlers.server_cmds[t.name]=t;a(TS.cmd_handlers.server_cmds,n)},resetUpCmds:function e(){TS.storage.storeCmds("");o()},getCmdAppUserIds:function e(){return r},sortNames:function e(t){var n=t.sort(TS.interop.i18n.sorter);function r(e,t){return e.filter(function(e){return-1!==t.indexOf(TS.cmd_handlers[e].type)})}var i=r(n,["client","core"]);var a=r(n,["custom"]);var s=r(n,["app","service"]);var o=s.filter(function(e){return!!TS.cmd_handlers.getAppNameForCmdName(e)});o.sort(function(e,t){var n=TS.cmd_handlers.getAppNameForCmdName(e);var r=TS.cmd_handlers.getAppNameForCmdName(t);return TS.interop.i18n.sorter(n,r)});var l=s.filter(function(e){return!TS.cmd_handlers.getAppNameForCmdName(e)});l.sort();var u=[].concat(i,a,o,l);return u},getAppNameForCmdName:function e(t){var n="";var r=TS.cmd_handlers[t];if(r)if(r.app){var i=TS.interop.apps.getAppById(r.app);!i||i.isUnknown||i.isNonExistent||(n=i.name)}else r.service_name&&(n=r.service_name);return n},mergeInServerCmds:function e(t){TS.cmd_handlers.server_cmds=t;var n;for(var r in TS.cmd_handlers){if(0!==r.indexOf("/"))continue;"client"===TS.cmd_handlers[r].type?delete TS.cmd_handlers[r].override:delete TS.cmd_handlers[r]}for(n in t){if(0!==n.indexOf("/"))continue;if(TS.cmd_handlers[n]&&!TS.cmd_handlers[n].can_be_overridden_by_server_cmd){TS.cmd_handlers[n].override=true;continue}TS.cmd_handlers[n]=TS.cmd_handlers.makeInternalCmdObject(t[n])}for(n in t){if(0!==n.indexOf("/"))continue;if(!TS.cmd_handlers[n].alias_of)continue;var i=TS.cmd_handlers[TS.cmd_handlers[n].alias_of];if(!i)continue;if("client"===i.type)continue;i.aliases||(i.aliases=[]);i.aliases.push(n)}},makeInternalCmdObject:function e(t){return{autocomplete:true,alias_of:t.alias_of?t.alias_of:null,aliases:null,usage:t.usage||"",desc:t.desc||"",help_text:t.help_text||"",type:t.type||"",app:t.app||"",service_name:t.service_name||"",normalized:TS.interop.i18n.deburr(t.name),canonical_name:t.canonical_name||null}},addEphemeralFeedback:function e(t,n){n=_.defaults(n,{temporary:true});var r={text:t};n.input_txt&&(n.c_id&&n.thread_ts?TS.utility.populateThreadInputs(n.input_txt,n.c_id,n.thread_ts):TS.utility.contenteditable.value(TS.client.ui.$msg_input,n.input_txt));n.temporary||(n.c_id&&n.thread_ts?TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.c_id):TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid));n.temporary&&(r.ephemeral_type="temp_slash_cmd_feedback");n.slackbot_feels&&(r.slackbot_feels=n.slackbot_feels);if(n.c_id&&n.thread_ts){r.channel=n.c_id;r.thread_ts=n.thread_ts;n.temporary&&(r.ephemeral_type="threads_temp_slash_cmd_feedback")}n.temporary?TS.client.ui.addOrFlashEphemeralBotMsg(r):TS.client.ui.addEphemeralBotMsg(r)},runCommand:function e(t,n,r){if(!TS.cmd_handlers[t.cmd])return;if(n&&!TS.cmd_handlers.isCmdSupportedInThreads(t.cmd)){TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(t.cmd,t.original_txt,n,r);return}TS.model.last_active_cid&&TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.last_active_cid);var i=t.cmd;TS.cmd_handlers[t.cmd].canonical_name&&(i=TS.cmd_handlers[t.cmd].canonical_name);"client"===TS.cmd_handlers[t.cmd].type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_CALLED",{locale:TS.interop.i18n.locale,slash_command_canonical_name:i,slash_command_name:t.cmd});TS.cmd_handlers[t.cmd].func(t.cmd,t.rest,t.words,t.original_txt,n,r)},isCmdSupportedInThreads:function t(n){return n&&_.includes(e,n)},sendCmdNotSupportedInThreadsMsg:function e(t,n,r,i){var a;a=TS.cmd_handlers[t]?TS.interop.i18n.t("*{cmd}* is not supported in threads. Sorry!","threads")({cmd:t}):TS.interop.i18n.t("*{cmd}* is not a valid command.","threads")({cmd:t});TS.cmd_handlers.addEphemeralFeedback(a,{input_txt:n,slackbot_feels:"sad_surprise",c_id:i.id,thread_ts:r.ts})},unsupportedCommand:function e(){if(!TS.boot_data.feature_deprecate_unused_commands)return;TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Our apologies, but that command is no longer supported.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})},"/slacknetlog":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;if(!window.desktop.stats||!window.desktop.stats.restartWithNetlog)return;window.desktop.stats.restartWithNetlog()}},"/slackaccessibility":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://accessibility/",try_window_open_in_ssb:true})}},"/slackcookies":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.stats.downloadCookies"))return;desktop.stats.downloadCookies({showItemInFolder:true})}},"/slackgpuinfo":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://gpu/",try_window_open_in_ssb:true})}},"/slackmediainfo":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://media-internals/",try_window_open_in_ssb:true})}},"/slackdevtools":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.app.toggleDevTools"))return;var t=false;desktop.app.toggleDevTools(t)}},"/slacktaskmanager":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!TS.model.is_our_app)return;if(!window.desktop.app||!window.desktop.app.openTaskManager)return;desktop.app.openTaskManager()}},"/slackdebuglag":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(t,n,r){if(3!==r.length){TS.cmd_handlers.addEphemeralFeedback("usage: /slackdebuglag [api response delay in milliseconds] [flannel delay in milliseconds]");return}var i=r.slice(1),a=re()(i,2),s=a[0],o=a[1];TS.interop.api.debugSetResponseDelay(s);TS.interop.Flannel.debugSetResponseDelay(o);TS.cmd_handlers.addEphemeralFeedback("OK, every API call will be delayed by "+s+" ms, and every Flannel call by "+o+" ms.")}},"/slackdebugunreads":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){var t=TS.interop.redux.models.channels.getAllChannels(TS.redux.getState());if(!t||!Object.keys(t).length){var n="/slackdebugunreads: Could not get list of model objects for user. :(";TS.warn(n);TS.cmd_handlers.addEphemeralFeedback(n);return}var r=[];var i=0;var a=0;_.each(t,function(e){if(!e.unread_cnt)return;var t;t=e.is_group?"group":e.is_mpim?"mpim":e.is_im?"im":e.is_channel?"channel":"unknown";if((e.unread_cnt||e.unread_highlight_cnt)&&t){i+=1;r.push([">","`"+e.id+"`","group"===t||"mpim"===t?" ("+t+"):":":",e.unread_cnt?" unread"+(e.is_im||e.is_mpim?" (highlight)":"")+" = "+e.unread_cnt:"",e.unread_highlight_cnt?", highlight = "+e.unread_highlight_cnt:"",TS.notifs.isCorGMuted(e.id)?" (muted)":""].join(""));a+=e.unread_cnt}else{var s="/slackdebugunreads: bad type for channel id "+e.id+"? ("+t+")";TS.warn(s);TS.cmd_handlers.addEphemeralFeedback(n)}});a||r.push("No unreads found across "+t.length+" channels??");var s=TS.model.all_unread_highlights_cnt;var o=TS.model.all_unread_cnt;r=["\ud83d\udd75\ufe0f \ud83d\udcd6 *Unreads Report for user @"+TS.model.user.name+" (`"+TS.model.user.id+'`) in workspace "'+_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team))+'" (`'+TS.model.team.id+"`)*","> "+a+" unreads across "+i+(1===i?" channel":" channels"),"> TS.model.threads_has_unreads: "+TS.model.threads_has_unreads+" (TS.model.all_unread_cnt++ when true), TS.model.threads_mention_count: "+TS.model.threads_mention_count].concat(r);if(TS.model.is_our_app){if(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts){if(TS.model.all_unread_highlights_cnt_to_exclude){r.push("> TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude);s=Math.max(0,s-TS.model.all_unread_highlights_cnt_to_exclude)}if(TS.model.all_unread_cnt_to_exclude){r.push("> TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude);o=Math.max(0,o-TS.model.all_unread_cnt_to_exclude)}}r.push("> SSB setBadgeCount details: all_unread_highlights_cnt = "+s+", all_unread_cnt = "+o+", bullet = "+(!window.desktop||!TS.prefs.getPref("mac_ssb_bullet")?"false":"true"))}r=r.join("\n");TS.cmd_handlers.addEphemeralFeedback(r);TS.info(r)}},"/slackdebugwidget":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!TS.debug_widget)return;TS.debug_widget.toggle()}},"/slacktrace":{type:"client",autocomplete:function e(){return TS.client&&TS.client.traces.canTrace()&&TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:TS.interop.i18n.t("Submit a performance profile to Slack","cmd_handlers")(),func:function e(t,n,r){if(!TS.client||!TS.client.traces.canTrace())return;if(r.length>1&&"ui"===r[1]){if(!_.get(window,"desktop.stats.openTraceDialog"))return;desktop.stats.openTraceDialog();return}TS.client.traces.startTrace(parseInt(n,10),{reason:"slashcommand"});TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Thank you for submitting a performance profile to Slack!","cmd_handlers")())}},"/away":{localized:"/"+TS.interop.i18n.t("away","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t('Toggle your "away" status',"cmd_handlers")(),func:function e(t,n,r,i,a,s){TS.redux.presence.toggleUserPresence().then(function(e){var t=e.args.presence||TS.redux.presence.getPresenceByMemberId(TS.model.user.id);var n;n="away"===t?":white_check_mark: "+TS.interop.i18n.t("You are now marked as *away*.","cmd_handlers")():":white_check_mark: "+TS.interop.i18n.t("You are now marked as *active*.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false})}).catch(_.noop);n&&TS.members.setUserStatus(n)}},"/prefs":{localized:"/"+TS.interop.i18n.t("prefs","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Open the preferences dialog","cmd_handlers")(),func:function e(){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}TS.ui.prefs_dialog.start()}},"/shortcuts":{localized:"/"+TS.interop.i18n.t("shortcuts","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/keys"],localized_aliases:["/"+TS.interop.i18n.t("keys","cmd_handlers")()],desc:TS.interop.i18n.t("Open the keyboard shortcuts dialog","cmd_handlers")(),func:function e(){TS.redux.dispatch(TS.interop.actions.toggleKeyboardShortcuts())}},"/keys":{localized:"/"+TS.interop.i18n.t("keys","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/shortcuts",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/shortcuts"].func()}},"/open":{localized:"/"+TS.interop.i18n.t("open","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/join"],localized_aliases:["/"+TS.interop.i18n.t("join","cmd_handlers")()],desc:TS.interop.i18n.t("Open a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){if(1==r.length){TS.ui.channel_browser.start();return}var o=_.trim(i.substr(t.length));var l=TS.interop.texty.convertContentsStringToDisplayString(o);l=TS.utility.cleanChannelName(l);var u=l&&TS.redux.channels.getPublicOrPrivateChannelByName(l);var d=l&&!u?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:l,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve();d.then(function(){u=u||l&&TS.redux.channels.getPublicOrPrivateChannelByName(l);if(u&&u.is_channel){if(u.is_member)TS.channels.legacyDisplayChannel({id:u.id});else if(!TS.model.user.is_restricted){var e=function e(t,n){if(!t){var r=TS.interop.i18n.t("There was a problem joining \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:l});"is_archived"==n.error&&(r=TS.interop.i18n.t("\u201c{channel_name}\u201d has been archived, so can\u2019t be opened.","cmd_handlers")({channel_name:l}));s&&a?TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,slackbot_feels:"sad_surprise"})}};TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:u.id})).catch(function(t){e(false,{error:t.message})})}}else if(u&&u.is_group)u.is_archived&&!u.was_archived_this_session||TS.groups.legacyDisplayGroup({id:u.id});else if(TS.permissions.members.canCreateChannels())TS.ui.new_channel_modal.start(l);else{var t=TS.interop.i18n.t("I couldn\u2019t find a channel named \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:l});s&&a?TS.cmd_handlers.addEphemeralFeedback(t,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(t,{temporary:false,slackbot_feels:"sad_surprise"})}})}},"/join":{localized:"/"+TS.interop.i18n.t("join","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/open",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/open"].func(t,n,r,i,a,s)}},"/msg":{localized:"/"+TS.interop.i18n.t("msg","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/dm"],localized_aliases:["/"+TS.interop.i18n.t("dm","cmd_handlers")()],desc:TS.interop.i18n.t("Send a DM message to another user","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){var o=r.length>1?r[1]:"";var l;var u;var d=S(o);if(!d)if(o){var c=o.replace("#","");l=TS.redux.channels.getPublicOrPrivateChannelByName(c);if(!l){u=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}}else $("#direct_messages_header").trigger("click.open_dialog").scrollintoview({duration:500});var m=n.replace(o,"");m=d?_.trim(i.substr(i.indexOf(">")+1)):_.trim(i.substr(i.indexOf(o)+o.length));if(d){if(d.deleted){u=TS.interop.i18n.t("That user has been deactivated","cmd_handlers")()+" :disappointed:";s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.ims.legacyStartImByMemberId(d.id,false,m)}else if(l){if(l.is_archived){u=TS.interop.i18n.t("That {channel} has been archived","cmd_handlers")({channel:l.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()});s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}l.is_channel?TS.channels.legacyDisplayChannel({id:l.id,and_send_txt:m}):TS.groups.legacyDisplayGroup({id:l.id,and_send_txt:m})}}},"/invite":{localized:"/"+TS.interop.i18n.t("invite","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite another member to a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,n,r,i){var a=r.length>1?r[1]:"";var s=S(a);var o;a&&(o=TS.interop.userGroups.getUserGroupById(a.substr(1)));if(!s&&(!o||TS.interop.rules.user_groups.isUnknownOrNonExistent(o))&&a){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid member name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s&&s.deleted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("That user has been deactivated.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}var l=r.length>2?r[2]:"";var u=TS.interop.texty.convertContentsStringToDisplayString(l);var d=u&&TS.redux.channels.getPublicOrPrivateChannelByName(u);var c=u&&!d?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:u,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve();c.then(function(){d=d||u&&TS.redux.channels.getPublicOrPrivateChannelByName(u)||TS.shared.legacyGetActiveModelOb();var e=function e(){if(s&&s.is_app_user){TS.interop.addAppToChannel({appUserId:s.id,channelId:d.id,onError:function e(){return TS.utility.contenteditable.value(TS.client.ui.$msg_input,i)},referringEventId:"BUILTIN_CHAT_COMMAND_CALLED",sendEphemeralErrorMessage:true});return}d&&!d.is_im&&(s||o||d.is_mpim)?s?p(s,d,i):o&&!d.is_mpim?h(o,d,i):TS.ui.im_browser.startWithMpim(d):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"})};if(!(s&&s.is_restricted)||d&&(d.is_im||d.is_mpim)){e();return}TS.interop.members.fetchMemberProfileExtras(s.id,["channels"]).then(function(e){return e&&_.isArray(e.channels)&&e.channels||[]}).then(function(t){if(!s.is_ultra_restricted&&TS.model.user.is_admin||d&&t.indexOf(d.id)>-1){e();return}if(s.is_ultra_restricted&&t.length){TS.model.user.is_admin?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. To invite {user} to this channel, you\u2019ll need to <{team_url}admin#restricted|upgrade their membership> to a Multi-Channel Guest. \u200bNote: This will add a billable seat to your workspace.","cmd_handlers")({user:g(s),team_url:TS.boot_data.team_url}),{input_txt:i,slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. Your Workspace Admin can upgrade their membership to a Multi-Channel Guest.","cmd_handlers")({user:g(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}if(!TS.model.user.is_admin){if(s.is_ultra_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:g(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}if(d&&!d.is_private&&!d.is_group){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Multi-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:g(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}}e()})})}},"/invite_people":{localized:"/"+TS.interop.i18n.t("invite_people","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite people to your workspace","cmd_handlers")(),args:[{name:TS.utility.exampleEmailAddress()+", ...",optional:true}],func:function e(t,n){if(TS.ui.admin_invites.canInvite()){n=n&&n.trim();n&&TS.ui.admin_invites.populateInvites(n.split(/\s*,\s*|\s+/).map(function(e){return{email:e}}));TS.ui.admin_invites.start()}else TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to invite people.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/dm":{localized:"/"+TS.interop.i18n.t("dm","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/msg",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/msg"].func(t,n,r,i,a,s)}},"/archive":{localized:"/"+TS.interop.i18n.t("archive","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Archive the current channel","cmd_handlers")(),func:function e(){var t=TS.shared.legacyGetActiveModelOb();if(t.is_archived||TS.interop.rules.channels.isRequired(t))return;if(TS.interop.rules.channels.isExternallySharedChannel(t))return;if(t.is_channel&&!t.is_mpim){if(!TS.permissions.members.canArchiveChannels())return;if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",false)&&TS.interop.rules.channels.isOrgDefaultChannel(t))return;TS.channels.ui.showArchiveChannelDialog(t)}else if(t.is_group&&!t.is_mpim){if(TS.model.user.is_restricted)return;TS.channels.ui.showArchiveGroupDialog(t)}}},"/leave":{localized:"/"+TS.interop.i18n.t("leave","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/close","/part"],localized_aliases:["/"+TS.interop.i18n.t("close","cmd_handlers")(),"/"+TS.interop.i18n.t("part","cmd_handlers")()],desc:TS.interop.i18n.t("Leave a channel","cmd_handlers")(),func:function e(t,n,r){if(1==r.length){var i=TS.shared.legacyGetActiveModelOb();i.is_channel?i.is_mpim?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):i.is_archived?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):i.is_mpim||i.is_im?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):i.is_group?i.is_archived?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel or member name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}else{var a=TS.interop.texty.convertContentsStringToDisplayString(n);var s=a&&TS.redux.channels.getPublicOrPrivateChannelByName(a);var o=a&&!s?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:a,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve();o.then(function(){s=s||a&&TS.redux.channels.getPublicOrPrivateChannelByName(a);s?TS.channels.leave(s.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})})}}},"/star":{localized:"/"+TS.interop.i18n.t("star","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,desc:TS.interop.i18n.t("Stars the current channel or conversation","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o;s&&a?TS.stars.toggleStarOnMsg(a.ts,s,function(){o=a.is_starred?TS.interop.i18n.t("Ok, I starred this thread","cmd_handlers")():TS.interop.i18n.t("Ok, I unstarred this thread","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(o,{c_id:s.id,thread_ts:a.ts})}):TS.stars.toggleStarForActiveModel(function(e){o=e?TS.interop.i18n.t("Ok, I starred {channel}","cmd_handlers")({channel:s.name}):TS.interop.i18n.t("Ok, {channel} is unstarred","cmd_handlers")({channel:s.name});TS.cmd_handlers.addEphemeralFeedback(o)})}},"/close":{localized:"/"+TS.interop.i18n.t("close","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,n,r){TS.cmd_handlers["/leave"].func(t,n,r)}},"/part":{localized:"/"+TS.interop.i18n.t("part","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,n,r){TS.cmd_handlers["/leave"].func(t,n,r)}},"/topic":{localized:"/"+TS.interop.i18n.t("topic","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.rules.channels.isExternallySharedChannel(TS&&TS.shared&&TS.shared.legacyGetActiveModelOb())?TS.interop.i18n.t("Set the channel topic for your workspace","cmd_handlers")():TS.interop.i18n.t("Set the channel topic","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new topic","cmd_handlers")(),optional:true}],func:function e(t,n,r,i){var a=TS.shared.legacyGetActiveModelOb();if(TS.model.user.is_restricted||TS.interop.rules.channels.isRequired(a)&&!TS.permissions.members.canPostInChannel(a)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Setting the topic is a restricted action.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(TS.interop.channels.channelTopicExceedsLimit(n)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Topics cannot exceed {max_characters} characters.","cmd_handlers")({max_characters:TS.model.channel_topic_max_length}),{input_txt:i,slackbot_feels:"sad_surprise"});return}var s=_.trim(i.substr(t.length));a.is_mpim||a.is_im?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Regrettably, direct messages do not have topics","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):s?TS.interop.channels.submitChannelTopic(a.id,s).then(TS.channels.legacyUpdateTopicFromAPI).catch(TS.channels.legacyAlertSetTopicError):$("#channel_topic_text").click().focus().select()}},"/togglethemes":{localized:"/"+TS.interop.i18n.t("togglethemes","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}TS.prefs.setPrefByAPI({name:"messages_theme",value:"light_with_avatars"===TS.prefs.getPref("messages_theme")?"dense":"light_with_avatars"})}},"/search":{localized:"/"+TS.interop.i18n.t("search","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/s"],localized_aliases:["/"+TS.interop.i18n.t("s","cmd_handlers")()],desc:TS.interop.i18n.t("Perform a search","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your text","cmd_handlers")(),optional:true}],func:function e(t,n){TS.interop.searchActions.openFromSlashCommand({query:n})}},"/s":{localized:"/"+TS.interop.i18n.t("s","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/search",aliases:null,desc:"",func:function e(t,n){TS.cmd_handlers["/search"].func(t,n)}},"/rename":{localized:"/"+TS.interop.i18n.t("rename","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.rules.channels.isExternallySharedChannel(TS&&TS.shared&&TS.shared.legacyGetActiveModelOb())?TS.interop.i18n.t("Rename this channel for your workspace","cmd_handlers")():TS.interop.i18n.t("Rename a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new name","cmd_handlers")(),optional:true}],func:function e(t,n){if(TS.model.user.is_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var r=TS.shared.legacyGetActiveModelOb();if(r.is_mpim||r.is_im){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Direct messages don\u2019t even have a name! Ergo, regrettably, you can\u2019t change it.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if((r.is_channel||r.is_group)&&!TS.model.user.is_admin&&r.creator!=TS.model.user.id){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Only Workspace Admins (or the channel creator) are allowed to rename channels.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(!TS.permissions.channels.canSeeRenameChannelOption(r)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var i=_.escape(n)||r.name;TS.ui.channel_options_dialog.start(r.id,"rename",{name:i})}},"/beep":{localized:"/"+TS.interop.i18n.t("beep","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}TS.sounds.play("new_message")}},"/upload":{localized:"/"+TS.interop.i18n.t("upload","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,n){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}var r=TS.utility.base64StrtoBlob(n);TS.client.ui.file_pasted_sig.dispatch(r)}},"/colors":{localized:"/"+TS.interop.i18n.t("colors","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colours"],localized_aliases:["/"+TS.interop.i18n.t("colours","cmd_handlers")()],desc:TS.interop.i18n.t("View any custom colors you have set for other members","cmd_handlers")(),func:function e(t,n,r,i,a,s){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}var o=TS.members.getMembersForUser();var l;var u="";for(var d=0;d<o.length;d+=1){l=o[d];l.member_color!=l.color&&(u+=l.name+": "+l.member_color+"\n")}var c=u?TS.interop.i18n.t("You have overridden colors as follows:","cmd_handlers")()+"\n"+u:TS.interop.i18n.t("No user color overrides have been set.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false})}},"/colours":{localized:"/"+TS.interop.i18n.t("colours","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/colors",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/colors"].func(t,n,r,i,a,s)}},"/color":{localized:"/"+TS.interop.i18n.t("color","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colour"],localized_aliases:["/"+TS.interop.i18n.t("colour","cmd_handlers")()],desc:TS.interop.i18n.t("Set a custom color for another member","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=r.length>1?r[1]:"";var l=r.length>2?r[2].replace(/#/g,""):"";var u;var d=S(o);if(!d){u=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}var c;d&&(c=TS.interop.members.getPrefCompliantMemberName(d,true,true));if(l&&(6!=l.length||!("#"+l).match(TS.format.hex_rx))){u=TS.interop.i18n.t("A valid 6 character hex code is required, like `FF0000`.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i});return}TS.members.setMemberUserColor(d,l);TS.prefs.setPrefLocal("user_colors",JSON.stringify(TS.model.user_colors));TS.prefs.setPrefByAPI({name:"user_colors",value:TS.prefs.getPref("user_colors")});u=l?TS.interop.i18n.t("You\u2019ve set your custom color for {user} to {color}","cmd_handlers")({user:c,color:"#"+l}):TS.interop.i18n.t("You\u2019ve removed your custom color for {user}.","cmd_handlers")({user:c});s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i})}},"/colour":{localized:"/"+TS.interop.i18n.t("colour","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/color",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/color"].func(t,n,r,i,a,s)}},"/colortest":{localized:"/"+TS.interop.i18n.t("colortest","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,n){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}var r=null;if(n)try{r=JSON.parse(n)}catch(e){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Not a good value for colors: ","cmd_handlers")()+n,{slackbot_feels:"sad_surprise"});return}r&&r.length||(r=["#DDCFFA","#2EF645","#F38303","#E702AE","#3C986D","#9D6158","#F43368","#97C10A","#7491F9","#9E63A3","#FACE41","#35A5CC","#39A93E","#4FECA8","#CA5B34","#E2A974","#2BCFCB","#F89BA7","#89868A","#6A7841","#ADC498","#B1DBDD","#B849C3","#9CDB81","#E72F36","#A16A28","#F68CCF","#317C84","#58851C","#FC4A97","#5774BB","#97B7FE","#C64D97","#CB4A5C","#F68B6B","#81EE4F","#B7ED6D","#756D8E","#3AED69","#81E7FB","#91ECB7","#ED8947","#57AF19","#28BC89","#4A9788","#D645DF","#B498FE","#71C8F9","#C07B1D","#16BD60","#EFCAE3","#A4E0BB","#478AAF","#59953E","#886CA7","#F0C3F1","#29AF70","#80A5F8","#636BB8"]);var i;for(i=0;i<r.length;i+=1)r[i]=r[i].replace("#","");var a=TS.members.getMembersForUser();for(i=0;i<a.length;i+=1)TS.members.setMemberUserColor(a[i],r[_.random(0,r.length-1)])}},"/discon":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.disconnect()}},"/sleepsleep":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.sleep()}},"/sleepsleep2":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.sleep()}},"/wakewake":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.wake()}},"/discon4":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.disconnect()}},"/debugdegrade":{localized:null,type:"client",autocomplete:function e(){return TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.debugSetSocketConnectFlakiness(1);TS.interop.SocketManager.disconnect()}},"/debugrecover":{localized:null,type:"client",autocomplete:function e(){return TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:"",func:function e(){var t=0;if(TS.qs_args.ws_flakiness){t=parseFloat(TS.qs_args.ws_flakiness);(_.isNaN(t)||t<0||t>1)&&(t=0)}TS.interop.SocketManager.debugSetSocketConnectFlakiness(t);TS.client.manualReconnectNow()}},"/emo":{localized:"/"+TS.interop.i18n.t("emo","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/emote","/emoji"],localized_aliases:["/"+TS.interop.i18n.t("emote","cmd_handlers")(),"/"+TS.interop.i18n.t("emoji","cmd_handlers")()],desc:"",func:function e(){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}var t={target:TS.client.ui.$msg_input};TS.ui.react_emoji_menu.start({e:t})}},"/emoji":{localized:"/"+TS.interop.i18n.t("emoji","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/emote":{localized:"/"+TS.interop.i18n.t("emote","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/editlast":{localized:"/"+TS.interop.i18n.t("editlast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Edit the last message you posted","cmd_handlers")(),func:function e(t,n,r,i,a,s){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}var o=s||TS.shared.legacyGetActiveModelOb();var l;if(!o)return;var u=_.trim(i.substr(t.length));if(!u){l=TS.interop.i18n.t("You must enter some text!","cmd_handlers")();o&&a?TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,c_id:o.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i});return}var d;if(o&&a)d=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var c=TS.redux.messages.getMessagesByChannelId(o.id);c=_.reject(c,TS.interop.messages.isReply);d=TS.interop.rules.messages.getLastMessageByMember(c,TS.model.user.id)}if(!d){l=TS.interop.i18n.t("Found no recent messages from you to edit.","cmd_handlers")();o&&a?TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.redux.dispatch(TS.interop.redux.actions.saveMessageEdit({channelId:o.id,ts:d.ts,text:u}))}},"/deletelast":{localized:"/"+TS.interop.i18n.t("deletelast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Delete the last message you posted","cmd_handlers")(),func:function e(t,n,r,i,a,s){if(TS.boot_data.feature_deprecate_unused_commands){TS.cmd_handlers.unsupportedCommand();return}var o=s||TS.shared.legacyGetActiveModelOb();if(!o)return;var l;if(o&&a)l=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var u=TS.redux.messages.getMessagesByChannelId(o.id);u=_.reject(u,TS.interop.messages.isReply);l=TS.interop.rules.messages.getLastMessageByMember(u,TS.model.user.id)}if(!l){var d=TS.interop.i18n.t("Found no recent messages from you to delete.","cmd_handlers")();o&&a?TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise"});return}TS.msg_edit.startDelete(l.ts,o)}},"/collapse":{localized:"/"+TS.interop.i18n.t("collapse","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Collapse all files in the current channel (opposite of /expand)","cmd_handlers")(),func:function e(){var t=TS.shared.legacyGetActiveModelOb().id;var n=TS.redux.messages.getExpandablesInChannel(t);var r=_.zipObject(n,_.map(n,function(){return false}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(r));TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve collapsed all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/expand":{localized:"/"+TS.interop.i18n.t("expand","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Expand all files in the current channel (opposite of /collapse)","cmd_handlers")(),func:function e(){var t=TS.shared.legacyGetActiveModelOb().id;var n=TS.redux.messages.getExpandablesInChannel(t);var r=_.zipObject(n,_.map(n,function(){return true}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(r));TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve expanded all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/remove":{localized:"/"+TS.interop.i18n.t("remove","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/kick"],localized_aliases:["/"+TS.interop.i18n.t("kick","cmd_handlers")()],desc:TS.interop.i18n.t("Remove a person from the current channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false}],func:function e(t,n,r,i){var a=TS.shared.legacyGetActiveModelOb();n=$.trim(n);var s=S(n);var o=_.get(s,"is_app_user",false);if((a.is_im||a.is_mpim)&&!o){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove someone from a direct message.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(TS.interop.rules.channels.isPublicChannel(a)&&!o&&!TS.permissions.members.canKickFromChannels()){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(TS.interop.rules.channels.isPrivateChannel(a)&&!o&&!TS.permissions.members.canKickFromGroups()){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a private channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(a.is_archived){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove anyone from *{channel}* while it is archived.","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}),{slackbot_feels:"sad_surprise"});return}if(!n){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Please specify someone to remove!","cmd_handlers")(),{input_txt:i});return}if(!s){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{input}* is not a recognized member name.","cmd_handlers")({input:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(t.length))),TS.interop.prefs.getHighlightWords(),TS.interop.rules.emoji.shouldRenderEmojiAsText()))}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(TS.interop.rules.channels.isRequired(a)&&!s.is_restricted&&!s.is_bot){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove this member from *{channel}*!","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}));return}TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,[s.id]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(a.id,s.id);if(!e.is_member){var n;n=o?TS.interop.i18n.t("{app_user} isn\u2019t in this conversation, so you can\u2019t remove it.","apps")({app_user:TS.interop.i18n.safeString("<@"+s.id+">")}):TS.interop.i18n.t("*{user}* is not a member of this {channel}.","cmd_handlers")({user:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(t.length))),TS.interop.prefs.getHighlightWords(),TS.interop.rules.emoji.shouldRenderEmojiAsText())),channel:a.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()});TS.cmd_handlers.addEphemeralFeedback(n,{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_self){TS.client.ui.onSubmit("/leave");return}if(o){TS.interop.removeAppFromChannel({appUserId:s.id,channelId:a.id,onError:function e(){return TS.utility.contenteditable.value(TS.client.ui.$msg_input,i)},referringEventId:"BUILTIN_CHAT_COMMAND_CALLED",sendEphemeralErrorMessage:true});return}if(TS.interop.members.isExternal(s)){var r;r=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("You can\u2019t remove {member_name} from this channel, because they\u2019re from a workspace outside your organization.","cmd_handlers")({member_name:g(s)}):TS.interop.i18n.t("You can\u2019t remove {member_name} from this channel, because they\u2019re from another workspace.","cmd_handlers")({member_name:g(s)});TS.cmd_handlers.addEphemeralFeedback(r,{input_txt:i,slackbot_feels:"sad_surprise"});return}a.is_channel?TS.channels.legacyKickMember(a.id,s.id):a.is_group&&TS.groups.kickMember(a.id,s.id)})}},"/kick":{localized:"/"+TS.interop.i18n.t("kick","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/remove",aliases:null,desc:"",func:function e(t,n,r,i){TS.cmd_handlers["/remove"].func(t,n,r,i)}},"/feedback":{localized:"/"+TS.interop.i18n.t("feedback","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Send feedback to Slack","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){if(!n){TS.utility.openInNewTab("/help/requests/new","_blank");return}var o=_.trim(i.substr(t.length));o=TS.interop.texty.convertContentsStringToDisplayString(o,TS.interop.prefs.getHighlightWords());TS.generic_dialog.start({title:TS.interop.i18n.t("Send feedback","cmd_handlers")(),body:'<p class="bold">'+TS.interop.i18n.t("Looks like you are trying to send us some feedback! Yes?","cmd_handlers")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","cmd_handlers")(),onGo:function e(){var n={command:t,text:o,channel:TS.model.active_cid,client_token:TS.interop.client_action_token.generateAndEnqueue()};if(s&&a){n.channel=s.id;n.thread_ts=a.ts}var r=i;var l=function e(t,n,i){TS.client.ui.onAPICommand(t,n,i,r)};TS.interop.api.call("chat.command",n).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;l(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;l(i,t,n,r);return{data:t,args:n,request_id:r}})},onCancel:function e(){s&&a?TS.utility.populateThreadInputs(i,s.id,a.ts):TS.utility.populateInput(TS.client.ui.$msg_input,i)}})}},"/redox":{type:"client",autocomplete:true,alias_of:null,aliases:null,desc:"Display redux documentation (redox), only works in dev",func:function e(){window&&window.slackDebug&&window.slackDebug.redox&&window.slackDebug.redox()}},"/shrug":{localized:"/"+TS.interop.i18n.t("shrug","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Appends \xaf\\_(\u30c4)_/\xaf to your message","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){var o=_.trim(i.substr(t.length));o&&" "!==o.substr(o.length-1)&&(o+=" ");o+="\xaf\\_(\u30c4)_/\xaf ";s||(s=TS.shared.legacyGetActiveModelOb());TS.client.ui.sendMessage(s,o,a)}},"/showfallbacks":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.model.show_attachment_fallback=!TS.model.show_attachment_fallback}},"/toggle_debugging_prefs":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.ui.prefs_dialog.start("advanced","#prefs_debug")}}});var e=["/shrug","/prefs","/shortcuts","/keys","/toggle_debugging_prefs","/away","/search","/togglethemes","/feedback","/slack_diagnostic_report","/msg","/dm","/s","/editlast","/deletelast","/star","/beep","/colors","/colours","/color","/colour","/active"];var t;var n={localized:null,type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Start a call","cmd_handlers")(),args:[{name:TS.interop.i18n.t("help","cmd_handlers")(),optional:true}],can_be_overridden_by_server_cmd:true,func:function e(t,n){var r=TS.shared.legacyGetActiveModelOb();var i=TS.interop.members.getMemberById(r.user);if(TS.boot_data.page_needs_enterprise&&(TS.interop.rules.channels.isExternallySharedChannel(r)||TS.boot_data.feature_default_shared_channels&&TS.interop.rules.channels.isOrgDefaultChannel(r))){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You are not allowed to use this command here.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if("help"===n.trim()){var a;a=TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()?TS.interop.i18n.t("To call someone, use `/call` in a direct message to them.","cmd_handlers")():r.is_mpim?TS.interop.i18n.t("To call {group_name}, use `/call` in this group conversation.","cmd_handlers")({group_name:TS.interop.rules.channels.getDisplayNameForChannel(r)}):r.is_im?TS.interop.i18n.t("To call {user}, use `/call` in this Direct Message conversation.","cmd_handlers")({user:TS.interop.rules.channels.getDisplayNameForChannel(r)}):TS.interop.i18n.t("To start a call in {channel}, use `/call` here.","cmd_handlers")({channel:TS.interop.rules.channels.getDisplayNameForChannel(r)});a+="\n";a+=TS.interop.i18n.t("To run a series of tests, use `/call --test` here.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(a);return}if(n.trim().match(/--server=/)){var s=n.trim().replace(/--server=/g,"");var o=TS.storage.fetchCallsState();o.call_server_override=s;TS.storage.storeCallsState(o)}if(n.trim().match(/--test/)){var l="https://"+window.location.host+"/help/test/calls";TS.model.is_our_app?TS.client.windows.openWindow({url:l,no_spinner:true}):window.open(l,"calls_test");return}if(TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()){if("Slack"!==TS.prefs.getTeamPref("calling_app_name")){TS.utility.calls.startCallInModelOb(r,true);return}TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Group calls aren\u2019t available on the free plan. Try using `/call` in a Direct Message conversation!","cmd_handlers")());return}if(TS.interop.rules.channels.isSlackbot(r)){var u=[TS.interop.i18n.t("I\u2019m on the other line. Sorry!","cmd_handlers")(),TS.interop.i18n.t("Thanks for calling me! I\u2019m afraid I only accept calls from my mother, Sundays at 2pm.","cmd_handlers")(),TS.interop.i18n.t("I\u2019m washing my hair right now\u2026can\u2019t come to the phone!","cmd_handlers")(),TS.interop.i18n.t("It\u2019s awfully nice of you to try calling me. But \u2014 shh! \u2014 I\u2019m quite afraid of the phone!","cmd_handlers")()+" :grimacing:",TS.interop.i18n.t("Thank you so much for calling, but I can\u2019t talk right now, I\u2019m watching my stories.","cmd_handlers")()];var d=_.shuffle(u)[0];TS.cmd_handlers.addEphemeralFeedback(d);return}if(TS.interop.rules.channels.isTeambot(r,TS.boot_data.feature_teambot)){if(TS.boot_data.feature_teambot){var c=TS.interop.i18n.t("Sorry! Teambot can't handle phone calls. Try sending a direct message instead?","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(c)}return}if(i&&(i.is_bot||i.id==TS.model.user.id)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Calling yourself or an app isn't possible. Maybe try a landline and leave a voicemail.","cmd_handlers","2bcbf95065dddb358bd6e99bf0c7e1bc3c0697ce")({user:TS.interop.members.getPrefCompliantMemberName(i,false,true)}),{slackbot_feels:"sad_surprise"});return}TS.utility.calls.startCallInModelOb(r,true)}};var r=[];var i=function n(){if(t||TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE)return;t=true;var r;var i;_.forOwn(TS.cmd_handlers,function(t,n){if(0!==n.indexOf("/"))return;r=TS.cmd_handlers[n].localized?TS.cmd_handlers[n].localized.toLowerCase():null;if(r&&r!==n&&!TS.cmd_handlers[r]){TS.cmd_handlers[r]=_.clone(TS.cmd_handlers[n]);TS.cmd_handlers[r].localized=null;TS.cmd_handlers[r].canonical_name=n;TS.cmd_handlers[n].autocomplete=false;i=TS.interop.i18n.deburr(r);if(r!==i){TS.cmd_handlers[r].normalized=i;TS.cmd_handlers[i]||(TS.cmd_handlers[i]=_.clone(TS.cmd_handlers[n]))}_.includes(e,n)&&e.push(r)}})};var a=function e(t,n){TS.model.commands_cache_ts=n;var r={data:t,cache_ts:TS.model.commands_cache_ts,locale:TS.interop.i18n.locale};TS.storage.storeCmds(r);TS.cmd_handlers.mergeInServerCmds(t);l();TS.apps.permissions.areXoxaAppsInstalled()&&m(t)};var s=function e(){var t=TS.storage.fetchCmds();if(!t)return false;if(TS.model.commands_cache_ts!==t.cache_ts)return false;if(TS.interop.i18n.locale!==t.locale)return false;return true};var o=function e(){TS.cmd_handlers.setUpCmds()};var l=function e(){var t="/"+TS.interop.i18n.t("call","cmd_handlers")();var r=TS.interop.i18n.deburr(t);if(TS.utility.calls.isEnabled()){if(!TS.cmd_handlers["/call"])if("/call"===t)TS.cmd_handlers["/call"]=n;else{TS.cmd_handlers[t]=_.clone(n);var i=_.clone(n);i.autocomplete=false;i.localized=null;TS.cmd_handlers["/call"]=i;if(t!==r){TS.cmd_handlers[t].normalized=r;TS.cmd_handlers[r]||(TS.cmd_handlers[r]=i)}}}else{TS.cmd_handlers["/call"]&&"client"===TS.cmd_handlers["/call"].type&&_.unset(TS.cmd_handlers,"/call");TS.cmd_handlers[t]&&"client"===TS.cmd_handlers[t].type&&_.unset(TS.cmd_handlers,t);t!==r&&TS.cmd_handlers[r]&&"client"===TS.cmd_handlers[r].type&&_.unset(TS.cmd_handlers,t)}};var u=function e(t){var n=false;var r=TS.shared.legacyGetActiveModelOb();TS.interop.rules.channels.isOrgShared(r)&&(n=true);return{cmds:t.filter(function(e){return("core"===e.type||"client"===e.type)&&!(n&&"/call"===e.name)}),id:"core",name:"Slack"}};var d=function e(t){return{cmds:t.filter(function(e){return"custom"===e.type}),id:"custom",name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}};var c=function e(t){var n=TS.interop.apps.getAppById(t);if(!n)return false;if(n.isUnknown||n.isNonExistent)return false;if(!n.is_xoxa_app)return false;var r=TS.interop.membership.getCachedChannelMembershipInfoForUser(TS.model.active_cid,n.app_user_id);if(true===r.is_known&&false===r.is_member)return true;return false};var m=function e(t){var n=[];_.each(t,function(e){var t=e.app;if(t){var r=TS.interop.apps.getAppById(t);var i=r&&r.app_user_id;i&&n.push(i)}});r=n};var f=function e(t){var n=t.filter(function(e){return"app"===e.type||"service"===e.type});var r=n.filter(function(e){return!!(e.service_name||e.app)});var i=n.filter(function(e){return!(e.service_name||e.app)});var a={};r.forEach(function(e){var t=TS.cmd_handlers.getAppNameForCmdName(e.name);a[t]||(a[t]=[]);a[t].push(e)});var s=Object.keys(a).slice().sort(TS.interop.i18n.sorter);var o=s.map(function(e){var t={cmds:a[e],id:"app",name:e};TS.apps.permissions.areXoxaAppsInstalled()&&(t.xoxa_app_not_in_channel=c(a[e][0].app));return t});o.push({cmds:i,id:"app",name:"Other"});return o};var p=function e(t,n,r){if(!_.isObject(t))throw new Error("Expected user to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");if(!_.isString(r))throw new Error("Expected input_txt to be a string");return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(n.id,[t.id]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(n.id,t.id);if(e.is_member){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("{user} is already in this channel.","cmd_handlers")({user:g(t)}),{input_txt:r});return}if(!n.is_mpim&&!TS.permissions.channels.canMemberBeInvitedToChannel(n,t)){var i;if(TS.boot_data.page_needs_enterprise){i=TS.interop.members.isExternal(t)?TS.interop.rules.channels.isExternallySharedChannel(n)||!TS.teams.getTeamNameByMember(t)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization.","cmd_handlers")({member_name:g(t)}):1===TS.prefs.getTeamPref("enable_shared_channels")?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}. <https://get.slack.help/hc/articles/115004151183|Learn about shared channels>","cmd_handlers")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{user} is not a member of {team_name}.","cmd_handlers")({user:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:r,slackbot_feels:"sad_surprise"});return}if(TS.interop.members.isExternal(t)){i=TS.interop.rules.channels.isExternallySharedChannel(n)||!TS.teams.getTeamNameByMember(t)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace.","cmd_handlers")({member_name:g(t)}):1===TS.prefs.getTeamPref("enable_shared_channels")?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}. <https://get.slack.help/hc/articles/115004151183|Learn about shared channels>","cmd_handlers")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:r,slackbot_feels:"sad_surprise"});return}}if(TS.interop.rules.channels.isMpim(n))TS.ui.im_browser.startWithMpim(n,[t.id]);else{if(!TS.interop.rules.channels.isPrivateChannel(n))return TS.interop.api.call("conversations.invite",{channel:n.id,users:t.id});TS.ui.invite.showInviteMembersPreSelected(n.id,[t.id])}})};var h=function e(t,n,r){if(!_.isObject(t))throw new Error("Expected ug to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");if(!_.isString(r))throw new Error("Expected input_txt to be a string");TS.interop.userGroups.promiseToGetUserGroupMembers(t.id).then(function(e){TS.interop.membership.ensureChannelMembershipIsKnownForUsers(n.id,e.users).then(function(){var t=e.users.filter(function(e){if(TS.boot_data.page_needs_enterprise){var t=TS.interop.members.getMemberById(e);if(!TS.permissions.channels.canMemberBeInvitedToChannel(n,t))return false}var r=TS.interop.membership.getCachedChannelMembershipInfoForUser(n.id,e);return!r.is_member});if(!t.length){var i=TS.interop.i18n.t("All of the users in that user group are already in this channel.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:r});return}!n.is_private&&!n.is_group||TS.interop.rules.channels.isExternallySharedChannel(n)?TS.interop.api.call("conversations.invite",{channel:n.id,users:t,force:true}):TS.ui.invite.showInviteMembersPreSelected(n.id,t)})})};var g=function e(t){if(!_.isObject(t))throw new Error("Expected user to be an object");return TS.interop.members.getPrefCompliantMemberName(t,false,true)};var S=function e(t){return TS.interop.members.getMemberById(t)}})();(function(){TS.registerModule("stars",{member_stars_fetched_sig:new signals.Signal,member_stars_being_fetched_sig:new signals.Signal,channel_starred_sig:new signals.Signal,channel_unstarred_sig:new signals.Signal,has_more:false,fetched_once:false,onStart:function e(){TS.files.team_file_changed_sig.add(l);TS.files.team_file_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.files.team_file_comment_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.channels.message_changed_sig.add(s);TS.ims.message_changed_sig.add(s);TS.mpims.message_changed_sig.add(s);TS.groups.message_changed_sig.add(s);if(TS.client){TS.stars.badge_star_menu=TS.interop.experiments.getGroupForUser("badge_star_menu");"treatment"==TS.stars.badge_star_menu&&TS.stars.fetchUserStarredItems()}n=$("#member_stars_more_btn")},getAllStars:function e(){return a},maybeUpdateUserStarredList:function e(t){if(!TS.client)return;if(!TS.model.team)return;if(r||!TS.stars.fetched_once){i=true;return}o(t)},maybeRemoveStarredListItem:function e(t){if(!TS.client)return;var n=_.findIndex(a,function(e){if(e.type!==t.type)return false;switch(e.type){case"message":return e.message.ts===t.message.ts;case"file":return e.file.id===t.file_id;case"file_comment":return e.comment.id===t.comment.id;default:break}return false});-1!==n&&a.splice(n,1);d();if("stars"!==TS.model.ui_state.flex_name)return;var r;var i;if("file"===t.type){i=".star_item #file_"+t.file_id;r=$(i).parent(".star_item")}else if("message"===t.type){i='.star_item .message[data-ts="'+t.message.ts+'"]';r=$(i).parent(".star_item")}else{if("file_comment"!==t.type)return;i='.star_item .star_comment[data-comment-id="'+t.comment.id+'"]';r=$(i).parents(".star_item")}r.remove()},fetchUserStarredItems:function e(){var t=c();TS.stars.fetched_once||(TS.stars.fetched_once=true);return TS.interop.api.call("stars.list",t).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;u&&u(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;u&&u(i,t,n,r);return{data:t,args:n,request_id:r}})},userStarStatusHasChanged:function e(t,n,r){m(t,n,r);var i=false;if("message"===n.type){f(n.message.ts,n.channel,t,false);var a=TS.redux.messages.wasMessageDeleted(n.channel,n.message.ts);a||TS.redux.messages.replaceMessage(TS.interop.messages.preprocessImsg(n.message,n.channel))}else if("file"===n.type)n.file.is_starred!=t&&h(n.file.id,t);else if("file_comment"===n.type)n.comment.is_starred!=t&&p(n.comment.id,n.file.id,t);else if("channel"===n.type){var s=TS.interop.channels.getPublicChannelById(n.channel,i);s?s.is_starred!=t&&g(n.channel,t):TS.warn("userStarStatusHasChanged channel_id:"+n.channel+" not found")}else if("group"===n.type){var o=TS.interop.channels.getGroupById(n.channel,i);o||(o=TS.interop.channels.getMpimById(n.channel,i));o?o.is_starred!=t&&(o.is_mpim?b(n.channel,t):S(n.channel,t)):TS.warn("userStarStatusHasChanged group_id:"+n.channel+" not found")}else if("im"===n.type){var l=TS.interop.channels.getImById(n.channel,i);l?l.is_starred!=t&&T(n.channel,t):TS.warn("userStarStatusHasChanged im_id:"+n.channel+" not found")}else TS.error("userStarStatusHasChanged needs to handle star item type:"+n.type)},checkForStarClick:function e(t,n){if(!t.target)return false;var r=$(t.target);_.isFunction(n)||(n=_.noop);var i;var a=false;if(r.closest(".star").length)i=r.closest(".star");else{i=r.closest(".star_link");a=true}var s=false;if(!i||!i.length)if(r.is("button.file_star"))i=r.children(".star");else if(r.closest(".starred_icon").length){s=true;i=r.closest(".starred_icon")}if(!i||!i.length)return false;if(i.hasClass("not-clickable"))return false;var o=i.hasClass("starred");var l={};var u;if(s){var d=TS.redux.channels.getEntityById(i.data("c-id"));if(d){l.channel=d.id;o=d.is_starred;u=function e(t){d.is_channel?g(l.channel,t):d.is_im?T(l.channel,t):d.is_mpim?b(l.channel,t):d.is_group&&S(l.channel,t)}}}else if(i.hasClass("star_message")){l.channel=i.data("c-id");l.timestamp=i.data("msg-id");u=function e(t){f(l.timestamp,l.channel,t,true)}}else if(i.hasClass("star_file")){l.file=i.data("file-id");u=function e(t){h(l.file,t,a)}}else if(i.hasClass("star_file_comment")){l.file_comment=i.data("comment-id");u=function e(t){p(l.file_comment,i.data("file-id"),t)}}else if(i.hasClass("star_channel")){l.channel=i.data("channel-id");u=function e(t){g(l.channel,t)}}else if(i.hasClass("star_group")){l.channel=i.data("group-id");u=function e(t){S(l.channel,t)}}else if(i.hasClass("star_im")||i.hasClass("star_app")){l.channel=i.data("im-id");var c=false;TS.interop.apps.isAppSpaceEnabled()&&i.hasClass("star_app")&&(c=true);u=function e(t){T(l.channel,t,c)}}else{if(!i.hasClass("star_mpim")){TS.error("checkForStarClick doesn't know what to do with a click on "+i[0].outerHTML);return false}l.channel=i.data("mpim-id");u=function e(t){b(l.channel,t)}}i.parent("#star_container").length&&TS.interop.clog.track("GLOBAL_NAV",{contexts:{ui_context:{action:"CLICK",ui_component:"CHANNEL_HEADER",ui_element:"NAV_CHANNEL_STAR"}}});t.preventDefault();u(!o);n(!o);if(o){var m=function e(t,r){if(t)return;if("not_starred"===r.error){u(false);n(false)}else{u(true);n(true)}};TS.interop.api.call("stars.remove",l).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;m(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;m(i,t,n,r);return{data:t,args:n,request_id:r}})}else{var v=function e(t,r){if(t)return;if("already_starred"===r.error){u(true);n(true)}else{u(false);n(false)}};TS.interop.api.call("stars.add",l).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;v(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;v(i,t,n,r);return{data:t,args:n,request_id:r}})}return true},updateMsgStar:function e(t,n,r,i){f(t,n,r,i)},updateFileStar:function e(t,n){h(t,n)},updateFileCommentStar:function e(t,n,r){p(t,n,r)},toggleStarOnMsg:function e(t,n,r){if(!t||!n)return;var i=TS.utility.msgs.findMsg(t,n.id);if(!i)return;var a={channel:n.id,timestamp:t};var s=i.is_starred?"stars.remove":"stars.add";var o=function e(t,i){t?r&&r(n):i.error&&TS.error(i.error)};TS.interop.api.call(s,a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})},toggleStar:function e(t,n){var r=n?TS.redux.channels.getEntityById(n):TS.shared.legacyGetActiveModelOb();if(!r||TS.client.activeChannelIsHidden())return;var i=r.is_starred;var a={};a.channel=r.id;if(i){var s=function e(n,i){n?t&&t(r):i.error&&TS.error(i.error)};TS.interop.api.call("stars.remove",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}else{var o=function e(n,i){n?t&&t(r):i.error&&TS.error(i.error)};TS.interop.api.call("stars.add",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})}},toggleStarForActiveModel:function e(t){if(TS.client.activeChannelIsHidden())return;var n={preventDefault:_.noop,target:$("#star_container button.star").get(0)};try{TS.stars.checkForStarClick(n,t)}catch(e){TS.stars.toggleStar(function(e){t(e.is_starred)})}}});var e=1;var t=20;var n;var r=false;var i=false;var a=[];var s=function e(t,n){true===n.is_starred&&TS.stars.maybeUpdateUserStarredList()};var o=function e(n){r=true;i=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,true);var s=true;var o=c();o.page=1;o._update=true;o.count=Math.max(a.length,t);n&&n.delta&&(o.count+=n.delta);TS.interop.api.call("stars.list",o,null,s).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;u&&u(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;u&&u(i,t,n,r);return{data:t,args:n,request_id:r}})};var l=function e(t){if(t.hasOwnProperty("is_starred")){var n=$(".star_item");var r=TS.files.containerHasFileListItem(t,n);var i=!TS.interop.files.isObjectFresh(t.id);if(i&&r){TS.files.getFileById(t.id);return}if(r){h(t.id,t.is_starred,t.id);TS.files.updateFileListItem(t,n)}}};var u=function t(s,o,l){r=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,false);if(i){TS.stars.maybeUpdateUserStarredList();return}if(!s){TS.stars.member_stars_fetched_sig.dispatch({error:"api_not_ok"});return}for(var u=0;u<o.items.length;u+=1){var c=o.items[u];TS.stars.userStarStatusHasChanged(true,c,"stars.list")}if(1==l.page)a=o.items;else{a=a.concat(o.items);a=_.uniqWith(a,_.isEqual)}n.data("ladda")&&n.data("ladda").stop();d();TS.stars.has_more=o.paging.pages>o.paging.page;l._update||(e+=1);TS.stars.member_stars_fetched_sig.dispatch(null,TS.model.user)};var d=function e(){if("treatment"!=TS.stars.badge_star_menu)return;var t=Date.now()/1e3-259200;var n=_.countBy(a,function(e){return e.date_create>t});var r=_.get(n,true,0);0===r?$("#star_badge").hide():$("#star_badge").show().text(r>=20?"20+":r)};var c=function n(){var r={user:TS.model.user.id,exclude:"Ch,Gh,Dh",page:e,count:t};return r};var m=function e(t,n,r){if("message"===n.type){n.message._rxn_key=TS.rxns.getRxnKey("message",n.message.ts,n.channel);"channel_topic"!==n.message.type&&"channel_purpose"!==n.message.type&&"channel_join"!==n.message.type&&"channel_leave"!==n.message.type||(n.message.subtype=n.message.type);n.message.type="message"}else if("file"===n.type||"file_comment"===n.type){if(!n.file){TS.error("WTF no file in type "+n.type+" in "+r);return false}if(n.file_id){var i=TS.files.getFileById(n.file_id);if(!i)return false;TS.files.upsertAndSignal(v()({},i,{is_starred:t}),"slurpStarItem")}else TS.files.upsertAndSignal(n.file,"slurpStarItemFilesInfo");var a=n.file&&n.file.id;Object.defineProperty(n,"file",{enumerable:true,configurable:true,get:function e(){return TS.files.getFileById(a)},set:function e(){return false}});if("file_comment"===n.type){if(!n.comment){TS.error("WTF no comment in type "+n.type+" in "+r);return false}n.comment=TS.files.addCommentToFile(n.comment,n.file)}}else if("channel"===n.type);else if("group"===n.type);else if("im"!==n.type){TS.error("need to handle star item type:"+n.type+" in "+r);return false}return true};var f=function e(t,n,r,i){var a=TS.redux.channels.getEntityById(n);var s;a&&(s=TS.utility.msgs.findMsg(t,n));var o='.star_message[data-msg-id="'+t+'"][data-c-id="'+n+'"]';var l=$(o);if(i){var u={};var d=r?"STAR_ADD_CLICKED":"STAR_REMOVE_CLICKED";if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(t));TS.client.ui.unread.incrementTrackingSeqId()}_.merge(u,TS.ui.thread.getTrackingPayloadForEl(l));"threads_view"===TS.ui.thread.getContextForEl(l)&&TS.client.ui.threads.incrementTrackingSeqId();TS.interop.clog.track(d,u)}y(l,r,s)};var p=function e(t,n,r){var i=TS.files.getFileById(n);var a;i?a=TS.files.getFileCommentById(i,t):TS.warn("updateFileCommentStar file_id:"+n+" not found");var s='.star_comment[data-comment-id="'+t+'"]';y($(s),r,a)};var h=function e(t,n,r){var i=TS.files.getFileById(t);i||TS.warn("updateFileStar file_id:"+t+" not found");var a='.star_file[data-file-id="'+t+'"]';y($(a),n,i,r)};var g=function e(t,n){var r=TS.interop.channels.getPublicChannelById(t);r||TS.warn("updateChannelStar channel_id:"+t+" not found");r.is_starred=n;var i='.star_channel[data-channel-id="'+t+'"]';y($(i),n,r);if(TS.client){var a=TS.redux.channels.getEntityById(t);if(!a)return;n?TS.stars.channel_starred_sig.dispatch(a):TS.stars.channel_unstarred_sig.dispatch(a)}};var S=function e(t,n){var r=TS.interop.channels.getGroupById(t);r||TS.warn("updateGroupStar group_id:"+t+" not found");r.is_starred=n;var i='.star_group[data-group-id="'+t+'"]';y($(i),n,r)};var T=function e(t,n,r){var i=TS.interop.channels.getImById(t);i||TS.warn("updateImStar im_id:"+t+" not found");i.is_starred=n;var a="";a=r?'.star_app[data-im-id="'+t+'"]':'.star_im[data-im-id="'+t+'"]';y($(a),n,i)};var b=function e(t,n){var r=TS.interop.channels.getMpimById(t);r||TS.warn("updateMpimStar mpim_id:"+t+" not found");r.is_starred=n;var i='.star_mpim[data-mpim-id="'+t+'"]';y($(i),n,r)};var y=function e(t,n,r,i){n?t.hasClass("starred")||t.addClass("starred ts_icon_star").removeClass("ts_icon_star_o"):t.removeClass("starred ts_icon_star").addClass("ts_icon_star_o");i&&t.each(function(e){TS.tips.manuallyToggleTipTitle(t.eq(e))});r&&(r.is_starred=n)}})();var oe=n(2924);var le=n(2925);(function(){TS.registerModule("msg_edit",{editing:false,editing_in_msg_pane:false,editing_in_convo_pane:false,deleting_from_editing:false,current_msg:null,current_model_ob:null,mousedown_active:false,edit_interv:0,onStart:function e(){},onCountDownInterval:function e(){if(!TS.msg_edit.current_msg)return;if(-1==TS.prefs.getTeamPref("msg_edit_window_mins")||TS.interop.rules.channels.isYou(TS.msg_edit.current_model_ob)){$("#edit_countdown").empty();return}var t=TS.interop.datetime.toDateObject(TS.msg_edit.current_msg.ts).getTime()+60*TS.prefs.getTeamPref("msg_edit_window_mins")*1e3;var n=Math.floor((t-Date.now())/1e3);n<1?$("#edit_countdown").html(TS.interop.i18n.t("(your time to edit ran out)","msg_edit")()+"&nbsp&nbsp&nbsp&nbsp"):n<61?$("#edit_countdown").html(TS.interop.i18n.t("(you have <strong>{seconds_count, number}</strong> seconds)","msg_edit")({seconds_count:n})+"&nbsp&nbsp&nbsp&nbsp"):$("#edit_countdown").empty()},cancelEditingINothingHasChanged:function e(){if(!TS.msg_edit.editing)return true;var t=TS.format.unFormatMsg(TS.msg_edit.current_msg.text);var n=TS.utility.contenteditable.value($("#message_edit_form").find("#msg_text"));if(n===t){TS.msg_edit.onCancelEdit();return true}return false},editExpiration:function e(n){if(n>0){var r=t(n);if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")({msg_edit_duration_text:r})+"</p>";return'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")({msg_edit_duration_text:r})+"</p>"}if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")()+"</p>";return'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")()+"</p>"},startEdit:function t(n,r,i,a){if($("#message_edit_form").length&&!TS.msg_edit.cancelEditingINothingHasChanged()){TS.msg_edit.promptEdit();return}if(!n){TS.error("no msg_ts?");return null}if(!r){TS.error("no model_ob?");return null}a||(a=TS.utility.msgs.getMsg(n,e(r)));a||(a=TS.ui.replies.getActiveMessage(r,n));TS.model.threads_view_is_showing&&!a&&(a=TS.client.threads.getMessage(r,n));if(!a){TS.error("no msg in msgs?");return null}if("convo"!==i&&!TS.client.activeChannelIsHidden()){TS.redux.dispatch(TS.interop.redux.features.messageEdit.maybeStartEditingMessage({channelId:a.channel,ts:n,scroll:true}));return}var s=TS.format.unFormatMsg(a.text);var o=i&&i.force_reopen;if(!o){var l=Date.now();var u=TS.interop.datetime.toDateObject(a.ts);var d=l-u;var c=d/6e4;if(TS.prefs.getTeamPref("msg_edit_window_mins")>=0&&c>TS.prefs.getTeamPref("msg_edit_window_mins")&&!TS.interop.rules.channels.isYou(r)){TS.warn("Editing unavailable on channel "+r.id+", msg with ts = "+a.ts+". now = "+l+", elapsed (minutes) = "+c+", msg_edit_window_mins = "+TS.prefs.getTeamPref("msg_edit_window_mins"));var m=TS.prefs.getTeamPref("msg_edit_window_mins")>0?TS.interop.i18n.t("This message can\u2019t be edited","msg_edit")():TS.interop.i18n.t("Messages can\u2019t be edited","msg_edit")();TS.generic_dialog.alert(TS.msg_edit.editExpiration(TS.prefs.getTeamPref("msg_edit_window_mins")),m,TS.interop.i18n.t("Got It","msg_edit")());return}}var f;if("convo"===i){TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=true;f=TS.msg_edit.getDivForMsgInConvoPane(a.ts)}else{TS.msg_edit.editing_in_msg_pane=true;TS.msg_edit.editing_in_convo_pane=false;f=TS.msg_edit.getDivForMsgInMsgPane(a.ts)}if(!f.length){TS.error("no msg div for edit");return null}TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=r;f.addClass("hidden");var p=s;i&&i.text&&(p=i.text);var h=TS.templates.message_edit_form({msg:a,edit_text:p,permalink:TS.utility.msgs.constructMsgPermalink(r,a.ts,a.thread_ts),include_emo:!!TS.client,relative_ts:TS.interop.messages.isReply(a)});f.after(h);var g=$("#message_edit_form");var S=g;var T=g.find("#msg_text");TS.utility.contenteditable.create(T,{ariaLabel:TS.interop.i18n.t("Edit message","msg_edit")(),modules:{tabcomplete:{searchOptions:{},positionMenu:function e(t){t.style.width=T.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,T)},completers:["channels","emoji","members"]}},onEnter:function e(){TS.msg_edit.checkAndSubmit(T,g);return false},onEscape:function e(){TS.model.menu_is_showing||TS.model.dialog_is_showing||setTimeout(TS.msg_edit.onCancelEdit,0)},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(T)},enableBroadcastKeywords:!("convo"===i)});TS.utility.contenteditable.enable(T);T.on("keyup",function(){var e=TS.utility.contenteditable.cursorPosition(T);if(!e.length){var t=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);(!TS.client||g.outerHeight()<t.height)&&S.find(".edit_controls").scrollintoview({px_offset:-50})}});TS.utility.contenteditable.value(T,p);TS.msg_edit.checkLengthAndUpdateMessage(T);TS.info("message_edit_form added");TS.msg_edit.editing=true;g.bind("destroyed",function(){TS.utility.contenteditable.unload($("#message_edit_form #msg_text"));TS.info("message_edit_form removed");TS.msg_edit.editing=false;TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=false;g=null;T=null;TS.msg_edit.resetEditUI()});g.bind("submit",function(e){e.preventDefault();var t=TS.utility.contenteditable.value(T);t=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(t,{enableBroadcastKeywords:!("convo"===i)});if(t===s){TS.msg_edit.onCancelEdit();return}if(!t){var o=TS.utility.msgs.getMsgActions(a,r);var l=f.attr("id")===TS.templates.makeMsgDomIdInConversation(n)||f.attr("id")===TS.templates.makeMsgDomIdInThreadsView(n);o.remove_broadcast&&!l?TS.msg_edit.startRemoveBroadcast(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,true):o.delete_msg?TS.msg_edit.startDelete(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelEdit,true):TS.msg_edit.onConfirmEdit("~"+a.text.replace(/~/g,"")+"~");return}var u=TS.ui.needToBlockAtChannelKeyword(t,null,TS.msg_edit.current_model_ob.id);if(u){TS.generic_dialog.alert("<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{blocked_keyword}</strong> messages.","msg_edit")({blocked_keyword:TS.interop.i18n.safeString(_.escape(u))})+"</p>");return}if(!$.trim(t))return;TS.msg_edit.onConfirmEdit(t)});g.find("#commit_edit").bind("click",function(){TS.msg_edit.checkAndSubmit(T,g)});g.find("#cancel_edit").bind("click",function(){TS.msg_edit.onCancelEdit()});g.bind("mousedown",function(){TS.msg_edit.mousedown_active=true});g.bind("mouseup",function(){TS.msg_edit.mousedown_active=false});var v=g.find(".emo_menu");v.removeClass("hidden");v.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:"#msg_text"})});var b=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(!TS.client||g.outerHeight()<b.height)S.find(".edit_controls").scrollintoview({duration:500,px_offset:-50,complete:function e(){TS.msg_edit.focusAndSetCursorPosition(T,i)}});else{TS.msg_edit.focusAndSetCursorPosition(T,i);S.find(".edit_controls").scrollintoview({duration:500,px_offset:-50})}TS.msg_edit.onCountDownInterval();TS.msg_edit.edit_interv=setInterval(TS.msg_edit.onCountDownInterval,1e3)},isMessageTooLong:function e(t){var n=TS.format.cleanMsg(TS.utility.contenteditable.value(t));return n.length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH},updateTooLongWarning:function e(t,n){var r=$(t).parent().find(".edit_warning");n?r.removeClass("hidden"):$(t).parent().find(".edit_warning").addClass("hidden")},checkLengthAndUpdateMessage:function e(t){var n=TS.msg_edit.isMessageTooLong(t);TS.msg_edit.updateTooLongWarning(t,n);return!n},checkAndSubmit:function e(t,n){TS.msg_edit.checkLengthAndUpdateMessage(t)&&n.submit()},onConfirmEdit:function e(t){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}if(!t){TS.error("no edited_text?");return null}var n=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.commitEditInternal(t);TS.msg_edit.resetEditUI();if(TS.client)if(n){var r=true;TS.ui.replies.focusReplyInput(r)}else TS.view.focusMessageInput()},onCancelEdit:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.resetEditUI();if(TS.client)if(t){var n=true;TS.ui.replies.focusReplyInput(n)}else TS.view.focusMessageInput()},resetEditUI:function e(){clearInterval(TS.msg_edit.edit_interv);if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}TS.msg_edit.getDivBeingEdited().removeClass("hidden");$("#message_edit_container").remove()},getDivBeingEdited:function e(){if(TS.msg_edit.editing_in_msg_pane)return TS.msg_edit.getDivForMsgInMsgPane(TS.msg_edit.current_msg.ts);if(TS.msg_edit.editing_in_convo_pane)return TS.msg_edit.getDivForMsgInConvoPane(TS.msg_edit.current_msg.ts);return $()},getDivForMsgInMsgPane:function e(t){var n=TS.model.unread_view_is_showing;var r=TS.model.threads_view_is_showing;if(n)return $("#"+TS.templates.makeMsgDomIdInUnreadView(t));if(r)return $("#"+TS.templates.makeMsgDomIdInThreadsView(t));return $("#"+TS.templates.makeMsgDomId(t))},getDivForMsgInConvoPane:function e(t){return $("#"+TS.templates.makeMsgDomIdInConversation(t))},getAllDivsForMsg:function e(t){var n=TS.msg_edit.getDivForMsgInMsgPane(t);return n.add(TS.msg_edit.getDivForMsgInConvoPane(t))},commitEditInternal:function e(t){TS.msg_edit.commitEdit(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,t)},commitEdit:function e(n,r,i,a,s){if(!n){TS.error("no msg?");return null}if(!r){TS.error("no model_ob?");return null}a||(a=0);s||(s=100);var o=function e(a,s,o){if(a){var l=false;TS.boot_data.feature_degraded_send&&TS.interop.rules.messages.isReply(n)&&n.text!==s.text&&(l=true);if(TS.web||r.is_channel&&!r.is_member||l){var u=_.extend({},n,{text:s.text,edited:{ts:TS.interop.datetime.makeTsStamp(null,{padder:"0"})}});TS.utility.msgs.replaceMsg(r,u)}}else{if(s&&s.error)if("message_not_found"===s.error){if(o._attempts<10){o._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitEdit(n,r,i,o._attempts+1,o._delay_ms)},o._delay_ms);return}r.is_channel?TS.channels.legacyRemoveMsg(r.id,n):r.is_im?TS.ims.legacyRemoveMsg(r.id,n):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,n):r.is_group&&TS.groups.legacyRemoveMsg(r.id,n);TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")())}else if("edit_window_closed"===s.error){var d="<p>"+TS.interop.i18n.t("Sorry, but messages can only be edited for <strong>{msg_edit_duration_text}</strong> after posting.","msg_edit")({msg_edit_duration_text:t(TS.prefs.getTeamPref("msg_edit_window_mins"))})+"</p>";TS.model.user.is_admin&&(d+="<p>"+TS.interop.i18n.t('(To adjust the message editing window, visit <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.)',"msg_edit")()+"</p>");TS.generic_dialog.alert(d,TS.interop.i18n.t("Message editing failed","msg_edit")())}else"msg_too_long"===s.error?TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, your message is too long. Please shorten it and try again.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")()):TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());else TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());TS.msg_edit.startEdit(n.ts,r,{text:i,force_reopen:true})}};return TS.interop.api.call("chat.update",{channel:r.id,ts:n.ts,text:TS.format.cleanMsg(i),_attempts:a,_delay_ms:s}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})},promptEdit:function e(){if("none"!==$("#message_editing_info").css("display")){$("#message_edit_container").scrollintoview({duration:300,px_offset:0});return}$("#message_editing_info").css("display","");$("#message_editing_info").css("opacity",0);$("#message_edit_container").scrollintoview({duration:300,px_offset:0,complete:function e(){$("#message_editing_info").transition({opacity:1},250)}})},startDelete:function t(n,r,i,a,s){s=s||_.noop;if(!n){TS.error("no msg_ts?");s();return null}_.isString(r)&&(r=TS.redux.channels.getEntityById(r));if(!r){TS.error("no model_ob?");s();return null}var o=TS.redux.messages.getMessageByTimestamp(r.id,n);o&&o.file&&(o=v()({},o,{file:TS.redux.files.getFileById(o.file)}));o||(o=TS.utility.msgs.getMsg(n,e(r)));o||(o=TS.ui.replies.getActiveMessage(r,n));TS.model.threads_view_is_showing&&!o&&(o=TS.client.threads.getMessage(r,n));if(!o){TS.error("no msg in msgs?");s();return null}TS.msg_edit.deleting_from_editing=!!a;TS.msg_edit.current_msg=o;TS.msg_edit.current_model_ob=r;var l=TS.msg_edit.getAllDivsForMsg(o.ts);var u='<p class="bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete this message? This cannot be undone.","msg_edit")()+"</p>";if(o.subtype){var d;if(o.file){d="file";"snippet"===o.file.mode?d="snippet":"post"===o.file.mode&&(d="post")}var c="";"file_upload"===o.subtype?"file"===d?c=TS.interop.i18n.t("Note that deleting this message will not delete the file that was uploaded.","msg_edit")():"snippet"===d?c=TS.interop.i18n.t("Note that deleting this message will not delete the snippet that was uploaded.","msg_edit")():"post"===d&&(c=TS.interop.i18n.t("Note that deleting this message will not delete the post that was uploaded.","msg_edit")()):"file_share"===o.subtype?"file"===d?c=TS.interop.i18n.t("Note that deleting this message will not unshare the file.","msg_edit")():"snippet"===d?c=TS.interop.i18n.t("Note that deleting this message will not unshare the snippet.","msg_edit")():"post"===d&&(c=TS.interop.i18n.t("Note that deleting this message will not unshare the post.","msg_edit")()):"file_comment"===o.subtype&&(c=TS.interop.i18n.t("Note that deleting this message will not delete the comment.","msg_edit")());c&&(u+="<p>"+c+"</p>")}l.addClass("delete_mode");TS.generic_dialog.start({title:TS.interop.i18n.t("Delete message","msg_edit")(),body:u+TS.templates.builders.msgs.buildHTML({msg:o,model_ob:r,standalone:true}),go_button_text:TS.interop.i18n.t("Delete","msg_edit")(),go_button_class:"btn_danger",onGo:function e(){TS.msg_edit.deleting_from_editing&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:r.id,ts:n}));TS.msg_edit.commitDeleteInternal(i)},onCancel:function e(){TS.msg_edit.onCancelDelete()},onEnd:s});TS.generic_dialog.div.find("img.msg_inline_img.hidden").each(function(e,t){var n=$(t);n.prop("src",n.data("real-src"));n.removeClass("hidden")})},onCancelDelete:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.getAllDivsForMsg(TS.msg_edit.current_msg.ts);t.removeClass("delete_mode");TS.msg_edit.deleting_from_editing&&TS.utility.contenteditable.focus($("#msg_text"))},commitDeleteInternal:function e(t){TS.msg_edit.commitDelete(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelDelete,t)},commitDelete:function t(n,r,i,a,s,o,l){if(!n){TS.error("no msg?");return null}if(!r){TS.error("no model_ob?");return null}var u=r.id;o||(o=0);l||(l=100);if(n.is_ephemeral||TS.interop.rules.messages.isTempMsg(n))r.is_channel?TS.channels.legacyRemoveMsg(r.id,n):r.is_im?TS.ims.legacyRemoveMsg(r.id,n):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,n):r.is_group&&TS.groups.legacyRemoveMsg(r.id,n);else{if(n._jl_rollup_hash&&n._jl_rollup_hash.msg_ids){var d=n._jl_rollup_hash.msg_ids;d.forEach(function(t){if(t==n.ts)return;var d=function t(o,l,u){if(o||"message_not_found"===l.error){if("message_not_found"===l.error&&u._attempts<10){u._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(n,r,i,a,s,u._attempts+1,u._delay_ms)},u._delay_ms);return}(TS.web||r.is_channel&&!r.is_member)&&(r.is_channel?TS.channels.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))):r.is_im?TS.ims.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))):r.is_group&&TS.groups.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))))}};TS.interop.api.call("chat.delete",{channel:u,ts:t,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d(i,t,n,r);return{data:t,args:n,request_id:r}})})}var c=function e(t,o,l){if(t||"message_not_found"===o.error){if("message_not_found"===o.error&&l._attempts<10){l._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(n,r,i,a,s,l._attempts+1,l._delay_ms)},l._delay_ms);return}(TS.web||r.is_channel&&!r.is_member)&&(r.is_channel?TS.channels.legacyRemoveMsg(r.id,n):r.is_im?TS.ims.legacyRemoveMsg(r.id,n):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,n):r.is_group&&TS.groups.legacyRemoveMsg(r.id,n));a&&a()}else{i&&i();if(!s){var u;u=o&&o.error?TS.interop.i18n.t("The message was not deleted. The error was: {error}","msg_edit")({error:o.error}):TS.interop.i18n.t("The message was not deleted. The error was: unknown","msg_edit")();TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Message Failed","msg_edit")(),body:u,show_cancel_button:false,esc_for_ok:true})}}if(TS.web){var d=!TS.utility.msgs.getDisplayedMsgs(r.msgs).length;if(d){var c=$(".pager .previous a");c.attr("href")?window.location=c.attr("href"):TS.reload(false,"TS.msg_edit.commitEdit")}}};TS.interop.api.call("chat.delete",{channel:u,ts:n.ts,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;c(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;c(i,t,n,r);return{data:t,args:n,request_id:r}})}},$last_clicked_cb:null,startBatchDelete:function e(){$("#msgs_div").addClass("selecting_messages");$("#channel_actions_div").addClass("hidden");$("#batch_delete_div").removeClass("hidden");TS.msg_edit.batchDeleteSelectionChanged()},cancelBatchDelete:function e(){TS.msg_edit.selectNoneBatchDelete();$("#msgs_div").removeClass("selecting_messages");$("#channel_actions_div").removeClass("hidden");$("#batch_delete_div").addClass("hidden")},doBatchDelete:function t(){var n=$("#msgs_div").find(".msg_select_cb:checked");var r=TS.shared.legacyGetActiveModelOb();if(n.length){var i=n.length;if(1==i){TS.msg_edit.startDelete(n.eq(0).closest(".message").data("ts"),r,TS.msg_edit.cancelBatchDelete);return}var a='<p class="small_bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete {count, plural, =1 {this message} other {these messages}}? This cannot be undone! Note that deleting these messages will not delete any files or file comments.","msg_edit")({count:i})+"</p>";var s;var o;for(var l=0;l<i;l+=1){o&&!o.no_display&&(s=o);var u=n.eq(l).closest(".message").data("ts");o=TS.utility.msgs.getMsg(u,e(r));if(!o)continue;a+=TS.templates.builders.msgs.buildHTML({msg:o,prev_msg:s,model_ob:r,standalone:true})}var d=function e(t){function n(e){TS.msg_edit.commitDelete(e,r,i,i,true)}function i(){if(t.length)setTimeout(function(){n(t.pop())},100);else{TS.generic_dialog.cancel();TS.generic_dialog.start({title:"",body:TS.interop.i18n.t("Messages deleted.","msg_edit")(),show_cancel_button:false,esc_for_ok:true})}}TS.generic_dialog.start({title:"",body:"<p>"+TS.interop.i18n.t("Deleting messages...","msg_edit")()+"</p>",show_cancel_button:false,show_go_button:false});i()};TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Messages","msg_edit")(),body:a,go_button_text:TS.interop.i18n.t("Yes, delete these messages","msg_edit")(),go_button_class:"btn_danger",onGo:function t(){var a=[];for(var s=0;s<i;s+=1){var o=n.eq(s).closest(".message").data("ts");if(!o){alert("no msg_ts");return}var l=TS.utility.msgs.getMsg(o,e(r));if(!l){alert("no msg");return}a.push(l)}TS.msg_edit.cancelBatchDelete();d(a)}})}},batchDeleteSelectionChanged:function e(t,n){var r=TS.msg_edit.$last_clicked_cb;if(r&&t&&n){var i=$("#msgs_div").find(".msg_select_cb:visible");var a=i.index(r);var s=i.index(t);if(a>s){s=a;a=i.index(t)}var o="checked"===r.prop("checked");for(var l=a;l<=s;l+=1)i.eq(l).prop("checked",o)}r=t;TS.msg_edit.$last_clicked_cb=r;var u=TS.interop.i18n.t("0 messages","msg_edit")();var d=$("#msgs_div").find(".msg_select_cb:checked");$("#msgs_div").find(".multi_delete_mode").removeClass("multi_delete_mode");if(d.length){u=TS.interop.i18n.t("{count, plural, =1 {# message} other {# messages}}","msg_edit")({count:d.length});$("#batch_delete_button").removeClass("disabled");d.each(function(){$(this).closest(".message").addClass("multi_delete_mode")})}else $("#batch_delete_button").addClass("disabled");$("#batch_delete_count_span").html(u)},selectAllBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",true);TS.msg_edit.batchDeleteSelectionChanged()},selectNoneBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",false);TS.msg_edit.batchDeleteSelectionChanged()},startRemoveBroadcast:function e(t,n,r,i){i=i||_.noop;_.isString(n)&&(n=TS.redux.channels.getEntityById(n));var a=TS.utility.msgs.findMsg(t,n.id);if(!a){TS.error("Cannot find "+t+" for startRemoveBroadcast");i();return}TS.msg_edit.deleting_from_editing=!!r;TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=n;var s=TS.msg_edit.getDivForMsgInMsgPane(t);var o=n.is_channel||n.is_group&&!n.is_mpim;var l=TS.templates.builders.msgs.buildHTML({msg:a,model_ob:n,standalone:true});var u=TS.templates.thread_confirm_remove_broadcast({is_channel_or_group:o,msg_html:new Handlebars.SafeString(l)});s.addClass("delete_mode");var d;d=o?TS.interop.i18n.t("Remove from channel","msg_edit")():TS.interop.i18n.t("Remove from conversation","msg_edit")();TS.generic_dialog.start({title:d,body:u,go_button_text:TS.interop.i18n.t("Remove message","msg_edit")(),onGo:function e(){TS.msg_edit.deleting_from_editing&&TS.msg_edit.onCancelEdit();TS.interop.api.call("chat.delete",{channel:n.id,ts:a.ts,broadcast_delete:true}).then(function(){TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:n.id,ts:a.ts}));TS.web&&(n.is_channel?TS.channels.legacyRemoveMsg(n.id,a):n.is_im?TS.ims.legacyRemoveMsg(n.id,a):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,a):n.is_group&&TS.groups.legacyRemoveMsg(n.id,a))}).catch(function(e){TS.error("Failed to remove broadcast "+a.ts);TS.error(e);TS.msg_edit.current_msg===a&&TS.msg_edit.onCancelDelete()})},onCancel:function e(){TS.msg_edit.onCancelDelete()},onEnd:i})},pauseEditing:function e(){if(!TS.msg_edit.editing)return;var t=$("#msg_text");var n=TS.utility.contenteditable.value(t);var r=TS.utility.contenteditable.cursorPosition(t);var i={msg_ts:TS.msg_edit.current_msg.ts,model_ob:TS.msg_edit.current_model_ob,text:n,cursor_start:r.start,cursor_length:r.length};TS.msg_edit.resetEditUI();return i},resumeEditing:function e(t){if(TS.msg_edit.editing)return;if(!t)return;if(TS.model.active_cid!==t.model_ob.id)return;TS.msg_edit.startEdit(t.msg_ts,t.model_ob,t)},focusAndSetCursorPosition:function e(t,n){TS.utility.contenteditable.focus(t);TS.utility.rAF(function(){n&&_.isFinite(n.cursor_start)&&_.isFinite(n.cursor_length)?TS.utility.contenteditable.cursorPosition(t,n.cursor_start,n.cursor_length):TS.utility.contenteditable.cursorPosition(t,1e8,0)})}});var e=function e(t){return TS.model.archive_view_is_showing&&t._archive_msgs?t._archive_msgs:t.msgs};var t=function e(t){return TS.interop.datetime.toTimeDuration(t,{units:"minutes"})}})();var ue=n(2926);var de=n(2927);var ce=n(2928);var _e=n(2929);var me=n(2930);var fe=n(2931);var pe=n(2932);var he=n(2933);var ge=n(2934);var Se=n(2935);var Te=n(2936);var ve=n(2937);var be=n(2938);var ye=n(2939);var we=n(2940);var ke=n(2941);var xe=n(2942);var Ce=n(2943);var Ie=n(2944);var Me=n(2945);var Ae=n(1980);var Ee=n(2946);var Pe=n(2947);(function(){TS.registerModule("utility.contenteditable",{create:function e(t,a){a||(a={});t=r(t);if(!t)return;if(i(t))return;if(o(t))return;var s={modules:{tabcomplete:{searchOptions:{},appendMenu:function e(t){$("body").prepend(t)},render:TS.tabcomplete.render,trailingPunctuationChars:TS.interop.texty.TRAILING_PUNCTUATION_CHARACTERS,shouldCompleteOnTab:function e(){return!TS.i18n.sendButtonEnabled()},onRender:function e(){TS.tips.texty.hide()},tooltipIsShowing:function e(){return TS.tips.texty.isShowing()},tooltipShow:function e(t){TS.tips.texty.show(t)},tooltipHide:function e(){TS.tips.texty.isShowing()&&TS.tips.texty.hide()}},textsubstitutions:{getTextPreferences:function e(){if($("#chat_input_tab_ui").length)return null;return TS.interop.utility.getSystemTextPreferences()}},clipboard:{onPaste:function e(n){return TS.utility.contenteditable.paste(t,n)}},keyboard:{featureReactMessages:TS.boot_data.feature_react_messages,featureFileThreads:TS.boot_data.feature_file_threads,useFormattingCommands:true,shouldInsertNewline:function e(n){return TS.interop.texty.shouldInsertNewline(v()({},n,{useSendButton:TS.i18n.sendButtonEnabled(),usePreNewlines:TS.prefs.getPref("enter_is_special_in_tbt"),isCursorInPreBlock:TS.utility.contenteditable.isCursorInPreBlock(t)}))}},slackmention:true},onEnter:function e(){if(TS.boot_data.feature_file_threads)return false;return true},onEscape:function e(){if(TS.boot_data.feature_file_threads)return false;return true},onTab:function e(){return true},onMentionReplace:function e(r){var i=r.replacements,a=r.isLastReplacement;if(a&&1===i.length&&"UNVERIFIED"!==i[0].id){var s=t.querySelectorAll(".c-member_slug[data-id="+i[0].id+"]");if(1===s.length&&s[0].offsetTop>=t.offsetTop){TS.tips.texty.show(s[0]);n=setTimeout(function(){TS.tips.texty.hide();n=null},1500)}}},singleLineInput:false,inlineEmojiIsEnabled:TS.utility.contenteditable.inlineEmojiIsEnabled,convertEmoticonsIsEnabled:function e(){return TS.prefs.getPref("convert_emoticons")},isJumbomojiEnabled:false,onTextChange:_.noop,useLists:true,useSonicEmoji:TS.boot_data.feature_sonic_emoji,getLocale:function e(){return TS.interop.i18n.locale},getTeamId:function e(){return TS.model.team.id},enableBroadcastKeywords:true,isAutocompleteOpen:function e(){return!!$("#chat_input_tab_ui").length},getBroadcastKeywords:function e(){return _.curry(TS.interop.broadcast_keywords.getBroadcastKeywordsForUser)(TS.model.active_cid)},getUserHighlightWords:TS.interop.prefs.getHighlightWords,promiseToSearchMembers:d,className:"texty_legacy",tabIndex:0,showMentionTooltips:true,getEmojiNames:TS.emoji.legacyGetEmojiNames,logger:TS.interop.utility.getLogger({teamId:TS.model.team.id})};_.defaultsDeep(a,s);if(a.modules&&a.modules.tabcomplete){a.modules.tabcomplete.completers||(a.modules.tabcomplete.completers=["channels","commands","emoji","members"]);a.modules.tabcomplete.completers=_.compact(a.modules.tabcomplete.completers.map(function(e){if("channels"===e)return TS.tabcomplete.channels;if("commands"===e)return TS.tabcomplete.commands;if("emoji"===e)return TS.tabcomplete.emoji;if("members"===e)return TS.tabcomplete.members;TS.error("TEXTY","Invalid completer passed to texty");return null}))}if(!a.singleLineInput){var u=a.onTextChange;a.onTextChange=function(e){n||TS.tips.texty.hide();u(e)}}var c=new TS.interop.texty.TextyClass(t,a);l(t,c);return c},inlineEmojiIsEnabled:function e(){if(!TS.prefs.prefs_loaded)return"as_text"!==TS.boot_data.pref_emoji_mode;return!TS.interop.rules.emoji.shouldRenderEmojiAsText()},isJumbomojiEnabled:function e(){if(!TS.prefs.prefs_loaded)return TS.utility.contenteditable.inlineEmojiIsEnabled()&&!!TS.boot_data.pref_jumbomoji&&"dense"!==TS.boot_data.pref_messages_theme;return TS.utility.contenteditable.inlineEmojiIsEnabled()&&TS.prefs.getPref("jumbomoji")&&"dense"!==TS.prefs.getPref("theme")},refreshJumbomoji:function e(t){t=r(t);if(!t)return;if(!a(t))return;var n=o(t);n&&n.refreshJumbomoji()},refreshContents:function e(t){t=r(t);if(!t)return;if(!a(t))return;var n=o(t);if(n){var i=TS.utility.contenteditable.value(t);var s=TS.interop.texty.convertContentsStringToContents(i,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});n.refreshContents(s)}},unload:function e(t){t=r(t);if(!t)return;if(!a(t))return;var n=o(t);if(n){n.unload();u(t)}},isActiveElement:function e(t){t=r(t);if(!t)return false;if(i(t))return document.activeElement===t;if(a(t)){var n=o(t);if(n.hasFocus())return true;return document.activeElement&&-1!=document.activeElement.className.indexOf("ql-clipboard")&&document.activeElement.parentNode===t}return false},focus:function e(t){t=r(t);if(!t)return;if(i(t))t.focus();else if(a(t)){var n=o(t);n.focus()}},hasFocus:function e(t){t=r(t);if(!t)return;if(i(t))return $(t).is(":focus");if(a(t)){var n=o(t);return n.hasFocus()}},blur:function e(t){t=r(t);if(!t)return;if(i(t))t.blur();else if(a(t)){var n=o(t);n.blur()}},disable:function e(t){t=r(t);if(!t)return;if(i(t))t.disabled=true;else if(a(t)){var n=o(t);n.disable()}},isDisabled:function e(t){t=r(t);if(!t)return;if(i(t))return true===t.disabled;if(a(t)){var n=o(t);return!n.isEnabled()}return false},enable:function e(t){t=r(t);if(!t)return;if(i(t))t.disabled=false;else if(a(t)){var n=o(t);n.enable();TS.utility.contenteditable.updateSpellCheck(t)}},isEnabled:function e(t){t=r(t);if(!t)return false;if(i(t))return true!==t.disabled;if(a(t)){var n=o(t);return n.isEnabled()}return false},value:function e(t,n){t=r(t);if(!t)return"";if(i(t)){_.isString(n)&&(t.value=n);return t.value}if(a(t)){var s=o(t);if(_.isString(n)){var l=TS.interop.texty.convertContentsStringToContents(n,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});s.setContents(l)}else _.isObject(n)&&s.setContents(n);return TS.interop.texty.convertContentsToString(s.getContents())}return""},displayValue:function e(t){t=r(t);if(!t)return"";if(i(t))return t.value;if(a(t))return TS.interop.texty.convertContentsStringToDisplayString(TS.utility.contenteditable.value(t),TS.interop.prefs.getHighlightWords());return""},getContentsForRange:function e(t,n,i){t=r(t);if(!a(t))return;var s=o(t);return s.getContentsForRange({index:n,length:i})},getLength:function e(t){t=r(t);if(!t)return 0;if(i(t))return t.value.length;if(a(t)){var n=o(t);return n.getLength()}return 0},getDisplayValueLength:function e(t){return TS.utility.contenteditable.displayValue(t).length},getTextForRange:function e(t,n,s){t=r(t);if(!t)return"";if(i(t)){var l=TS.utility.contenteditable.value(t);return l.substr(n,s)}if(a(t)){var u=o(t);return u.getTextForRange(n,s)}return""},getDisplayTextForRange:function e(t,n,s){t=r(t);if(!t)return"";if(i(t)){var l=TS.utility.contenteditable.value(t);return l.substr(n,s)}if(a(t)){var u=o(t);return TS.interop.texty.convertContentsToStringForDisplay({contents:u.getContentsForRange(n,s).ops})}return""},insertTextAtCursor:function e(t,n,s){t=r(t);if(!t)return;var l;if(i(t)){if(!_.isString(n))return t.value;l=TS.utility.contenteditable.cursorPosition(t);var u=TS.utility.contenteditable.value(t);var d=u.substr(0,l.start)+n+u.substr(l.start);t.value=d;if(s){TS.utility.contenteditable.focus(t);TS.utility.contenteditable.cursorPosition(t,l.start+n.length,0)}}else if(a(t)){var c=o(t);_.isString(n)&&c.insertTextAtCursor(n,s)}},insertContentsAtCursor:function e(t,n,s){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"api";t=r(t);if(!t)return;if(i(t))TS.utility.contenteditable.insertTextAtCursor(t,TS.interop.texty.convertContentsToString(n),s);else if(a(t)){var u=o(t);u.insertContentsAtCursor(n,s,l)}},updateContents:function e(t,n){t=r(t);if(!t)return;if(i(t))TS.warn("updateContents called on form element");else if(a(t)){var s=o(t);s.updateContents(n)}},paste:function t(n,s){n=r(n);if(!n)return false;if(i(n))return false;if(!a(n))return false;var o=void 0;var l=s&&s.clipboardData&&s.clipboardData.types;var u=void 0;if(!l||!l.length){u=window.clipboardData&&window.clipboardData.getData("Text");if(!u){TS.interop.console.info("CONTENTEDITABLE","no MIME types in clipboard");return false}}if(u){TS.interop.console.info("CONTENTEDITABLE","Using alternate clipboard");o={contents:[{insert:u}]}}else{l=Array.prototype.slice.call(l);TS.interop.console.info("CONTENTEDITABLE",'MIME types in clipboard: "'+l.join(', "')+'"');o=TS.interop.texty.getContentsFromClipboard(s,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale})}if(!o){TS.interop.console.info("CONTENTEDITABLE","nothing usable in clipboard");return false}s.preventDefault();var d=TS.interop.texty.detachInvalidMentionsFromContents(o,function(e){return c(e.id)});var _=TS.interop.texty.convertContentsToStringForDisplay(d);if(_.length>e){s.stopPropagation();m(n);TS.interop.console.info("CONTENTEDITABLE","paste contents exceeded limit");return true}TS.utility.contenteditable.insertContentsAtCursor(n,d,true,"user");TS.interop.console.info("CONTENTEDITABLE",'pasted into "'+n.id+'"');return true},getFormats:function e(t,n){t=r(t);if(!t)return{};if(a(t)){var i=o(t);return i.getFormats(n)}return{}},isEmpty:function e(t,n){var r=TS.utility.contenteditable.value(t);r&&n&&(r=r.trim());return 0===r.length},clear:function e(t,n){t=r(t);if(!t)return;if(i(t))t.value="";else if(a(t)){var s=o(t);s.clear({is_silent:!!n})}},placeholder:function e(t,n){t=r(t);if(!t)return"";var s;if(i(t)){_.isString(n)&&(""===n?t.removeAttribute("placeholder"):t.setAttribute("placeholder",n));s=t.getAttribute("placeholder")}else if(a(t)){var l=o(t);l.setPlaceholder(n);s=l.getPlaceholder()}return s||""},ariaLabel:function e(t,n){t=r(t);if(!t)return;if(a(t)){var i=o(t);i.setAriaLabel(n)}},cursorPosition:function e(t,n,s){_.isString(t)&&(t=$(t));var l;var u={start:0,end:0,length:0};t=r(t);if(!t)return u;if(_.isNumber(n)){s||(s=0);u.start=n;u.end=n+s;u.length=s;if(i(t))TS.selection.selectCharacters(t,u.start,u.end);else if(a(t)){l=o(t);l.setSelection(u.start,u.length)}}else{if(!TS.utility.contenteditable.isActiveElement(t)){var d=$(t).data("utility-contenteditable-cursor-position");if(_.isObject(d))return d}if(i(t)){t.focus();u.start=t.selectionStart;u.end=t.selectionEnd;u.length=Math.abs(t.selectionEnd-t.selectionStart)}else if(a(t)){l=o(t);var c=l.getSelection();if(c){u.start=c.index;u.length=c.length;u.end=u.start+u.length}}}return u},setCursorAtEnd:function e(n){var i=TS.utility.contenteditable.getLength(n);TS.utility.contenteditable.cursorPosition(n,i);n=r(n);if(!a(n))return;$(n).find(".ql-editor").get(0).scrollLeft=t},selectAll:function e(t){var n=TS.utility.contenteditable.getLength(t);TS.utility.contenteditable.cursorPosition(t,0,n)},isTextSelected:function e(t){t=r(t);if(!t)return;if(i(t))return!!(window.getSelection&&window.getSelection().toString());if(a(t)){var n=o(t);return n.getSelection().length>0}},deserialize:function e(t,n){if(!n)return;t=r(t);if(!t)return;if(i(t))t.value=n;else if(a(t)){if("object"===("undefined"===typeof n?"undefined":s()(n))&&n.hasOwnProperty("contents")){TS.utility.contenteditable.value(t,n);return}if("string"!==typeof n)return;try{var o=JSON.parse(n);if(null!==o&&"object"===("undefined"===typeof o?"undefined":s()(o))){TS.utility.contenteditable.value(t,o);return}}catch(e){}TS.utility.contenteditable.value(t,n)}},isCursorInPreBlock:function e(t){t=r(t);if(!t)return false;if(a(t)){var n=o(t);return n.isCursorInPreBlock()}return false},isIndexInCode:function e(t,n){t=r(t);if(!t)return false;if(a(t)){var i=o(t);return i.isIndexInCode(n)}return false},deleteSelection:function e(t){t=r(t);if(!t)return false;if(a(t)){var n=o(t);return n.deleteSelection()}window.getSelection().deleteFromDocument()},deleteText:function e(t,n,i){t=r(t);if(!t)return;if(a(t)){var s=o(t);s.deleteText(n,i)}},clearHistory:function e(t){t=r(t);if(!t)return false;var n=o(t);if(!n)return;n.clearHistory()},updateSpellCheck:function e(t){t=r(t);if(!t)return false;var n=o(t);if(!n)return;$(t).find("[contenteditable=true]").attr("spellcheck",!!(TS.client&&TS.prefs.getPref("webapp_spellcheck")))},legacySynchronouslyReplacePotentialMentions:function e(t,n){n=_.defaults(n||{},{enableBroadcastKeywords:true});if(!t.length)return t;var r=TS.interop.texty.convertContentsStringToContents(t,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});var i={usergroups:TS.interop.userGroups.getActiveUserGroups(),members:TS.members.getActiveMembersWithSelfAndSlackbot()};var a={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};var s=[];if(n.enableBroadcastKeywords){var o=TS.shared.legacyGetActiveModelOb();o&&(s=TS.interop.broadcast_keywords.getBroadcastKeywordsForUser(o.id))}var l=TS.interop.texty.replacePotentialMentionsSynchronously({contents:new TS.interop.texty.Delta(r.contents),highlightWords:TS.interop.prefs.getHighlightWords(),searchFunc:function e(t){var n=t.replace(/^[@\uff20]/,"");var r=TS.interop.texty.getBroadcastMatch(s,n);if(r)return[r];return TS.sorter.search(n,i,a)}});return TS.interop.texty.convertContentsToString({contents:l.ops})},test:function e(){var e={_normalizeInput:r,_isFormElement:i};return e}});var e=5e4;var t=1e4;var n=null;var r=function e(t){if(!t)return false;t instanceof jQuery&&t[0]&&(t=t[0]);if(t.nodeType!==Node.ELEMENT_NODE)return false;if("textarea"===t.tagName.toLowerCase())return t;if("input"===t.tagName.toLowerCase())return t;if($(t).hasClass("ql-editor"))return t.parentNode;if(t.hasAttribute("contenteditable"))return t;if("DIV"===t.tagName)return t;return false};var i=function e(t){if(!t||!t.tagName)return false;if("textarea"===t.tagName.toLowerCase())return true;if("input"===t.tagName.toLowerCase())return true;return false};var a=function e(t){if(!t)return false;var n=o(t);if(n)return true;return false};var o=function e(t){return $(t).data("__ts_quill")};var l=function e(t,n){$(t).data("__ts_quill",n);$(t).attr("data-contenteditable-override","true")};var u=function e(t){$(t).removeData("__ts_quill")};var d=function e(t,n){var r;n.no_model_ob||(r=n.model_ob||TS.shared.legacyGetActiveModelOb());var i={query:t.replace(/^[@\uff20]/,""),max_api_results:20,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false,limit_by_model_relevancy:r};return TS.members.promiseToSearchMembers(i).then(function(e){var n={usergroups:TS.interop.userGroups.getActiveUserGroups(),members:e&&e.items?e.items:[]};var r={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};return TS.sorter.search(t,n,r)})};var c=function e(t){if(TS.interop.members.getMemberById(t))return true;var n=TS.interop.userGroups.getUserGroupById(t);if(n&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(n))return true;var r=TS.utility.members.getBroadcastKeywordsForUser();var i=_.map(r,"id");if(_.includes(i,t))return true;return false};var m=function e(t){var n=TS.interop.i18n.t("That\u2019s a bit too long to paste","msg_input")();var r=TS.interop.i18n.t("To keep things running smoothly, there\u2019s a limit on the number of characters you can paste into Slack. If you\u2019d like you could <b>create a snippet</b> instead.","msg_input")();r='<p class="no_bottom_margin">'+r+"</p>";TS.generic_dialog.start({title:n||"",body:r,show_cancel_button:false,esc_for_ok:true,fullscreen:false,go_button_text:TS.interop.i18n.t("OK","msg_input")(),show_secondary_go_button:t===TS.client.msg_input.$input.get(0),secondary_go_button_text:TS.interop.i18n.t("Create a snippet","msg_input")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){TS.ui.snippet_dialog.startCreate()}})}})();(function(){TS.registerModule("utility.attachments",{hasContent:function t(n,r){if(!n)return false;_.isArray(r)||(r=[].concat(r));if(TS.attachment_actions.client_buttons.isClientButtonAttachment(n))return true;var i=_.difference(e,r);return _.some(i,function(e){return!_.isEmpty(n[e])})},getMediaSource:function e(t){if(!t)return;var n=TS.utility.attachments.getMediaType(t);switch(n){case"video":return t.thumb_url;case"audio":return t.audio_html||t.audio_url;case"other":return t.other_html;case"image":return t.image_url;default:break}return t.from_url},getMediaType:function e(t){if(!t)return;if(t.video_html)return"video";if(t.audio_html||t.audio_url)return"audio";if(t.other_html)return"other";if(t.image_url)return"image"},getDecoratedAttachment:function e(t,n){var d=_.cloneDeep(t);d=r(d);d._source=i(d);a(d)?d=s(d,n):"twitter"===d.service_name?d=o(d):"salesforce"===d.service_name&&(d=l(d));if(d.is_app_unfurl&&d.bot_id){var c=TS.interop.bots.getBotById(d.bot_id);if(c){d._attribution=c.name;d._attribution_link="/services/"+d.bot_id}}if(d._source.icon){var m=u(d._source.icon);d._source.icon=m.src;d._source.icon_srcset=m.srcset}if(d.footer_icon){var f=u(d.footer_icon);d.footer_icon=f.src;d.footer_icon_srcset=f.srcset}return d},getSlackMessageFooterText:function e(t,n,r){if(!a(t))return"";var i=t.channel_name;var s=t.channel_id;!s&&t.from_url&&(s=TS.utility.getChannelNameFromUrl(t.from_url));var o=TS.redux.channels.getEntityById(s)||TS.redux.channels.getPublicChannelByName(i);!i&&o&&(i=_.escape(o.name));var l=n.source_team_id&&TS.teams.getTeamNameById(n.source_team_id);var u='<a class="channel_link_unfurl_footer" data-channel-id='+s+" data-channel-name="+i+' target="_blank" href='+t.from_url+">#"+i+"</a>";if(i){if("Direct Message"===i||o&&(o.is_im||o.is_mpim))return TS.interop.i18n.t("Direct message","attachments")();if(t.is_reply_unfurl){if(r)return TS.interop.i18n.t("From a thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("From a thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)})}if(t.is_thread_root_unfurl){if(r)return TS.interop.i18n.t("Thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("Thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)})}if(r)return TS.interop.i18n.t("Posted in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("Posted in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)})}if(l)return TS.interop.i18n.t("From {team_name}","attachments")({team_name:l});return TS.interop.i18n.t("From another workspace","attachments")()},getSlackMessageFooterPermalinkText:function e(t){if(!a(t)||!TS.boot_data.feature_slack_unfurl_links)return"";var n=t.channel_name;var r=t.channel_id;!r&&t.from_url&&(r=TS.utility.getChannelNameFromUrl(t.from_url));var i=TS.redux.channels.getEntityById(r)||TS.redux.channels.getPublicChannelByName(n);if(n){if("Direct Message"===n||i&&(i.is_im||i.is_mpim))return TS.interop.i18n.t("View conversation","attachments")();if(t.is_reply_unfurl)return TS.interop.i18n.t("View reply","attachments")()}return TS.interop.i18n.t("View message","attachments")()},getMediaCaretLocation:function e(n){var r=_.find(t,function(e){return _.some(n[e])});return r||"end"},isAutomatedSlackUnfurl:function e(t){return!!t&&a(t)&&TS.interop.rules.messages.isAutomatedSubtype(t.msg_subtype)},formatMessageAttachmentPart:function e(t,n,r,i,a,s){if(n){r&&TS.interop.rules.messages.isAutomatedSubtype(n.subtype)&&(r=false);if(r&&!_.isEmpty(n.attachments)){var o=n.attachments.some(TS.utility.attachments.isAutomatedSlackUnfurl);o&&(r=false)}}true===s&&(t=_.escape(t));var l=TS.format.formatWithOptions(t,n,{no_highlights:true!==r,no_specials:true!==i,enable_slack_action_links:true===a});l=TS.utility.msgs.handleSearchHighlights(l);return l},findAttachment:function e(t){if(!t)return;var n=TS.utility.msgs.findMsg(t.message_ts,t.channel_id);if(!n)return;return _.find(n.attachments,{id:t.attachment_id})},unfurlPlaceholders:function e(t){t.find(".unfurl-placeholder:not(.unfurled)").each(function(e,t){var r=$(t);r.addClass("unfurled");var i=_.uniqueId("pending_unfurl_");r.attr("id",i);try{var a=r.attr("href");TS.interop.api.call("chat.unfurlLink",{url:a}).then(function(e){if(!(e&&e.data&&e.data.attachments&&e.data.attachments[a]))throw new Error("No unfurl data");var t=e.data.attachments[a];var r=$("#"+i);if(!r.length)return;if(false===TS.prefs.getPref("a11y_animations")&&"gif"===t.file_type)return;var s=TS.inline_attachments.renderStandaloneAttachment(t);if(TS.client&&TS.client.ui){r.replaceWith(s);n()}else{var o=r.closest(".unfurl-container");r.replaceWith(s);o.wrap('<div class="unfurl"></div>');o.removeClass("unfurl-render-pending")}}).catch(function(){$("#"+i).addClass("hidden")})}catch(e){r.addClass("hidden")}});n()},test:function e(){var e={};Object.defineProperty(e,"_isSlackMessageUnfurl",{get:function e(){return a},set:function e(t){a=t}});return e}});var e=["title","text","pretext","video_html","audio_html","audio_url","other_html","from_url","fields","actions","image_url","thumb_url","author_name","service_name","footer","footer_icon","ts"];var t=["ts","footer","fields","text","title","_source"];var n=_.throttle(function(){TS.client&&TS.client.ui&&TS.client.ui.checkInlineImgsAndIframes("file_preview")},150);var r=function e(t){if(t.author_id&&!t.author_name){var n=TS.redux.members.getPotentiallyUnknownMemberById(t.author_id);if(!n||n.is_non_existent){t.author_name=TS.interop.i18n.t("Private user info","member_token")();t.author_icon=cdn_url+"/436da/img/unknown_avatar.png"}else if(n.is_unknown);else{t.author_name=TS.interop.members.getPrefCompliantMemberName(n);t.author_link="/team/"+n.id;n.profile&&(t.author_icon=n.profile.image_24)}}return t};var i=function e(t){var n={};n.icon=t.service_icon||t.author_icon;n.name=t.service_name||t.author_name;n.link=t.service_url||t.author_link;n.author_name=t.author_name==n.name?t.author_subname:t.author_name;n.author_link=t.author_link;return n};var a=function e(t){if(t.is_msg_unfurl)return true;if(t.from_url&&/slack\.com\/archives\/.+\/p.+/.test(t.from_url)){t.is_msg_unfurl=true;return true}};var s=function e(t,n){if(t.author_link){var r=TS.utility.getMemberIdFromURL(t.author_link);var i=TS.interop.utility.getBotIdFromUrl(t.author_link);r&&(t._slack_author_id=r);i&&(t._slack_bot_id=i)}n&&"pinned_item"===n.subtype&&(t.from_url=TS.utility.msgs.constructAbsoluteMsgPermalink(TS.shared.legacyGetActiveModelOb(),t.ts));t._is_automated_unfurl=TS.utility.attachments.isAutomatedSlackUnfurl(t);t.color=null;_.set(t,"mrkdwn_in_hash.text",true);TS.interop.members.shouldDisplayRealNames()?t._source.name=t.author_name||t.author_subname:t._source.name=t.author_subname||t.author_name;t._source.author_name=null;t._source.author_link=null;t._unfurl_type_message=true;if(!t.footer){var a=TS.utility.attachments.getSlackMessageFooterText(t,n);a&&(t.footer=a)}return t};var o=function e(t){t._source.name=t.author_name;t._source.link="https://twitter.com/"+t.author_subname;t._source.author_name=t.author_subname;t._source.author_link=t._source.link;t._unfurl_type_message=true;t.footer||(t.footer=TS.interop.i18n.t("Twitter","attachments")());t.footer_icon||(t.footer_icon=cdn_url+"/6e067/img/services/twitter_pixel_snapped_32.png");return t};var l=function e(t){t._source.name=t.author_name;t._source.author_name=t.author_subname;t._unfurl_type_message=true;t._always_expand=true;return t};var u=function e(t){if(!t)return;if(0===t.indexOf("/img/"))return t;var n={width:16,height:16};"ico"===t.split(".").pop()&&(n.convert_ico=true);var r=TS.utility.getImgProxyURLWithOptions(t,n);var i=TS.utility.getImgProxyURLWithOptions(t,v()({},n,{width:2*n.width,height:2*n.height}));return{src:r,srcset:r+" 1x, "+i+" 2x"}}})();var Fe=n(2948);var Oe=n(2949);var De=n(2950);var He=n(2951);var $e=n(2952);var je=n(2953);var Be=n(2954);var Le=n(2955);var Ne=n(2956);var Re=n(2957);var Ue=n(2958);var Ge=n(2959);var qe=n(2960);var We=n(2961);var ze=n(2965);(function(){TS.registerModule("tabcomplete.members",{type:"members",getMatch:function e(t,n,r,i){var a;var s;var o=/(^|\n|.)?((?:@|\uFF20)([^\n@\uFF20]*))$/i;t.replace(o,function(e,t,n,r,o){var l=""===TS.interop.texty.trimAllowedMatchPrefix(t)||i&&i.allowed_preceding_symbols&&-1!==i.allowed_preceding_symbols.indexOf(t);if(!l)return;if(r.length&&r.match(/^\s/))return;t&&(o+=t.length);a=n;s=o});if(!a&&n){var l=_.last(/(^|\s)([^\s\n@\uFF20]+)$/.exec(t));l=TS.interop.texty.trimAllowedMatchPrefix(l,{trimCJK:false});if(p(l,n)){a=l;s=t.length-l.length}}if(!a)return;var u=4;var d=a.split(" ").length-1;if(d>u)return null;return{match:a,index:s}},shouldDisplayResults:function e(t,n){if(!t||_.isEmpty(n))return false;return true},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;TS.log(90211,"Getting result at index: "+n+"; User: "+(t[n]?t[n].id:""));return t[n]},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"member"}}});var n=TS.interop.texty.getDisplayTextForSearchResult(t);TS.log(90211,"Getting insert data for result: "+t.id);var r=TS.interop.texty.shouldHighlightMention(t.id,n,TS.interop.prefs.getHighlightWords());return{text:n,format:{slackmention:{id:t.id,label:n,mention:r}}}},search:function n(r,i,a){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"member"}}});var l=g(r,i.isUserSolicited);var m=h(l);var f;i.no_model_ob||(f=i.model_ob||TS.shared.legacyGetActiveModelOb());var p=d(f,i.no_model_ob);var T=TS.interop.userGroups.getActiveUserGroups();var v=[];f&&i.enableBroadcastKeywords&&(v=TS.interop.broadcast_keywords.getBroadcastKeywordsForUser(f.id));var b=s(f,r,{members:p,usergroups:T,broadcast_keywords:v},i.include_deleted);m(function(){a(null,b)});if(f){var y=_(p).map("id").without("USLACKBOT").value();if(y.length>e){var w=TS.boot_data.page_needs_enterprise?"W":"U";var k=TS.ui.frecency.getMostCommonWithPrefix(w,e);var x=_.map(k,"id");var C=_.intersection(y,x);var I=_.difference(y,C);y=C.concat(I.slice(0,e-C.length))}TS.log(1990,"Ensuring we have membership for "+y.length+" users in "+f.id+": "+y);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(f.id,y).then(function(e){TS.log(1990,"Got membership for "+y.length+" users in "+f.id+"; any fetches required? "+e);e&&m(function(){a(null,b)})})}if(TS.model.team&&"T025LDE84"===TS.model.team.id&&r&&0===r.indexOf("@helen")){var A=b.map(function(e){return e&&e.id});if(-1===A.indexOf("U7T4Z7K8A")){var E=function e(t){if(!t.id)return"NOT FOUND";return{id:t.id,is_stranger:t.is_stranger,deleted:t.deleted,name:t.name.match(/helen/i),_display_name_lc:t._display_name_lc.match(/helen/i),_real_name_lc:t._real_name_lc.match(/helen/i)}};var P=_.find(TS.model.members,function(e){return e&&"U7T4Z7K8A"===e.id})||{};var F=_.filter(TS.model.members,function(e){return e&&(e.name.match(/helen/i)||e._display_name_lc.match(/helen/i)||e._real_name_lc.match(/helen/i))})||{};var O=_.find(TS.members.getActiveMembersWithSelfAndSlackbot(),function(e){return e&&"U7T4Z7K8A"===e.id})||{};var D=_.filter(TS.members.getActiveMembersWithSelfAndSlackbot(),function(e){return e&&(e.name.match(/helen/i)||e._display_name_lc.match(/helen/i)||e._real_name_lc.match(/helen/i))})||{};var H=_.find(p,function(e){return e&&"U7T4Z7K8A"===e.id})||{};var $=TS.shared.legacyGetActiveModelOb();TS.logError({members:A.sort(),channel_id:$&&$.id,model_u7t:E(P),model_h:_.map(F,E),getter_u7t:E(O),getter_h:_.map(D,E),local_u7t:E(H)},"tabcomplete_missing_member TS.tabcomplete.members.search local_results","T025LDE84")}}if(u(r,p,i)){var j={include_deleted:i.include_deleted,limit:t};var B=o(f,r,j);B.then(function(e){var t=void 0;if(TS.boot_data.feature_lazy_user_groups){t=e.members;T=_.unionBy(T,e.usergroups,"id")}else t=e;var n=_(p).concat(t).compact().uniqBy("id").value();TS.boot_data.page_needs_enterprise&&(n=c(n));var o=s(f,r,{members:n,usergroups:T,broadcast_keywords:v},i.include_deleted);var l=[];if(f){var u=_.filter(o,"is_usergroup");l=_.reduce(u,function(e,t){var n=M(t.id,f.id);n.isResolved()||e.push(n);return e},[]);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(f.id,_.map(o,"id"))}l.length?Promise.all(l).then(function(){m(function(){a(null,o)})}):S(b,o)||m(function(){a(null,o)});return null})}},render:function e(t,n,r){"@"!==t[0]&&"\uff20"!==t[0]&&(t="@"+t);var i=TS.templates.tabcomplete_member_header({text:t});var a;r.no_model_ob||(a=r.model_ob||TS.shared.legacyGetActiveModelOb());var s=n.map(function(e){if(e.is_broadcast_keyword)return e;if(e.is_usergroup||e.is_subteam)return f(a,e);return m(a,e,t)});var o=TS.templates.tabcomplete_member_results({results:s,is_client:!!TS.client});return TS.tabcomplete.renderMenu(i,o)},onSelect:function e(t,n){if(!t)return;n||(n="");n=n.replace(/^@/,"");TS.ui.frecency.record(t,n);TS.boot_data.feature_lazy_user_groups&&a&&a.cancel()},getIndexForPopulatingInput:function e(t,n){if(!C()){TS.tabcomplete.members.onSelectedIndexChange(t);return t}var r=$(".tab_complete_ui_item.active").data("index");var i=t;var a=t;var s=x(r,t,n);if(k()||y(t))if(s){i=b()-1;a=i}else{i=0;a=0}else if(_.isUndefined(n)&&w(t)){i=r;a=r}else if(!s&&w(t)){i=0;a=0}TS.tabcomplete.members.onSelectedIndexChange(a);return i},onSelectedIndexChange:function e(t){TS.log(90211,"Selected index changed to: "+t);TS.tabcomplete.onSelectedIndexChange(t)},test:function e(){var t={IGNORED_SEARCH_TERMS:n,MIN_UNPREFIXED_MATCH_LENGTH:r,getAsyncResults:o};Object.defineProperty(t,"IGNORED_SEARCH_TERMS",{get:function e(){return n},set:function e(t){n=t}});Object.defineProperty(t,"_cached_fetch_remote_user_groups",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"_shouldDoAsyncSearch",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(t,"_getLocalMembers",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(t,"_sortResults",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(t,"SEARCH_DELAY_MS",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(t,"_ensureUserGroupMembersInModelObNumIsKnown",{get:function e(){return M},set:function e(t){M=t}});Object.defineProperty(t,"_getUserGroupMembersNotInModelObCount",{get:function e(){return A},set:function e(t){A=t}});Object.defineProperty(t,"_fetchUserGroups",{get:function e(){return l},set:function e(t){l=t}});return t}});var e=100;var t=25;var n=["the","and"];var r=3;var i=500;var a;var s=function e(n,r,i,a){var s={allow_empty_query:true,frecency:true,limit:t,prefer_exact_match:true};var o=n&&!n.is_im;if(o){s.model_ob=n;s.prefer_channel_members=o}var l=r.replace(/^@/,"");var u=_.trimEnd(l);var d=TS.sorter.search(u,i,s);var c=_.map(d,"model_ob");var m=c;a&&(m=_.sortBy(m,function(e){return e.deleted}));if(i&&i.broadcast_keywords){var f=_.findIndex(m,function(e){return e.is_broadcast_keyword&&e.name===u});if(f>0){var p=m[f];m.splice(f,1);m.unshift(p)}}return m};var o=function e(t,n,r){var i={query:n.replace(/^@/,""),max_api_results:r.limit,include_deleted:r.include_deleted,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false};r.include_deleted||(i.limit_by_model_relevancy=t);t&&!t.is_im&&(i.determine_membership_for_channel=t.id);if(TS.boot_data.feature_lazy_user_groups){var a=[l(n),TS.members.promiseToSearchMembers(i).then(function(e){if(!e||!e.items||!e.items.length)return[];return e.items})];return Promise.all(a).then(function(e){var t=re()(e,2),n=t[0],r=t[1];return{usergroups:n||[],members:r}})}return TS.members.promiseToSearchMembers(i).then(function(e){if(!e||!e.items||!e.items.length)return[];return e.items})};function l(e){if(!TS.boot_data.feature_lazy_user_groups)return Promise.resolve();if(TS.model.user.is_restricted)return Promise.resolve([]);var t=TS.boot_data.feature_allow_cjk_autocomplete?e.replace(/^(@|@)/,""):e.replace(/^@/,"");var n=""===TS.model.team.plan?1e3:200;a&&a.cancel();a=Promise.delay(n).then(function(){return TS.searcher.search(t,{usergroups:{include_deleted:false,runaway:true},tiered:true,sort:{prefer_exact_match:true,frecency:true,allow_empty_query:true},limit:25})}).then(function(e){var t=e.promise;return t.then(function(e){var t=_.map(e,"model_ob");return t||[]})});return a}var u=function e(t,i,a){if(0!==t.indexOf("@")){if(-1!==n.indexOf(t))return false;if(t.length<r)return false;if(a.member_prefix_required)return false;return false}if(i&&i.length&&1===i.length&&"@"+i[0].name===t)return false;return true};var d=function e(t,n){var r=TS.members.getActiveMembersWithSelfAndSlackbot();TS.boot_data.page_needs_enterprise&&(r=c(r));n||(r=r.filter(function(e){return TS.utility.members.isMemberRelevantToModel(e,t)}));if(!r||!r.length){var i="TS.tabcomplete.members@_getLocalMembers: no active members returned!";var a=TS.boot_data.feature_scg_api_filters?0:TS.model.guest_accessible_user_ids.length;var s=["active_members:"+r,"guest_accessible_user_ids:"+a].join(", ");TS.console.logError(i,s)}return r};var c=function e(t){return t.filter(function(e){if(TS.boot_data.feature_wta_org_level_apps&&e.is_app_user)return true;if(!e.enterprise_user||!e.enterprise_user.teams)return true;return e.enterprise_user.teams.length})};var m=function e(t,n){var r=[];var i=[];var a;var s;a=TS.interop.members.getPrefCompliantMemberName(n,false,false);s=TS.interop.members.getMemberSecondaryName(n);r.push("primary_name");i.push("secondary_name");var o=t&&(!t.is_im||n.is_app_user);var l;var u;var d;if(o){d=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,n.id);u=d.is_known;u&&(l=!d.is_member)}var c;if(TS.interop.members.isExternal(n)){var _=TS.teams.getTeamById(n.team_id);_&&(c=TS.interop.rules.teams.getTeamDisplayName(_))}return{is_member:true,member:n,primary_name_classes:r.join(" "),secondary_name_classes:i.join(" "),show_channel_membership:o,member_does_not_belong_to_channel:l,secondary_name:s,primary_name:a,membership_status_is_known:u,team_name:c}};var f=function e(t,n){var r=0;t&&(r=A(n.id,t.id));return{description:n.description||n.name,is_usergroup:true,members_not_in_channel:r,usergroup:n}};var p=function e(t,i){if(!t)return false;if(i)return true;if(t.length<r)return false;if(_.includes(n,t.toLowerCase()))return false;return true};var h=function e(t){var n=Date.now()+t;return function(e){var t=Date.now();var r=Math.max(0,n-t);setTimeout(e,r)}};var g=function e(t,n){if(0===t.indexOf("@"))return 0;if(n)return 0;return i};var S=function e(t,n){if(!n&&!t)return true;if(!n||!t)return false;if(t.length!==n.length)return false;return _.isEqualWith(t,n,function(e,t){return e.id===t.id})};var T=function e(){return $(".tab_complete_ui_item")};var v="reveal_hidden_items";var b=function e(){var t=T();var n=t.index($("."+v));if(n)return n;return-1};var y=function e(t){var n=T();if(n.eq(t).hasClass("deleted"))return true;return false};var w=function e(t){var n=T();if(n.eq(t).hasClass(v))return true;return false};var k=function e(){var t=$(".active."+v);return-1!==T().index(t)};var x=function e(t,n,r){if(r)return r;if(0===t&&Math.abs(n-t)>1)return true;if(t-n===1)return true;return false};var C=function e(){if($(".tab_complete_ui_item.deleted").length)return true;return false};var I={};var M=function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);var i=false;var a=TS.interop.channels.getPublicChannelById(n,i)||TS.interop.channels.getGroupById(n,i);if(!r||TS.interop.rules.user_groups.isUnknownOrNonExistent(r)||!a)return Promise.resolve();if(_.isUndefined(r.users)){if(!I[t]){I[t]=TS.interop.userGroups.promiseToGetUserGroupMembers(t).then(function(e){if(e&&e.users)return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,e.users)}).finally(function(){delete I[t]});return I[t]}return I[t]}return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,r.users)};var A=function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);var i=_.get(r,"users.length");var a=false;var s=TS.interop.channels.getPublicChannelById(n,a)||TS.interop.channels.getGroupById(n,a);if(!r||TS.interop.rules.user_groups.isUnknownOrNonExistent(r)||!s)return 0;if(_.isUndefined(r.users))return 0;var o=r.users.some(function(e){return!TS.interop.redux.models.membership.isMembershipKnownForUser(TS.redux.getState(),s.id,e)});if(o)return 0;var l=r.users.filter(function(e){var t=TS.interop.membership.getCachedChannelMembershipInfoForUser(s.id,e);return t.is_known&&t.is_member});return i-l.length}})();var Ke=n(2966);(function(){TS.registerModule("tabcomplete.commands",{type:"commands",getMatch:function e(t,n,r){if(!_.isString(t))return;if(_.isNumber(r)&&0!==r)return;t.startsWith("\uff0f")&&(t="/"+t.substring(1));"/"===t&&TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_start",trigger:"slash_command"}}});var i;var a;TS.interop.i18n.deburr(t).replace(/^(\/\S*)$/i,function(e,n,r){a=r;i=t.substr(a,n.length)});if(!i)return;return{match:i,index:a}},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;var r=_.flatMap(t,"cmds");return _.find(r,{index:n})},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_select",trigger:"slash_command"}}});if("last"===t.type)return TS.interop.texty.convertContentsStringToContents(t.cmd,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});return{text:t.name}},getNumResults:function e(t){return _.reduce(t,function(e,t){return e+t.cmds.length},0)},search:function t(n,r,i){if(TS.apps.permissions.areXoxaAppsInstalled()){i(null,e(n,r));var a=TS.cmd_handlers.getCmdAppUserIds();a.length&&TS.interop.membership.ensureChannelMembershipIsKnownForUsers(TS.model.active_cid,a).then(function(t){t&&i(null,e(n,r))})}else{var s=e(n,r);i(null,s)}},render:function e(t,n){TS.interop.rules.channels.isExternallySharedChannel(TS.shared.legacyGetActiveModelOb())&&n[0]&&n[0].cmds&&(n[0].cmds=n[0].cmds.map(function(e){switch(e.name){case"/topic":return v()({},e,{desc:TS.interop.i18n.t("Set the channel topic for your workspace","cmd_handlers")()});case"/rename":return v()({},e,{desc:TS.interop.i18n.t("Rename this channel for your workspace","cmd_handlers")()});default:return e}}));var r=TS.templates.tabcomplete_command_header({text:t});var i=TS.templates.tabcomplete_command_results({results:n});return TS.tabcomplete.renderMenu(r,i)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},onSelect:function e(t,n){"client"===t.type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_AUTOCOMPLETE",{locale:TS.interop.i18n.locale,search_term:n,slash_command_canonical_name:t.canonical_name||t.name,slash_command_name:t.name})}});function e(e,r){var i=n(r);var a=TS.interop.i18n.deburr(e.toLowerCase());a=TS.tabcomplete.trimTrailingCharacterModifier(a);a&&(i=i.filter(function(e){if(0===(e.normalized||e.name).indexOf(a))return true;if(e.canonical_name&&0===e.canonical_name.indexOf(a))return true;var t=e.localized_aliases||e.aliases;if(t)return t.some(function(e){var t=TS.interop.i18n.deburr(e);return 0===t.indexOf(a)});return false}));var s=_.map(i,"name");var o=TS.cmd_handlers.sortNames(s);var l;if("/"===a&&TS.chat_history.getCommands().length){var u=TS.chat_history.getCommands()[0].trim();var d=u.split(" ")[0];var c=TS.cmd_handlers.getAvailableUserCmds()[d]&&!r.in_thread;l=o.map(function(e){return _.assign({name:e},TS.cmd_handlers[e])});var m=u;m=TS.interop.texty.convertContentsStringToDisplayString(u,TS.interop.prefs.getHighlightWords());if(c){var f={name:m,cmd:u,type:"last"};l.unshift(f);var p=TS.cmd_handlers.groupCmdsByType(l);var h=TS.interop.i18n.t("Last Used","command_tab_complete")();p.unshift({name:h,id:"last",cmds:[f]});t(p);return p}}else l=o.map(function(e){return _.assign({name:e},TS.cmd_handlers[e])});var g=TS.cmd_handlers.groupCmdsByType(l);t(g);return g}function t(e){var t=0;e.forEach(function(e){e.cmds=e.cmds.map(function(e){var n=_.assign({index:t},e);t+=1;return n})})}function n(e){var t=TS.cmd_handlers.getAvailableUserCmds(e);var n=_.map(t,function(e,t){return _.assign({name:t},e)});return n}})();var Ve=n(2967);var Ye=n(2968);(function(){TS.registerModule("utility.calls_state_logging",{logState:function t(n,r){switch(n){case"idle":TS.utility.calls_state_logging.transition("CALLS_IDLE");break;case"start_call":TS.utility.calls_state_logging.transition("CALLS_START_CALL");break;case"get_regions":TS.utility.calls_state_logging.transition("CALLS_GET_REGIONS");break;case"get_server":TS.utility.calls_state_logging.transition("CALLS_GET_SERVER");break;case"initialize_janus":TS.utility.calls_state_logging.transition("CALLS_INITIALIZE_JANUS");break;case"join_room":TS.utility.calls_state_logging.transition("CALLS_JOIN_ROOM");break;case"in_room":TS.utility.calls_state_logging.transition("CALLS_IN_ROOM");break;case"publisher_connected":TS.utility.calls_state_logging.transition("CALLS_PUBLISHER_CONNECTED");break;case"disconnect_janus":TS.utility.calls_state_logging.transition("CALLS_DISCONNECT_JANUS");break;case"disconnect_for_reconnect_janus":TS.utility.calls_state_logging.transition("CALLS_DISCONNECT_FOR_RECONNECT_JANUS");break;case"reconnect":e+=1;TS.utility.calls_state_logging.transition("CALLS_RECONNECT");break;case"terminal":TS.utility.calls_state_logging.transition("CALLS_TERMINAL",{terminal_type:r.terminal_type});break;default:break}},transition:function r(i,a){a=a||{};TS.utility.calls_log.logEventInfo({event:"StateTransition",value:v()({state:i,reconnect_attempt:e,prev_state:t,reachability:window.navigator.onLine},a)});TS.interop.clog.track(i,v()({},n(),a));t=i},error:function r(i,a){a=a||{};TS.utility.calls_log.logEventWarn({event:"StateError",value:v()({state:i,reconnect_attempt:e,prev_state:t,reachability:window.navigator.onLine},a)});TS.interop.clog.track(i,v()({},n(),a));t=i},event:function r(i,a){a=a||{};TS.utility.calls_log.logEventInfo({event:"StateEvent",value:v()({state:i,reconnect_attempt:e,current_state:t,reachability:window.navigator.onLine},a)});TS.interop.clog.track(i,v()({},n(),a))}});var e=0;var t="";var n=function n(){return{reconnect_attempt:e,prev_state:t,room_id:TS.calls?TS.calls.getCallState().room_id:"",num_participants:TS.calls?TS.calls.participants.getAllParticipants().length:0,reachability:window.navigator.onLine}}})()},2965:function(e,t){(function(){TS.registerModule("tabcomplete",{positionUIRelativeToInput:function e(t,n,r){if(!t||!n)return;var i=$(n).offset();t.style.left=i.left+"px";var a;if(r){var s=i.top+$(n).height()+2;t.style.top=s+"px";a=$(window).height()-s}else{t.style.bottom=$(window).height()-i.top+"px";a=i.top}var o=_.clamp(a-$(t).find(".tab_complete_ui_header").outerHeight()-2,454);$(t).find(".tab_complete_ui_scroller").css("maxHeight",o+"px")},render:function e(t,n,r,i){switch(t){case"members":return TS.tabcomplete.members.render(n,r,i);case"commands":return TS.tabcomplete.commands.render(n,r,i);case"emoji":return TS.tabcomplete.emoji.render(n,r,i);case"channels":return TS.tabcomplete.channels.render(n,r,i);default:TS.warn('TS.tabcomplete: unknown render type "'+t+'"')}},renderMenu:function e(t,n){return TS.templates.tabcomplete_menu({safe_header_html:new Handlebars.SafeString(t),safe_results_html:new Handlebars.SafeString(n)})},onSelectedIndexChange:function e(t){var n=$(".tab_complete_ui_item");n.removeClass("active");n.removeAttr("aria-selected");n.eq(t).addClass("active").attr("aria-selected","true");n.eq(t).scrollintoview({duration:0})},trimTrailingCharacterModifier:function t(n){if(!n)return"";return n.replace(e,"")}});var e=/[`\xb4\u02c6\xa8\u02dc]$/})()},2966:function(e,t){(function(){TS.registerModule("tabcomplete.channels",{type:"channels",getMatch:function e(t){if(!_.isString(t))return;var n;var r;var i;if(TS.boot_data.feature_allow_cjk_autocomplete){r=Math.max(t.lastIndexOf("\uff03"),t.lastIndexOf("#"));i=/(^|\n|.)([#\uff03][^~`!@#\uff03$%^&*()+=[\]{}\\|;:'",.<>\/?\s]*)$/i}else{r=t.lastIndexOf("#");i=/(^|\n|.)(#[^~`!@#$%^&*()+=[\]{}\\|;:'",.<>\/?\s]*)$/i}var a=TS.interop.i18n.deburr(t);a.replace(i,function(e,i){if(TS.interop.texty.trimAllowedMatchPrefix(i))return;n=t.substr(r,t.length-r)});if(!n)return;return{match:n,index:r}},shouldDisplayResults:function e(t,n){if(!t||_.isEmpty(n))return false;var r=t.replace(/^#/,"").toLowerCase();var i=1===n.length&&n[0].name===r;return!i},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;return t[n]},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"channel"}}});var n="#"+t.name;return{text:n,ensure_preceding_space:true}},search:function r(i,a,s){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"channel"}}});n(i).then(function(n){var r=_.map(n,"model_ob");s(null,r);if(!e(i,r))return;return n.promise.then(function(e){var n=_.map(e,"model_ob");t(r,n)||s(null,n)})})},render:function e(t,n){var r=TS.templates.tabcomplete_channel_header({text:t});var i=TS.templates.tabcomplete_channel_results({results:n});return TS.tabcomplete.renderMenu(r,i)},onSelect:function e(t,n){if(!t)return;n||(n="");n=TS.boot_data.feature_allow_cjk_autocomplete?n.replace(/^(#|\uff03)/,""):n.replace(/^#/,"");TS.ui.frecency.record(t,n)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)}});var e=function e(t,n){t=TS.boot_data.feature_allow_cjk_autocomplete?t.replace(/^(#|\uff03)/,""):t.replace(/^#/,"");if(n&&1===n.length&&""+n[0].name===t)return false;return true};var t=function e(t,n){if(!n&&!t)return true;if(!n||!t)return false;if(t.length!==n.length)return false;return _.isEqualWith(t,n,function(e,t){return e.id===t.id})};function n(e){var t=TS.boot_data.feature_allow_cjk_autocomplete?e.replace(/^(#|\uff03)/,""):e.replace(/^#/,"");return TS.searcher.search(t,{channels:{include_archived:false},tiered:true,sort:{prefer_exact_match:true,frecency:true,allow_empty_query:true,search_previous_channel_names:true,prefer_channels_user_belongs_to:false},limit:25})}})()},2967:function(e,t){(function(){TS.registerModule("tabcomplete.emoji",{type:"emoji",getMatch:function e(t,n){if(!_.isString(t))return;var r;var i;var a=/(^|\n|[^+-])([+-]?[:|\uff1a][^~@#$%^&*()=[\]{}\\|!?`;:\uff1a",.<>\/ ]*)$/i;t.replace(a,function(e,n,a,s){var o=n[n.length-1];if(TS.interop.texty.trimAllowedMatchPrefix(o))return;if(n.trim()&&/^[+-]/.test(a)){a=a.slice(1);s+=1}i=s+n.length;r=t.substr(i,a.length)});if(!r)return;if(TS.interop.utility.getEmoticonsRx().test(r))return;if(!n&&!u(r,TS.interop.i18n.locale))return;return{match:r,index:i}},shouldDisplayResults:function e(t,n,r){if(!t||_.isEmpty(n)||_.isEmpty(n.results))return false;if(1===n.results.length&&r)return false;return true},getResultAtIndex:function e(t,n){if(!t||!t.results||!_.isNumber(n))return;var r=t.results[n];if(!r)return;return{action:t.action,emoji:r}},getInsertData:function e(t){if(!t||!t.emoji)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"emoji"}}});var n=t.emoji.name;var r=t.emoji.display_name||t.emoji.name;if(TS.boot_data.feature_sonic_emoji){n=t.emoji.emojiBestNameMatchCanonical;r=TS.emoji.maybeGetLocalizedEmojiName(n)}var i=":"+r+":";TS.utility.contenteditable.inlineEmojiIsEnabled()&&(i=":"+n+":");var a=t.emoji.is_skin;TS.boot_data.feature_sonic_emoji&&(a=TS.interop.emoji.isEmojiNameSkinToneModifiable(n));if(a){var s=!TS.utility.contenteditable.inlineEmojiIsEnabled();i+=TS.emoji.getChosenSkinToneModifier(s)||""}var o=i;var l="";if("add_rxn"===t.action){o="+"+i;l="+"}else if("remove_rxn"===t.action){o="-"+i;l="-"}if(TS.utility.contenteditable.inlineEmojiIsEnabled())return{text:l,slackemoji:{text:i}};return{text:o}},getNumResults:function e(t){return t.results.length},getNextSelectedIndex:function e(a){var s;switch(a.keyCode){case TS.utility.keymap.right:s="right";break;case TS.utility.keymap.left:s="left";break;case TS.utility.keymap.up:s="up";break;case TS.utility.keymap.down:s="down";break;default:break}if(!s)return;var o=t(a.menu);if(1===o.length)return 0;if("right"===s)return a.selectedIndex<o.length-1?a.selectedIndex+1:0;if("left"===s)return a.selectedIndex>0?a.selectedIndex-1:o.length-1;if(a.keyCode===TS.utility.keymap.home||"up"===s&&a.metaKey)return 0;if(a.keyCode===TS.utility.keymap.end||"down"===s&&a.metaKey)return o.length-1;var l=_.map(o,function(e,t){var r=n(e);r.index=t;return r});var u=l[a.selectedIndex];var d=r(u,l,"down"===s);var c=i(u,d);if(!c){if("down"===s)return o.length-1;if("up"===s)return 0}return c.index},search:function t(n,r,i){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"emoji"}}});var o=/^(\+|-):/.test(n)?n[0]:"";var l=r.index;var u=TS.shared.legacyGetActiveModelOb();var d=e(u);n=TS.emoji.normalizeSearchTerm(n);n=TS.tabcomplete.trimTrailingCharacterModifier(n);if(TS.boot_data.feature_sonic_emoji){s(n).then(function(e){var t=null;var n="search";if(e&&e.length){if(0===l&&o)if("+"===o){e=_.differenceBy(e,d,function(e){return e.name||e.item&&e.item.name});n="add_rxn"}else"-"===o&&(n="remove_rxn");t={action:n,results:e}}i(null,t)});return}var c=a(n);var m;if(0===l&&o){if("-"===o)m={action:"remove_rxn",results:c};else if("+"===o){var f=_.difference(c,d);_.isEmpty(f)||(m={action:"add_rxn",results:f})}}else m={action:"search",results:c};"U02592DNU"===TS.model.user.id&&TS.console.logError(JSON.stringify({query:n,results:m}),"emoji_tabcomplete_results");m&&!m.results.length&&(m=null);i(null,m)},render:function e(t,n){var r=TS.templates.tabcomplete_emoji_header({text:t,action:n.action});var i=_.map(n.results,function(e){var t=e;if(TS.boot_data.feature_sonic_emoji){var r=e.emojiBestNameMatchCanonical;var i=TS.emoji.maybeGetLocalizedEmojiName(r);t={name:r,display_name:i}}return l(t,n.action)});var a=TS.templates.tabcomplete_emoji_results({results:i});return TS.tabcomplete.renderMenu(r,a)},onSelect:function e(t,n){if(!t||!t.emoji)return;n||(n="");n=n.replace(/^:/,"");if(TS.boot_data.feature_sonic_emoji){var r=TS.interop.emoji.getEmojiFrecencyIdFromName(t.emoji.name);TS.redux.dispatch(TS.interop.searcher.recordFrecencyEvent({id:r,text:n}));return}TS.ui.frecency.record(t.emoji,n)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},test:function n(){var r={};Object.defineProperty(r,"_getResultElements",{get:function e(){return t},set:function e(n){t=n}});Object.defineProperty(r,"_getLocalResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(r,"_getPrevMsgRxns",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(r,"_sortResults",{get:function e(){return o},set:function e(t){o=t}});return r}});var e=function e(t){if(!t)return;var n=TS.utility.msgs.getDisplayedMsgs(t.msgs);var r=_.find(n,function(e){return!e.is_ephemeral});if(!r)return;var i=TS.rxns.getMemberRxnsFromMessage(r,TS.model.user.id);var a=_.map(i,function(e){var t=e.name.replace(/(:.+)$/,"");return TS.boot_data.feature_sonic_emoji?{name:t}:TS.emoji.getEmojiByName(t)});return _.compact(a)};var t=function e(t){if(!t)return[];return _.toArray(t.querySelectorAll(".tab_complete_ui_item"))};var n=function e(t){var n=t.offsetLeft;return{left:n,right:n+t.offsetWidth,top:t.offsetTop}};var r=function e(t,n,r){if(!t||!n||!n.length)return;var i=_.groupBy(n,"top");var a=_.map(_.keys(i),_.toNumber);var s=a.indexOf(t.top);var o=r?s+1:s-1;var l=a[o];return i[l]};var i=function e(t,n){if(!t||!n||!n.length)return;var r=n.filter(function(e){if(_.inRange(e.left,t.left,t.right))return true;if(_.inRange(e.right,t.left,t.right))return true;if(e.left<t.left&&e.right>t.right)return true;return false});if(!r)return;var i=_.maxBy(r,function(e){var n=Math.max(e.left,t.left);var r=Math.min(e.right,t.right);return r-n});return i};var a=function e(t){return o(t,TS.model.emoji_map)};var s=function e(t){var n=t.replace(/^(\+|-)?:/,"");return TS.redux.dispatch(TS.interop.searcher.search({query:n,options:{entities:{emoji:true},sort:{frecency:true},limit:50,returnMetadata:true}}))};var o=function e(t,n){if(!n||!n.length)return[];var r={emoji:n};var i={allow_empty_query:true,frecency:true,limit:50,prefer_exact_match:true};var a=t.replace(/^(\+|-)?:/,"");n=TS.sorter.search(a,r,i);return _.map(n,"model_ob")};var l=function e(t){var n=":"+t.name+":";var r=":"+(t.display_name||t.name)+":";var i={emoji_is_plain_text_only:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emoji_name_with_colons:n,emoji_display_name_with_colons:r};var a=t.is_skin;TS.boot_data.feature_sonic_emoji&&(a=TS.interop.emoji.isEmojiNameSkinToneModifiable(t.name));if(a){i.show_skin_tone_variant=a;i.emoji_name_with_colons_and_skin=n+TS.emoji.getChosenSkinToneModifier();i.emoji_display_name_with_colons_and_skin=r+TS.emoji.getChosenSkinToneModifier(true)}return i};var u=function e(t,n){switch(n){case"ja-JP":return t.length>=2;default:return t.length>=3}}})()},2968:function(e,t){(function(){TS.registerModule("automount",{onStart:function e(){var t=TS.redux.getStoreInstance();TS.interop.automount.mountAllWithStore(t)}})})()},3:function(e,t,n){"use strict";t.__esModule=true;var r=n(224);var i=a(r);function a(e){return e&&e.__esModule?e:{default:e}}t.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},327:function(e,t,n){e.exports={default:n(328),__esModule:true}},3275:function(e,t){(function(){TS.registerModule("utility.msgs",{allowed_embed_attributes:["class","name","id","src","width","oldwidth","height","oldheight","frameborder","title","scrolling","allowtransparency","allowfullscreen","oallowfullscreen","msallowfullscreen","webkitallowfullscreen","mozallowfullscreen","controls","autoplay","loop","muted","poster","preload","webkit-playsinline","type"],ephemeral_msgs_map:{},messageIncludesMember:function e(t,n){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!n){TS.warn("messageIncludesMember: WTF no msg?");return}if(TS.utility.msgs.memberSentMessage(t,n))return true;var r=o(n);var i;for(var a=0,s=r.length;a<s;a+=1){i=r[a];if(0===i.indexOf("<")&&0===i.indexOf("<@")){var l=i.replace(/<|>/g,"");var u=TS.utility.msgs.getMemberIdFromMemberMarkup(l);if(u&&u==t.id)return true}}return false},messageIncludesUserGroup:function e(t,n){if(!TS.boot_data.feature_lazy_user_groups)return false;if(!t){TS.warn("messageIncludesUserGroup: WTF no user group?");return false}if(!n){TS.warn("messageIncludesUserGroup: WTF no msg?");return false}var r=o(n);var i=_.some(r,function(e){if(e&&l(e)){var n=TS.utility.msgs.getUserGroupIdFromUserGroupMarkup(e);if(n&&n==t.id)return true}return false});return i},extractUserGroupIdsFromMessage:function e(t){if(!t)return[];var n=o(t);var r=_.reduce(n,function(e,t){if(l(t)){var n=TS.utility.msgs.getUserGroupIdFromUserGroupMarkup(t);e.push(n)}return e},[]);return r},memberSentMessage:function e(t,n){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!n){TS.warn("messageIncludesMember: WTF no msg?");return}return!!(n.user&&n.user==t.id)||!!(n.comment&&n.comment.user==t.id)},allUnknownUsersInMessage:function e(t){var n=[];var r=t.text;var i=TS.format.calculateOptions(t,{});var a=TSF.getTokensArray($.trim(r),i.tsf_mode,{jumbomoji:!i.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});for(var s=0;s<a.length;s+=1){var o=a[s];if(0===o.indexOf("<")&&0===o.indexOf("<@")){var l=o.replace(/<|>/g,"");var u=TS.utility.msgs.getMemberIdFromMemberMarkup(l);var d=TS.redux.members.getPotentiallyUnknownMemberById(u);d||TS.boot_data.feature_deprecate_get_member_by_name||(d=TS.interop.members.getMemberByName(u));d||n.indexOf(u)<0&&n.push(u)}}return n},appendMsg:function e(t,n){t.unshift(TS.utility.msgs.makeSureMsgObIsValid(n))},setMsgs:function e(t,n){for(var r=0;r<n.length;r+=1)n[r]=TS.utility.msgs.makeSureMsgObIsValid(n[r]);TS.utility.msgs.sortMsgs(n);t.msgs=n;return t.msgs},spliceMsg:function e(t,n){var r=t.indexOf(n);r>-1&&t.splice(r,1)},getNonTempMsgFromUserMatchingText:function e(t,n,r){if(!t&&0!==t)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i.user!=n)continue;if(TS.interop.rules.messages.isTempMsg(i))continue;if(i.text==t)return i}return null},getMsgByProp:function e(t,n,r){if(!n&&0!==n)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i[t]==n)return i}return null},getEditableReplyByProp:function e(t,n,r,i){if(!n&&0!==n||!r||!i)return null;var a;if(TS.ui.replies.activeConvoModelId()===r.id&&TS.ui.replies.activeConvoThreadTs()===i)a=TS.ui.replies.getActiveMessages();else if(TS.model.threads_view_is_showing){var s=TS.client.threads.getThread(r,i);a=s&&s.replies?s.replies:[]}var o=_.findLast(a,function(e){var r=!(e.subtype&&"me_message"!==e.subtype);var i=e[t]===n;return r&&i});return o},sortMsgs:function e(t){function n(e,t){if(e.ts<t.ts)return 1;if(e.ts>t.ts)return-1;return 0}t.sort(n)},isMsgRolledUp:function e(t){if(!t._jl_rolled_up_in)return false;return t._jl_rolled_up_in!==t.ts},getPrevDisplayedMsg:function e(t,n){var r;var i=false;for(var a=0;a<n.length;a+=1){r=n[a];if(i){if(!TS.interop.rules.messages.isHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}else r.ts==t&&(i=true)}return null},getDisplayedMsgs:function e(t){var n=[];var r;for(var i=0;i<t.length;i+=1){r=t[i];TS.interop.rules.messages.isHidden(r)||TS.utility.msgs.isMsgRolledUp(r)||n.push(r)}return n},getDisplayedMsgAfterTS:function e(t,n){var r;for(var i=n.length-1;i>-1;i-=1){r=n[i];if(r.ts>t&&!TS.interop.rules.messages.isHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}return null},getDisplayedMsgBeforeTS:function e(t,n){var r;for(var i=0;i<n.length;i+=1){r=n[i];if(r.ts<t&&!TS.interop.rules.messages.isHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}return null},getUnreadCountableMsgAfterTS:function e(t,n){var r;for(var i=n.length-1;i>-1;i-=1){r=n[i];if(r.ts>t&&TS.interop.messages.canCountAsUnreadForCurrentUser(r,TS.model.user.id))return r}return null},getMarkMsgTSForUnreadPoint:function e(t,n,r){var i;var a;if(r.oldest_msg_ts&&t==r.oldest_msg_ts)i="0000000000.000000";else{a=TS.utility.msgs.getPrevDisplayedMsg(t,n)||TS.utility.msgs.getMsg(t,n);a&&(i=a.ts)}if(!i)return null;while(i&&!TS.utility.msgs.getUnreadCountableMsgAfterTS(i,n)){a=TS.utility.msgs.getPrevDisplayedMsg(i,n);i=a?a.ts:null}if(!i)return null;return i},getMsg:function e(t,n){if(!n)return null;return TS.utility.msgs.getMsgByProp("ts",t,n)},getFileOnMsg:function e(t){if(!t)return;if(TS.interop.messages.shouldRenderFileThread(t)&&t.files&&t.files.length)return t.files[0];return t.file},getFilesOnMsg:function e(t){if(!t)return null;if(!t.file&&!t.files)return null;if(TS.interop.messages.shouldRenderFileThread(t)&&t.files&&t.files.length){var n=_.chain(t.files).map(function(e){if(_.isString(e))return TS.files.getFileById(e);if(e&&_.isString(e.id))return TS.files.getFileById(e.id);return e}).compact().value();return n&&n.length?n:null}var r=t.file;_.isString(t.file)?r=TS.files.getFileById(t.file):t.file&&_.isString(t.file.id)&&(r=TS.files.getFileById(t.file.id));return r?[r]:null},getMsgActions:function e(t,n,r){if(!t)return;n=n||TS.shared.legacyGetActiveModelOb();var i={edit_msg:TS.interop.messages.canEditMessage(TS.model.user.id,t,n,TS.prefs.getTeamPref("msg_edit_window_mins")),delete_msg:true};var a=false;t.user==TS.model.user.id&&(a=true);var s=TS.utility.teams.isMsgFromOtherTeam(t);t.file&&"email"===t.file.mode&&(i.open_original=true);var o=TS.interop.members.getMemberById(t.user);var l=o&&o.is_stranger&&o.deleted;if(TS.prefs.getTeamPref("allow_message_deletion"))if("tombstone"===t.subtype)i.delete_msg=false;else if("retention"===t.subtype)i.delete_msg=false;else if(s&&!l)TS.boot_data.page_needs_enterprise&&(a||TS.model.user.enterprise_user.is_admin&&!n.is_im)?i.delete_msg=true:i.delete_msg=false;else if(n.is_im)a||"USLACKBOT"===t.user||"UTEAMSBOT"===t.user||"bot_message"===t.subtype||(i.delete_msg=false);else if(a){if(TS.interop.rules.messages.isAutomatedSubtype(t.subtype)){var u=["pinned_item","sh_room_created","sh_room_shared","reply_broadcast"];TS.model.user.is_admin||_.includes(u,t.subtype)||(i.delete_msg=false)}}else TS.model.user.is_admin||(i.delete_msg=false);else s&&!l?TS.boot_data.page_needs_enterprise&&TS.model.user.enterprise_user.is_admin&&!n.is_im?i.delete_msg=true:i.delete_msg=false:TS.model.user.is_admin?n.is_im&&(a||"USLACKBOT"===t.user||"UTEAMSBOT"===t.user||"bot_message"===t.subtype||(i.delete_msg=false)):i.delete_msg=false;var d=r!==TS.interop.constants.MESSAGE_CONTAINERS.THREADS_FLEXPANE&&r!==TS.interop.constants.MESSAGE_CONTAINERS.THREADS_VIEW;"thread_broadcast"===t.subtype&&d&&(i.remove_broadcast=i.delete_msg);if(t.is_ephemeral)i.delete_msg=true;else{if(TS.client&&"pinned_item"!==t.subtype&&"unpinned_item"!==t.subtype&&"sh_room_created"!==t.subtype&&"sh_room_shared"!==t.subtype){TS.pins.canUserPinHere(n)&&(TS.pins.isMessagePinned(t,n)?i.unpin_msg=true:i.pin_msg=true);if("tombstone"===t.subtype){i.unpin_msg=false;i.pin_msg=false}var c=["channel_join","channel_leave","group_join","group_leave"];_.includes(c,t.subtype)&&(i.pin_msg=false)}"file_comment"===t.subtype?i.add_file_comment_rxn=true:TS.interop.rules.messages.isFile(t)?i.add_file_rxn=true:"tombstone"===t.subtype?i.add_rxn=false:i.add_rxn=true;if(TS.clipboard.canWriteText()){i.copy_link=true;"tombstone"===t.subtype&&(i.copy_link=false)}}TS.client&&(i.mark_unread=true);var m=!t.thread_ts||t.thread_ts==t.ts;i.jump_to_original=true;TS.replies.canReplyToMsg(n,t)&&(i.reply=true);i.jump_to_original=m;var f="thread_broadcast"===t.subtype&&d;!i.mark_unread||m||f||(i.mark_unread=false);var p=["bot_message","file_share","file_mention","file_comment","me_message","reply_broadcast","thread_broadcast"];t.is_ephemeral||t.subtype&&-1===p.indexOf(t.subtype)||(i.remind_me=true);(i.jump_to_original||i.copy_link||i.mark_unread||i.remind_me)&&(i.has_private_actions=true);(i.copy_link||i.add_rxn||i.add_file_rxn||i.add_file_comment_rxn||i.pin_msg||i.unpin_msg)&&(i.has_public_actions=true);t.is_ephemeral||TS.interop.rules.messages.isTempMsg(t)||("file_share"===t.subtype||"file_mention"===t.subtype?i.share_file=true:"tombstone"===t.subtype?i.share_message=false:i.share_message=!TS.interop.channels.isImWithDeletedMember(n)&&(!n.is_archived||n.is_channel));return i},validateMsg:function e(t,n,r){if(!n.ts){TS.error("msg lacks a ts ("+t+")");TS.dir(0,n);return false}if(TS.utility.msgs.getMsg(n.ts,r)){TS.warn("msg "+n.ts+" already exists! ("+t+")");TS.dir(0,n);return false}return true},findMsg:function e(t,n){var r=TS.redux.messages.getMessageByTimestamp(n,t);if(r)return r;var i=TS.redux.channels.getEntityById(n);if(i){r=i.msgs&&TS.utility.msgs.getMsg(t,i.msgs);if(r)return r;r=i._archive_msgs&&TS.utility.msgs.getMsg(t,i._archive_msgs);if(r)return r;if(TS.ui.replies){r=TS.ui.replies.getActiveMessage(i,t);if(r)return r}if(TS.client){r=TS.client.threads.getMessage(i,t);if(r)return r}if(!r&&TS.model.unread_view_is_showing&&TS.client){r=TS.client.unread.getMessage(i,t);if(r)return r}}var a=TS.mentions.getMentionByMsgId(n,t);if(a)return a.message;return null},legacyMsgChangedWorker:function e(t){var n=TS.redux.channels.getEntityById(t.channel);TS.mentions.replaceMsg(t.channel,t.message);TS.pins&&TS.pins.replaceMsg(t.message,n);(t.message.imgs||TS.utility.msgs.hasImgs(t.message))&&(TS.model.show_inline_img_size_pref_reminder=true)},legacyMsgDeletedWorker:function e(t,n){TS.mentions.legacyRemoveMsg(t.id,n.deleted_ts);TS.pins&&TS.pins.legacyRemoveMsg(n.deleted_ts,t);TS.utility.msgs.legacyDeleteMsg(t,n)},legacyDeleteMsg:function e(t,n){var r=TS.utility.msgs.getMsg(n.deleted_ts,t.msgs);!r&&t._archive_msgs&&(r=TS.utility.msgs.getMsg(n.deleted_ts,t._archive_msgs));r||(r=TS.client.unread.getMessage(t,n.deleted_ts));r||(r=TS.ui.replies.getActiveMessage(t,n.deleted_ts));r||(r=TS.client.threads.getMessage(t,n.deleted_ts));if(!r)return;TS.shared.legacyRemoveMsgFromModern(t,r)},replaceMsg:function e(t,n,r,i,a){TS.redux.messages.replaceMessage(TS.interop.messages.preprocessImsg(n,t.id),a);TS.utility.msgs.legacyReplaceMsg(t,n,r,i)},removeEphemeralMsg:function e(t,n){var r=TS.interop.channels.getGroupById(t)||TS.interop.channels.getPublicChannelById(t);if(!r)return;var i=TS.utility.msgs.findMsg(n,r.id);r.is_channel?TS.channels.legacyRemoveMsg(t,i):r.is_mpim?TS.mpims.legacyRemoveMsg(t,i):r.is_group&&TS.groups.legacyRemoveMsg(t,i)},getMemberFromMemberMarkup:function e(t){var n=TS.utility.msgs.getMemberIdFromMemberMarkup(t);var r=TS.redux.members.getPotentiallyUnknownMemberById(n);r||TS.boot_data.feature_deprecate_get_member_by_name||(r=TS.interop.members.getMemberByName(n));return r},getMemberIdFromMemberMarkup:function e(t){var n=t.substr(1);n&&(n=n.split("|")[0]);return n},getUserGroupIdFromUserGroupMarkup:function e(t){if(!TS.boot_data.feature_lazy_user_groups)return null;var n=new RegExp(TS.interop.userGroups.USER_GROUP_MSG_REGEX);var r=n.exec(t);if(r&&_.isArray(r)){var i=r[1];return i}return null},makeSureMsgObIsValid:function e(t){return t},old_api_url_prefix:"api::",new_api_url_prefix:"slack-action://",doNewApiUrl:function e(t){if(!TS.client){alert(TS.interop.i18n.t("This link will not work in the archives.","msgs")());return}var n=t.replace(TS.utility.msgs.new_api_url_prefix,"").split("/");var r=n.shift();var i=n.join("/");TS.interop.api.call("chat.action",{bot:r,payload:decodeURIComponent(i)})},getMsgMentionData:function e(t,n){var r={mentions:false,non_channel_mentions:false};var i="bot_message"===t.subtype;var a=TS.interop.messages.isReply(t);function s(e){if(o(e)){r.non_channel_mentions=true;r.mentions=true;return true}l(e)&&(r.mentions=true);return false}function o(e){if(!e)return false;if(TS.interop.members.getMemberMentionRegExp(TS.model.user.id).test(e))return true;if(i)return false;if(!n){var t=TS.interop.prefs.getHighlightWords();var r=TS.interop.format.locateHighlightWords(e,t);if(r.length)return true}return false}function l(e){if(!e)return false;if(TS.interop.messages.atEveryoneRegExp.test(e)&&!a)return true;if(TS.interop.messages.atChannelRegExp.test(e)&&!a)return true;if(TS.interop.messages.atGroupRegExp.test(e)&&!a)return true;return false}if(!t.ignore_if_attachments_supported&&s(t.text))return r;var u;var d;if(t.attachments)for(var c=0;c<t.attachments.length;c+=1){u=t.attachments[c];if(u.from_url)continue;if(s(u.title))return r;if(s(u.pretext))return r;if(s(u.text))return r;if(s(u.footer))return r;if(!u.fields||!u.fields.length)continue;for(var _=0;_<u.fields.length;_+=1){d=u.fields[_];if(s(d.value))return r}}return r},countAllUnreads:function t(){if(e)return;TS.model.all_unread_highlights_cnt=0;TS.model.all_unread_cnt=0;TS.model.all_unread_cnt_to_exclude=0;TS.model.all_unread_highlights_cnt_to_exclude=0;var n=TS.redux.getState();var r=TS.interop.redux.models.channels.getAllChannels(n);_.each(r,function(e){if(!TS.interop.rules.unreads.shouldCountUnreadsInModel(n,e))return;if(TS.interop.rules.channels.shouldSuppressOrgChannel(n,e))return;var t=parseInt(e.unread_cnt,10)||0;var r=parseInt(e.unread_highlight_cnt,10)||0;var i=TS.interop.rules.unreads.useUnreadCountAsMentionCount(n,e)?t:r;TS.model.all_unread_cnt+=t;TS.model.all_unread_highlights_cnt+=i});_.each(TS.model.threads_mention_counts,function(e,t){var n=parseInt(e,10)||0;TS.model.all_unread_highlights_cnt+=n;TS.utility.msgs.maybeExcludeUnreads(TS.redux.channels.getEntityById(t),0,n)});TS.model.threads_has_unreads&&(TS.model.all_unread_cnt+=1)},maybeExcludeUnreads:function e(t,n,r){if(!t)return;if(!n&&!r)return;if(!TS.interop.rules.channels.isOrgShared(t))return;if(TS.interop.rules.channels.shouldSuppressOrgChannel(TS.redux.getState(),t)){TS.model.is_our_app&&TS.has_pri[a]&&TS.log(a,"Excluding unread of "+n+" and highlight of "+r+" for shared channel "+t.id+" because this is NOT the relevant team.");TS.model.all_unread_cnt_to_exclude+=n;TS.model.all_unread_highlights_cnt_to_exclude+=r}else TS.has_pri[a]&&TS.model.is_our_app&&TS.log(a,"Using unread of "+n+" and highlight of "+r+" for shared channel "+t.id+" because this IS the relevant team.")},doesMsgHaveRxnFromUser:function e(t,n){return TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t._rxn_key),n)},doesMsgHaveRxn:function e(t,n){return TS.rxns.doesRxnsHaveRxn(TS.rxns.getExistingRxnsByKey(t._rxn_key),n)},recordEmojiInHash:function e(t,n){if(!t)return false;if(!n)return false;var r=true;var i=TS.utility.findAllTeamEmojiInStr(t,r);if(!i.length)return false;var a=false;var s;for(var o=0;o<i.length;o+=1){s=TS.emoji.isValidName(i[o]);if(!s){TS.error(i[o]+" invalid");continue}parseInt(n[s],10)||(n[s]=0);n[s]+=1;a=true}return a},startBatchUnreadCalc:function t(){if("0"==TS.qs_args.unread_batch)return;e=true},finishBatchUnreadCalc:function t(){e=false;TS.utility.msgs.countAllUnreads()},maybeSetOldestMsgsTsAfterMsgAdded:function e(t){if(t.oldest_msg_ts)return;if(t.latest)return;TS.utility.msgs.setOldestMsgsTs(t)},setOldestMsgsTs:function e(t){var n=TS.utility.msgs.getOldestValidTs(t);if(n){TS.pri&&TS.log(58,"setOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> '+n);t.oldest_msg_ts=n;TS.storage.storeOldestTs(t.id,t.oldest_msg_ts);t._latest_via_users_counts&&(t._latest_via_users_counts=void 0)}},resetOldestMsgsTs:function e(t){TS.pri&&TS.log(58,"resetOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> null');t.oldest_msg_ts=null;TS.storage.storeOldestTs(t.id,null)},getOlderMsgsStatus:function e(t){var n=t.msgs;var r=t.oldest_msg_ts;var i=false;var a="ERROR";var s=false;var o=0;var l;t.msgs.length&&(l=TS.interop.rules.channels.getLatestMsgTs(t)||null);r&&TS.utility.msgs.getMsg(r,n)&&(i=true);if(l)if(i||t.is_limited){s=false;o=3;a="We have the oldest msg: "+r+". is_limited:"+t.is_limited}else{s=true;o=4;a=r?"There are older messages than these. oldest_msg_ts: "+r:"There are older messages than these. oldest_msg_ts: unknown"}else if(n.length){s=false;o=1;a="There are NOT older messages than these."}else{s=false;o=2;a="THIS IS A BRAND NEW CHANNEL SAY SOMETHING"}return{text:a,more:s,code:o,is_limited:t.is_limited}},getMostRecentValidTs:function e(t){if(!t)return null;var n;var r=t.msgs||[];for(var i=0;i<r.length;i+=1){n=r[i];if(!TS.interop.rules.messages.isTempMsg(n)){TS.pri&&i>0&&TS.log(58,"getMostRecentValidTs ("+t.id+"): "+n.ts+" at msgs["+i+"] of "+r.length);return n.ts}}var a=TS.interop.rules.channels.getLatestMsgTs(t)||null;TS.pri&&TS.log(58,"getMostRecentValidTs ("+t.id+"): did not find most recent valid ts. getLatestMsgTs() returned "+a);return a},getOldestValidTs:function e(t){var n;if(!t||!t.msgs)return null;var r=t.msgs.length-1;for(var i=r;i>-1;i-=1){n=t.msgs[i];if(!TS.interop.rules.messages.isTempMsg(n)){TS.pri&&i!==r&&TS.log(58,"getOldestValidTs("+t.id+"): "+n.ts+" at msgs["+i+"] of "+r);return n.ts}}TS.pri&&TS.warn("getOldestValidTs("+t.id+"): none found. msgs.length = "+r);return null},getHistoryFetchJobKey:function e(t,n){var r=t;n&&(r+="_"+n);return r},processImsg:function e(t,n){return TS.interop.messages.preprocessImsg(t,n)},processImsgFromHistory:function e(t,n){var r=TS.interop.messages.preprocessImsg(t,n);t.channel=n;"message_deleted"===t.subtype?TS.ms.msg_handlers.subtype__message_deleted(t):"message_changed"===t.subtype&&TS.ms.msg_handlers.subtype__message_changed(t);return r},maybeFetchUserDataFromLS:function e(t){if(!t){TS.warn("maybeFetchUserDataFromLS: WTF no model_ob?");return}if(r[t.id])return;if(!t.last_msg_input){t.last_msg_input=TS.storage.fetchLastMsgInput(t.id);t.has_draft=!!t.last_msg_input;t.last_msg_input&&TS.has_pri[s]&&TS.log(s,'Got last_msg_input for "'+t.id+'": length = '+(t.last_msg_input.length||"unknown"))}r[t.id]=true},_handleLegacyAttachment:function e(t,n){if(!t){TS.warn("attachment is null!");return}if(t.slack_file_id&&!t._slack_file_is_deleted){var r=TS.files.getFileById(t.slack_file_id);r?t._slack_file=r:t._slack_file&&(t._slack_file=TS.files.upsertFile(t._slack_file,"handleLegacyAttachment").file)}if(t.mrkdwn_in&&_.isArray(t.mrkdwn_in)&&t.mrkdwn_in.length){t.mrkdwn_in_hash={};for(var i=0;i<t.mrkdwn_in.length;i+=1)t.mrkdwn_in_hash[t.mrkdwn_in[i]]=true}t.mrkdwn_in_hash||(t.mrkdwn_in_hash={});delete t.mrkdwn_in;t.hex_swatches=!!t.hex_swatches;(t.audio_html||t.audio_url)&&TS.inline_audios.makeInternalInlineAudio(t.audio_html||t.audio_url,t);if(t.other_html)TS.inline_others.makeInternalInlineOther(t);else if(t.video_html){var a=t.video_html_width&&parseInt(t.video_html_width,10)>parseInt(t.thumb_width,10)?t.video_html_width:t.thumb_width;var s=t.video_html_height&&parseInt(t.video_html_height,10)>parseInt(t.thumb_height,10)?t.video_html_height:t.thumb_height;TS.inline_videos.makeInternalInlineVideo(t.from_url||t.thumb_url,{title:t.title,html:TS.utility.msgs.filterHTMLForEmbeds(t.video_html),thumbnail:{url:t.thumb_url,width:a,height:s,link_url:t.from_url||t.title_url}})}else t.image_url&&TS.inline_imgs.makeInternalInlineImg(t.from_url||t.image_url,{src:t.image_url,width:t.image_width,height:t.image_height,link_url:t.from_url||t.title_url||t.image_url,bytes:t.image_bytes,rotation:t.rotation,content_type:t.content_type});TS.inline_attachments.massageAttachment(t,n);return t},processAttachments:function e(t){if(!t)return;var n;for(var r=0;r<t.length;r+=1){n=t[r];switch(n.type){case"canvas":TS.redux.canvases.addCanvas(n);delete n.content;break;default:TS.utility.msgs._handleLegacyAttachment(n,r)}}},constructMsgPermalink:function e(t,n,r){if(!t)return"";var i;i=_.isString(t)?t:t.id;return TS.interop.rules.messages.constructMsgPermalink(i,n,r)},constructAbsoluteMsgPermalink:function e(t,n,r){var i=TS.boot_data.team_url.slice(0,-1)+TS.utility.msgs.constructMsgPermalink(t,n,r);return i},constructConversationPermalink:function e(t,n){var r;r=_.isString(t)?t:t.id;return"/conversation/"+r+"/p"+n.replace(".","")},shouldMarkUnreadsOnMessageFetch:function e(t){if("1"==TS.qs_args.no_unread_marking_on_msgs_fetch)return false;var n;if(t){n=TS.shared.legacyGetActiveModelOb();if(!n||n.id!==t.id)return false}TS.pri&&n&&TS.log(58,"shouldMarkUnreadsOnMessageFetch: returning TRUE for active model_ob of "+n.id);return true},removeFileSharesAndMentions:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];"file_share"!==i.subtype&&"file_mention"!==i.subtype||!i.file||i.file.id!=n.id||(t.is_mpim?TS.mpims.legacyRemoveMsg(t.id,i):t.is_group?TS.groups.legacyRemoveMsg(t.id,i):t.is_channel?TS.channels.legacyRemoveMsg(t.id,i):TS.ims.legacyRemoveMsg(t.id,i))}},removeFileComments:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];"file_comment"===i.subtype&&i.file&&i.file.id==n.id&&(t.is_mpim?TS.mpims.legacyRemoveMsg(t.id,i):t.is_group?TS.groups.legacyRemoveMsg(t.id,i):t.is_channel?TS.channels.legacyRemoveMsg(t.id,i):TS.ims.legacyRemoveMsg(t.id,i))}},removeFileReferences:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];if(i.attachments){var s=TS.inline_attachments.getAttachmentBySlackFileId(i.attachments,n);if(s&&!s._slack_file_is_deleted){s._slack_file_is_deleted=true;delete s._slack_file;t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,i):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,i):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,i):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,i)}}}},updateFileMsgs:function e(t,n){var r=t.msgs;var i=!(r&&r.length)||TS.model.archive_view_is_showing&&t.is_channel&&false===t.is_member;r=i?t._archive_msgs:r;if(!r||!r.length)return;var a;var s=function e(t){if(!t)return false;if(!t.attachments)return false;if(!t.attachments.length)return false;if(TS.inline_attachments.getAttachmentBySlackFileId(t.attachments,n.id))return true;return false};for(var o=r.length-1;o>-1;o-=1){a=r[o];if(n.is_deleted||"file_share"!==a.subtype&&"file_mention"!==a.subtype&&"file_comment"!==a.subtype||!a.file||a.file.id!=n.id){if(!s(a))continue}else;a.file=_.assign({},n);if(n.is_tombstoned)t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,a):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,a):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,a):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,a);else{if("hosted"===n.mode||"external"===n.mode||"snippet"===n.mode){if(!n.comments.length&&n.is_tombstoned)continue;t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,a):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,a):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,a):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,a)}TS.view.rebuildMsgFile(a,n,i)}}},updateCommentReferences:function e(t){if(!t)return;var n=TS.interop.redux.models.channels.getAllChannels(TS.redux.getState());_.forEach(n,function(e){_.forEach(e.msgs,function(e){if(!e.file||e.file.id!==t.id)return;if(!e.comment)return;var n=_.find(t.comments,{id:e.comment.id});n&&(e.comment=n)})})},maybeTruncateMsgs:function e(t){if(!t)return;if(!t.msgs)return;if(!t.msgs.length)return;if(!TS.model.active_cid||!TS.shared.legacyGetActiveModelOb())return;var n=TS.model.initial_msgs_cnt+1;var r=Math.min(TS.model.hard_msg_limit,2*n);var i=1e3;var a=0;var s=2e4;var o=t.msgs;var l=TS.utility.msgs.getDisplayedMsgs(o);var u=Date.now();var d=t.has_fetched_history_after_scrollback?u-t.fetched_history_after_scrollback_time:u;if(l.length>r&&(t.id!=TS.shared.legacyGetActiveModelOb().id||t.scroll_top<i&&d>s))n=r;else{if(l.length-50<=n)return;if(t.last_made_active){var c=u-t.last_made_active;if(c<a)return}if(-1!=t.scroll_top)return}if(t.history_is_being_fetched)return;var _=[];while(TS.utility.msgs.getDisplayedMsgs(o).length>n)_.push(o.pop());if(t.is_limited){TS.info("Truncated "+t.id+" and reset is_limited");t.is_limited=false}t.id==TS.shared.legacyGetActiveModelOb().id&&TS.view.removeMsgsAfterTruncation(_)},checkForMsgsToTruncate:function e(){if(!TS.model)return;if(!TS.model.channels)return;var t=TS.model.channels;var n;var r;for(r=0;r<t.length;r+=1){n=t[r];if(n.id==TS.model.active_channel_id)continue;if(!n.is_member)continue;if(n.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(n)}var i=TS.model.ims;var a;for(r=0;r<i.length;r+=1){a=i[r];if(a.id==TS.model.active_im_id)continue;TS.utility.msgs.maybeTruncateMsgs(a)}var s=TS.model.groups;var o;for(r=0;r<s.length;r+=1){o=s[r];if(o.id==TS.model.active_group_id)continue;if(o.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(o)}var l=TS.model.mpims;var u;for(r=0;r<l.length;r+=1){u=l[r];if(u.id==TS.model.active_mpim_id)continue;TS.utility.msgs.maybeTruncateMsgs(u)}},getEphemeralMsgsByCidAndType:function e(t,n){var r;var i=[];var a=TS.redux.channels.getEntityById(t);if(!a)return i;i=TS.redux.messages.getMessagesByProp(t,{_ephemeral_type:n});_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,s){if(e.ephemeral_type==n&&e.c_id==t){r=TS.utility.msgs.getMsg(s,a.msgs);if(!r)return;i.push(r)}});return i},removeAllEphemeralMsgsByType:function e(t,n,r){if(!r){var i=TS.redux.messages.getMessagesByProp(n,{_ephemeral_type:t});_.forEach(i,function(e){var t=TS.redux.channels.getEntityById(e.channel);if(!t)return;var n=TS.shared.legacyGetControllerForModelOb(t);n.legacyRemoveMsg(t.id,e)});return}var a;var s;_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,i){if(e.ephemeral_type==t){if(n&&n!=e.c_id)return;if(r&&r!=e.thread_ts)return;a=TS.redux.channels.getEntityById(e.c_id);if(!a)return;s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;a.is_im?TS.ims.legacyRemoveMsg(a.id,s):a.is_mpim?TS.mpims.legacyRemoveMsg(a.id,s):a.is_channel?TS.channels.legacyRemoveMsg(a.id,s):a.is_group&&TS.groups.legacyRemoveMsg(a.id,s);delete TS.utility.msgs.ephemeral_msgs_map[i]}})},hasImgs:function e(t){if(!t)return false;if(t.img_vids)_.forOwn(t.img_vids,function(e){if("img"===e.img_vid_type)return true});else if(t.attachments)for(var n=0;n<t.attachments.length;n+=1)if(t.attachments[n].image_url)return true;return false},ingestMessagesFromBootData:function e(t){if(!TS.boot_data.msgs)return;var n=TS.boot_data.msgs[t.id]||[];var r=TS.interop.messages.preprocessImsgs(n.filter(function(e){return!!e.ts}),t.id);TS.utility.msgs.setMsgs(t,r)},handleSearchHighlights:function e(t){return TS.format.replaceHighlightMarkers(t,'<span class="match">',"</span>")},handleFailedMsgSend:function e(t,n,r){var i=TS.utility.msgs.findMsg(t,n.id);if(i){var a;var s;if(r&&i.thread_ts){a=TS.utility.msgs.findMsg(i.thread_ts,n.id);s=i._was_reply_broadcast}n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,i):n.is_channel?TS.channels.legacyRemoveMsg(n.id,i):n.is_group?TS.groups.legacyRemoveMsg(n.id,i):TS.ims.legacyRemoveMsg(n.id,i);r&&TS.shared.legacySendMsg(n.id,TS.format.unFormatMsg(i.text,i),a,s);delete TS.model.unsent_msgs[i.ts];delete TS.model.display_unsent_msgs[i.ts]}else TS.error("no msg?: "+t)},msgMightBeRolledUp:function e(t){return t.subtype&&-1!=TS.model.join_leave_subtypes.indexOf(t.subtype)},msgRollUpWorker:function e(t,n,r,i){delete n._jl_rollup_hash;delete n._jl_rolled_up_in;if(!TS.utility.msgs.msgMightBeRolledUp(n))return;i.push(n);if(0!==t&&TS.utility.msgs.msgMightBeRolledUp(r[t-1]))return"continue";i[0]._jl_rollup_hash={msg_ids:[],users:{}};var a=i[0]._jl_rollup_hash;var s;for(var o=0;o<i.length;o+=1){s=i[o];a.users[s.user]=a.users[s.user]||{};var l=a.users[s.user];a.msg_ids.push(s.ts);s._jl_rolled_up_in=i[0].ts;if("channel_join"===s.subtype||"group_join"===s.subtype){l.inviter=s.inviter;l.joined=true;l.is_in=true}else if("channel_leave"===s.subtype||"group_leave"===s.subtype){l.left=true;l.is_in=false}}return"swap"},shouldHaveBotLabel:function e(t,n){var r=t.subtype&&("bot_message"===t.subtype||"thread_broadcast"===t.subtype&&t.bot_id)&&"USLACKBOT"!==t.user&&"UTEAMSBOT"!==t.user;var i=n&&n.is_bot&&!TS.interop.rules.members.isSlackbotOrTeambot(n,TS.boot_data.feature_teambot);return r||i},filterHTMLForEmbeds:function e(r){if(!r)return r;var i;var a=new DOMParser;var s=a.parseFromString(r,"text/html")||a.parseFromString(r,"text/xml");var o="";var l;s&&(l=$(s.body));if(!l)return r;if(l){i=l.find(n);i.length&&(o=TS.utility.sanitizeHTML(i.first()[0].outerHTML,t,TS.utility.msgs.allowed_embed_attributes))}a=null;s=null;l=null;i=null;return o},areMsgsSameDay:function e(t,n){var r=TS.interop.datetime.toDateObject(t.ts);var i=TS.interop.datetime.toDateObject(n.ts);return TS.interop.datetime.isSameDay(r,i)},maybeSetPrevLastRead:function e(t,n){if(!t)return;var r=TS.utility.msgs.getMostRecentValidTs(t);n!=r?TS.utility.msgs.setPrevLastRead(t,n):TS.utility.msgs.setPrevLastRead(t,t.last_read)},setPrevLastRead:function e(t,n){if(!t)return;if(t._prev_last_read||!t.unread_cnt||TS.notifs.isCorGMuted(t.id)){var r=TS.utility.msgs.getMostRecentValidTs(t);var i=TS.utility.msgs.getMsg(r,t.msgs);i&&"pinned_item"===i.subtype&&(t._prev_last_read=n)}else t._prev_last_read=n},maybeClearPrevLastRead:function e(t){t=t||TS.shared.legacyGetActiveModelOb();t&&t._prev_last_read&&(t._prev_last_read=void 0)},msgHasReplies:function e(t){if(!t)return false;return t.ts===t.thread_ts&&!!t.reply_count},startUpdatingRelativeTimestamps:function e(t){i.start(t)},stopUpdatingRelativeTimestamps:function e(t){i.stop(t)},extractMsgDisplayContext:function e(t){var n=t.closest("#unread_msgs_div, #sli_briefing");if(n.is("#unread_msgs_div"))return"all_unreads";if(n.is("#sli_briefing"))return"briefing";return null},extractLinkType:function e(t,n,r){if(n.data("member-id")||t.data("member-id"))return"user";if(n.data("channel-id")||t.data("channel-id"))return"channel";if(n.data("file-id")||t.data("file-id"))return"file";if(r&&r.match(/\.slack\.com\/archives\//))return"message";var i=r&&!TS.interop.url.getHostName(r).match(/\.slack\.com/);if(i)return"external";return"internal"},extractLinkItemId:function e(t,n,r){if("user"===r)return n.data("member-id")||t.data("member-id");if("channel"===r)return n.data("channel-id")||t.data("channel-id");if("file"===r)return n.data("file-id")||t.data("file-id");return null},extractLinkAction:function e(t,n){if(n.hasClass("file_preview_action")){if(n.hasClass("file_ssb_download_link"))return"file_ssb_download_link";if(n.hasClass("file_new_window_link"))return"file_new_window_link";if(n.hasClass("file_comment_link"))return"file_comment_link";return"file_preview_action"}if(t.hasClass("file_viewer_external_link"))return"file_viewer_external_link";if(t.hasClass("file_viewer_link"))return"file_viewer_link";if(n.hasClass("file_preview_link"))return"file_preview_link";if(n.hasClass("file_header"))return"file_header";if(n.parent()&&n.parent().hasClass("rest_text_expander"))return"rest_text_expander";return null},extractLinkAttachmentField:function e(t){var n=t.parent();if(t.hasClass("btn_attachment_link"))return"attachment_link_button";if(n.hasClass("attachment_source_icon"))return"attachment_source_icon";if(n.hasClass("attachment_source_name"))return"attachment_source_name";if(n.hasClass("attachment_author_name"))return"attachment_author_name";if(n.hasClass("attachment_title"))return"attachment_title";return null},isRawLink:function e(t,n){if(!t||!n)return false;if(!t.is("a"))return false;var r=n.replace(/(^\w+:|^)\/\//,"");return t.text()===n||t.text()===r},getUnreadMsgTimestampsWithoutHighlights:function e(t){if(!t||!t.unread_cnt)return[];var n=parseFloat(t.last_read);return _.reduce(t.msgs,function(e,r){parseFloat(r.ts)>n&&!TS.client.highlights.msgIsHighlight(t.id,r.ts)&&!TS.client.highlights.isMsgBeingRequested(t.id,r.ts)&&(e[r.ts]=true);return e},{})},legacyReplaceMsg:function e(t,n,r,i){var a=TS.utility.msgs.getMsg(n.ts,t.msgs);!a&&t._archive_msgs&&(a=TS.utility.msgs.getMsg(n.ts,t._archive_msgs));!a&&TS.ui.replies&&(a=TS.ui.replies.getActiveMessage(t,n.ts));!a&&TS.client&&(a=TS.client.threads.getMessage(t,n.ts));!a&&TS.client&&(a=TS.client.unread.getMessage(t,n.ts));if(!a){r||TS.error("unknown msg:"+n.ts+" in "+t.id);return}n._rxn_key=a._rxn_key;n.pinned_to||(n.pinned_to=a.pinned_to);"is_starred"in n||(n.is_starred=a.is_starred);!n.recap&&a.recap&&(n.recap=a.recap);var s=null;if(n.comment&&n.file){var o=TS.files.getFileById(n.file.id);if(o){TS.files.editCommentOnFile(n.comment,o);s=TS.files.getFileCommentById(o,n.comment.id)}}n=TS.interop.messages.preprocessImsg(n,t.id);s&&(n.comment=s);var l=_.union(Object.keys(n),Object.keys(a)).filter(function(e){return n[e]!=a[e]});if(!l.length&&!i){TS.info("Not signalling message change because it doesn't look like anything has changed for "+n.ts+" in "+t.id);return}_.each(_.keys(a),function(e){delete a[e]});_.forOwn(n,function(e,t){a[t]=e});t.is_im?TS.ims.message_changed_sig.dispatch(t,a,l):t.is_group&&t.is_mpim?TS.mpims.message_changed_sig.dispatch(t,a,l):t.is_group&&!t.is_mpim?TS.groups.message_changed_sig.dispatch(t,a,l):t.is_channel&&TS.channels.message_changed_sig.dispatch(t,a,l)},test:function e(){var t={looksLikeUserGroupMarkup:l,tokenizeMessage:o};return t}});var e=false;var t=["video","iframe","source"];var n=t.join(",");var r={};var i=function(){var e=null;var t=[];function n(n){if(_.includes(t,n))return;t.push(n);null===e&&(e=setInterval(i,6e4))}function r(n){_.pull(t,n);if(!t.length){clearInterval(e);e=null}}function i(){_.forEach(t,function(e){$(e).find(".relative_ts").each(function(){var e=$(this).attr("data-ts");var t=$(this).data("really-short");var n=TS.interop.datetime.toTimeAgo(e,{compact:t});n!==$(this).text()&&$(this).text(n)})})}return{start:n,stop:r}}();var a=67;var s=667;var o=function e(t){var n=t.text;var r=TS.format.calculateOptions(t);var i=TSF.getTokensArray($.trim(n),r.tsf_mode,{jumbomoji:!r.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});return i};var l=function e(t){return 0===t.indexOf("<")&&0===t.indexOf("<!subteam")}})()},328:function(e,t,n){n(148);n(125);e.exports=n(329)},329:function(e,t,n){var r=n(192);var i=n(43)("iterator");var a=n(80);e.exports=n(52).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||a.hasOwnProperty(r(t))}},330:function(e,t,n){n(148);n(125);e.exports=n(331)},331:function(e,t,n){var r=n(71);var i=n(215);e.exports=n(52).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},40:function(e,t,n){"use strict";t.__esModule=true;var r=n(275);var i=l(r);var a=n(288);var s=l(a);var o="function"===typeof s.default&&"symbol"===typeof i.default?function(e){return typeof e}:function(e){return e&&"function"===typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":typeof e};function l(e){return e&&e.__esModule?e:{default:e}}t.default="function"===typeof s.default&&"symbol"===o(i.default)?function(e){return"undefined"===typeof e?"undefined":o(e)}:function(e){return e&&"function"===typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":"undefined"===typeof e?"undefined":o(e)}},412:function(e,t,n){e.exports={default:n(434),__esModule:true}},43:function(e,t,n){var r=n(109)("wks");var i=n(91);var a=n(46).Symbol;var s="function"==typeof a;var o=e.exports=function(e){return r[e]||(r[e]=s&&a[e]||(s?a:i)("Symbol."+e))};o.store=r},434:function(e,t,n){n(125);n(435);e.exports=n(52).Array.from},435:function(e,t,n){"use strict";var r=n(146);var i=n(86);var a=n(120);var s=n(436);var o=n(437);var l=n(154);var u=n(438);var d=n(215);i(i.S+i.F*!n(439)(function(e){Array.from(e)}),"Array",{from:function e(t){var n=a(t);var i="function"==typeof this?this:Array;var c=arguments.length;var _=c>1?arguments[1]:void 0;var m=void 0!==_;var f=0;var p=d(n);var h,g,S,T;m&&(_=r(_,c>2?arguments[2]:void 0,2));if(void 0==p||i==Array&&o(p)){h=l(n.length);for(g=new i(h);h>f;f++)u(g,f,m?_(n[f],f):n[f])}else for(T=p.call(n),g=new i;!(S=T.next()).done;f++)u(g,f,m?s(T,_,[S.value,f],true):S.value);g.length=f;return g}})},436:function(e,t,n){var r=n(71);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e["return"];void 0!==a&&r(a.call(e));throw t}}},437:function(e,t,n){var r=n(80);var i=n(43)("iterator");var a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},438:function(e,t,n){"use strict";var r=n(58);var i=n(83);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},439:function(e,t,n){var r=n(43)("iterator");var i=false;try{var a=[7][r]();a["return"]=function(){i=true};Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return false;var n=false;try{var a=[7];var s=a[r]();s.next=function(){return{done:n=true}};a[r]=function(){return s};e(a)}catch(e){}return n}},46:function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},52:function(e,t){var n=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},56:function(e,t,n){e.exports=!n(73)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},58:function(e,t,n){var r=n(71);var i=n(136);var a=n(115);var s=Object.defineProperty;t.f=n(56)?Object.defineProperty:function e(t,n,o){r(t);n=a(n,true);r(o);if(i)try{return s(t,n,o)}catch(e){}if("get"in o||"set"in o)throw TypeError("Accessors not supported!");"value"in o&&(t[n]=o.value);return t}},60:function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},64:function(e,t,n){var r=n(58);var i=n(83);e.exports=n(56)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){e[t]=n;return e}},66:function(e,t,n){var r=n(133);var i=n(96);e.exports=function(e){return r(i(e))}},67:function(e,t,n){"use strict";t.__esModule=true;var r=n(327);var i=o(r);var a=n(296);var s=o(a);function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(e,t){var n=[];var r=true;var i=false;var a=void 0;try{for(var o=(0,s.default)(e),l;!(r=(l=o.next()).done);r=true){n.push(l.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,i.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},68:function(e,t){e.exports=function(e){return"object"===typeof e?null!==e:"function"===typeof e}},71:function(e,t,n){var r=n(68);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},73:function(e,t){e.exports=function(e){try{return!!e()}catch(e){return true}}},80:function(e,t){e.exports={}},83:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},86:function(e,t,n){var r=n(46);var i=n(52);var a=n(146);var s=n(64);var o="prototype";var l=function(e,t,n){var u=e&l.F;var d=e&l.G;var c=e&l.S;var _=e&l.P;var m=e&l.B;var f=e&l.W;var p=d?i:i[t]||(i[t]={});var h=p[o];var g=d?r:c?r[t]:(r[t]||{})[o];var S,T,v;d&&(n=t);for(S in n){T=!u&&g&&void 0!==g[S];if(T&&S in p)continue;v=T?g[S]:n[S];p[S]=d&&"function"!=typeof g[S]?n[S]:m&&T?a(v,r):f&&g[S]==v?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};t[o]=e[o];return t}(v):_&&"function"==typeof v?a(Function.call,v):v;if(_){(p.virtual||(p.virtual={}))[S]=v;e&l.R&&h&&!h[S]&&s(h,S,v)}}};l.F=1;l.G=2;l.S=4;l.P=8;l.B=16;l.W=32;l.U=64;l.R=128;e.exports=l},91:function(e,t){var n=0;var r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},95:function(e,t){var n=Math.ceil;var r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},96:function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},98:function(e,t,n){var r=n(137);var i=n(110);e.exports=Object.keys||function e(t){return r(t,i)}}},[[2962,0]]]);